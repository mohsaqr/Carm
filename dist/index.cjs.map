{
  "version": 3,
  "sources": ["../src/index.ts", "../src/core/matrix.ts", "../src/core/math.ts", "../src/core/apa.ts", "../src/core/prng.ts", "../src/stats/descriptive.ts", "../src/stats/effect-size.ts", "../src/stats/frequency.ts", "../src/stats/regression.ts", "../src/stats/comparison.ts", "../src/stats/post-hoc.ts", "../src/stats/correlation.ts", "../src/stats/preprocess.ts", "../src/stats/pca.ts", "../src/stats/mixed.ts", "../src/stats/analyze.ts", "../src/stats/clustering.ts", "../src/stats/factor-analysis.ts", "../src/stats/bootstrap.ts", "../src/viz/themes/default.ts", "../src/viz/components/tooltip.ts", "../src/viz/components/annotations.ts", "../src/viz/components/brackets.ts", "../src/viz/components/axis.ts", "../src/viz/plots/violin-box.ts", "../src/viz/plots/scatter-stats.ts", "../src/viz/plots/histogram.ts", "../src/viz/plots/bar-stats.ts", "../src/viz/plots/correlogram.ts", "../src/viz/plots/coef-plot.ts", "../src/viz/plots/qq-plot.ts", "../src/viz/plots/residual-panel.ts", "../src/viz/plots/raincloud.ts", "../src/viz/plots/mixed-plot.ts", "../src/viz/plots/pca-plot.ts", "../src/viz/plots/distribution.ts", "../src/viz/plots/density.ts", "../src/viz/plots/boxplot.ts", "../src/viz/plots/lollipop.ts", "../src/viz/plots/dot-plot.ts", "../src/viz/plots/grouped-bar.ts", "../src/viz/plots/line-chart.ts", "../src/viz/plots/bubble-chart.ts", "../src/viz/plots/pareto.ts", "../src/viz/plots/funnel.ts", "../src/viz/plots/pie-chart.ts", "../src/viz/plots/area-chart.ts", "../src/viz/plots/forest-plot.ts", "../src/viz/plots/roc-curve.ts", "../src/viz/plots/strip-plot.ts", "../src/viz/plots/swarm-plot.ts", "../src/viz/plots/mosaic-plot.ts", "../src/viz/plots/pair-plot.ts", "../src/viz/plots/radar-chart.ts", "../src/viz/plots/parallel-coords.ts", "../src/viz/plots/treemap.ts", "../src/viz/plots/waffle-chart.ts", "../src/viz/plots/sparkline.ts", "../src/viz/plots/sunburst.ts", "../src/viz/plots/marimekko.ts", "../src/viz/plots/chord-diagram.ts", "../src/viz/plots/arc-diagram.ts", "../src/viz/plots/alluvial-plot.ts", "../src/viz/plots/edge-bundling.ts", "../src/viz/plots/dendrogram.ts", "../src/viz/plots/fa-plot.ts", "../src/viz/export.ts"],
  "sourcesContent": ["/**\n * Carm \u2014 Statistical analysis and visualization for TypeScript/JavaScript.\n *\n * Usage:\n *   import { describe, tTestIndependent, renderViolinBox } from 'carm'\n *   import { runLMM } from 'carm/stats'\n *   import { renderCorrelogram } from 'carm/viz'\n */\n\n// Core: types, matrix, math utilities, APA formatting\nexport * from './core/index.js'\n\n// Stats: all statistical computation modules\nexport * from './stats/index.js'\n\n// Viz: all D3 plot renderers\nexport * from './viz/index.js'\n", "/**\n * Matrix class for Carm.\n * Implements multiply, transpose, inverse (via Cholesky or LU), log-determinant, and SVD.\n * Pure computation \u2014 no DOM, no D3, no side effects.\n */\n\nexport class Matrix {\n  readonly rows: number\n  readonly cols: number\n  private readonly _data: readonly number[]  // row-major flat array\n\n  constructor(rows: number, cols: number, data?: readonly number[]) {\n    this.rows = rows\n    this.cols = cols\n    this._data = data ?? new Array<number>(rows * cols).fill(0)\n    if (this._data.length !== rows * cols) {\n      throw new Error(`Matrix data length ${this._data.length} does not match ${rows}\u00D7${cols}`)\n    }\n  }\n\n  /** Build from 2-D array (row-major). */\n  static fromArray(arr: readonly (readonly number[])[]): Matrix {\n    const rows = arr.length\n    if (rows === 0) throw new Error('Matrix cannot have 0 rows')\n    const cols = arr[0]!.length\n    const data: number[] = []\n    for (const row of arr) {\n      if (row.length !== cols) throw new Error('All rows must have equal length')\n      for (const v of row) data.push(v)\n    }\n    return new Matrix(rows, cols, data)\n  }\n\n  /** Identity matrix of size n. */\n  static identity(n: number): Matrix {\n    const data = new Array<number>(n * n).fill(0)\n    for (let i = 0; i < n; i++) data[i * n + i] = 1\n    return new Matrix(n, n, data)\n  }\n\n  /** Zero matrix. */\n  static zeros(rows: number, cols: number): Matrix {\n    return new Matrix(rows, cols, new Array<number>(rows * cols).fill(0))\n  }\n\n  /** Get element at (i, j) \u2014 0-indexed. */\n  get(i: number, j: number): number {\n    const v = this._data[i * this.cols + j]\n    if (v === undefined) throw new Error(`Index (${i},${j}) out of bounds for ${this.rows}\u00D7${this.cols}`)\n    return v\n  }\n\n  /** Return 2-D array representation. */\n  toArray(): number[][] {\n    return Array.from({ length: this.rows }, (_, i) =>\n      Array.from({ length: this.cols }, (_, j) => this.get(i, j))\n    )\n  }\n\n  /** Return flat row-major copy. */\n  toFlat(): number[] {\n    return [...this._data]\n  }\n\n  /** Matrix transpose. */\n  transpose(): Matrix {\n    const data: number[] = new Array(this.rows * this.cols)\n    for (let i = 0; i < this.rows; i++) {\n      for (let j = 0; j < this.cols; j++) {\n        data[j * this.rows + i] = this.get(i, j)\n      }\n    }\n    return new Matrix(this.cols, this.rows, data)\n  }\n\n  /** Matrix multiplication: this \u00D7 other. */\n  multiply(other: Matrix): Matrix {\n    if (this.cols !== other.rows) {\n      throw new Error(`Dimension mismatch: ${this.rows}\u00D7${this.cols} \u00D7 ${other.rows}\u00D7${other.cols}`)\n    }\n    const data: number[] = new Array(this.rows * other.cols).fill(0)\n    for (let i = 0; i < this.rows; i++) {\n      for (let k = 0; k < this.cols; k++) {\n        const aik = this.get(i, k)\n        for (let j = 0; j < other.cols; j++) {\n          data[i * other.cols + j]! += aik * other.get(k, j)\n        }\n      }\n    }\n    return new Matrix(this.rows, other.cols, data)\n  }\n\n  /** Scalar multiplication. */\n  scale(s: number): Matrix {\n    return new Matrix(this.rows, this.cols, this._data.map(v => v * s))\n  }\n\n  /** Element-wise add. */\n  add(other: Matrix): Matrix {\n    if (this.rows !== other.rows || this.cols !== other.cols) {\n      throw new Error('Matrix dimensions must match for addition')\n    }\n    return new Matrix(this.rows, this.cols, this._data.map((v, i) => v + (other._data[i] ?? 0)))\n  }\n\n  /** Element-wise subtract. */\n  subtract(other: Matrix): Matrix {\n    if (this.rows !== other.rows || this.cols !== other.cols) {\n      throw new Error('Matrix dimensions must match for subtraction')\n    }\n    return new Matrix(this.rows, this.cols, this._data.map((v, i) => v - (other._data[i] ?? 0)))\n  }\n\n  /**\n   * Cholesky decomposition for symmetric positive-definite matrices.\n   * Returns lower-triangular L such that this = L * L^T.\n   * Throws if matrix is not SPD.\n   */\n  cholesky(): Matrix {\n    if (this.rows !== this.cols) throw new Error('Cholesky requires square matrix')\n    const n = this.rows\n    const L: number[] = new Array(n * n).fill(0)\n\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j <= i; j++) {\n        let sum = this.get(i, j)\n        for (let k = 0; k < j; k++) {\n          sum -= (L[i * n + k] ?? 0) * (L[j * n + k] ?? 0)\n        }\n        if (i === j) {\n          if (sum <= 0) throw new Error(`Matrix is not positive definite (diagonal became ${sum} at position ${i})`)\n          L[i * n + j] = Math.sqrt(sum)\n        } else {\n          const diag = L[j * n + j]\n          if (!diag || diag === 0) throw new Error('Zero diagonal in Cholesky')\n          L[i * n + j] = sum / diag\n        }\n      }\n    }\n    return new Matrix(n, n, L)\n  }\n\n  /**\n   * Log-determinant via Cholesky: log|A| = 2 * \u03A3 log(L_ii).\n   * Only valid for symmetric positive-definite matrices.\n   */\n  logDet(): number {\n    const L = this.cholesky()\n    let logdet = 0\n    for (let i = 0; i < this.rows; i++) {\n      const diag = L.get(i, i)\n      if (diag <= 0) throw new Error('Non-positive diagonal in Cholesky')\n      logdet += Math.log(diag)\n    }\n    return 2 * logdet\n  }\n\n  /**\n   * Inverse via LU decomposition with partial pivoting.\n   * Works for any non-singular square matrix.\n   * Formula: Doolittle LU, then forward/back substitution for each column of I.\n   */\n  inverse(): Matrix {\n    if (this.rows !== this.cols) throw new Error('Inverse requires square matrix')\n    const n = this.rows\n    // Build augmented matrix [A | I]\n    const aug: number[] = new Array(n * 2 * n)\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < n; j++) {\n        aug[i * 2 * n + j] = this.get(i, j)\n        aug[i * 2 * n + n + j] = i === j ? 1 : 0\n      }\n    }\n\n    // Gaussian elimination with partial pivoting\n    for (let col = 0; col < n; col++) {\n      // Find pivot\n      let maxRow = col\n      let maxVal = Math.abs(aug[col * 2 * n + col] ?? 0)\n      for (let row = col + 1; row < n; row++) {\n        const v = Math.abs(aug[row * 2 * n + col] ?? 0)\n        if (v > maxVal) { maxVal = v; maxRow = row }\n      }\n      if (maxVal < 1e-12) throw new Error('Matrix is singular or near-singular')\n\n      // Swap rows\n      if (maxRow !== col) {\n        for (let j = 0; j < 2 * n; j++) {\n          const tmp = aug[col * 2 * n + j] ?? 0\n          aug[col * 2 * n + j] = aug[maxRow * 2 * n + j] ?? 0\n          aug[maxRow * 2 * n + j] = tmp\n        }\n      }\n\n      const pivot = aug[col * 2 * n + col] ?? 0\n      // Eliminate below\n      for (let row = 0; row < n; row++) {\n        if (row === col) continue\n        const factor = (aug[row * 2 * n + col] ?? 0) / pivot\n        for (let j = 0; j < 2 * n; j++) {\n          aug[row * 2 * n + j]! -= factor * (aug[col * 2 * n + j] ?? 0)\n        }\n      }\n      // Scale pivot row\n      for (let j = 0; j < 2 * n; j++) {\n        aug[col * 2 * n + j]! /= pivot\n      }\n    }\n\n    // Extract right half (inverse)\n    const inv: number[] = new Array(n * n)\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < n; j++) {\n        inv[i * n + j] = aug[i * 2 * n + n + j] ?? 0\n      }\n    }\n    return new Matrix(n, n, inv)\n  }\n\n  /**\n   * Singular Value Decomposition: A = U \u00B7 S \u00B7 V^T\n   * Returns { U, S (diagonal values), V }.\n   * Algorithm: Golub-Reinsch (one-sided Jacobi for small matrices).\n   * Reference: Golub & Van Loan, \"Matrix Computations\", 4th ed., Algorithm 8.6.2\n   */\n  svd(): { U: Matrix; S: number[]; V: Matrix } {\n    // Use Jacobi one-sided SVD\n    const m = this.rows\n    const n = this.cols\n    // Work on a copy of A as column matrix V^T = I\n    const a = this.toArray()\n    const v: number[][] = Array.from({ length: n }, (_, i) =>\n      Array.from({ length: n }, (_, j) => (i === j ? 1 : 0))\n    )\n\n    const MAX_ITER = 200 * n * n\n    for (let iter = 0; iter < MAX_ITER; iter++) {\n      let converged = true\n      for (let p = 0; p < n - 1; p++) {\n        for (let q = p + 1; q < n; q++) {\n          // Compute alpha, beta, gamma for Jacobi rotation\n          let alpha = 0, beta = 0, gamma = 0\n          for (let i = 0; i < m; i++) {\n            alpha += (a[i]![p] ?? 0) ** 2\n            beta  += (a[i]![q] ?? 0) ** 2\n            gamma += (a[i]![p] ?? 0) * (a[i]![q] ?? 0)\n          }\n          if (Math.abs(gamma) < 1e-15 * Math.sqrt(alpha * beta)) continue\n          converged = false\n          const zeta = (beta - alpha) / (2 * gamma)\n          const t = Math.sign(zeta) / (Math.abs(zeta) + Math.sqrt(1 + zeta * zeta))\n          const c = 1 / Math.sqrt(1 + t * t)\n          const s = t * c\n\n          // Update columns p and q of a\n          for (let i = 0; i < m; i++) {\n            const ap = a[i]![p] ?? 0\n            const aq = a[i]![q] ?? 0\n            a[i]![p] = c * ap + s * aq\n            a[i]![q] = -s * ap + c * aq\n          }\n          // Update V\n          for (let i = 0; i < n; i++) {\n            const vp = v[i]![p] ?? 0\n            const vq = v[i]![q] ?? 0\n            v[i]![p] = c * vp + s * vq\n            v[i]![q] = -s * vp + c * vq\n          }\n        }\n      }\n      if (converged) break\n    }\n\n    // Compute singular values and normalize columns of a \u2192 U\n    const singularValues = Array.from({ length: n }, (_, j) => {\n      let sum = 0\n      for (let i = 0; i < m; i++) sum += (a[i]![j] ?? 0) ** 2\n      return Math.sqrt(sum)\n    })\n\n    // Build U (m\u00D7n), normalize each column\n    const uData: number[][] = Array.from({ length: m }, () => new Array<number>(n).fill(0))\n    for (let j = 0; j < n; j++) {\n      const sv = singularValues[j] ?? 0\n      for (let i = 0; i < m; i++) {\n        uData[i]![j] = sv > 1e-15 ? (a[i]![j] ?? 0) / sv : 0\n      }\n    }\n\n    // Sort by descending singular value, truncate to k = min(m, n)\n    const order = singularValues.map((_, i) => i).sort((a, b) => (singularValues[b] ?? 0) - (singularValues[a] ?? 0))\n    const k = Math.min(m, n)\n    const S = order.slice(0, k).map(i => singularValues[i] ?? 0)\n    const Uarr: number[][] = Array.from({ length: m }, (_, i) => order.slice(0, k).map(j => uData[i]![j] ?? 0))\n    const Varr: number[][] = Array.from({ length: n }, (_, i) => order.slice(0, k).map(j => v[i]![j] ?? 0))\n\n    return {\n      U: Matrix.fromArray(Uarr),\n      S,\n      V: Matrix.fromArray(Varr),\n    }\n  }\n\n  /**\n   * Pseudo-inverse via SVD: A+ = V \u00B7 S^{-1} \u00B7 U^T\n   */\n  pseudoInverse(tol = 1e-10): Matrix {\n    const { U, S, V } = this.svd()\n    const maxS = Math.max(...S)\n    const threshold = tol * maxS\n    const SInv = S.map(s => (s > threshold ? 1 / s : 0))\n\n    // V * diag(SInv)\n    const VSInv = Matrix.fromArray(\n      Array.from({ length: V.rows }, (_, i) =>\n        Array.from({ length: V.cols }, (_, j) => V.get(i, j) * (SInv[j] ?? 0))\n      )\n    )\n    return VSInv.multiply(U.transpose())\n  }\n\n  /** Trace (sum of diagonal elements). */\n  trace(): number {\n    const n = Math.min(this.rows, this.cols)\n    let t = 0\n    for (let i = 0; i < n; i++) t += this.get(i, i)\n    return t\n  }\n\n  /** Extract diagonal as array. */\n  diagonal(): number[] {\n    const n = Math.min(this.rows, this.cols)\n    return Array.from({ length: n }, (_, i) => this.get(i, i))\n  }\n\n  /** Column vector as Matrix from array. */\n  static colVec(data: readonly number[]): Matrix {\n    return new Matrix(data.length, 1, [...data])\n  }\n\n  /** Row vector as Matrix from array. */\n  static rowVec(data: readonly number[]): Matrix {\n    return new Matrix(1, data.length, [...data])\n  }\n\n  /**\n   * Eigendecomposition for symmetric matrices via Jacobi iterations.\n   * Returns { values, vectors } where vectors are columns of the eigenvector matrix.\n   * Reference: Golub & Van Loan, Algorithm 8.4.1\n   */\n  eigen(): { values: number[]; vectors: Matrix } {\n    if (this.rows !== this.cols) throw new Error('eigen() requires square matrix')\n    const n = this.rows\n    const a = this.toArray()\n    const q: number[][] = Array.from({ length: n }, (_, i) =>\n      Array.from({ length: n }, (_, j) => (i === j ? 1 : 0))\n    )\n\n    for (let iter = 0; iter < 100 * n * n; iter++) {\n      // Find largest off-diagonal element\n      let p = 0, r = 1\n      let maxVal = Math.abs(a[0]![1] ?? 0)\n      for (let i = 0; i < n; i++) {\n        for (let j = i + 1; j < n; j++) {\n          if (Math.abs(a[i]![j] ?? 0) > maxVal) {\n            maxVal = Math.abs(a[i]![j] ?? 0)\n            p = i; r = j\n          }\n        }\n      }\n      if (maxVal < 1e-12) break\n\n      const app = a[p]![p] ?? 0, arr = a[r]![r] ?? 0, apr = a[p]![r] ?? 0\n      const theta = 0.5 * Math.atan2(2 * apr, app - arr)\n      const c = Math.cos(theta), s = Math.sin(theta)\n\n      // Update a\n      const newApp = c * c * app + 2 * s * c * apr + s * s * arr\n      const newArr = s * s * app - 2 * s * c * apr + c * c * arr\n      a[p]![p] = newApp; a[r]![r] = newArr; a[p]![r] = 0; a[r]![p] = 0\n\n      for (let i = 0; i < n; i++) {\n        if (i === p || i === r) continue\n        const aip = a[i]![p] ?? 0, air = a[i]![r] ?? 0\n        a[i]![p] = c * aip + s * air\n        a[p]![i] = a[i]![p]!\n        a[i]![r] = -s * aip + c * air\n        a[r]![i] = a[i]![r]!\n      }\n\n      // Update eigenvectors\n      for (let i = 0; i < n; i++) {\n        const qip = q[i]![p] ?? 0, qir = q[i]![r] ?? 0\n        q[i]![p] = c * qip + s * qir\n        q[i]![r] = -s * qip + c * qir\n      }\n    }\n\n    const values = Array.from({ length: n }, (_, i) => a[i]![i] ?? 0)\n    // Sort descending\n    const order = values.map((_, i) => i).sort((a, b) => values[b]! - values[a]!)\n    return {\n      values: order.map(i => values[i]!),\n      vectors: Matrix.fromArray(Array.from({ length: n }, (_, i) => order.map(j => q[i]![j] ?? 0))),\n    }\n  }\n}\n\n/** Solve linear system A\u00B7x = b using the (already computed) inverse.  */\nexport function solveLinear(A: Matrix, b: readonly number[]): number[] {\n  const inv = A.inverse()\n  const x = inv.multiply(Matrix.colVec(b))\n  return Array.from({ length: b.length }, (_, i) => x.get(i, 0))\n}\n", "/**\n * Core mathematical utilities for Carm.\n * Beta/Gamma functions, Nelder-Mead optimizer, p-value adjustment.\n * All pure functions \u2014 no DOM, no side effects.\n */\n\nimport type { PAdjMethod } from './types.js'\n\n// \u2500\u2500\u2500 Gamma / Beta functions \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Natural log of the Gamma function via Lanczos approximation.\n * Reference: Press et al., \"Numerical Recipes in C\", 3rd ed., \u00A76.1\n */\nexport function logGamma(z: number): number {\n  if (z <= 0) throw new Error(`logGamma: z must be positive, got ${z}`)\n  if (z < 0.5) {\n    // Reflection formula: \u0393(z)\u0393(1-z) = \u03C0/sin(\u03C0z)\n    return Math.log(Math.PI / Math.sin(Math.PI * z)) - logGamma(1 - z)\n  }\n  const g = 7\n  const c = [\n    0.99999999999980993,\n    676.5203681218851,\n    -1259.1392167224028,\n    771.32342877765313,\n    -176.61502916214059,\n    12.507343278686905,\n    -0.13857109526572012,\n    9.9843695780195716e-6,\n    1.5056327351493116e-7,\n  ]\n  const x = z - 1\n  let sum = c[0]!\n  for (let i = 1; i < g + 2; i++) sum += (c[i] ?? 0) / (x + i)\n  const t = x + g + 0.5\n  return 0.5 * Math.log(2 * Math.PI) + (x + 0.5) * Math.log(t) - t + Math.log(sum)\n}\n\n/** Gamma function. */\nexport function gamma(z: number): number {\n  return Math.exp(logGamma(z))\n}\n\n/**\n * Digamma function \u03C8(x) = d/dx ln \u0393(x).\n * Asymptotic series for x \u2265 8, recurrence \u03C8(x) = \u03C8(x+1) - 1/x for small x.\n * Reference: Abramowitz & Stegun \u00A76.3.18\n */\nexport function digamma(x: number): number {\n  if (x <= 0 && x === Math.floor(x)) return NaN  // poles at non-positive integers\n  // Reflection formula for x < 0: \u03C8(x) = \u03C8(1-x) - \u03C0/tan(\u03C0x)\n  if (x < 0) return digamma(1 - x) - Math.PI / Math.tan(Math.PI * x)\n  // Recurrence to shift x \u2265 8\n  let result = 0\n  let z = x\n  while (z < 8) {\n    result -= 1 / z\n    z += 1\n  }\n  // Asymptotic series: \u03C8(z) \u2248 ln(z) - 1/(2z) - \u03A3 B_{2k}/(2k\u00B7z^{2k})\n  // Bernoulli numbers: B2=1/6, B4=-1/30, B6=1/42, B8=-1/30, B10=5/66, B12=-691/2730\n  const z2 = 1 / (z * z)\n  result += Math.log(z) - 0.5 / z\n    - z2 * (1 / 12 - z2 * (1 / 120 - z2 * (1 / 252 - z2 * (1 / 240 - z2 * (5 / 660 - z2 * 691 / 32760)))))\n  return result\n}\n\n/**\n * Trigamma function \u03C8'(x) = d\u00B2/dx\u00B2 ln \u0393(x).\n * Asymptotic series for x \u2265 8, recurrence \u03C8'(x) = \u03C8'(x+1) + 1/x\u00B2 for small x.\n * Reference: Abramowitz & Stegun \u00A76.4.12\n *\n * Asymptotic: \u03C8'(z) = 1/z + 1/(2z\u00B2) + 1/(6z\u00B3) - 1/(30z\u2075) + 1/(42z\u2077) - 1/(30z\u2079) + ...\n *           = 1/z + 1/(2z\u00B2) + (1/z\u00B3)\u00B7[1/6 - (1/z\u00B2)\u00B7(1/30 - (1/z\u00B2)\u00B7(1/42 - ...))]\n */\nexport function trigamma(x: number): number {\n  if (x <= 0 && x === Math.floor(x)) return NaN\n  if (x < 0) {\n    const piX = Math.PI * x\n    const sinPiX = Math.sin(piX)\n    return -(Math.PI * Math.PI) / (sinPiX * sinPiX) + trigamma(1 - x)\n  }\n  let result = 0\n  let z = x\n  while (z < 8) {\n    result += 1 / (z * z)\n    z += 1\n  }\n  const iz = 1 / z\n  const iz2 = iz * iz\n  // \u03C8'(z) = 1/z + 1/(2z\u00B2) + 1/(6z\u00B3) - 1/(30z\u2075) + 1/(42z\u2077) - 1/(30z\u2079) + 5/(66z\u00B9\u00B9) - 691/(2730z\u00B9\u00B3)\n  result += iz + iz2 / 2\n    + iz2 * iz * (1 / 6 - iz2 * (1 / 30 - iz2 * (1 / 42 - iz2 * (1 / 30 - iz2 * (5 / 66 - iz2 * 691 / 2730)))))\n  return result\n}\n\n/** Log of Beta function: log B(a, b) = log\u0393(a) + log\u0393(b) - log\u0393(a+b). */\nexport function logBeta(a: number, b: number): number {\n  return logGamma(a) + logGamma(b) - logGamma(a + b)\n}\n\n/** Beta function. */\nexport function betaFn(a: number, b: number): number {\n  return Math.exp(logBeta(a, b))\n}\n\n/**\n * Regularized incomplete beta function I_x(a, b) via continued fraction.\n * Used for t, F, and beta distribution CDFs.\n * Reference: Press et al., \u00A76.4 (Lentz continued fraction algorithm)\n */\nexport function incompleteBeta(x: number, a: number, b: number): number {\n  if (x < 0 || x > 1) throw new Error(`incompleteBeta: x must be in [0,1], got ${x}`)\n  if (x === 0) return 0\n  if (x === 1) return 1\n\n  // Use symmetry when x > (a+1)/(a+b+2) for faster convergence\n  if (x > (a + 1) / (a + b + 2)) {\n    return 1 - incompleteBeta(1 - x, b, a)\n  }\n\n  const lbeta_ab = logBeta(a, b)\n  const front = Math.exp(Math.log(x) * a + Math.log(1 - x) * b - lbeta_ab) / a\n\n  // Lentz continued fraction\n  const MAX_ITER = 200\n  const EPS = 3e-7\n  const FPMIN = 1e-30\n\n  let f = 1\n  let C = 1\n  let D = 1 - (a + b) * x / (a + 1)\n  if (Math.abs(D) < FPMIN) D = FPMIN\n  D = 1 / D\n  f = D\n\n  for (let m = 1; m <= MAX_ITER; m++) {\n    // Even step\n    let num = m * (b - m) * x / ((a + 2 * m - 1) * (a + 2 * m))\n    D = 1 + num * D\n    if (Math.abs(D) < FPMIN) D = FPMIN\n    C = 1 + num / C\n    if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D\n    f *= C * D\n\n    // Odd step\n    num = -(a + m) * (a + b + m) * x / ((a + 2 * m) * (a + 2 * m + 1))\n    D = 1 + num * D\n    if (Math.abs(D) < FPMIN) D = FPMIN\n    C = 1 + num / C\n    if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D\n    const delta = C * D\n    f *= delta\n\n    if (Math.abs(delta - 1) < EPS) break\n  }\n  return front * f\n}\n\n/**\n * Regularized incomplete gamma function P(a, x) via series expansion.\n * Used for chi-square and Poisson CDFs.\n * Reference: Press et al., \u00A76.2\n */\nexport function incompleteGamma(a: number, x: number): number {\n  if (x < 0) throw new Error(`incompleteGamma: x must be \u2265 0, got ${x}`)\n  if (x === 0) return 0\n\n  if (x < a + 1) {\n    // Series representation\n    let term = 1 / a\n    let sum = term\n    for (let n = 1; n < 200; n++) {\n      term *= x / (a + n)\n      sum += term\n      if (Math.abs(term) < Math.abs(sum) * 3e-7) break\n    }\n    return sum * Math.exp(-x + a * Math.log(x) - logGamma(a))\n  } else {\n    // Continued fraction (complement)\n    return 1 - incompleteGammaComplement(a, x)\n  }\n}\n\nfunction incompleteGammaComplement(a: number, x: number): number {\n  // Lentz continued fraction for Q(a,x)\n  const FPMIN = 1e-30\n  let f = x + 1 - a\n  if (Math.abs(f) < FPMIN) f = FPMIN\n  let C = f, D = 0\n  for (let i = 1; i <= 200; i++) {\n    const an = -i * (i - a)\n    const bn = x + 2 * i + 1 - a\n    D = bn + an * D\n    if (Math.abs(D) < FPMIN) D = FPMIN\n    C = bn + an / C\n    if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D\n    const delta = C * D\n    f *= delta\n    if (Math.abs(delta - 1) < 3e-7) break\n  }\n  return Math.exp(-x + a * Math.log(x) - logGamma(a)) / f\n}\n\n// \u2500\u2500\u2500 t-distribution CDF \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Two-tailed p-value from t statistic with df degrees of freedom. */\nexport function tDistPValue(t: number, df: number): number {\n  const x = df / (df + t * t)\n  const p = incompleteBeta(x, df / 2, 0.5)\n  return p  // already two-tailed\n}\n\n/** CDF of t-distribution P(T \u2264 t | df). */\nexport function tDistCDF(t: number, df: number): number {\n  const x = df / (df + t * t)\n  const p = 0.5 * incompleteBeta(x, df / 2, 0.5)\n  return t >= 0 ? 1 - p : p\n}\n\n/** Quantile (inverse CDF) of t-distribution. Uses bisection. */\nexport function tDistQuantile(p: number, df: number): number {\n  if (p <= 0 || p >= 1) throw new Error(`tDistQuantile: p must be in (0,1), got ${p}`)\n  // Bisection on CDF\n  let lo = -50, hi = 50\n  for (let i = 0; i < 100; i++) {\n    const mid = (lo + hi) / 2\n    if (tDistCDF(mid, df) < p) lo = mid\n    else hi = mid\n    if (hi - lo < 1e-10) break\n  }\n  return (lo + hi) / 2\n}\n\n// \u2500\u2500\u2500 F-distribution CDF \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** P(F \u2264 f | df1, df2) via regularized incomplete beta. */\nexport function fDistCDF(f: number, df1: number, df2: number): number {\n  if (f <= 0) return 0\n  const x = df1 * f / (df1 * f + df2)\n  return incompleteBeta(x, df1 / 2, df2 / 2)\n}\n\n/** Upper tail p-value for F-distribution. */\nexport function fDistPValue(f: number, df1: number, df2: number): number {\n  return 1 - fDistCDF(f, df1, df2)\n}\n\n// \u2500\u2500\u2500 Chi-square distribution \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** P(\u03C7\u00B2 \u2264 x | df). */\nexport function chiSqCDF(x: number, df: number): number {\n  if (x <= 0) return 0\n  return incompleteGamma(df / 2, x / 2)\n}\n\n/** Upper tail p-value for chi-square. */\nexport function chiSqPValue(x: number, df: number): number {\n  return 1 - chiSqCDF(x, df)\n}\n\n/** Quantile of chi-square distribution via bisection. */\nexport function chiSqQuantile(p: number, df: number): number {\n  if (p <= 0) return 0\n  if (p >= 1) return Infinity\n  let lo = 0, hi = df + 10 * Math.sqrt(2 * df)\n  for (let i = 0; i < 100; i++) {\n    const mid = (lo + hi) / 2\n    if (chiSqCDF(mid, df) < p) lo = mid\n    else hi = mid\n    if (hi - lo < 1e-10) break\n  }\n  return (lo + hi) / 2\n}\n\n// \u2500\u2500\u2500 Normal distribution \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Standard normal CDF using complementary error function. */\nexport function normalCDF(z: number): number {\n  return 0.5 * (1 + erf(z / Math.SQRT2))\n}\n\n/**\n * Upper-tail probability P(Z > z) \u2014 numerically stable for large z.\n * Uses erfc directly to avoid catastrophic cancellation in `1 - normalCDF(z)`.\n * Matches R's `pnorm(z, lower.tail = FALSE)`.\n */\nexport function normalSurvival(z: number): number {\n  if (z >= 0) {\n    // P(Z > z) = 0.5 * erfc(z / sqrt(2))\n    return 0.5 * erfc(z / Math.SQRT2)\n  }\n  // P(Z > z) for z < 0: use symmetry = 1 - 0.5*erfc(-z/sqrt(2))\n  return 1 - 0.5 * erfc(-z / Math.SQRT2)\n}\n\n// \u2500\u2500\u2500 Exact distribution functions for rank correlations \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Exact CDF of Kendall's tau concordance count: P(T \u2264 q).\n * T = number of concordant pairs in a permutation of n elements.\n * Uses recursive DP with memoization (R's kendall.c algorithm, Best & Gipps 1974).\n * Only valid for n < 50 (no ties). Falls back to normal approximation otherwise.\n */\nexport function pKendallExact(q: number, n: number): number {\n  q = Math.floor(q + 1e-7)\n  const maxT = n * (n - 1) / 2\n  if (q < 0) return 0\n  if (q > maxT) return 1\n\n  // ckendall(k, nn): number of permutations of nn elements with exactly k concordant pairs\n  const cache = new Map<number, Float64Array>()\n  function ckendall(k: number, nn: number): number {\n    const u = nn * (nn - 1) / 2\n    if (k < 0 || k > u) return 0\n    if (nn === 1) return k === 0 ? 1 : 0\n\n    if (!cache.has(nn)) {\n      const arr = new Float64Array(u + 1)\n      for (let i = 0; i <= u; i++) arr[i] = -1\n      cache.set(nn, arr)\n    }\n    const w = cache.get(nn)!\n    if (w[k]! < 0) {\n      let s = 0\n      for (let i = 0; i < nn; i++) s += ckendall(k - i, nn - 1)\n      w[k] = s\n    }\n    return w[k]!\n  }\n\n  let p = 0\n  for (let j = 0; j <= q; j++) p += ckendall(j, n)\n\n  // Divide by n!\n  let nfact = 1\n  for (let i = 2; i <= n; i++) nfact *= i\n  return p / nfact\n}\n\n/**\n * Exact/Edgeworth CDF for Spearman's rho statistic D = \u03A3(d_i\u00B2).\n * For n \u2264 9: exact enumeration of all n! permutations (AS89).\n * For n > 9: Edgeworth series expansion (AS89 large-n approximation).\n * Reference: Best & Roberts (1975), R's prho.c\n *\n * @param D - Sum of squared rank differences \u03A3(rank_x_i - rank_y_i)\u00B2\n * @param n - Sample size\n * @param lowerTail - If true, returns P(D' \u2264 D); if false, P(D' \u2265 D)\n */\nexport function pSpearmanExact(D: number, n: number, lowerTail: boolean): number {\n  const n3 = n * (n * n - 1) / 3 // max possible D\n\n  if (n <= 1) return lowerTail ? 0 : 1\n  if (D <= 0) return lowerTail ? 0 : 1\n  if (D > n3) return lowerTail ? 1 : 0\n\n  if (n <= 9) {\n    // Exact enumeration \u2014 generate all n! permutations\n    const perm = new Array<number>(n)\n    for (let i = 0; i < n; i++) perm[i] = i + 1\n\n    let nfac = 1\n    for (let i = 1; i <= n; i++) nfac *= i\n\n    let ifr = 0 // count of perms where D' \u2265 D\n    // Use the same permutation algorithm as R's prho.c\n    for (let m = 0; m < nfac; m++) {\n      // Compute sum of squared differences for current permutation\n      let ise = 0\n      for (let i = 0; i < n; i++) {\n        const d = i + 1 - perm[i]!\n        ise += d * d\n      }\n      if (D <= ise) ifr++\n\n      // Advance to next permutation (R's cyclic rotation method)\n      let n1 = n\n      do {\n        const mt = perm[0]!\n        for (let i = 1; i < n1; i++) perm[i - 1] = perm[i]!\n        n1--\n        perm[n1] = mt\n        if (mt !== n1 + 1 || n1 <= 1) break\n      } while (true)\n    }\n\n    return (lowerTail ? nfac - ifr : ifr) / nfac\n  }\n\n  // Edgeworth series expansion for n > 9 (from R's prho.c, AS89)\n  const c1 = 0.2274, c2 = 0.2531, c3 = 0.1745, c4 = 0.0758\n  const c5 = 0.1033, c6 = 0.3932, c7 = 0.0879, c8 = 0.0151\n  const c9 = 0.0072, c10 = 0.0831, c11 = 0.0131, c12 = 4.6e-4\n\n  const yn = n\n  const b = 1 / yn\n  const x = (6 * (D - 1) * b / (yn * yn - 1) - 1) * Math.sqrt(yn - 1)\n  let y = x * x\n  const u = x * b * (c1 + b * (c2 + c3 * b) +\n    y * (-c4 + b * (c5 + c6 * b) -\n      y * b * (c7 + c8 * b -\n        y * (c9 - c10 * b + y * b * (c11 - c12 * y)))))\n  y = x * x // restore y\n  const correction = u / Math.exp(y / 2)\n\n  // pnorm(x, lower_tail) + correction\n  let pv: number\n  if (lowerTail) {\n    pv = -correction + normalCDF(x)\n  } else {\n    pv = correction + normalSurvival(x)\n  }\n  if (pv < 0) pv = 0\n  if (pv > 1) pv = 1\n  return pv\n}\n\n/**\n * Inverse standard normal CDF (quantile function).\n * Peter Acklam's rational approximation \u2014 max absolute error ~1.15e-9.\n * Reference: https://web.archive.org/web/20151030215612/http://home.online.no/~pjacklam/notes/invnorm/\n */\nexport function normalQuantile(p: number): number {\n  if (p <= 0 || p >= 1) throw new Error(`normalQuantile: p must be in (0,1), got ${p}`)\n\n  // Coefficients for the rational approximations\n  const a1 = -3.969683028665376e+01, a2 =  2.209460984245205e+02\n  const a3 = -2.759285104469687e+02, a4 =  1.383577518672690e+02\n  const a5 = -3.066479806614716e+01, a6 =  2.506628277459239e+00\n  const b1 = -5.447609879822406e+01, b2 =  1.615858368580409e+02\n  const b3 = -1.556989798598866e+02, b4 =  6.680131188771972e+01\n  const b5 = -1.328068155288572e+01\n  const c1 = -7.784894002430293e-03, c2 = -3.223964580411365e-01\n  const c3 = -2.400758277161838e+00, c4 = -2.549732539343734e+00\n  const c5 =  4.374664141464968e+00, c6 =  2.938163982698783e+00\n  const d1 =  7.784695709041462e-03, d2 =  3.224671290700398e-01\n  const d3 =  2.445134137142996e+00, d4 =  3.754408661907416e+00\n\n  const pLow = 0.02425, pHigh = 1 - pLow\n\n  if (p < pLow) {\n    // Lower tail region\n    const q = Math.sqrt(-2 * Math.log(p))\n    return (((((c1*q+c2)*q+c3)*q+c4)*q+c5)*q+c6) /\n           ((((d1*q+d2)*q+d3)*q+d4)*q+1)\n  } else if (p <= pHigh) {\n    // Central region\n    const q = p - 0.5, r = q * q\n    return (((((a1*r+a2)*r+a3)*r+a4)*r+a5)*r+a6)*q /\n           (((((b1*r+b2)*r+b3)*r+b4)*r+b5)*r+1)\n  } else {\n    // Upper tail region (mirror of lower)\n    const q = Math.sqrt(-2 * Math.log(1 - p))\n    return -(((((c1*q+c2)*q+c3)*q+c4)*q+c5)*q+c6) /\n            ((((d1*q+d2)*q+d3)*q+d4)*q+1)\n  }\n}\n\n/** Error function approximation (Horner's method). */\nfunction erf(x: number): number {\n  // Abramowitz & Stegun formula 7.1.26\n  const t = 1 / (1 + 0.3275911 * Math.abs(x))\n  const poly = t * (0.254829592 + t * (-0.284496736 + t * (1.421413741 + t * (-1.453152027 + t * 1.061405429))))\n  const result = 1 - poly * Math.exp(-x * x)\n  return x >= 0 ? result : -result\n}\n\n/** Complementary error function erfc(x) = 1 - erf(x), stable for large x. */\nfunction erfc(x: number): number {\n  // For x >= 0: erfc(x) = poly * exp(-x\u00B2), directly from A&S 7.1.26\n  const ax = Math.abs(x)\n  const t = 1 / (1 + 0.3275911 * ax)\n  const poly = t * (0.254829592 + t * (-0.284496736 + t * (1.421413741 + t * (-1.453152027 + t * 1.061405429))))\n  const val = poly * Math.exp(-ax * ax)\n  return x >= 0 ? val : 2 - val\n}\n\n// \u2500\u2500\u2500 Nelder-Mead Optimizer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface NelderMeadOptions {\n  readonly maxIter?: number\n  readonly tol?: number\n  readonly alpha?: number   // reflection\n  readonly beta?: number    // contraction\n  readonly gamma?: number   // expansion\n  readonly delta?: number   // shrink\n}\n\nexport interface NelderMeadResult {\n  readonly x: readonly number[]\n  readonly fval: number\n  readonly iterations: number\n  readonly converged: boolean\n}\n\n/**\n * Nelder-Mead simplex optimizer for unconstrained minimization.\n * Reference: Nelder & Mead (1965), The Computer Journal 7(4):308-313\n */\nexport function nelderMead(\n  fn: (x: readonly number[]) => number,\n  x0: readonly number[],\n  opts: NelderMeadOptions = {}\n): NelderMeadResult {\n  const n = x0.length\n  const maxIter = opts.maxIter ?? 1000 * n\n  const tol = opts.tol ?? 1e-8\n  const alpha = opts.alpha ?? 1.0\n  const beta = opts.beta ?? 0.5\n  const gam = opts.gamma ?? 2.0\n  const delta = opts.delta ?? 0.5\n\n  // Initialize simplex: n+1 vertices\n  const simplex: number[][] = Array.from({ length: n + 1 }, (_, i) => {\n    const v = [...x0]\n    if (i > 0) v[i - 1] = (v[i - 1] ?? 0) + ((Math.abs(v[i - 1] ?? 0) > 1e-8) ? 0.05 * (v[i - 1] ?? 0) : 0.00025)\n    return v\n  })\n  let fvals = simplex.map(v => fn(v))\n\n  let iter = 0\n  let converged = false\n\n  for (; iter < maxIter; iter++) {\n    // Sort by function value and keep simplex in sync\n    const order = fvals.map((_, i) => i).sort((a, b) => fvals[a]! - fvals[b]!)\n    const sorted = order.map(i => simplex[i]!)\n    fvals = order.map(i => fvals[i]!)\n    // Critical: sync simplex so simplex[i] corresponds to fvals[i]\n    for (let i = 0; i <= n; i++) simplex[i] = sorted[i]!\n\n    // Check convergence\n    const fRange = (fvals[n] ?? 0) - (fvals[0] ?? 0)\n    if (fRange < tol) { converged = true; break }\n\n    // Centroid of all but worst (simplex[n] is now the worst)\n    const centroid = Array.from({ length: n }, (_, j) =>\n      simplex.slice(0, n).reduce((s, v) => s + (v[j] ?? 0), 0) / n\n    )\n\n    // Reflect worst\n    const worst = simplex[n]!\n    const reflected = centroid.map((c, j) => c + alpha * (c - (worst[j] ?? 0)))\n    const fr = fn(reflected)\n\n    if (fr < (fvals[0] ?? 0)) {\n      // Expansion\n      const expanded = centroid.map((c, j) => c + gam * (reflected[j]! - c))\n      const fe = fn(expanded)\n      simplex[n] = fe < fr ? expanded : reflected\n      fvals[n] = fe < fr ? fe : fr\n    } else if (fr < (fvals[n - 1] ?? 0)) {\n      simplex[n] = reflected\n      fvals[n] = fr\n    } else {\n      // Contraction\n      const contracted = centroid.map((c, j) => c + beta * ((worst[j] ?? 0) - c))\n      const fc = fn(contracted)\n      if (fc < (fvals[n] ?? 0)) {\n        simplex[n] = contracted\n        fvals[n] = fc\n      } else {\n        // Shrink toward best (simplex[0])\n        const best = simplex[0]!\n        for (let i = 1; i <= n; i++) {\n          simplex[i] = simplex[i]!.map((v, j) => (best[j] ?? 0) + delta * (v - (best[j] ?? 0)))\n          fvals[i] = fn(simplex[i]!)\n        }\n      }\n    }\n  }\n\n  const order0 = fvals.map((_, i) => i).sort((a, b) => fvals[a]! - fvals[b]!)\n  return {\n    x: simplex[order0[0]!]!,\n    fval: fvals[order0[0]!]!,\n    iterations: iter,\n    converged,\n  }\n}\n\n// \u2500\u2500\u2500 P-value adjustment \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Adjust p-values for multiple comparisons.\n * Methods: 'bonferroni', 'holm', 'BH' (Benjamini-Hochberg), 'BY', 'none'.\n * Reference: R stats::p.adjust\n */\nexport function adjustPValues(pValues: readonly number[], method: PAdjMethod): number[] {\n  const n = pValues.length\n  if (n === 0) return []\n  if (method === 'none') return [...pValues]\n\n  if (method === 'bonferroni') {\n    return pValues.map(p => Math.min(1, p * n))\n  }\n\n  if (method === 'holm') {\n    const order = pValues.map((p, i) => ({ p, i })).sort((a, b) => a.p - b.p)\n    const adj = new Array<number>(n)\n    let running = 0\n    for (let k = 0; k < n; k++) {\n      const { p, i } = order[k]!\n      running = Math.max(running, p * (n - k))\n      adj[i] = Math.min(1, running)\n    }\n    return adj\n  }\n\n  if (method === 'BH') {\n    // Benjamini-Hochberg\n    const order = pValues.map((p, i) => ({ p, i })).sort((a, b) => b.p - a.p) // descending\n    const adj = new Array<number>(n)\n    let minSoFar = Infinity\n    for (let k = 0; k < n; k++) {\n      const { p, i } = order[k]!\n      const rank = n - k  // rank from smallest (1-indexed)\n      const adjusted = p * n / rank\n      minSoFar = Math.min(minSoFar, adjusted)\n      adj[i] = Math.min(1, minSoFar)\n    }\n    return adj\n  }\n\n  if (method === 'BY') {\n    // Benjamini-Yekutieli\n    const cm = pValues.reduce((s, _, k) => s + 1 / (k + 1), 0)\n    const order = pValues.map((p, i) => ({ p, i })).sort((a, b) => b.p - a.p)\n    const adj = new Array<number>(n)\n    let minSoFar = Infinity\n    for (let k = 0; k < n; k++) {\n      const { p, i } = order[k]!\n      const rank = n - k\n      const adjusted = p * n * cm / rank\n      minSoFar = Math.min(minSoFar, adjusted)\n      adj[i] = Math.min(1, minSoFar)\n    }\n    return adj\n  }\n\n  throw new Error(`Unknown p-adjust method: ${method}`)\n}\n\n// \u2500\u2500\u2500 Descriptive utilities \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Sample mean. */\nexport function mean(x: readonly number[]): number {\n  if (x.length === 0) throw new Error('mean: empty array')\n  // Explicit Number() coercion guards against JS string-concatenation if TypeScript\n  // safety is bypassed (e.g. CSV-sourced data passed without type-checking).\n  return x.reduce((s, v) => s + Number(v), 0) / x.length\n}\n\n/** Sample variance (n-1 denominator). */\nexport function variance(x: readonly number[]): number {\n  if (x.length < 2) throw new Error('variance: need at least 2 observations')\n  const m = mean(x)\n  // If the mean is non-finite (e.g. any value is Infinity), return NaN explicitly\n  // rather than letting Infinity - Infinity produce an opaque NaN mid-loop.\n  if (!isFinite(m)) return NaN\n  return x.reduce((s, v) => s + (v - m) ** 2, 0) / (x.length - 1)\n}\n\n/** Sample standard deviation. */\nexport function sd(x: readonly number[]): number {\n  return Math.sqrt(variance(x))\n}\n\n/** Standard error of the mean. */\nexport function se(x: readonly number[]): number {\n  return sd(x) / Math.sqrt(x.length)\n}\n\n/** Median. */\nexport function median(x: readonly number[]): number {\n  if (x.length === 0) throw new Error('median: empty array')\n  const sorted = [...x].sort((a, b) => a - b)\n  const mid = Math.floor(sorted.length / 2)\n  return sorted.length % 2 === 0\n    ? ((sorted[mid - 1]! + sorted[mid]!) / 2)\n    : sorted[mid]!\n}\n\n/** Quantile (using linear interpolation, same as R type=7). */\nexport function quantile(x: readonly number[], p: number): number {\n  if (p < 0 || p > 1) throw new Error(`quantile: p must be in [0,1], got ${p}`)\n  const sorted = [...x].sort((a, b) => a - b)\n  const n = sorted.length\n  const h = (n - 1) * p\n  const lo = Math.floor(h)\n  const hi = Math.ceil(h)\n  if (lo === hi) return sorted[lo]!\n  return sorted[lo]! + (h - lo) * (sorted[hi]! - sorted[lo]!)\n}\n\n/** Sort array ascending (returns new array). */\nexport function sortAsc(x: readonly number[]): number[] {\n  return [...x].sort((a, b) => a - b)\n}\n\n/** Sum of squared deviations from mean. */\nexport function ss(x: readonly number[]): number {\n  const m = mean(x)\n  return x.reduce((s, v) => s + (v - m) ** 2, 0)\n}\n\n/** Ranks (average ties), 1-indexed. */\nexport function rank(x: readonly number[]): number[] {\n  const n = x.length\n  const order = x.map((v, i) => ({ v, i })).sort((a, b) => a.v - b.v)\n  const ranks = new Array<number>(n)\n\n  let i = 0\n  while (i < n) {\n    let j = i\n    while (j < n && order[j]!.v === order[i]!.v) j++\n    const avgRank = (i + j - 1) / 2 + 1\n    for (let k = i; k < j; k++) ranks[order[k]!.i] = avgRank\n    i = j\n  }\n  return ranks\n}\n\n/** Covariance between two arrays (n-1 denominator). */\nexport function cov(x: readonly number[], y: readonly number[]): number {\n  if (x.length !== y.length) throw new Error('cov: arrays must have equal length')\n  if (x.length < 2) throw new Error('cov: need at least 2 observations')\n  const mx = mean(x), my = mean(y)\n  return x.reduce((s, v, i) => s + (v - mx) * ((y[i] ?? 0) - my), 0) / (x.length - 1)\n}\n\n/** Clamp a number to [lo, hi]. */\nexport function clamp(v: number, lo: number, hi: number): number {\n  return Math.max(lo, Math.min(hi, v))\n}\n\n/** Round to n decimal places. */\nexport function roundTo(v: number, n: number): number {\n  const factor = 10 ** n\n  return Math.round(v * factor) / factor\n}\n\n// \u2500\u2500\u2500 Studentized Range Distribution (ptukey) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Standard normal PDF.\n */\nfunction normalPDF(z: number): number {\n  return Math.exp(-0.5 * z * z) / Math.sqrt(2 * Math.PI)\n}\n\n/**\n * CDF of the studentized range distribution P(Q \u2264 q | k, df).\n *\n * Uses multi-interval Gauss-Legendre quadrature over the variable\n * v = 2\u03C7\u00B2/df which has density Gamma(df/2, rate=df/4) with mean=2.\n * The integral: P(Q \u2264 q | k, df) = \u222B_0^\u221E f_v(v) \u00B7 P_\u221E(q\u00B7\u221A(v/2)) dv\n *\n * Follows R's Copenhaver & Holland (1988) approach: adaptive subinterval\n * widths based on df, 16-point Gauss-Legendre per subinterval.\n *\n * Reference: Copenhaver & Holland (1988), JRSS-B 50:36-45;\n * R source code src/nmath/ptukey.c\n */\nexport function ptukeyApprox(q: number, k: number, df: number): number {\n  if (q <= 0) return 0\n  if (!isFinite(q) || isNaN(q)) return NaN\n  if (k < 2) return NaN\n\n  // For very large df, use the normal (df=\u221E) case directly\n  if (df > 5000) return ptukeyInfDf(q, k)\n\n  // Determine subinterval width based on df (narrower for larger df\n  // so the chi-square peak near v=2 is adequately resolved)\n  let wStep: number\n  if (df <= 100) wStep = 1.0\n  else if (df <= 800) wStep = 0.5\n  else if (df <= 5000) wStep = 0.25\n  else wStep = 0.125\n\n  // Density of v = 2\u03C7\u00B2/df: v ~ Gamma(shape=df/2, rate=df/4)\n  // f_v(v) = (df/4)^(df/2) / Gamma(df/2) \u00B7 v^(df/2-1) \u00B7 exp(-df\u00B7v/4)\n  // Mean=2, Variance=8/df\n  const halfDf = df / 2\n  const rate = df / 4\n  const logNorm = halfDf * Math.log(rate) - logGamma(halfDf)\n\n  // 16-point Gauss-Legendre per subinterval (matches R)\n  const glPts = 16\n  const gl = gaussLegendreRef(glPts)\n\n  let result = 0\n  let vLo = 0\n\n  // Integrate subintervals until contribution is negligible\n  for (let interval = 0; interval < 200; interval++) {\n    const vHi = vLo + wStep\n    const mid = (vLo + vHi) / 2\n    const half = (vHi - vLo) / 2\n\n    let subResult = 0\n    for (let i = 0; i < glPts; i++) {\n      const v = mid + half * gl.nodes[i]!\n      const w = half * gl.weights[i]!\n      if (v <= 0) continue\n\n      // Gamma(df/2, rate=df/4) density\n      const logDens = logNorm + (halfDf - 1) * Math.log(v) - rate * v\n      const dens = Math.exp(logDens)\n      if (dens < 1e-300) continue\n\n      // P_\u221E(q \u00B7 \u221A(v/2))  where \u221A(v/2) = \u221A(\u03C7\u00B2/df)\n      const scaledQ = q * Math.sqrt(v / 2)\n      const pInf = ptukeyInfDf(scaledQ, k)\n\n      subResult += w * dens * pInf\n    }\n\n    result += subResult\n    vLo = vHi\n\n    // Stop when this subinterval contributed negligibly AND we're past the peak\n    if (vLo > 2 && Math.abs(subResult) < 1e-10) break\n  }\n\n  return Math.max(0, Math.min(1, result))\n}\n\n/**\n * CDF of studentized range for df = \u221E (normal case).\n * P(Q \u2264 q | k, \u221E) = k * \u222B_{-\u221E}^{\u221E} \u03C6(z) * [\u03A6(z + q) - \u03A6(z)]^{k-1} dz\n *\n * Uses Gauss-Hermite quadrature for the infinite-range integral.\n */\nfunction ptukeyInfDf(q: number, k: number): number {\n  if (q <= 0) return 0\n\n  // Use Gauss-Legendre on a truncated range. \u03C6(z) is negligible for |z| > 8\n  const lo = -8\n  const hi = 8\n  const npts = 64\n\n  const { nodes, weights } = gaussLegendreAB(npts, lo, hi)\n\n  let result = 0\n  for (let i = 0; i < npts; i++) {\n    const z = nodes[i]!\n    const w = weights[i]!\n    const phi = normalPDF(z)\n    const diff = normalCDF(z + q) - normalCDF(z)\n    if (diff <= 0) continue\n    result += w * phi * Math.pow(diff, k - 1)\n  }\n\n  return Math.max(0, Math.min(1, k * result))\n}\n\n/**\n * Upper-tail p-value for studentized range distribution.\n * P(Q > q | k, df)\n */\nexport function pValueStudentizedRangeApprox(q: number, k: number, df: number): number {\n  return Math.max(0, Math.min(1, 1 - ptukeyApprox(q, k, df)))\n}\n\n// \u2500\u2500\u2500 Gauss-Legendre Quadrature Nodes & Weights \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Gauss-Legendre nodes and weights on [a, b].\n * Computes from [-1, 1] reference nodes via affine transformation.\n */\nfunction gaussLegendreAB(n: number, a: number, b: number): { nodes: number[]; weights: number[] } {\n  const ref = gaussLegendreRef(n)\n  const mid = (a + b) / 2\n  const half = (b - a) / 2\n  return {\n    nodes: ref.nodes.map(t => mid + half * t),\n    weights: ref.weights.map(w => half * w),\n  }\n}\n\n/**\n * Gauss-Legendre nodes and weights on [-1, 1].\n * Uses Newton iteration on Legendre polynomials.\n * Reference: Golub & Welsch (1969)\n */\nfunction gaussLegendreRef(n: number): { nodes: number[]; weights: number[] } {\n  const nodes: number[] = []\n  const weights: number[] = []\n  const m = Math.ceil(n / 2)\n\n  for (let i = 0; i < m; i++) {\n    // Initial guess from Tricomi approximation\n    let z = Math.cos(Math.PI * (i + 0.75) / (n + 0.5))\n\n    let pp = 0\n    for (let iter = 0; iter < 100; iter++) {\n      let p0 = 1\n      let p1 = z\n      for (let j = 2; j <= n; j++) {\n        const p2 = ((2 * j - 1) * z * p1 - (j - 1) * p0) / j\n        p0 = p1\n        p1 = p2\n      }\n      pp = n * (z * p1 - p0) / (z * z - 1)\n      const zOld = z\n      z = z - p1 / pp\n      if (Math.abs(z - zOld) < 1e-15) break\n    }\n\n    nodes.push(z)\n    nodes.push(-z)\n    const w = 2 / ((1 - z * z) * pp * pp)\n    weights.push(w)\n    weights.push(w)\n  }\n\n  // If n is odd, the center node (z=0) was added twice \u2014 fix\n  if (n % 2 === 1) {\n    nodes.pop()\n    weights.pop()\n  }\n\n  return { nodes, weights }\n}\n", "/**\n * APA 7th edition string formatting for statistical results.\n * Every stat function uses these formatters to produce the `formatted` string\n * that gets embedded directly into plots as subtitles/captions.\n */\n\nimport { roundTo } from './math.js'\n\n/**\n * Format a p-value in APA style.\n * < .001 \u2192 \"p < .001\"\n * otherwise \u2192 \"p = .025\" (leading zero dropped, 3 decimal places)\n */\nexport function formatP(p: number): string {\n  if (p < 0.001) return 'p < .001'\n  const rounded = roundTo(p, 3).toFixed(3).replace('0.', '.')\n  return `p = ${rounded}`\n}\n\n/**\n * Format a statistic value: 2 decimal places, no leading zero for absolute values.\n * Used for t, F, z, \u03C7\u00B2, etc.\n */\nexport function formatStat(v: number, decimals = 2): string {\n  return roundTo(v, decimals).toFixed(decimals)\n}\n\n/**\n * Format a confidence interval: [lo, hi] \u2192 \"[0.08, 1.22]\"\n */\nexport function formatCI(ci: readonly [number, number], decimals = 2): string {\n  return `[${roundTo(ci[0], decimals).toFixed(decimals)}, ${roundTo(ci[1], decimals).toFixed(decimals)}]`\n}\n\n/**\n * Format degrees of freedom \u2014 integer if whole number, else 2 decimal places.\n */\nexport function formatDF(df: number | readonly [number, number]): string {\n  if (typeof df === 'number') {\n    return Number.isInteger(df) ? String(df) : df.toFixed(2)\n  }\n  const [df1, df2] = df\n  const f1 = Number.isInteger(df1) ? String(df1) : df1.toFixed(2)\n  const f2 = Number.isInteger(df2) ? String(df2) : df2.toFixed(2)\n  return `${f1}, ${f2}`\n}\n\n/**\n * Full APA string for a t-test result.\n * e.g. \"t(48) = 2.31, p = .025, d = 0.65, 95% CI [0.08, 1.22]\"\n */\nexport function formatTTest(\n  t: number,\n  df: number,\n  pValue: number,\n  effectSize: number,\n  effectName: string,\n  ci: readonly [number, number],\n  ciLevel = 0.95\n): string {\n  const ciPct = Math.round(ciLevel * 100)\n  return `t(${formatDF(df)}) = ${formatStat(t)}, ${formatP(pValue)}, ${effectName} = ${formatStat(effectSize)}, ${ciPct}% CI ${formatCI(ci)}`\n}\n\n/**\n * Full APA string for ANOVA.\n * e.g. \"F(2, 87) = 4.21, p = .018, \u03B7\u00B2 = 0.09\"\n */\nexport function formatANOVA(\n  F: number,\n  df1: number,\n  df2: number,\n  pValue: number,\n  effectSize: number,\n  effectName = '\u03B7\u00B2'\n): string {\n  return `F(${formatDF([df1, df2])}) = ${formatStat(F)}, ${formatP(pValue)}, ${effectName} = ${formatStat(effectSize)}`\n}\n\n/**\n * APA string for repeated measures ANOVA.\n * Sphericity assumed: \"F(2, 18) = 4.21, p = .018, \u03B7\u00B2_p = 0.32\"\n * GG corrected: \"F_GG(1.23, 11.07) = 4.21, p = .042, \u03B7\u00B2_p = 0.32\"\n */\nexport function formatRMANOVA(\n  F: number,\n  df1: number,\n  df2: number,\n  pValue: number,\n  effectSize: number,\n  effectName = '\u03B7\u00B2_p',\n  correction?: 'Greenhouse-Geisser' | 'Huynh-Feldt'\n): string {\n  const prefix = correction === 'Greenhouse-Geisser' ? 'F_GG' : correction === 'Huynh-Feldt' ? 'F_HF' : 'F'\n  return `${prefix}(${formatDF([df1, df2])}) = ${formatStat(F)}, ${formatP(pValue)}, ${effectName} = ${formatStat(effectSize)}`\n}\n\n/**\n * Full APA string for chi-square test.\n * e.g. \"\u03C7\u00B2(3) = 8.46, p = .037, V = 0.29\"\n */\nexport function formatChiSq(\n  chiSq: number,\n  df: number,\n  pValue: number,\n  effectSize: number,\n  effectName = \"V\"\n): string {\n  return `\u03C7\u00B2(${formatDF(df)}) = ${formatStat(chiSq)}, ${formatP(pValue)}, ${effectName} = ${formatStat(effectSize)}`\n}\n\n/**\n * APA string for Pearson/Spearman/Kendall correlation.\n * e.g. \"r(48) = 0.54, p = .003, 95% CI [0.28, 0.73]\"\n */\nexport function formatCorrelation(\n  r: number,\n  df: number,\n  pValue: number,\n  ci: readonly [number, number],\n  method = 'r',\n  ciLevel = 0.95\n): string {\n  const ciPct = Math.round(ciLevel * 100)\n  return `${method}(${formatDF(df)}) = ${formatStat(r)}, ${formatP(pValue)}, ${ciPct}% CI ${formatCI(ci)}`\n}\n\n/**\n * APA string for linear regression.\n * e.g. \"R\u00B2 = 0.42, F(3, 96) = 23.2, p < .001\"\n */\nexport function formatRegression(\n  r2: number,\n  adjR2: number,\n  F: number,\n  df1: number,\n  df2: number,\n  pValue: number\n): string {\n  return `R\u00B2 = ${formatStat(r2)}, adj. R\u00B2 = ${formatStat(adjR2)}, F(${formatDF([df1, df2])}) = ${formatStat(F)}, ${formatP(pValue)}`\n}\n\n/**\n * APA string for Mann-Whitney / Wilcoxon.\n * e.g. \"W = 423, p = .031, r = 0.27\"\n */\nexport function formatMannWhitney(\n  W: number,\n  pValue: number,\n  r: number\n): string {\n  return `W = ${formatStat(W, 0)}, ${formatP(pValue)}, r = ${formatStat(r)}`\n}\n\n/**\n * APA string for Kruskal-Wallis.\n * e.g. \"H(2) = 12.3, p = .002, \u03B7\u00B2_H = 0.18\"\n */\nexport function formatKruskalWallis(\n  H: number,\n  df: number,\n  pValue: number,\n  etaSq: number\n): string {\n  return `H(${formatDF(df)}) = ${formatStat(H)}, ${formatP(pValue)}, \u03B7\u00B2_H = ${formatStat(etaSq)}`\n}\n\n/**\n * APA string for LMM.\n * e.g. \"ICC = 0.42, AIC = 1234.5\"\n */\nexport function formatLMM(icc: number, aic: number, bic: number, logLik: number): string {\n  return `ICC = ${formatStat(icc)}, AIC = ${formatStat(aic, 1)}, BIC = ${formatStat(bic, 1)}, logLik = ${formatStat(logLik, 1)}`\n}\n\n/**\n * Interpret Cohen's d effect size.\n */\nexport function interpretCohensD(d: number): string {\n  const abs = Math.abs(d)\n  if (abs < 0.2) return 'negligible'\n  if (abs < 0.5) return 'small'\n  if (abs < 0.8) return 'medium'\n  return 'large'\n}\n\n/**\n * Interpret eta-squared / omega-squared.\n */\nexport function interpretEtaSq(eta: number): string {\n  if (eta < 0.01) return 'negligible'\n  if (eta < 0.06) return 'small'\n  if (eta < 0.14) return 'medium'\n  return 'large'\n}\n\n/**\n * Interpret Pearson r.\n */\nexport function interpretR(r: number): string {\n  const abs = Math.abs(r)\n  if (abs < 0.1) return 'negligible'\n  if (abs < 0.3) return 'small'\n  if (abs < 0.5) return 'medium'\n  if (abs < 0.7) return 'large'\n  return 'very large'\n}\n\n/**\n * Interpret Cram\u00E9r's V.\n */\nexport function interpretCramerV(v: number, df: number): string {\n  // Benchmarks depend on df (Cohen 1988 adjusted for contingency tables)\n  const small = df === 1 ? 0.1 : df === 2 ? 0.07 : 0.06\n  const medium = df === 1 ? 0.3 : df === 2 ? 0.21 : 0.17\n  if (v < small) return 'negligible'\n  if (v < medium) return 'small'\n  if (v < medium * 1.5) return 'medium'\n  return 'large'\n}\n\nimport type { EffectInterpretation, FactorFit } from './types.js'\n\n/**\n * APA string for CFA/EFA fit indices.\n * e.g. \"\u03C7\u00B2(24) = 28.42, p = .241, RMSEA = 0.042 [0.000, 0.085], CFI = 0.987, TLI = 0.982, SRMR = 0.038\"\n */\nexport function formatCFAFit(fit: FactorFit): string {\n  return `\u03C7\u00B2(${formatDF(fit.df)}) = ${formatStat(fit.chiSq)}, ${formatP(fit.pValue)}, RMSEA = ${formatStat(fit.rmsea, 3)} ${formatCI(fit.rmseaCI, 3)}, CFI = ${formatStat(fit.cfi, 3)}, TLI = ${formatStat(fit.tli, 3)}, SRMR = ${formatStat(fit.srmr, 3)}`\n}\n\n/**\n * APA string for Poisson regression.\n * e.g. \"Deviance = 12.3, Null deviance = 45.6, AIC = 78.9\"\n */\nexport function formatPoisson(deviance: number, nullDeviance: number, aic: number): string {\n  return `Deviance = ${formatStat(deviance, 1)}, Null deviance = ${formatStat(nullDeviance, 1)}, AIC = ${formatStat(aic, 1)}`\n}\n\n/**\n * APA string for negative binomial regression.\n * e.g. \"Deviance = 12.3, \u03B8 = 4.56, AIC = 78.9\"\n */\nexport function formatNegBin(deviance: number, theta: number, aic: number): string {\n  return `Deviance = ${formatStat(deviance, 1)}, \u03B8 = ${formatStat(theta, 2)}, AIC = ${formatStat(aic, 1)}`\n}\n\n/**\n * APA string for two-way ANOVA factor row.\n * e.g. \"Factor A: F(2, 54) = 4.21, p = .018, \u03B7\u00B2 = 0.14\"\n */\nexport function formatTwoWayANOVA(\n  source: string,\n  F: number,\n  df1: number,\n  df2: number,\n  pValue: number,\n  etaSq: number\n): string {\n  return `${source}: F(${formatDF([df1, df2])}) = ${formatStat(F)}, ${formatP(pValue)}, \u03B7\u00B2 = ${formatStat(etaSq)}`\n}\n\n/**\n * APA string for ANCOVA factor row.\n * e.g. \"Factor: F(2, 53) = 5.10, p = .009, \u03B7\u00B2 = 0.16\"\n */\nexport function formatANCOVA(\n  source: string,\n  F: number,\n  df1: number,\n  df2: number,\n  pValue: number,\n  etaSq: number\n): string {\n  return `${source}: F(${formatDF([df1, df2])}) = ${formatStat(F)}, ${formatP(pValue)}, \u03B7\u00B2 = ${formatStat(etaSq)}`\n}\n\n/**\n * APA string for binomial test.\n * e.g. \"p\u0302 = 0.60, p = .327, 95% CI [0.36, 0.81], g = 0.10\"\n */\nexport function formatBinomial(\n  pHat: number,\n  pValue: number,\n  ci: readonly [number, number],\n  g: number,\n  ciLevel = 0.95\n): string {\n  const ciPct = Math.round(ciLevel * 100)\n  return `p\u0302 = ${formatStat(pHat, 3)}, ${formatP(pValue)}, ${ciPct}% CI ${formatCI(ci, 3)}, g = ${formatStat(g, 3)}`\n}\n\n/**\n * APA string for proportions z-test.\n * e.g. \"z = 2.31, p = .021, h = 0.45, 95% CI [0.02, 0.18]\"\n */\nexport function formatProportions(\n  z: number,\n  pValue: number,\n  h: number,\n  ci: readonly [number, number],\n  ciLevel = 0.95\n): string {\n  const ciPct = Math.round(ciLevel * 100)\n  return `z = ${formatStat(z)}, ${formatP(pValue)}, h = ${formatStat(h)}, ${ciPct}% CI ${formatCI(ci, 3)}`\n}\n\n/**\n * APA string for Cochran's Q test.\n * e.g. \"Q(2) = 8.40, p = .015\"\n */\nexport function formatCochranQ(Q: number, df: number, pValue: number): string {\n  return `Q(${formatDF(df)}) = ${formatStat(Q)}, ${formatP(pValue)}`\n}\n\n/** Generic effect size interpretation helper. */\nexport function interpretEffect(value: number, thresholds: readonly [number, number, number]): EffectInterpretation {\n  const abs = Math.abs(value)\n  if (abs < thresholds[0]) return 'negligible'\n  if (abs < thresholds[1]) return 'small'\n  if (abs < thresholds[2]) return 'medium'\n  return 'large'\n}\n", "/**\n * Deterministic PRNG (splitmix32).\n * Shared across clustering, factor-analysis, bootstrap, and any stochastic module.\n * Default seed: 42. Every stochastic function accepts `seed?` in options.\n */\n\nexport class PRNG {\n  private state: number\n  constructor(seed: number) { this.state = seed >>> 0 }\n  next(): number {\n    this.state = (this.state + 0x9E3779B9) | 0\n    let t = this.state ^ (this.state >>> 16)\n    t = Math.imul(t, 0x21F0AAAD)\n    t = t ^ (t >>> 15)\n    t = Math.imul(t, 0x735A2D97)\n    t = t ^ (t >>> 15)\n    return (t >>> 0) / 4294967296\n  }\n}\n", "/**\n * Descriptive statistics module.\n * Computes mean, median, mode, variance, SD, SE, skewness, kurtosis,\n * percentiles, confidence intervals, and the Shapiro-Wilk normality test.\n */\n\nimport {\n  mean as _mean,\n  median as _median,\n  variance as _variance,\n  sd as _sd,\n  se as _se,\n  quantile,\n  sortAsc,\n  tDistQuantile,\n  normalCDF,\n  normalQuantile,\n  roundTo,\n} from '../core/math.js'\nimport { formatP } from '../core/apa.js'\nimport type { DescriptiveResult } from '../core/types.js'\n\n// \u2500\u2500\u2500 Mode \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction mode(x: readonly number[]): number[] {\n  const counts = new Map<number, number>()\n  for (const v of x) counts.set(v, (counts.get(v) ?? 0) + 1)\n  const maxCount = Math.max(...counts.values())\n  const modes: number[] = []\n  for (const [v, c] of counts) {\n    if (c === maxCount) modes.push(v)\n  }\n  return modes.sort((a, b) => a - b)\n}\n\n// \u2500\u2500\u2500 Trimmed mean \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** \u03B1-trimmed mean: removes \u03B1 proportion from each tail. */\nexport function trimmedMean(x: readonly number[], alpha = 0.05): number {\n  const sorted = sortAsc(x)\n  const n = sorted.length\n  const trim = Math.floor(n * alpha)\n  const trimmed = sorted.slice(trim, n - trim)\n  if (trimmed.length === 0) throw new Error('trimmedMean: too much trimming, no data remains')\n  return _mean(trimmed)\n}\n\n// \u2500\u2500\u2500 Skewness & Kurtosis \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Sample skewness (adjusted Fisher-Pearson). */\nexport function skewness(x: readonly number[]): number {\n  const n = x.length\n  if (n < 3) throw new Error('skewness: need at least 3 observations')\n  const m = _mean(x)\n  const s = _sd(x)\n  if (s === 0) return 0\n  const sum = x.reduce((acc, v) => acc + ((v - m) / s) ** 3, 0)\n  return (n / ((n - 1) * (n - 2))) * sum\n}\n\n/** Sample excess kurtosis (adjusted Fisher-Pearson). */\nexport function kurtosis(x: readonly number[]): number {\n  const n = x.length\n  if (n < 4) throw new Error('kurtosis: need at least 4 observations')\n  const m = _mean(x)\n  const s = _sd(x)\n  if (s === 0) return 0\n  const sum = x.reduce((acc, v) => acc + ((v - m) / s) ** 4, 0)\n  const k1 = (n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3)) * sum\n  const k2 = 3 * (n - 1) ** 2 / ((n - 2) * (n - 3))\n  return k1 - k2\n}\n\n// \u2500\u2500\u2500 Confidence interval for mean \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** t-based CI for the mean. Returns [lower, upper]. */\nexport function ciMean(\n  x: readonly number[],\n  ciLevel = 0.95\n): readonly [number, number] {\n  const n = x.length\n  if (n < 2) throw new Error('ciMean: need at least 2 observations')\n  const m = _mean(x)\n  const s = _se(x)\n  const t = tDistQuantile(1 - (1 - ciLevel) / 2, n - 1)\n  return [m - t * s, m + t * s]\n}\n\n// \u2500\u2500\u2500 Shapiro-Wilk normality test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n// AS R94 polynomial coefficient arrays (ascending degree: c[0] + c[1]*x + c[2]*x\u00B2 + ...)\n// Source: Royston (1995) Applied Statistics 44(4):547-551, Table 1\nconst SW_C1 = [0, 0.221157, -0.147981, -2.07119, 4.434685, -2.706056] as const\nconst SW_C2 = [0, 0.042981, -0.293762, -1.752461, 5.682633, -3.582633] as const\n\n/** Polynomial evaluation, ascending degree: c[0] + c[1]*x + ... (Horner's method) */\nfunction swPoly(c: readonly number[], x: number): number {\n  let r = 0\n  for (let i = c.length - 1; i >= 0; i--) r = r * x + (c[i] ?? 0)\n  return r\n}\n\n/**\n * Shapiro-Wilk W test for normality.\n * Full AS R94 algorithm (Royston 1995) \u2014 valid for n=3..5000.\n * Reference: Royston (1995), Applied Statistics, 44(4):547-551.\n *\n * Cross-validated with R:\n * > shapiro.test(c(1,2,3,4,5,6,7,8,9,10))\n * W = 0.9728, p-value = 0.9177\n */\nexport function shapiroWilk(x: readonly number[]): { statistic: number; pValue: number } {\n  const n = x.length\n  if (n < 3) throw new Error('shapiroWilk: need at least 3 observations')\n  if (n > 5000) throw new Error('shapiroWilk: n > 5000 not supported')\n\n  const sorted = sortAsc(x)\n  const nn2 = Math.floor(n / 2)\n\n  // a[0..nn2-1]: upper-half Shapiro-Wilk coefficients, all positive after computation.\n  // a[0] = outermost (largest), a[nn2-1] = innermost (smallest).\n  const a: number[] = new Array(nn2).fill(0)\n\n  if (n === 3) {\n    a[0] = Math.SQRT1_2  // 1/sqrt(2) \u2248 0.7071\n  } else if (n === 4) {\n    a[0] = 0.6872; a[1] = 0.1677\n  } else if (n === 5) {\n    a[0] = 0.6646; a[1] = 0.2413\n  } else {\n    // n >= 6: full AS R94 algorithm \u2014 port of R's swilk.c\n    //\n    // Step 1: expected normal quantiles (1-indexed in R: a[i] = \u03A6\u207B\u00B9((i\u22120.375)/(n+0.25))).\n    // These are negative for i=1..nn2 (small-probability quantiles).\n    for (let i = 0; i < nn2; i++) {\n      a[i] = normalQuantile((i + 1 - 0.375) / (n + 0.25))\n    }\n\n    // Step 2: sum of squares of the full antisymmetric array (2 \u00D7 upper half).\n    let summ2 = 0\n    for (let i = 0; i < nn2; i++) summ2 += a[i]! * a[i]!\n    summ2 *= 2\n    const ssumm2 = Math.sqrt(summ2)\n    const rsn = 1 / Math.sqrt(n)\n\n    // Save originals before overwriting \u2014 needed to compute fac after a[0]/a[1] are replaced.\n    const a0orig = a[0]!  // most-negative quantile \u2192 becomes outermost positive coefficient\n    const a1orig = a[1]!  // second-most-negative \u2192 becomes second positive coefficient\n\n    // Step 3: polynomial correction for outermost coefficient (R's a[1]).\n    // Subtracting a0orig (negative) / ssumm2 effectively adds a positive term.\n    const a1corr = swPoly(SW_C1, rsn) - a0orig / ssumm2\n\n    if (n > 5) {\n      // Step 4: polynomial correction for second coefficient (R's a[2]).\n      const a2corr = -a1orig / ssumm2 + swPoly(SW_C2, rsn)\n\n      // Step 5: scale factor \u2014 ensures the full antisymmetric array has unit sum of squares.\n      // num/den: variance accounted for by the two corrected outer coefficients vs. their originals.\n      const num = summ2 - 2 * a0orig * a0orig - 2 * a1orig * a1orig\n      const den = 1 - 2 * a1corr * a1corr - 2 * a2corr * a2corr\n      const fac = num > 0 && den > 0 ? Math.sqrt(num / den) : 1\n\n      a[0] = a1corr; a[1] = a2corr\n      // Remaining inner quantiles (still negative) divided by \u2212fac become positive.\n      for (let i = 2; i < nn2; i++) a[i] = (a[i] ?? 0) / -fac\n\n    } else {\n      // n === 6: correct only the outermost coefficient.\n      const num = summ2 - 2 * a0orig * a0orig\n      const den = 1 - 2 * a1corr * a1corr\n      const fac = num > 0 && den > 0 ? Math.sqrt(num / den) : 1\n\n      a[0] = a1corr\n      for (let i = 1; i < nn2; i++) a[i] = (a[i] ?? 0) / -fac\n    }\n  }\n\n  // W = (\u03A3\u1D62 a[i] \u00B7 (x[n\u22121\u2212i] \u2212 x[i]))\u00B2 / SST\n  // Equivalent to the standard \u03A3 a\u1D62\u00B7x\u208D\u1D62\u208E with a full antisymmetric array, but using only the\n  // upper half: each pair contributes a[i]\u00B7x[n\u22121\u2212i] \u2212 (\u2212a[i])\u00B7x[i] = a[i]\u00B7(x[n\u22121\u2212i] \u2212 x[i]).\n  let w1 = 0\n  for (let i = 0; i < nn2; i++) {\n    w1 += (a[i] ?? 0) * ((sorted[n - 1 - i] ?? 0) - (sorted[i] ?? 0))\n  }\n  const sst = _variance(sorted) * (n - 1)\n  const W = sst > 0 ? Math.min(1, (w1 * w1) / sst) : 1\n\n  const pValue = shapiroWilkPValue(W, n)\n  return { statistic: roundTo(W, 4), pValue: roundTo(pValue, 4) }\n}\n\n/**\n * Ascending-degree polynomial: c[0] + c[1]*x + c[2]*x\u00B2 + ...  (Horner's method)\n * Matches R's poly() in swilk.c: zero-order coefficient first.\n */\nfunction polyAsc(c: readonly number[], x: number): number {\n  let r = c[c.length - 1]!\n  for (let i = c.length - 2; i >= 0; i--) r = r * x + c[i]!\n  return r\n}\n\n// R swilk.c coefficient arrays (Royston 1995, Applied Statistics 44(4):547-551)\n// Ascending degree: c[0] + c[1]*x + c[2]*x\u00B2 + c[3]*x\u00B3\nconst SW_G  = [-2.273, 0.459] as const                             // gamma (n \u2264 11), var = n\nconst SW_C3 = [0.544, -0.39978, 0.025054, -6.714e-4] as const     // mu (n \u2264 11), var = n\nconst SW_C4 = [1.3822, -0.77857, 0.062767, -0.0020322] as const   // log(sigma) (n \u2264 11), var = n\nconst SW_C5 = [-1.5861, -0.31082, -0.083751, 0.0038915] as const  // mu (n \u2265 12), var = log(n)\nconst SW_C6 = [-0.4803, -0.082676, 0.0030302] as const            // log(sigma) (n \u2265 12), var = log(n)\n\nfunction shapiroWilkPValue(W: number, n: number): number {\n  // n = 3: exact p-value (R's swilk.c special case)\n  if (n === 3) {\n    const pi6 = 6 / Math.PI\n    const stqr = normalQuantile(0.75) // \u2248 0.6744898\n    const pw = pi6 * (Math.asin(Math.sqrt(W)) - stqr)\n    return Math.max(0, Math.min(1, pw))\n  }\n\n  const y0 = Math.log(1 - W)\n  let z: number\n\n  if (n <= 11) {\n    // Royston (1995) small-sample approximation, variable = n\n    const gamma = polyAsc(SW_G, n)\n    if (y0 >= gamma) return 0 // effectively zero (R returns 1e-99)\n    const y = -Math.log(gamma - y0)\n    const mu = polyAsc(SW_C3, n)\n    const sigma = Math.exp(polyAsc(SW_C4, n))\n    z = (y - mu) / sigma\n  } else {\n    // Royston (1995) large-sample approximation, variable = log(n)\n    const xx = Math.log(n)\n    const mu = polyAsc(SW_C5, xx)\n    const sigma = Math.exp(polyAsc(SW_C6, xx))\n    z = (y0 - mu) / sigma\n  }\n\n  // Upper tail: large W \u2192 normal \u2192 large p\n  return Math.max(0, Math.min(1, 1 - normalCDF(z)))\n}\n\n// \u2500\u2500\u2500 Main descriptive function \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute full descriptive statistics for a numeric vector.\n *\n * Cross-validated with R:\n * > x <- c(2,4,4,4,5,5,7,9)\n * > mean(x)  # 5\n * > sd(x)    # 2\n * > e1071::skewness(x, type=2)  # 0.4895\n */\nexport function describe(x: readonly number[], ciLevel = 0.95): DescriptiveResult {\n  if (x.length === 0) throw new Error('describe: empty array')\n  const n = x.length\n  const m = _mean(x)\n  const med = _median(x)\n  const modes = mode(x)\n  const tm = trimmedMean(x, 0.05)\n  const s = _sd(x)\n  const sem = _se(x)\n  const v = _variance(x)\n  const sorted = sortAsc(x)\n  const mn = sorted[0]!\n  const mx = sorted[n - 1]!\n  const q1 = quantile(x, 0.25)\n  const q3 = quantile(x, 0.75)\n  const iqr = q3 - q1\n  const skew = n >= 3 ? skewness(x) : 0\n  const kurt = n >= 4 ? kurtosis(x) : 0\n  const ci = ciMean(x, ciLevel)\n  const sw = n >= 3 ? shapiroWilk(x) : { statistic: NaN, pValue: NaN }\n\n  const ciPct = Math.round(ciLevel * 100)\n  const formatted = [\n    `n = ${n}`,\n    `M = ${roundTo(m, 2)}, SD = ${roundTo(s, 2)}, SE = ${roundTo(sem, 2)}`,\n    `Mdn = ${roundTo(med, 2)}, IQR = ${roundTo(iqr, 2)}`,\n    `Skew = ${roundTo(skew, 2)}, Kurt = ${roundTo(kurt, 2)}`,\n    `${ciPct}% CI [${roundTo(ci[0], 2)}, ${roundTo(ci[1], 2)}]`,\n    n >= 3 ? `Shapiro-Wilk W = ${roundTo(sw.statistic, 3)}, ${formatP(sw.pValue)}` : '',\n  ].filter(Boolean).join('; ')\n\n  return {\n    n,\n    mean: roundTo(m, 6),\n    median: roundTo(med, 6),\n    mode: modes,\n    trimmedMean: roundTo(tm, 6),\n    sd: roundTo(s, 6),\n    se: roundTo(sem, 6),\n    variance: roundTo(v, 6),\n    min: mn,\n    max: mx,\n    range: mx - mn,\n    iqr: roundTo(iqr, 6),\n    q1: roundTo(q1, 6),\n    q3: roundTo(q3, 6),\n    skewness: roundTo(skew, 6),\n    kurtosis: roundTo(kurt, 6),\n    ci,\n    ciLevel,\n    shapiroWilk: sw,\n    formatted,\n  }\n}\n\n// Named re-export of math utilities for external use\nexport { _mean as mean, _median as median, _sd as sd, _se as se, _variance as variance, quantile }\n", "/**\n * Effect size calculations for Carm.\n * Cohen's d, Hedges' g, eta-squared, omega-squared, rank-biserial correlation.\n * All functions return structured EffectSize objects.\n */\n\nimport { mean as _mean, variance as _variance, sd as _sd } from '../core/math.js'\nimport {\n  interpretCohensD,\n  interpretEtaSq,\n  interpretR,\n} from '../core/apa.js'\nimport type { EffectSize, EffectInterpretation } from '../core/types.js'\n\n// \u2500\u2500\u2500 Cohen's d \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Cohen's d for independent samples.\n * Uses pooled SD (equal variances assumed).\n * Formula: d = (M\u2081 - M\u2082) / SD_pooled\n * Reference: Cohen (1988), \"Statistical Power Analysis for the Behavioral Sciences\"\n *\n * Cross-validated with R:\n * > library(effsize)\n * > cohen.d(c(1,2,3,4,5), c(3,4,5,6,7))\n * d = -1.2649...  (negative because group2 > group1)\n */\nexport function cohensD(x1: readonly number[], x2: readonly number[]): EffectSize {\n  if (x1.length < 2 || x2.length < 2) throw new Error('cohensD: need at least 2 observations per group')\n  const n1 = x1.length, n2 = x2.length\n  const m1 = _mean(x1), m2 = _mean(x2)\n  const v1 = _variance(x1), v2 = _variance(x2)\n  // Pooled SD\n  const sdPooled = Math.sqrt(((n1 - 1) * v1 + (n2 - 1) * v2) / (n1 + n2 - 2))\n  if (sdPooled === 0) return { value: 0, name: \"Cohen's d\", interpretation: 'negligible' }\n  const d = (m1 - m2) / sdPooled\n  return {\n    value: d,\n    name: \"Cohen's d\",\n    interpretation: interpretCohensD(d) as EffectInterpretation,\n  }\n}\n\n/**\n * Cohen's d for paired samples (dependent t-test).\n * Formula: d = M_diff / SD_diff\n */\nexport function cohensDPaired(diffs: readonly number[]): EffectSize {\n  if (diffs.length < 2) throw new Error('cohensDPaired: need at least 2 differences')\n  const m = _mean(diffs)\n  const s = _sd(diffs)\n  const d = s === 0 ? 0 : m / s\n  return {\n    value: d,\n    name: \"Cohen's d\",\n    interpretation: interpretCohensD(d) as EffectInterpretation,\n  }\n}\n\n// \u2500\u2500\u2500 Hedges' g \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Hedges' g \u2014 bias-corrected version of Cohen's d.\n * Correction factor J = 1 - 3/(4\u00B7df - 1), df = n1 + n2 - 2.\n * Reference: Hedges (1981), Journal of Educational Statistics\n */\nexport function hedgesG(x1: readonly number[], x2: readonly number[]): EffectSize {\n  const d = cohensD(x1, x2)\n  const df = x1.length + x2.length - 2\n  const J = 1 - 3 / (4 * df - 1)\n  const g = d.value * J\n  return {\n    value: g,\n    name: \"Hedges' g\",\n    interpretation: interpretCohensD(g) as EffectInterpretation,\n  }\n}\n\n// \u2500\u2500\u2500 Eta-squared \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Eta-squared: \u03B7\u00B2 = SS_between / SS_total\n * For one-way ANOVA. Between 0 and 1.\n * Reference: Cohen (1973)\n */\nexport function etaSquared(ssBetween: number, ssTotal: number): EffectSize {\n  if (ssTotal <= 0) return { value: 0, name: '\u03B7\u00B2', interpretation: 'negligible' }\n  const eta2 = Math.max(0, Math.min(1, ssBetween / ssTotal))\n  return {\n    value: eta2,\n    name: '\u03B7\u00B2',\n    interpretation: interpretEtaSq(eta2) as EffectInterpretation,\n  }\n}\n\n/**\n * Omega-squared: \u03C9\u00B2 = (SS_between - df_between \u00B7 MS_within) / (SS_total + MS_within)\n * Less biased than eta-squared.\n * Reference: Hays (1963)\n */\nexport function omegaSquared(\n  ssBetween: number,\n  ssTotal: number,\n  dfBetween: number,\n  msWithin: number\n): EffectSize {\n  const denom = ssTotal + msWithin\n  if (denom <= 0) return { value: 0, name: '\u03C9\u00B2', interpretation: 'negligible' }\n  const omega2 = Math.max(0, (ssBetween - dfBetween * msWithin) / denom)\n  return {\n    value: omega2,\n    name: '\u03C9\u00B2',\n    interpretation: interpretEtaSq(omega2) as EffectInterpretation,\n  }\n}\n\n// \u2500\u2500\u2500 Rank-biserial correlation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Rank-biserial correlation for Mann-Whitney U.\n * r = 1 - (2U) / (n1 * n2)\n * Reference: Wendt (1972)\n */\nexport function rankBiserial(U: number, n1: number, n2: number): EffectSize {\n  const r = 1 - 2 * U / (n1 * n2)\n  return {\n    value: r,\n    name: 'r (rank-biserial)',\n    interpretation: interpretR(r) as EffectInterpretation,\n  }\n}\n\n/**\n * Rank-biserial correlation for Wilcoxon signed-rank (paired).\n * r = T / (n(n+1)/2) where T = sum of positive ranks (or negative).\n */\nexport function rankBiserialWilcoxon(T: number, n: number): EffectSize {\n  const maxT = n * (n + 1) / 2\n  const r = maxT > 0 ? T / maxT * 2 - 1 : 0\n  return {\n    value: r,\n    name: 'r (rank-biserial)',\n    interpretation: interpretR(r) as EffectInterpretation,\n  }\n}\n\n// \u2500\u2500\u2500 Eta\u00B2 for Kruskal-Wallis \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Eta-squared for Kruskal-Wallis: \u03B7\u00B2_H = (H - k + 1) / (n - k)\n * Reference: Tomczak & Tomczak (2014)\n */\nexport function etaSquaredKW(H: number, k: number, n: number): EffectSize {\n  const eta2 = Math.max(0, (H - k + 1) / (n - k))\n  return {\n    value: eta2,\n    name: '\u03B7\u00B2_H',\n    interpretation: interpretEtaSq(eta2) as EffectInterpretation,\n  }\n}\n\n// \u2500\u2500\u2500 CI for Cohen's d \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Normal approximation CI for Cohen's d.\n * Reference: Hedges & Olkin (1985), \"Statistical Methods for Meta-Analysis\"\n */\nexport function cohensDCI(\n  d: number,\n  n1: number,\n  n2: number,\n  ciLevel = 0.95\n): readonly [number, number] {\n  const sampleSE = Math.sqrt((n1 + n2) / (n1 * n2) + d * d / (2 * (n1 + n2)))\n  const z = normalQuantileInline(1 - (1 - ciLevel) / 2)\n  return [d - z * sampleSE, d + z * sampleSE]\n}\n\n/** Inline normal quantile to avoid circular import. */\nfunction normalQuantileInline(p: number): number {\n  const a = [2.515517, 0.802853, 0.010328]\n  const b = [1.432788, 0.189269, 0.001308]\n  const t = Math.sqrt(-2 * Math.log(p <= 0.5 ? p : 1 - p))\n  const num = a[0]! + a[1]! * t + a[2]! * t * t\n  const den = 1 + b[0]! * t + b[1]! * t * t + b[2]! * t * t * t\n  const x = t - num / den\n  return p <= 0.5 ? -x : x\n}\n", "/**\n * Frequency analysis module.\n * Frequency tables, chi-square test of independence, Fisher's exact test,\n * Cram\u00E9r's V, phi coefficient, odds ratio, goodness-of-fit test.\n */\n\nimport { chiSqPValue, normalQuantile, incompleteBeta, normalCDF, normalSurvival, logGamma } from '../core/math.js'\nimport { formatChiSq, formatP, interpretCramerV, formatBinomial, formatProportions } from '../core/apa.js'\nimport { PRNG } from '../core/prng.js'\nimport type {\n  FrequencyRow,\n  FrequencyTestResult,\n  StatResult,\n  EffectSize,\n  EffectInterpretation,\n} from '../core/types.js'\n\n// \u2500\u2500\u2500 Frequency table \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Build a frequency table from an array of values.\n * Returns rows sorted by value with absolute, relative, and cumulative frequencies.\n */\nexport function frequencyTable(data: readonly (string | number)[]): FrequencyRow[] {\n  const counts = new Map<string | number, number>()\n  for (const v of data) counts.set(v, (counts.get(v) ?? 0) + 1)\n\n  const total = data.length\n  const sorted = [...counts.entries()].sort((a, b) => {\n    const av = typeof a[0] === 'number' ? a[0] : String(a[0])\n    const bv = typeof b[0] === 'number' ? b[0] : String(b[0])\n    return av < bv ? -1 : av > bv ? 1 : 0\n  })\n\n  let cumulative = 0\n  return sorted.map(([value, count]) => {\n    const relative = count / total\n    cumulative += relative\n    return { value, count, relative, cumulative: Math.min(1, cumulative) }\n  })\n}\n\n// \u2500\u2500\u2500 Contingency table helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Convert grouped data to a contingency table (rows = group1, cols = group2). */\nexport function contingencyTable(\n  group1: readonly (string | number)[],\n  group2: readonly (string | number)[]\n): { table: number[][]; rowLabels: (string | number)[]; colLabels: (string | number)[] } {\n  if (group1.length !== group2.length) throw new Error('contingencyTable: arrays must have equal length')\n\n  const rowSet = [...new Set(group1)].sort()\n  const colSet = [...new Set(group2)].sort()\n  const table = Array.from({ length: rowSet.length }, () =>\n    new Array<number>(colSet.length).fill(0)\n  )\n\n  for (let i = 0; i < group1.length; i++) {\n    const r = rowSet.indexOf(group1[i]!)\n    const c = colSet.indexOf(group2[i]!)\n    table[r]![c]!++\n  }\n\n  return { table, rowLabels: rowSet, colLabels: colSet }\n}\n\n// \u2500\u2500\u2500 Expected counts \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction expectedCounts(observed: readonly (readonly number[])[]): number[][] {\n  const R = observed.length\n  const C = observed[0]!.length\n  const rowTotals = observed.map(row => row.reduce((s, v) => s + v, 0))\n  const colTotals = Array.from({ length: C }, (_, j) =>\n    observed.reduce((s, row) => s + (row[j] ?? 0), 0)\n  )\n  const total = rowTotals.reduce((s, v) => s + v, 0)\n\n  return Array.from({ length: R }, (_, i) =>\n    Array.from({ length: C }, (_, j) => (rowTotals[i]! * (colTotals[j] ?? 0)) / total)\n  )\n}\n\n// \u2500\u2500\u2500 Chi-square test of independence \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Pearson chi-square test of independence for a contingency table.\n *\n * Cross-validated with R:\n * > chisq.test(matrix(c(10,20,30,40), nrow=2))\n * X-squared = 0.6061, df = 1, p-value = 0.4363\n * Cram\u00E9r's V = 0.0875\n */\nexport function chiSquareTest(\n  observed: readonly (readonly number[])[],\n  yatesCorrection = false\n): FrequencyTestResult {\n  const R = observed.length\n  if (R < 2) throw new Error('chiSquareTest: need at least 2 rows')\n  const C = observed[0]!.length\n  if (C < 2) throw new Error('chiSquareTest: need at least 2 columns')\n\n  const expected = expectedCounts(observed)\n  const n = observed.reduce((s, row) => s + row.reduce((a, v) => a + v, 0), 0)\n\n  let chiSq = 0\n  for (let i = 0; i < R; i++) {\n    for (let j = 0; j < C; j++) {\n      const o = observed[i]![j] ?? 0\n      const e = expected[i]![j] ?? 0\n      if (e < 5) { /* warn: expected < 5, consider Fisher */ }\n      const num = yatesCorrection ? Math.max(0, Math.abs(o - e) - 0.5) : o - e\n      chiSq += (num * num) / e\n    }\n  }\n\n  const df = (R - 1) * (C - 1)\n  const pValue = chiSqPValue(chiSq, df)\n\n  // Cram\u00E9r's V\n  const minDim = Math.min(R, C) - 1\n  const cramersV = Math.sqrt(chiSq / (n * Math.max(1, minDim)))\n  const effectSize: EffectSize = {\n    value: cramersV,\n    name: \"Cram\u00E9r's V\",\n    interpretation: interpretCramerV(cramersV, df) as EffectInterpretation,\n  }\n\n  const ci: readonly [number, number] = [NaN, NaN]\n  const formatted = formatChiSq(chiSq, df, pValue, cramersV, \"V\")\n\n  return {\n    testName: \"Pearson's \u03C7\u00B2\",\n    statistic: chiSq,\n    df,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel: 0.95,\n    n,\n    formatted,\n    table: frequencyTable(observed.flatMap((row, i) =>\n      row.flatMap((count, j) => new Array<string>(count).fill(`${i},${j}`))\n    )),\n    expectedCounts: expected,\n  }\n}\n\n// \u2500\u2500\u2500 Fisher's exact test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Fisher's exact test for 2\u00D72 contingency tables.\n * Uses the hypergeometric distribution.\n *\n * Cross-validated with R:\n * > fisher.test(matrix(c(11, 5, 3, 6), nrow=2))\n * p-value = 0.2684, odds ratio = 4.0\n */\nexport function fisherExactTest(a: number, b: number, c: number, d: number): StatResult {\n  if (a < 0 || b < 0 || c < 0 || d < 0) throw new Error('fisherExactTest: all cells must be non-negative')\n\n  const n = a + b + c + d\n  const r1 = a + b  // row 1 total\n  const c1 = a + c  // col 1 total\n  const c2 = b + d  // col 2 total\n\n  // Two-tailed p-value: sum all tables at least as extreme\n  const pObserved = hypergeomPMF(a, r1, c1, n)\n  let pValue = 0\n  const kMin = Math.max(0, r1 - c2)\n  const kMax = Math.min(r1, c1)\n  for (let k = kMin; k <= kMax; k++) {\n    const p = hypergeomPMF(k, r1, c1, n)\n    if (p <= pObserved + 1e-10) pValue += p\n  }\n  pValue = Math.min(1, pValue)\n\n  // Odds ratio (a\u00B7d)/(b\u00B7c), with 0.5 continuity if any cell is 0\n  const oddsRatio = (b === 0 || c === 0)\n    ? ((a + 0.5) * (d + 0.5)) / ((b + 0.5) * (c + 0.5))\n    : (a * d) / (b * c)\n\n  // CI for log(OR) via normal approximation\n  const se = Math.sqrt(1 / (a + 0.5) + 1 / (b + 0.5) + 1 / (c + 0.5) + 1 / (d + 0.5))\n  const z = normalQuantile(0.975)\n  const logOR = Math.log(oddsRatio)\n  const ci: readonly [number, number] = [Math.exp(logOR - z * se), Math.exp(logOR + z * se)]\n\n  const effectSize: EffectSize = {\n    value: oddsRatio,\n    name: 'Odds ratio',\n    interpretation: oddsRatio >= 3 ? 'large' : oddsRatio >= 1.5 ? 'medium' : 'small',\n  }\n\n  return {\n    testName: \"Fisher's Exact Test\",\n    statistic: oddsRatio,\n    df: 1,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel: 0.95,\n    n,\n    formatted: `OR = ${oddsRatio.toFixed(2)}, ${formatP(pValue)}, 95% CI [${ci[0].toFixed(2)}, ${ci[1].toFixed(2)}]`,\n  }\n}\n\n/** Hypergeometric PMF: P(X = k | n, K, N). */\nfunction hypergeomPMF(k: number, n: number, K: number, N: number): number {\n  return Math.exp(\n    logCombination(K, k) + logCombination(N - K, n - k) - logCombination(N, n)\n  )\n}\n\n/** Log of binomial coefficient: log C(n, k). */\nfunction logCombination(n: number, k: number): number {\n  if (k < 0 || k > n) return -Infinity\n  if (k === 0 || k === n) return 0\n  return logFactorial(n) - logFactorial(k) - logFactorial(n - k)\n}\n\n/** Log factorial using Stirling-style accumulation for small n. */\nfunction logFactorial(n: number): number {\n  if (n <= 1) return 0\n  let result = 0\n  for (let i = 2; i <= n; i++) result += Math.log(i)\n  return result\n}\n\n// \u2500\u2500\u2500 Phi coefficient \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Phi coefficient for 2\u00D72 tables: \u03C6 = (ad - bc) / sqrt((a+b)(c+d)(a+c)(b+d))\n */\nexport function phiCoefficient(a: number, b: number, c: number, d: number): number {\n  const denom = Math.sqrt((a + b) * (c + d) * (a + c) * (b + d))\n  return denom === 0 ? 0 : (a * d - b * c) / denom\n}\n\n// \u2500\u2500\u2500 Goodness-of-fit test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Chi-square goodness-of-fit test.\n * Tests whether observed frequencies match expected proportions.\n *\n * Cross-validated with R:\n * > chisq.test(c(30, 20, 50), p = c(1/3, 1/3, 1/3))\n * X-squared = 10, df = 2, p-value = 0.006738\n */\nexport function goodnessOfFit(\n  observed: readonly number[],\n  expected?: readonly number[]  // proportions; if omitted, assumes equal\n): StatResult {\n  const n = observed.reduce((s, v) => s + v, 0)\n  const k = observed.length\n  if (k < 2) throw new Error('goodnessOfFit: need at least 2 categories')\n\n  const expCounts = expected\n    ? expected.map(p => p * n)\n    : new Array<number>(k).fill(n / k)\n\n  let chiSq = 0\n  for (let i = 0; i < k; i++) {\n    const o = observed[i] ?? 0\n    const e = expCounts[i] ?? 0\n    if (e <= 0) throw new Error(`goodnessOfFit: expected count must be > 0 at index ${i}`)\n    chiSq += (o - e) ** 2 / e\n  }\n\n  const df = k - 1\n  const pValue = chiSqPValue(chiSq, df)\n  const w = Math.sqrt(chiSq / n)  // Cohen's w\n\n  return {\n    testName: 'Chi-square goodness-of-fit',\n    statistic: chiSq,\n    df,\n    pValue,\n    effectSize: {\n      value: w,\n      name: \"Cohen's w\",\n      interpretation: w < 0.1 ? 'negligible' : w < 0.3 ? 'small' : w < 0.5 ? 'medium' : 'large',\n    },\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted: formatChiSq(chiSq, df, pValue, w, \"w\"),\n  }\n}\n\n// \u2500\u2500\u2500 Cram\u00E9r's V with Bootstrap CI \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Cram\u00E9r's V with bootstrap confidence interval via multinomial resampling.\n *\n * Cross-validated with R:\n * > library(rcompanion)\n * > m <- matrix(c(10,20,30,40,50,60), nrow=2)\n * > cramerV(m, ci=TRUE, R=2000)\n */\nexport function cramersVWithCI(\n  observed: readonly (readonly number[])[],\n  ciLevel = 0.95,\n  nBoot = 2000,\n  seed = 42\n): StatResult {\n  const R = observed.length\n  const C = observed[0]!.length\n  if (R < 2 || C < 2) throw new Error('cramersVWithCI: need at least a 2\u00D72 table')\n\n  // Compute observed V via chiSquareTest\n  const result = chiSquareTest(observed)\n  const V = result.effectSize.value\n  const n = result.n\n  const df = (R - 1) * (C - 1)\n\n  // Flatten observed into multinomial probabilities\n  const flat: number[] = []\n  for (let i = 0; i < R; i++) {\n    for (let j = 0; j < C; j++) {\n      flat.push(observed[i]![j]!)\n    }\n  }\n  const probs = flat.map(c => c / n)\n\n  // Cumulative probabilities for multinomial sampling\n  const cumProbs: number[] = []\n  let cumSum = 0\n  for (const p of probs) {\n    cumSum += p\n    cumProbs.push(cumSum)\n  }\n\n  const rng = new PRNG(seed)\n  const bootV: number[] = []\n\n  for (let b = 0; b < nBoot; b++) {\n    // Generate bootstrap table via multinomial resampling\n    const bootFlat = new Array<number>(flat.length).fill(0)\n    for (let s = 0; s < n; s++) {\n      const u = rng.next()\n      let idx = 0\n      while (idx < cumProbs.length - 1 && u > cumProbs[idx]!) idx++\n      bootFlat[idx]!++\n    }\n\n    // Reshape to table and compute V\n    const bootTable: number[][] = Array.from({ length: R }, (_, i) =>\n      bootFlat.slice(i * C, (i + 1) * C)\n    )\n\n    // Compute chi-square for bootstrap table\n    const bootN = n\n    const rowTotals = bootTable.map(row => row.reduce((s, v) => s + v, 0))\n    const colTotals = Array.from({ length: C }, (_, j) =>\n      bootTable.reduce((s, row) => s + (row[j] ?? 0), 0)\n    )\n    let chiSq = 0\n    let valid = true\n    for (let i = 0; i < R; i++) {\n      for (let j = 0; j < C; j++) {\n        const e = (rowTotals[i]! * (colTotals[j] ?? 0)) / bootN\n        if (e <= 0) { valid = false; break }\n        const o = bootTable[i]![j]!\n        chiSq += (o - e) ** 2 / e\n      }\n      if (!valid) break\n    }\n    if (!valid) continue\n\n    const minDim = Math.min(R, C) - 1\n    bootV.push(Math.sqrt(chiSq / (bootN * Math.max(1, minDim))))\n  }\n\n  // Percentile CI\n  bootV.sort((a, b) => a - b)\n  const alpha = 1 - ciLevel\n  const loIdx = Math.max(0, Math.floor((alpha / 2) * bootV.length))\n  const hiIdx = Math.min(bootV.length - 1, Math.floor((1 - alpha / 2) * bootV.length))\n  const ci: readonly [number, number] = [bootV[loIdx]!, bootV[hiIdx]!]\n\n  const effectSize: EffectSize = {\n    value: V,\n    name: \"Cram\u00E9r's V\",\n    interpretation: interpretCramerV(V, df) as EffectInterpretation,\n  }\n\n  const ciPct = Math.round(ciLevel * 100)\n  const formatted = `V = ${V.toFixed(2)}, ${ciPct}% CI [${ci[0].toFixed(2)}, ${ci[1].toFixed(2)}]`\n\n  return {\n    testName: \"Cram\u00E9r's V with Bootstrap CI\",\n    statistic: V,\n    df,\n    pValue: result.pValue,\n    effectSize,\n    ci,\n    ciLevel,\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 McNemar's Test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * McNemar's test for paired nominal data (2\u00D72 table).\n * Inputs b and c are off-diagonal counts: b = 0\u21921 switches, c = 1\u21920 switches.\n *\n * Cross-validated with R:\n * > mcnemar.test(matrix(c(20, 5, 10, 15), nrow=2), correct=FALSE)\n * McNemar's chi-squared = 1.6667, df = 1, p-value = 0.1967\n */\nexport function mcnemarsTest(\n  b: number,\n  c: number,\n  correction = false\n): StatResult {\n  if (b < 0 || c < 0) throw new Error('mcnemarsTest: b and c must be non-negative')\n  if (b + c === 0) throw new Error('mcnemarsTest: b + c must be > 0')\n\n  const diff = Math.abs(b - c)\n  const corrected = correction ? Math.max(0, diff - 1) : diff\n  const chiSq = (corrected * corrected) / (b + c)\n  const df = 1\n  const pValue = chiSqPValue(chiSq, df)\n\n  // Effect size: odds ratio b/c\n  const oddsRatio = c === 0 ? Infinity : b / c\n\n  const effectSize: EffectSize = {\n    value: oddsRatio,\n    name: 'Odds ratio',\n    interpretation: oddsRatio >= 3 || (oddsRatio > 0 && oddsRatio <= 1 / 3) ? 'large'\n      : oddsRatio >= 1.5 || (oddsRatio > 0 && oddsRatio <= 1 / 1.5) ? 'medium' : 'small',\n  }\n\n  const formatted = `\u03C7\u00B2(${df}) = ${chiSq.toFixed(2)}, ${formatP(pValue)}, OR = ${oddsRatio === Infinity ? '\u221E' : oddsRatio.toFixed(2)}`\n\n  return {\n    testName: \"McNemar's Test\",\n    statistic: chiSq,\n    df,\n    pValue,\n    effectSize,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n: b + c,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Binomial Test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Exact binomial test with Clopper-Pearson CI.\n * Uses regularized incomplete beta function for exact p-values and CI.\n *\n * Cross-validated with R:\n * > binom.test(6, 10, p = 0.5)\n * p-value = 0.7539, 95% CI [0.2624, 0.8784]\n */\nexport function binomialTest(\n  successes: number,\n  trials: number,\n  p0 = 0.5,\n  alternative: 'two.sided' | 'less' | 'greater' = 'two.sided',\n  ciLevel = 0.95\n): StatResult {\n  if (trials < 1) throw new Error('binomialTest: trials must be >= 1')\n  if (successes < 0 || successes > trials) throw new Error('binomialTest: successes must be in [0, trials]')\n  if (p0 <= 0 || p0 >= 1) throw new Error('binomialTest: p0 must be in (0, 1)')\n\n  const k = successes\n  const n = trials\n  const pHat = k / n\n\n  // Handle boundary cases where incompleteBeta would call logGamma(0)\n  // P(X <= k) = I_{1-p0}(n-k, k+1)\n  const pLessOrEqual = (k === n) ? 1 : incompleteBeta(1 - p0, n - k, k + 1)\n  // P(X >= k) = I_{p0}(k, n-k+1) = 1 - P(X <= k-1)\n  const pGreaterOrEqual = k === 0 ? 1 : ((k === n) ? Math.pow(p0, n) : incompleteBeta(p0, k, n - k + 1))\n\n  let pValue: number\n  if (alternative === 'less') {\n    pValue = pLessOrEqual\n  } else if (alternative === 'greater') {\n    pValue = pGreaterOrEqual\n  } else {\n    // R's binom.test two-sided: sum probabilities of all outcomes\n    // at least as extreme as the observed (exact two-sided method).\n    // For small n, compute the exact sum.\n    pValue = binomialTwoSidedP(k, n, p0)\n  }\n\n  // Clopper-Pearson exact CI via bisection on incompleteBeta\n  const alpha = 1 - ciLevel\n  let ciLo: number, ciHi: number\n\n  if (k === 0) {\n    ciLo = 0\n  } else {\n    // Find p such that I_p(k, n-k+1) = alpha/2  (lower bound)\n    ciLo = bisectBetaQuantile(alpha / 2, k, n - k + 1)\n  }\n\n  if (k === n) {\n    ciHi = 1\n  } else {\n    // Find p such that I_p(k+1, n-k) = 1 - alpha/2  (upper bound)\n    ciHi = bisectBetaQuantile(1 - alpha / 2, k + 1, n - k)\n  }\n\n  const ci: readonly [number, number] = [ciLo, ciHi]\n\n  // Effect size: Cohen's g\n  const g = Math.abs(pHat - p0)\n\n  const effectSize: EffectSize = {\n    value: g,\n    name: \"Cohen's g\",\n    interpretation: g < 0.05 ? 'negligible' : g < 0.15 ? 'small' : g < 0.25 ? 'medium' : 'large',\n  }\n\n  return {\n    testName: 'Exact Binomial Test',\n    statistic: k,\n    df: 0,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel,\n    n,\n    formatted: formatBinomial(pHat, pValue, ci, g, ciLevel),\n  }\n}\n\n/**\n * Exact two-sided binomial p-value matching R's binom.test.\n * Sums probabilities of all outcomes with P(X=j) <= P(X=k).\n * Uses log-space computation to avoid overflow.\n */\nfunction binomialTwoSidedP(k: number, n: number, p0: number): number {\n  // Compute log(P(X = j)) = log(C(n,j)) + j*log(p0) + (n-j)*log(1-p0)\n  const logP0 = Math.log(p0)\n  const logQ0 = Math.log(1 - p0)\n\n  // Log of binomial coefficient via logGamma, handling edge cases\n  const logBinomPMF = (j: number): number => {\n    if (j < 0 || j > n) return -Infinity\n    // Use Stirling: log(C(n,j)) = logGamma(n+1) - logGamma(j+1) - logGamma(n-j+1)\n    // logGamma(1) = 0, so logGamma(0+1) = 0\n    const logCoeff = logGamma(n + 1) - logGamma(j + 1) - logGamma(n - j + 1)\n    return logCoeff + j * logP0 + (n - j) * logQ0\n  }\n\n  const logPk = logBinomPMF(k)\n\n  // Sum P(X=j) for all j where P(X=j) <= P(X=k)\n  // Use a small tolerance for floating point comparison (matching R's relErr = 1 + 1e-7)\n  let pValue = 0\n  for (let j = 0; j <= n; j++) {\n    const logPj = logBinomPMF(j)\n    if (logPj <= logPk + 1e-7) {\n      pValue += Math.exp(logPj)\n    }\n  }\n  return Math.min(1, pValue)\n}\n\n/**\n * Bisection to find the quantile of a Beta(a, b) distribution.\n * Finds x such that I_x(a, b) = target.\n */\nfunction bisectBetaQuantile(target: number, a: number, b: number): number {\n  let lo = 0, hi = 1\n  for (let iter = 0; iter < 100; iter++) {\n    const mid = (lo + hi) / 2\n    const val = incompleteBeta(mid, a, b)\n    if (val < target) lo = mid\n    else hi = mid\n    if (hi - lo < 1e-10) break\n  }\n  return (lo + hi) / 2\n}\n\n// \u2500\u2500\u2500 Proportions Z-Test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Z-test for proportions (1-sample or 2-sample).\n *\n * Cross-validated with R:\n * > prop.test(c(30, 40), c(100, 100), correct=FALSE)\n * X-squared = 2.2222, p-value = 0.1360  (z = -1.4907)\n *\n * > prop.test(60, 100, p=0.5, correct=FALSE)\n * X-squared = 4, p-value = 0.0455  (z = 2.0)\n */\nexport function proportionsZTest(\n  x1: number,\n  n1: number,\n  x2?: number,\n  n2?: number,\n  p0 = 0.5,\n  alternative: 'two.sided' | 'less' | 'greater' = 'two.sided',\n  ciLevel = 0.95,\n  yates = false\n): StatResult {\n  if (n1 < 1) throw new Error('proportionsZTest: n1 must be >= 1')\n  if (x1 < 0 || x1 > n1) throw new Error('proportionsZTest: x1 must be in [0, n1]')\n\n  const twoSample = x2 !== undefined && n2 !== undefined\n  const pHat1 = x1 / n1\n  const alpha = 1 - ciLevel\n  const zCrit = normalQuantile(1 - alpha / 2)\n\n  let z: number\n  let ci: readonly [number, number]\n  let h: number\n  let n: number\n\n  if (twoSample) {\n    if (n2! < 1) throw new Error('proportionsZTest: n2 must be >= 1')\n    if (x2! < 0 || x2! > n2!) throw new Error('proportionsZTest: x2 must be in [0, n2]')\n\n    const pHat2 = x2! / n2!\n    const pooledP = (x1 + x2!) / (n1 + n2!)\n    const se = Math.sqrt(pooledP * (1 - pooledP) * (1 / n1 + 1 / n2!))\n    const diff = pHat1 - pHat2\n    const absDiff = Math.abs(diff)\n    const correction = yates ? 0.5 * (1 / n1 + 1 / n2!) : 0\n    const correctedDiff = Math.max(0, absDiff - correction)\n    z = se === 0 ? 0 : (diff >= 0 ? correctedDiff : -correctedDiff) / se\n\n    // Wald CI for the difference (unpooled SE)\n    const seDiff = Math.sqrt(pHat1 * (1 - pHat1) / n1 + pHat2 * (1 - pHat2) / n2!)\n    ci = [diff - zCrit * seDiff, diff + zCrit * seDiff]\n\n    // Cohen's h\n    h = 2 * Math.asin(Math.sqrt(pHat1)) - 2 * Math.asin(Math.sqrt(pHat2))\n    n = n1 + n2!\n  } else {\n    // 1-sample\n    const se = Math.sqrt(p0 * (1 - p0) / n1)\n    const diff = pHat1 - p0\n    const absDiff = Math.abs(diff)\n    const correction = yates ? 0.5 / n1 : 0\n    const correctedDiff = Math.max(0, absDiff - correction)\n    z = se === 0 ? 0 : (diff >= 0 ? correctedDiff : -correctedDiff) / se\n\n    // Wald CI for proportion\n    const seProp = Math.sqrt(pHat1 * (1 - pHat1) / n1)\n    ci = [pHat1 - zCrit * seProp, pHat1 + zCrit * seProp]\n\n    // Cohen's h\n    h = 2 * Math.asin(Math.sqrt(pHat1)) - 2 * Math.asin(Math.sqrt(p0))\n    n = n1\n  }\n\n  // p-value from z\n  let pValue: number\n  if (alternative === 'less') {\n    pValue = normalCDF(z)\n  } else if (alternative === 'greater') {\n    pValue = normalSurvival(z)\n  } else {\n    pValue = 2 * normalSurvival(Math.abs(z))\n  }\n\n  const effectSize: EffectSize = {\n    value: h,\n    name: \"Cohen's h\",\n    interpretation: Math.abs(h) < 0.2 ? 'negligible'\n      : Math.abs(h) < 0.5 ? 'small'\n      : Math.abs(h) < 0.8 ? 'medium' : 'large',\n  }\n\n  return {\n    testName: twoSample ? 'Two-sample Z-test for proportions' : 'One-sample Z-test for proportions',\n    statistic: z,\n    df: 0,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel,\n    n,\n    formatted: formatProportions(z, pValue, h, ci, ciLevel),\n  }\n}\n", "/**\n * Regression analysis module.\n * Simple and multiple OLS, logistic regression, polynomial regression,\n * diagnostics (R\u00B2, AIC, BIC, VIF, residual plots).\n */\n\nimport { mean as _mean, variance as _variance, fDistPValue, tDistPValue, tDistQuantile, normalQuantile, logGamma, digamma, trigamma, roundTo } from '../core/math.js'\nimport { formatRegression, formatPoisson, formatNegBin } from '../core/apa.js'\nimport { Matrix } from '../core/matrix.js'\nimport type { RegressionResult, RegressionCoef, OrdinalRegressionResult } from '../core/types.js'\n\n// \u2500\u2500\u2500 OLS Helper \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Fit OLS regression: y = X\u03B2 + \u03B5\n * Returns coefficients, SE, t-statistics, p-values, R\u00B2, AIC, BIC.\n *\n * Cross-validated with R:\n * > lm(y ~ x1 + x2, data = df)\n */\nfunction fitOLS(\n  X: Matrix,\n  y: readonly number[],\n  coefNames: readonly string[],\n  ciLevel = 0.95\n): RegressionResult {\n  const n = y.length\n  const p = X.cols  // includes intercept column\n\n  const Xt = X.transpose()\n  const XtX = Xt.multiply(X)\n  const XtY = Xt.multiply(Matrix.colVec(y))\n  const XtXInv = XtX.inverse()\n  const betaM = XtXInv.multiply(XtY)\n  const beta = Array.from({ length: p }, (_, i) => betaM.get(i, 0))\n\n  // Fitted values and residuals\n  const fitted = Array.from({ length: n }, (_, i) => {\n    let val = 0\n    for (let j = 0; j < p; j++) val += X.get(i, j) * (beta[j] ?? 0)\n    return val\n  })\n  const residuals = y.map((v, i) => v - (fitted[i] ?? 0))\n\n  // RSS, TSS\n  const yMean = _mean(y)\n  const ss_res = residuals.reduce((s, r) => s + r * r, 0)\n  const ss_tot = y.reduce((s, v) => s + (v - yMean) ** 2, 0)\n  const r2 = ss_tot > 0 ? Math.max(0, 1 - ss_res / ss_tot) : 0\n  const adjR2 = 1 - (1 - r2) * (n - 1) / (n - p)\n\n  // sigma\u00B2 = RSS / (n - p)\n  const dfRes = n - p\n  if (dfRes <= 0) throw new Error('fitOLS: not enough degrees of freedom')\n  const sigma2 = ss_res / dfRes\n\n  // SE of coefficients: diag(sigma\u00B2 * (X'X)^-1)\n  const covBeta = XtXInv.scale(sigma2)\n  const tCrit = tDistQuantile(1 - (1 - ciLevel) / 2, dfRes)\n\n  const coefficients: RegressionCoef[] = beta.map((b, i) => {\n    const se = Math.sqrt(Math.max(0, covBeta.get(i, i)))\n    const t = se === 0 ? 0 : b / se\n    const pVal = tDistPValue(t, dfRes)\n    const ci: readonly [number, number] = [b - tCrit * se, b + tCrit * se]\n    return {\n      name: coefNames[i] ?? `\u03B2${i}`,\n      estimate: roundTo(b, 6),\n      se: roundTo(se, 6),\n      tValue: roundTo(t, 4),\n      pValue: roundTo(pVal, 4),\n      ci,\n    }\n  })\n\n  // F-statistic for overall model\n  const dfModel = p - 1  // excluding intercept\n  const ss_reg = ss_tot - ss_res\n  const F = sigma2 === 0 || dfModel === 0 ? 0 : (ss_reg / dfModel) / sigma2\n  const fPValue = fDistPValue(F, dfModel, dfRes)\n\n  // AIC and BIC: -2 * logLik + penalty\n  // logLik for normal errors: -n/2 * log(2\u03C0) - n/2 * log(\u03C3\u00B2) - RSS/(2\u03C3\u00B2)\n  // Clamp RSS to avoid log(0) = -Inf on perfect fit\n  const rssSafe = Math.max(ss_res, 1e-15)\n  const logLik = -n / 2 * (Math.log(2 * Math.PI) + Math.log(rssSafe / n) + 1)\n  const aic = -2 * logLik + 2 * (p + 1)\n  const bic = -2 * logLik + Math.log(n) * (p + 1)\n\n  const formatted = formatRegression(r2, adjR2, F, dfModel, dfRes, fPValue)\n\n  return {\n    coefficients,\n    r2: roundTo(r2, 6),\n    adjR2: roundTo(adjR2, 6),\n    fStatistic: roundTo(F, 4),\n    fDf: [dfModel, dfRes],\n    fPValue: roundTo(fPValue, 4),\n    aic: roundTo(aic, 2),\n    bic: roundTo(bic, 2),\n    residuals,\n    fitted,\n    n,\n    formatted,\n  }\n}\n\n/**\n * Compute residual sum of squares from a design matrix and response.\n * RSS = y'y - y'X(X'X)\u207B\u00B9X'y = ||y - X\u00B7\u03B2\u0302||\u00B2\n * Used by two-way ANOVA and ANCOVA for Type II/III SS via model comparison.\n */\nexport function computeRSS(X: Matrix, y: readonly number[]): number {\n  const Xt = X.transpose()\n  const XtX = Xt.multiply(X)\n  const XtY = Xt.multiply(Matrix.colVec(y))\n  const beta = XtX.inverse().multiply(XtY)\n  const n = y.length\n  let rss = 0\n  for (let i = 0; i < n; i++) {\n    let fitted = 0\n    for (let j = 0; j < X.cols; j++) fitted += X.get(i, j) * beta.get(j, 0)\n    rss += (y[i]! - fitted) ** 2\n  }\n  return rss\n}\n\n// \u2500\u2500\u2500 Simple linear regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Simple linear regression: y = \u03B2\u2080 + \u03B2\u2081\u00B7x\n */\nexport function linearRegression(\n  x: readonly number[],\n  y: readonly number[],\n  ciLevel = 0.95\n): RegressionResult {\n  if (x.length !== y.length) throw new Error('linearRegression: arrays must have equal length')\n  if (x.length < 3) throw new Error('linearRegression: need at least 3 observations')\n  const n = x.length\n  const X = Matrix.fromArray(Array.from({ length: n }, (_, i) => [1, x[i] ?? 0]))\n  return fitOLS(X, y, ['(Intercept)', 'x'], ciLevel)\n}\n\n// \u2500\u2500\u2500 Multiple linear regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Multiple linear regression: y = \u03B2\u2080 + \u03B2\u2081\u00B7x\u2081 + ... + \u03B2\u2096\u00B7x\u2096\n * `predictors`: named columns { name: values[] }\n */\nexport function multipleRegression(\n  y: readonly number[],\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95\n): RegressionResult {\n  if (predictors.length === 0) throw new Error('multipleRegression: need at least 1 predictor')\n  const n = y.length\n  for (const p of predictors) {\n    if (p.values.length !== n) throw new Error(`multipleRegression: predictor '${p.name}' length mismatch`)\n  }\n\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(p => p.values[i] ?? 0)])\n  )\n  const names = ['(Intercept)', ...predictors.map(p => p.name)]\n  return fitOLS(X, y, names, ciLevel)\n}\n\n// \u2500\u2500\u2500 Polynomial regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Polynomial regression: y = \u03B2\u2080 + \u03B2\u2081\u00B7x + \u03B2\u2082\u00B7x\u00B2 + ... + \u03B2\u2096\u00B7x\u1D4F\n */\nexport function polynomialRegression(\n  x: readonly number[],\n  y: readonly number[],\n  degree: number,\n  ciLevel = 0.95\n): RegressionResult {\n  if (degree < 1) throw new Error('polynomialRegression: degree must be \u2265 1')\n  if (x.length !== y.length) throw new Error('polynomialRegression: arrays must match length')\n  const n = x.length\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) =>\n      [1, ...Array.from({ length: degree }, (_, d) => (x[i] ?? 0) ** (d + 1))]\n    )\n  )\n  const names = ['(Intercept)', ...Array.from({ length: degree }, (_, d) => `x^${d + 1}`)]\n  return fitOLS(X, y, names, ciLevel)\n}\n\n// \u2500\u2500\u2500 Logistic regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Binary logistic regression via IRLS (iteratively reweighted least squares).\n * Outcome y must be 0/1.\n *\n * Implements Fisher scoring matching R's glm.fit exactly:\n *   Working response: z = \u03B7 + (y - \u03BC) / w   where w = \u03BC(1-\u03BC)\n *   Solve WLS: (X'WX) \u03B2_new = X'Wz\n *   Equivalently: (Xw'Xw) \u03B2_new = Xw' zw   with Xw = \u221AW\u00B7X, zw = \u221AW\u00B7z\n *\n * Cross-validated with R:\n * > glm(y ~ x1 + x2, family = binomial, data = df)\n *\n * Cross-validated with Python:\n * > import statsmodels.api as sm\n * > sm.GLM(y, sm.add_constant(X), family=sm.families.Binomial()).fit()\n */\nexport function logisticRegression(\n  y: readonly number[],\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95,\n  maxIter = 100,\n  tol = 1e-8\n): RegressionResult {\n  for (const v of y) {\n    if (v !== 0 && v !== 1) throw new Error('logisticRegression: y must be 0 or 1')\n  }\n  const n = y.length\n  const p = predictors.length + 1  // +intercept\n\n  // Design matrix\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(pr => pr.values[i] ?? 0)])\n  )\n  const names = ['(Intercept)', ...predictors.map(pr => pr.name)]\n\n  // Helper: compute \u03B7 = X\u03B2\n  const computeEta = (b: number[]): number[] =>\n    Array.from({ length: n }, (_, i) => {\n      let v = 0\n      for (let j = 0; j < p; j++) v += X.get(i, j) * (b[j] ?? 0)\n      return v\n    })\n\n  // Helper: logistic with eta clamping to prevent overflow\n  // Clamp output to (eps, 1-eps) matching R's family$linkinv boundary behavior\n  const EPS_MU = 1e-15\n  const logistic = (e: number): number => {\n    const mu = 1 / (1 + Math.exp(-Math.min(700, Math.max(-700, e))))\n    return Math.min(1 - EPS_MU, Math.max(EPS_MU, mu))\n  }\n\n  // Helper: compute deviance = -2 * logLik\n  const computeDeviance = (yArr: readonly number[], muArr: number[]): number => {\n    let dev = 0\n    for (let i = 0; i < n; i++) {\n      const yi = yArr[i] ?? 0\n      const mi = muArr[i]!\n      dev += -2 * (yi * Math.log(Math.max(1e-15, mi)) + (1 - yi) * Math.log(Math.max(1e-15, 1 - mi)))\n    }\n    return dev\n  }\n\n  // IRLS with step-halving (matching R's glm.fit Fisher scoring)\n  // Initialize: intercept = log(p\u0304/(1-p\u0304)), other coefficients = 0\n  let beta = new Array<number>(p).fill(0)\n  const pMeanInit = Math.min(1 - 1e-6, Math.max(1e-6, _mean([...y])))\n  beta[0] = Math.log(pMeanInit / (1 - pMeanInit))\n\n  let prevDeviance = Infinity\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    // \u03B7 = X\u03B2, \u03BC = logistic(\u03B7), w = \u03BC(1-\u03BC)\n    const eta = computeEta(beta)\n    const mu = eta.map(logistic)\n    const w = mu.map(m => Math.max(1e-10, m * (1 - m)))\n\n    // Deviance = -2 * logLik\n    const dev = computeDeviance(y, mu)\n\n    // Convergence: |dev - devold| / (0.1 + |dev|) < tol  (R's formula)\n    if (iter > 0 && Math.abs(dev - prevDeviance) / (0.1 + Math.abs(dev)) < tol) break\n    prevDeviance = dev\n\n    // Working response: z_i = \u03B7_i + (y_i - \u03BC_i) / w_i\n    // This is the linearized pseudo-observation from the Fisher scoring derivation.\n    // R's glm.fit: z <- eta + (y - mu) / mu.eta.val  where mu.eta.val = dmu/deta = mu*(1-mu)\n    const z = Array.from({ length: n }, (_, i) => eta[i]! + ((y[i] ?? 0) - mu[i]!) / w[i]!)\n\n    // Weighted system: Xw = \u221AW\u00B7X, zw = \u221AW\u00B7z\n    // Solve (Xw'Xw) \u03B2_new = Xw' zw  \u27F9  \u03B2_new = (X'WX)\u207B\u00B9 X'Wz\n    const sqrtW = w.map(Math.sqrt)\n    const Xw = Matrix.fromArray(\n      Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n    )\n    const zw = z.map((zi, i) => zi * sqrtW[i]!)\n\n    try {\n      const Xwt = Xw.transpose()\n      const XwtXw = Xwt.multiply(Xw)\n      const XwtZw = Xwt.multiply(Matrix.colVec(zw))\n      const betaNewM = XwtXw.inverse().multiply(XwtZw)\n      const betaNew = Array.from({ length: p }, (_, j) => betaNewM.get(j, 0))\n\n      // Step-halving: if deviance increases or is non-finite, halve toward betaNew\n      let accepted = false\n      let stepScale = 1.0\n      for (let half = 0; half < 10; half++) {\n        const betaTry = beta.map((b, j) => b + stepScale * (betaNew[j]! - b))\n\n        // Compute trial deviance\n        const etaTry = computeEta(betaTry)\n        const muTry = etaTry.map(logistic)\n        const trialDev = computeDeviance(y, muTry)\n\n        if (isFinite(trialDev) && (trialDev <= dev + 1e-8 || half === 9)) {\n          beta = betaTry\n          accepted = true\n          break\n        }\n        stepScale *= 0.5\n      }\n      if (!accepted) break\n    } catch {\n      break  // singular \u2014 stop iterating\n    }\n  }\n\n  // \u2500\u2500 Final quantities at converged \u03B2 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const eta = computeEta(beta)\n  const mu = eta.map(logistic)  // clamped via logistic helper\n  const w = mu.map(m => Math.max(1e-10, m * (1 - m)))\n\n  // Fisher information: (X'WX)\u207B\u00B9 = covariance of \u03B2\u0302\n  const sqrtW = w.map(Math.sqrt)\n  const Xw = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n  )\n  let covBeta: Matrix\n  try {\n    covBeta = Xw.transpose().multiply(Xw).inverse()\n  } catch {\n    covBeta = Matrix.identity(p)\n  }\n\n  // CIs use normal quantile (MLE asymptotics), not t-distribution\n  const zCrit = normalQuantile(1 - (1 - ciLevel) / 2)\n  const coefficients: RegressionCoef[] = beta.map((b, i) => {\n    const se = Math.sqrt(Math.max(0, covBeta.get(i, i)))\n    const zStat = se === 0 ? 0 : b / se\n    const pVal = 2 * (1 - normCDFLocal(Math.abs(zStat)))\n    const ci: readonly [number, number] = [b - zCrit * se, b + zCrit * se]\n    return {\n      name: names[i] ?? `\u03B2${i}`,\n      estimate: roundTo(b, 10),\n      se: roundTo(se, 10),\n      tValue: roundTo(zStat, 6),\n      pValue: roundTo(pVal, 6),\n      ci,\n    }\n  })\n\n  // Log-likelihood at converged estimates\n  const logLik = mu.reduce((s, m, i) => {\n    const yi = y[i] ?? 0\n    return s + yi * Math.log(Math.max(1e-15, m)) + (1 - yi) * Math.log(Math.max(1e-15, 1 - m))\n  }, 0)\n\n  // Null log-likelihood (intercept only)\n  const pMeanRaw = _mean([...y])\n  const pMean = Math.min(1 - 1e-12, Math.max(1e-12, pMeanRaw))\n  const nullLogLik = n * (pMean * Math.log(Math.max(1e-15, pMean)) + (1 - pMean) * Math.log(Math.max(1e-15, 1 - pMean)))\n\n  // McFadden pseudo-R\u00B2\n  const r2 = Math.abs(nullLogLik) < 1e-12 ? NaN : 1 - logLik / nullLogLik\n\n  const aic = -2 * logLik + 2 * p\n  const bic = -2 * logLik + Math.log(n) * p\n  const residuals = y.map((v, i) => (v ?? 0) - (mu[i] ?? 0))\n\n  return {\n    coefficients,\n    r2: roundTo(r2, 6),\n    adjR2: roundTo(r2, 6),  // McFadden's for logistic\n    fStatistic: NaN,\n    fDf: [p - 1, n - p],\n    fPValue: NaN,\n    aic: roundTo(aic, 2),\n    bic: roundTo(bic, 2),\n    residuals,\n    fitted: mu,\n    n,\n    formatted: `McFadden R\u00B2 = ${roundTo(r2, 3)}, AIC = ${roundTo(aic, 1)}`,\n  }\n}\n\nfunction normCDFLocal(z: number): number {\n  const x = Math.abs(z) / Math.SQRT2\n  const t = 1 / (1 + 0.3275911 * x)\n  const poly = t * (0.254829592 + t * (-0.284496736 + t * (1.421413741 + t * (-1.453152027 + t * 1.061405429))))\n  const erf = 1 - poly * Math.exp(-x * x)\n  return 0.5 * (1 + (z >= 0 ? erf : -erf))\n}\n\n// \u2500\u2500\u2500 Regression diagnostics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface RegressionDiagnostics {\n  readonly leverage: readonly number[]       // hat matrix diagonal\n  readonly cooksDistance: readonly number[]  // Cook's D\n  readonly standardizedResiduals: readonly number[]\n  readonly vif: readonly number[]            // variance inflation factors\n}\n\n/**\n * Compute regression diagnostics.\n * Returns leverage (hat values), Cook's distance, standardized residuals, VIF.\n */\nexport function regressionDiagnostics(\n  result: RegressionResult,\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>\n): RegressionDiagnostics {\n  const n = result.n\n  const p = result.coefficients.length\n\n  // Rebuild design matrix\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(pr => pr.values[i] ?? 0)])\n  )\n\n  // Hat matrix diagonal: h_ii = X(X'X)^-1X'\n  const Xt = X.transpose()\n  let XtXInv: Matrix\n  try { XtXInv = Xt.multiply(X).inverse() } catch { XtXInv = Matrix.identity(p) }\n\n  const hat = X.multiply(XtXInv).multiply(Xt)\n  const leverage = Array.from({ length: n }, (_, i) => hat.get(i, i))\n\n  // MSE\n  const mse = result.residuals.reduce((s, r) => s + r * r, 0) / (n - p)\n\n  // Standardized residuals\n  const standardizedResiduals = result.residuals.map((r, i) => {\n    const denom = Math.sqrt(mse * (1 - (leverage[i] ?? 0)))\n    return denom === 0 ? 0 : r / denom\n  })\n\n  // Cook's distance\n  const cooksDistance = result.residuals.map((r, i) => {\n    const h = leverage[i] ?? 0\n    return (r * r * h) / (p * mse * (1 - h) ** 2)\n  })\n\n  // VIF: 1 / (1 - R\u00B2_j) for each predictor\n  const vif = predictors.map((_, j) => {\n    const otherPreds = predictors.filter((__, k) => k !== j)\n    if (otherPreds.length === 0) return 1\n\n    const xj = predictors[j]!.values\n    const others = otherPreds.map(p => ({ name: p.name, values: p.values }))\n    try {\n      const res = multipleRegression(xj, others)\n      return 1 / Math.max(1e-10, 1 - res.r2)\n    } catch {\n      return NaN\n    }\n  })\n\n  return { leverage, cooksDistance, standardizedResiduals, vif }\n}\n\n// \u2500\u2500\u2500 Poisson regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Poisson regression via IRLS (iteratively reweighted least squares).\n * Link: log(\u03BC) = X\u03B2,  Variance: V(\u03BC) = \u03BC\n * Outcome y must be non-negative (ideally integer counts).\n *\n * Implements Fisher scoring matching R's glm(family = poisson):\n *   Working response: z = \u03B7 + (y - \u03BC) / \u03BC\n *   Weights: W = diag(\u03BC)\n *   Solve WLS: (X'WX) \u03B2_new = X'Wz\n *\n * Cross-validated with R:\n * > glm(y ~ x1 + x2, family = poisson, data = df)\n * > coef(mod); summary(mod)$coefficients; AIC(mod); deviance(mod)\n */\nexport function poissonRegression(\n  y: readonly number[],\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95,\n  maxIter = 100,\n  tol = 1e-8\n): RegressionResult {\n  const n = y.length\n  for (let i = 0; i < n; i++) {\n    if ((y[i] ?? 0) < 0) throw new Error('poissonRegression: y must be non-negative')\n  }\n  const p = predictors.length + 1  // +intercept\n\n  // Design matrix\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(pr => pr.values[i] ?? 0)])\n  )\n  const names = ['(Intercept)', ...predictors.map(pr => pr.name)]\n\n  // Helper: compute \u03B7 = X\u03B2\n  const computeEta = (b: number[]): number[] =>\n    Array.from({ length: n }, (_, i) => {\n      let v = 0\n      for (let j = 0; j < p; j++) v += X.get(i, j) * (b[j] ?? 0)\n      return v\n    })\n\n  // Helper: exp with overflow protection\n  const safeExp = (x: number): number => Math.exp(Math.min(700, Math.max(-700, x)))\n  const EPS_MU = 1e-10\n\n  // Helper: compute Poisson deviance = 2\u00B7\u03A3[y\u00B7log(y/\u03BC) \u2212 (y \u2212 \u03BC)]\n  // Convention: 0\u00B7log(0) = 0\n  const computeDeviance = (yArr: readonly number[], muArr: number[]): number => {\n    let dev = 0\n    for (let i = 0; i < n; i++) {\n      const yi = yArr[i] ?? 0\n      const mi = muArr[i]!\n      if (yi > 0) dev += yi * Math.log(yi / Math.max(EPS_MU, mi))\n      dev -= (yi - mi)\n    }\n    return 2 * dev\n  }\n\n  // IRLS with step-halving\n  // Initialize: intercept = log(mean(y)), other coefficients = 0\n  let beta = new Array<number>(p).fill(0)\n  const yMeanRaw = _mean([...y])\n  const yMeanSafe = Math.max(EPS_MU, yMeanRaw)\n  beta[0] = Math.log(yMeanSafe)\n\n  let prevDeviance = Infinity\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    const eta = computeEta(beta)\n    const mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n    const dev = computeDeviance(y, mu)\n\n    // Convergence check (R's formula)\n    if (iter > 0 && Math.abs(dev - prevDeviance) / (0.1 + Math.abs(dev)) < tol) break\n    prevDeviance = dev\n\n    // Working response: z_i = \u03B7_i + (y_i \u2212 \u03BC_i) / \u03BC_i\n    // Weights: w_i = \u03BC_i\n    const z = Array.from({ length: n }, (_, i) => eta[i]! + ((y[i] ?? 0) - mu[i]!) / mu[i]!)\n    const w = mu.map(m => Math.max(EPS_MU, m))\n\n    // Weighted LS: (X'WX)\u03B2 = X'Wz via \u221AW transformation\n    const sqrtW = w.map(Math.sqrt)\n    const Xw = Matrix.fromArray(\n      Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n    )\n    const zw = z.map((zi, i) => zi * sqrtW[i]!)\n\n    try {\n      const Xwt = Xw.transpose()\n      const XwtXw = Xwt.multiply(Xw)\n      const XwtZw = Xwt.multiply(Matrix.colVec(zw))\n      const betaNewM = XwtXw.inverse().multiply(XwtZw)\n      const betaNew = Array.from({ length: p }, (_, j) => betaNewM.get(j, 0))\n\n      // Step-halving: if deviance increases, halve step\n      let accepted = false\n      let stepScale = 1.0\n      for (let half = 0; half < 10; half++) {\n        const betaTry = beta.map((b, j) => b + stepScale * (betaNew[j]! - b))\n        const etaTry = computeEta(betaTry)\n        const muTry = etaTry.map(e => Math.max(EPS_MU, safeExp(e)))\n        const trialDev = computeDeviance(y, muTry)\n\n        if (isFinite(trialDev) && (trialDev <= dev + 1e-8 || half === 9)) {\n          beta = betaTry\n          accepted = true\n          break\n        }\n        stepScale *= 0.5\n      }\n      if (!accepted) break\n    } catch {\n      break  // singular \u2014 stop iterating\n    }\n  }\n\n  // \u2500\u2500 Final quantities at converged \u03B2 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const eta = computeEta(beta)\n  const mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n\n  // Fisher information: (X'WX)\u207B\u00B9  where W = diag(\u03BC)\n  const sqrtW = mu.map(m => Math.sqrt(Math.max(EPS_MU, m)))\n  const Xw = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n  )\n  let covBeta: Matrix\n  try {\n    covBeta = Xw.transpose().multiply(Xw).inverse()\n  } catch {\n    covBeta = Matrix.identity(p)\n  }\n\n  // Wald z-tests (normal approximation)\n  const zCrit = normalQuantile(1 - (1 - ciLevel) / 2)\n  const coefficients: RegressionCoef[] = beta.map((b, i) => {\n    const se = Math.sqrt(Math.max(0, covBeta.get(i, i)))\n    const zStat = se === 0 ? 0 : b / se\n    const pVal = 2 * (1 - normCDFLocal(Math.abs(zStat)))\n    const ci: readonly [number, number] = [b - zCrit * se, b + zCrit * se]\n    return {\n      name: names[i] ?? `\u03B2${i}`,\n      estimate: roundTo(b, 10),\n      se: roundTo(se, 10),\n      tValue: roundTo(zStat, 6),  // actually z, but same field\n      pValue: roundTo(pVal, 6),\n      ci,\n    }\n  })\n\n  // Log-likelihood: \u03A3[y\u00B7log(\u03BC) \u2212 \u03BC \u2212 log(y!)]\n  let logLik = 0\n  for (let i = 0; i < n; i++) {\n    const yi = y[i] ?? 0\n    const mi = mu[i]!\n    logLik += yi * Math.log(Math.max(EPS_MU, mi)) - mi - logGamma(yi + 1)\n  }\n\n  // Null log-likelihood (intercept-only model: \u03BC = mean(y))\n  let nullLogLik = 0\n  for (let i = 0; i < n; i++) {\n    const yi = y[i] ?? 0\n    nullLogLik += yi * Math.log(Math.max(EPS_MU, yMeanSafe)) - yMeanSafe - logGamma(yi + 1)\n  }\n\n  // Deviance and null deviance\n  const deviance = computeDeviance(y, mu)\n  const nullDeviance = computeDeviance(y, new Array(n).fill(yMeanSafe))\n\n  // McFadden pseudo-R\u00B2 = 1 \u2212 deviance/null_deviance\n  const r2 = nullDeviance > 1e-12 ? 1 - deviance / nullDeviance : 0\n\n  const aic = -2 * logLik + 2 * p\n  const bic = -2 * logLik + Math.log(n) * p\n  const residuals = y.map((v, i) => (v ?? 0) - (mu[i] ?? 0))\n\n  return {\n    coefficients,\n    r2: roundTo(r2, 6),\n    adjR2: roundTo(r2, 6),  // McFadden pseudo-R\u00B2 for Poisson\n    fStatistic: NaN,\n    fDf: [p - 1, n - p],\n    fPValue: NaN,\n    aic: roundTo(aic, 2),\n    bic: roundTo(bic, 2),\n    residuals,\n    fitted: mu,\n    n,\n    formatted: formatPoisson(deviance, nullDeviance, aic),\n  }\n}\n\n// \u2500\u2500\u2500 Quasi-Poisson regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Quasi-Poisson regression.\n * Thin wrapper around poissonRegression that estimates the dispersion parameter\n * phi = Pearson chi^2/(n-p) and scales standard errors by sqrt(phi).\n * AIC/BIC are NaN (not defined for quasi-likelihood).\n *\n * Cross-validated with R:\n * > glm(y ~ x, family = quasipoisson, data = df)\n * > summary(mod)$dispersion\n */\nexport function quasiPoissonRegression(\n  y: readonly number[],\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95,\n  maxIter = 100,\n  tol = 1e-8\n): RegressionResult & { readonly dispersion: number } {\n  const base = poissonRegression(y, predictors, ciLevel, maxIter, tol)\n  const n = y.length\n  const p = predictors.length + 1\n\n  // Pearson chi^2 = sum (y_i - mu_i)^2 / mu_i\n  let pearsonChi2 = 0\n  for (let i = 0; i < n; i++) {\n    const yi = y[i]!\n    const mi = base.fitted[i]!\n    pearsonChi2 += (yi - mi) ** 2 / Math.max(1e-10, mi)\n  }\n  const dispersion = pearsonChi2 / (n - p)\n\n  // Scale SEs by sqrt(phi), recompute z and p\n  const sqrtPhi = Math.sqrt(dispersion)\n  const zCrit = normalQuantile(1 - (1 - ciLevel) / 2)\n  const coefficients: RegressionCoef[] = base.coefficients.map(c => {\n    const newSE = c.se * sqrtPhi\n    const newZ = newSE === 0 ? 0 : c.estimate / newSE\n    const newP = 2 * (1 - normCDFLocal(Math.abs(newZ)))\n    const newCI: readonly [number, number] = [c.estimate - zCrit * newSE, c.estimate + zCrit * newSE]\n    return { ...c, se: roundTo(newSE, 10), tValue: roundTo(newZ, 6), pValue: roundTo(newP, 6), ci: newCI }\n  })\n\n  return {\n    ...base,\n    coefficients,\n    aic: NaN,  // not defined for quasi-likelihood\n    bic: NaN,\n    dispersion,\n    formatted: `Quasi-Poisson (phi = ${roundTo(dispersion, 2)}), ${base.formatted}`,\n  }\n}\n\n// \u2500\u2500\u2500 Negative binomial regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Negative binomial regression via IRLS.\n * Link: log(mu) = X*beta, Variance: V(mu) = mu + mu^2/theta\n * Uses outer loop for theta: method-of-moments init, Newton steps on profile logLik.\n *\n * Cross-validated with R:\n * > library(MASS)\n * > glm.nb(y ~ x1 + x2, data = df)\n */\nexport function negativeBinomialRegression(\n  y: readonly number[],\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95,\n  maxIter = 100,\n  tol = 1e-8\n): RegressionResult & { readonly theta: number } {\n  const n = y.length\n  for (let i = 0; i < n; i++) {\n    if ((y[i] ?? 0) < 0) throw new Error('negativeBinomialRegression: y must be non-negative')\n  }\n  const p = predictors.length + 1\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(pr => pr.values[i] ?? 0)])\n  )\n  const names = ['(Intercept)', ...predictors.map(pr => pr.name)]\n\n  const computeEta = (b: number[]): number[] =>\n    Array.from({ length: n }, (_, i) => {\n      let v = 0\n      for (let j = 0; j < p; j++) v += X.get(i, j) * (b[j] ?? 0)\n      return v\n    })\n\n  const safeExp = (x: number): number => Math.exp(Math.min(700, Math.max(-700, x)))\n  const EPS_MU = 1e-10\n\n  // Initialize beta from Poisson fit\n  const poisFit = poissonRegression(y, predictors, ciLevel, maxIter, tol)\n  let beta = poisFit.coefficients.map(c => c.estimate)\n  let eta = computeEta(beta)\n  let mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n\n  // Initialize theta via method of moments: Var(Y) = mu + mu^2/theta -> theta = mu^2/(Var-mu)\n  const yMean = y.reduce((s, v) => s + v, 0) / n\n  const yVar = y.reduce((s, v) => s + (v - yMean) ** 2, 0) / (n - 1)\n  let theta = yVar > yMean ? yMean * yMean / (yVar - yMean) : 10\n\n  // Outer loop for theta\n  for (let outer = 0; outer < 25; outer++) {\n    // Inner IRLS with current theta: V(mu) = mu + mu^2/theta, w = mu^2/(mu+mu^2/theta) = mu*theta/(theta+mu)\n    for (let iter = 0; iter < maxIter; iter++) {\n      eta = computeEta(beta)\n      mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n      const w = mu.map(m => m * theta / (theta + m))\n      const z = Array.from({ length: n }, (_, i) => eta[i]! + (y[i]! - mu[i]!) / mu[i]!)\n\n      const sqrtW = w.map(wi => Math.sqrt(Math.max(EPS_MU, wi)))\n      const Xw = Matrix.fromArray(\n        Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n      )\n      const zw = z.map((zi, i) => zi * sqrtW[i]!)\n\n      try {\n        const Xwt = Xw.transpose()\n        const betaNewM = Xwt.multiply(Xw).inverse().multiply(Xwt.multiply(Matrix.colVec(zw)))\n        const betaNew = Array.from({ length: p }, (_, j) => betaNewM.get(j, 0))\n\n        const maxDelta = Math.max(...betaNew.map((b, i) => Math.abs(b - beta[i]!)))\n        beta = betaNew\n        if (maxDelta < tol) break\n      } catch { break }\n    }\n\n    // Update theta via Newton step on profile log-likelihood\n    // score = d(logLik)/d(theta), info = d^2(logLik)/d(theta)^2\n    eta = computeEta(beta)\n    mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n\n    let score = 0, info = 0\n    for (let i = 0; i < n; i++) {\n      const yi = y[i]!\n      const mi = mu[i]!\n      score += digamma(yi + theta) - digamma(theta) + Math.log(theta) + 1 - Math.log(theta + mi) - (yi + theta) / (theta + mi)\n      info += trigamma(yi + theta) - trigamma(theta) + 1 / theta - 2 / (theta + mi) + (yi + theta) / ((theta + mi) * (theta + mi))\n    }\n\n    if (Math.abs(info) > EPS_MU) {\n      const thetaNew = theta - score / info\n      if (thetaNew > 0.001) {\n        const thetaDelta = Math.abs(thetaNew - theta)\n        theta = thetaNew\n        if (thetaDelta < tol) break\n      }\n    }\n  }\n\n  // Final quantities\n  eta = computeEta(beta)\n  mu = eta.map(e => Math.max(EPS_MU, safeExp(e)))\n  const w = mu.map(m => m * theta / (theta + m))\n  const sqrtW = w.map(wi => Math.sqrt(Math.max(EPS_MU, wi)))\n  const Xw = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => Array.from({ length: p }, (_, j) => X.get(i, j) * sqrtW[i]!))\n  )\n  let covBeta: Matrix\n  try { covBeta = Xw.transpose().multiply(Xw).inverse() } catch { covBeta = Matrix.identity(p) }\n\n  const zCrit = normalQuantile(1 - (1 - ciLevel) / 2)\n  const coefficients: RegressionCoef[] = beta.map((b, i) => {\n    const se = Math.sqrt(Math.max(0, covBeta.get(i, i)))\n    const zStat = se === 0 ? 0 : b / se\n    const pVal = 2 * (1 - normCDFLocal(Math.abs(zStat)))\n    const ci: readonly [number, number] = [b - zCrit * se, b + zCrit * se]\n    return { name: names[i] ?? `b${i}`, estimate: roundTo(b, 10), se: roundTo(se, 10), tValue: roundTo(zStat, 6), pValue: roundTo(pVal, 6), ci }\n  })\n\n  // Log-likelihood\n  let logLik = 0\n  for (let i = 0; i < n; i++) {\n    const yi = y[i]!\n    const mi = mu[i]!\n    logLik += logGamma(yi + theta) - logGamma(theta) - logGamma(yi + 1) + theta * Math.log(theta / (theta + mi)) + yi * Math.log(mi / (theta + mi))\n  }\n\n  // Deviance: 2 * sum[y*log(y/mu) - (y+theta)*log((y+theta)/(mu+theta))]\n  let deviance = 0\n  for (let i = 0; i < n; i++) {\n    const yi = y[i]!\n    const mi = mu[i]!\n    deviance += yi > 0 ? yi * Math.log(yi / mi) : 0\n    deviance -= (yi + theta) * Math.log((yi + theta) / (mi + theta))\n  }\n  deviance *= 2\n\n  const aic = -2 * logLik + 2 * (p + 1)  // +1 for theta\n  const bic = -2 * logLik + Math.log(n) * (p + 1)\n  const residuals = y.map((v, i) => v - mu[i]!)\n\n  return {\n    coefficients,\n    r2: NaN, adjR2: NaN,\n    fStatistic: NaN, fDf: [p - 1, n - p], fPValue: NaN,\n    aic: roundTo(aic, 2), bic: roundTo(bic, 2),\n    residuals, fitted: mu, n,\n    formatted: formatNegBin(deviance, theta, aic),\n    theta,\n  }\n}\n\n// \u2500\u2500\u2500 Ordinal logistic regression \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Ordinal logistic regression (proportional odds / cumulative logit model).\n * P(Y <= j | x) = logistic(alpha_j - x'beta), j = 1,...,J-1\n * Uses Fisher scoring (Newton-Raphson on the logLik).\n *\n * Cross-validated with R:\n * > library(MASS)\n * > polr(factor(y) ~ x1 + x2, method = \"logistic\", data = df)\n */\nexport function ordinalLogisticRegression(\n  y: readonly number[],  // integer categories 1..J\n  predictors: ReadonlyArray<{ name: string; values: readonly number[] }>,\n  ciLevel = 0.95,\n  maxIter = 100,\n  tol = 1e-8\n): OrdinalRegressionResult {\n  const n = y.length\n  if (n === 0) throw new Error('ordinalLogisticRegression: empty data')\n  for (const pr of predictors) {\n    if (pr.values.length !== n) throw new Error(`ordinalLogisticRegression: predictor '${pr.name}' length mismatch`)\n  }\n\n  // Get unique sorted categories\n  const categories = [...new Set(y)].sort((a, b) => a - b)\n  const J = categories.length\n  if (J < 2) throw new Error('ordinalLogisticRegression: need at least 2 categories')\n  const K = J - 1  // number of thresholds\n\n  // Map y to category indices 0..J-1\n  const catMap = new Map<number, number>()\n  for (let j = 0; j < J; j++) catMap.set(categories[j]!, j)\n  const yIdx = y.map(v => catMap.get(v)!)\n\n  const nPred = predictors.length\n  const nParams = K + nPred  // thresholds + coefficients\n\n  // Build predictor matrix (no intercept column - thresholds act as intercepts)\n  const xMat: number[][] = Array.from({ length: n }, (_, i) =>\n    predictors.map(pr => pr.values[i] ?? 0)\n  )\n\n  // Logistic function with clamping\n  const logistic = (e: number): number => {\n    const v = 1 / (1 + Math.exp(-Math.min(700, Math.max(-700, e))))\n    return Math.min(1 - 1e-15, Math.max(1e-15, v))\n  }\n\n  // Initialize thresholds from empirical cumulative logits\n  const cumCounts = new Array<number>(J).fill(0)\n  for (const idx of yIdx) cumCounts[idx]!++\n  const thresholds = new Array<number>(K)\n  let cumSum = 0\n  for (let j = 0; j < K; j++) {\n    cumSum += cumCounts[j]!\n    const p = Math.min(1 - 1e-6, Math.max(1e-6, cumSum / n))\n    thresholds[j] = Math.log(p / (1 - p))\n  }\n\n  // Initialize coefficients to 0\n  let betaCoefs = new Array<number>(nPred).fill(0)\n\n  // Pack/unpack parameter vector: [alpha_1, ..., alpha_{K}, beta_1, ..., beta_p]\n  const pack = (): number[] => [...thresholds, ...betaCoefs]\n  const unpack = (params: number[]): void => {\n    for (let j = 0; j < K; j++) thresholds[j] = params[j]!\n    for (let j = 0; j < nPred; j++) betaCoefs[j] = params[K + j]!\n  }\n\n  // Compute cumulative probabilities P(Y <= j | x_i) for each observation and category\n  const computeGammas = (): number[][] => {\n    // gammas[i][j] = P(Y <= j | x_i), j = 0..K-1\n    // P(Y <= j) = logistic(alpha_j - x'beta)\n    return Array.from({ length: n }, (_, i) => {\n      let xBeta = 0\n      for (let k = 0; k < nPred; k++) xBeta += xMat[i]![k]! * betaCoefs[k]!\n      return Array.from({ length: K }, (_, j) => logistic(thresholds[j]! - xBeta))\n    })\n  }\n\n  // Compute category probabilities P(Y = j | x_i) from cumulative\n  const computeProbs = (gammas: number[][]): number[][] => {\n    return Array.from({ length: n }, (_, i) => {\n      return Array.from({ length: J }, (_, j) => {\n        let prob: number\n        if (j === 0) {\n          prob = gammas[i]![0]!\n        } else if (j === J - 1) {\n          prob = 1 - gammas[i]![K - 1]!\n        } else {\n          prob = gammas[i]![j]! - gammas[i]![j - 1]!\n        }\n        return Math.max(1e-15, prob)\n      })\n    })\n  }\n\n  // Fisher scoring iterations\n  for (let iter = 0; iter < maxIter; iter++) {\n    const gammas = computeGammas()\n    const probs = computeProbs(gammas)\n\n    // Compute gradient and Hessian\n    const grad = new Array<number>(nParams).fill(0)\n    const hess: number[][] = Array.from({ length: nParams }, () => new Array<number>(nParams).fill(0))\n\n    for (let i = 0; i < n; i++) {\n      const yi = yIdx[i]!\n      const pi = probs[i]!\n      const gi = gammas[i]!\n\n      // For each threshold alpha_j:\n      // d(logLik_i)/d(alpha_j) depends on whether yi == j, yi == j+1, or neither\n      // gamma_j * (1 - gamma_j) is the derivative of logistic\n      for (let j = 0; j < K; j++) {\n        const gj = gi[j]!\n        const dgj = gj * (1 - gj)  // d(gamma_j)/d(alpha_j)\n\n        // d(log p_yi)/d(alpha_j)\n        let dLogP = 0\n        if (yi === j) {\n          // p_j = gamma_j - gamma_{j-1}, d(p_j)/d(alpha_j) = dgj\n          dLogP = dgj / pi[yi]!\n        } else if (yi === j + 1) {\n          // p_{j+1} = gamma_{j+1} - gamma_j, d(p_{j+1})/d(alpha_j) = -dgj\n          dLogP = -dgj / pi[yi]!\n        }\n        // All other cases: d(p_yi)/d(alpha_j) = 0\n\n        grad[j]! += dLogP\n\n        // For the Hessian (expected Fisher information):\n        // E[-d^2 logLik / d(alpha_j) d(alpha_k)] contributions\n        // Use expected information: I_{jk} = sum_i sum_m (1/p_im) * dp_im/d(theta_j) * dp_im/d(theta_k)\n      }\n\n      // For coefficients beta_k:\n      // d(gamma_j)/d(beta_k) = -gamma_j*(1-gamma_j)*x_{ik}\n      for (let k = 0; k < nPred; k++) {\n        const xik = xMat[i]![k]!\n        let dLogP = 0\n        if (yi === 0) {\n          // p_0 = gamma_0, dp_0/dbeta_k = -dg0 * xik\n          const dg0 = gi[0]! * (1 - gi[0]!)\n          dLogP = -dg0 * xik / pi[0]!\n        } else if (yi === J - 1) {\n          // p_{J-1} = 1 - gamma_{K-1}, dp/dbeta_k = dg_{K-1} * xik\n          const dgK = gi[K - 1]! * (1 - gi[K - 1]!)\n          dLogP = dgK * xik / pi[J - 1]!\n        } else {\n          // p_yi = gamma_yi - gamma_{yi-1}\n          const dgY = gi[yi]! * (1 - gi[yi]!)\n          const dgY1 = gi[yi - 1]! * (1 - gi[yi - 1]!)\n          dLogP = (-dgY + dgY1) * xik / pi[yi]!\n        }\n        grad[K + k]! += dLogP\n      }\n\n      // Expected Fisher information (using observed per-category contributions)\n      // I_{ab} = sum_i sum_m (1/p_im) * dp_im/da * dp_im/db\n      // dp_im/d(alpha_j): nonzero only for m=j (positive) and m=j+1 (negative)\n      // dp_im/d(beta_k): nonzero for m=0 (neg), m in [1..K-1] (diff), m=J-1 (pos)\n\n      // Precompute dp/d(param) for each category m\n      const dpda: number[][] = Array.from({ length: J }, (_, m) => {\n        const result = new Array<number>(nParams).fill(0)\n        // Threshold derivatives\n        if (m === 0) {\n          // dp_0/d(alpha_0) = dg_0\n          result[0] = gi[0]! * (1 - gi[0]!)\n        } else if (m === J - 1) {\n          // dp_{J-1}/d(alpha_{K-1}) = -dg_{K-1}\n          result[K - 1] = -(gi[K - 1]! * (1 - gi[K - 1]!))\n        } else {\n          // dp_m/d(alpha_m) = dg_m\n          result[m] = gi[m]! * (1 - gi[m]!)\n          // dp_m/d(alpha_{m-1}) = -dg_{m-1}\n          result[m - 1] = -(gi[m - 1]! * (1 - gi[m - 1]!))\n        }\n        // Beta derivatives: dp_m/d(beta_k) = -x_ik * [dg_m (if m<J-1) - dg_{m-1} (if m>0)]\n        for (let k = 0; k < nPred; k++) {\n          const xik = xMat[i]![k]!\n          let val = 0\n          if (m < J - 1) val -= gi[m]! * (1 - gi[m]!) * xik\n          if (m > 0) val += gi[m - 1]! * (1 - gi[m - 1]!) * xik\n          result[K + k] = val\n        }\n        return result\n      })\n\n      // Accumulate Fisher information\n      for (let m = 0; m < J; m++) {\n        const invP = 1 / pi[m]!\n        for (let a = 0; a < nParams; a++) {\n          for (let b = a; b < nParams; b++) {\n            const val = invP * dpda[m]![a]! * dpda[m]![b]!\n            hess[a]![b]! += val\n            if (b !== a) hess[b]![a]! += val\n          }\n        }\n      }\n    }\n\n    // Newton step: delta = H^{-1} * g\n    const H = Matrix.fromArray(hess)\n    const g = Matrix.colVec(grad)\n    let delta: number[]\n    try {\n      const deltaM = H.inverse().multiply(g)\n      delta = Array.from({ length: nParams }, (_, i) => deltaM.get(i, 0))\n    } catch {\n      break  // singular Hessian\n    }\n\n    // Update parameters\n    const params = pack()\n    const newParams = params.map((p, i) => p + delta[i]!)\n    unpack(newParams)\n\n    // Enforce threshold ordering: alpha_1 < alpha_2 < ... < alpha_{K}\n    for (let j = 1; j < K; j++) {\n      if (thresholds[j]! <= thresholds[j - 1]!) {\n        thresholds[j] = thresholds[j - 1]! + 0.01\n      }\n    }\n\n    // Check convergence\n    const maxDelta = Math.max(...delta.map(Math.abs))\n    if (maxDelta < tol) break\n  }\n\n  // Final quantities\n  const gammas = computeGammas()\n  const probs = computeProbs(gammas)\n\n  // Log-likelihood\n  let logLik = 0\n  for (let i = 0; i < n; i++) {\n    logLik += Math.log(probs[i]![yIdx[i]!]!)\n  }\n\n  // Compute final Hessian for SEs\n  const finalHess: number[][] = Array.from({ length: nParams }, () => new Array<number>(nParams).fill(0))\n  for (let i = 0; i < n; i++) {\n    const pi = probs[i]!\n    const gi = gammas[i]!\n\n    const dpda: number[][] = Array.from({ length: J }, (_, m) => {\n      const result = new Array<number>(nParams).fill(0)\n      if (m === 0) {\n        result[0] = gi[0]! * (1 - gi[0]!)\n      } else if (m === J - 1) {\n        result[K - 1] = -(gi[K - 1]! * (1 - gi[K - 1]!))\n      } else {\n        result[m] = gi[m]! * (1 - gi[m]!)\n        result[m - 1] = -(gi[m - 1]! * (1 - gi[m - 1]!))\n      }\n      for (let k = 0; k < nPred; k++) {\n        const xik = xMat[i]![k]!\n        let val = 0\n        if (m < J - 1) val -= gi[m]! * (1 - gi[m]!) * xik\n        if (m > 0) val += gi[m - 1]! * (1 - gi[m - 1]!) * xik\n        result[K + k] = val\n      }\n      return result\n    })\n\n    for (let m = 0; m < J; m++) {\n      const invP = 1 / pi[m]!\n      for (let a = 0; a < nParams; a++) {\n        for (let b = a; b < nParams; b++) {\n          const val = invP * dpda[m]![a]! * dpda[m]![b]!\n          finalHess[a]![b]! += val\n          if (b !== a) finalHess[b]![a]! += val\n        }\n      }\n    }\n  }\n\n  let covMatrix: Matrix\n  try { covMatrix = Matrix.fromArray(finalHess).inverse() } catch { covMatrix = Matrix.identity(nParams) }\n\n  const zCritVal = normalQuantile(1 - (1 - ciLevel) / 2)\n\n  // Threshold results\n  const thresholdResults = thresholds.map((alpha, j) => {\n    const se = Math.sqrt(Math.max(0, covMatrix.get(j, j)))\n    const z = se === 0 ? 0 : alpha / se\n    const pVal = 2 * (1 - normCDFLocal(Math.abs(z)))\n    return {\n      name: `${categories[j]!}|${categories[j + 1]!}`,\n      estimate: roundTo(alpha, 6),\n      se: roundTo(se, 6),\n      z: roundTo(z, 4),\n      pValue: roundTo(pVal, 6),\n    }\n  })\n\n  // Coefficient results\n  const coefficientResults = betaCoefs.map((b, k) => {\n    const se = Math.sqrt(Math.max(0, covMatrix.get(K + k, K + k)))\n    const z = se === 0 ? 0 : b / se\n    const pVal = 2 * (1 - normCDFLocal(Math.abs(z)))\n    const ciR: readonly [number, number] = [b - zCritVal * se, b + zCritVal * se]\n    return {\n      name: predictors[k]!.name,\n      estimate: roundTo(b, 6),\n      se: roundTo(se, 6),\n      z: roundTo(z, 4),\n      pValue: roundTo(pVal, 6),\n      ci: ciR,\n    }\n  })\n\n  const aic = -2 * logLik + 2 * nParams\n  const bic = -2 * logLik + Math.log(n) * nParams\n\n  const formatted = `Ordinal logistic: logLik = ${roundTo(logLik, 1)}, AIC = ${roundTo(aic, 1)}, BIC = ${roundTo(bic, 1)}, J = ${J}`\n\n  return {\n    thresholds: thresholdResults,\n    coefficients: coefficientResults,\n    logLik: roundTo(logLik, 4),\n    aic: roundTo(aic, 2),\n    bic: roundTo(bic, 2),\n    n,\n    nCategories: J,\n    formatted,\n  }\n}\n\n", "/**\n * Group comparison module.\n * t-tests, one-way ANOVA, Mann-Whitney U, Wilcoxon signed-rank,\n * Kruskal-Wallis, Friedman test.\n */\n\nimport {\n  mean as _mean,\n  median as _median,\n  variance as _variance,\n  sd as _sd,\n  se as _se,\n  rank,\n  tDistQuantile,\n  tDistPValue,\n  fDistPValue,\n  chiSqPValue,\n} from '../core/math.js'\nimport {\n  formatTTest,\n  formatANOVA,\n  formatRMANOVA,\n  formatMannWhitney,\n  formatKruskalWallis,\n  formatChiSq,\n  formatCochranQ,\n  formatTwoWayANOVA,\n  formatANCOVA,\n  formatP,\n  interpretEtaSq,\n} from '../core/apa.js'\nimport { Matrix } from '../core/matrix.js'\nimport { cohensD, cohensDPaired, omegaSquared, etaSquaredKW, rankBiserial } from './effect-size.js'\nimport { computeRSS } from './regression.js'\nimport type { StatResult, GroupData, RMANOVAResult, TwoWayANOVAResult, ANOVATableRow, ANCOVAResult, EffectInterpretation } from '../core/types.js'\n\n// \u2500\u2500\u2500 Independent samples t-test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Welch's t-test for independent samples (unequal variances, default).\n * Set `equalVariances = true` for Student's t-test.\n *\n * Cross-validated with R:\n * > t.test(c(2,3,5,6,8), c(1,4,7,9,10), var.equal = FALSE)\n * t = -0.4851, df = 7.6, p-value = 0.6408\n * > t.test(c(2,3,5,6,8), c(1,4,7,9,10), var.equal = TRUE)\n * t = -0.4851, df = 8, p-value = 0.6403\n */\nexport function tTestIndependent(\n  x1: readonly number[],\n  x2: readonly number[],\n  equalVariances = false,\n  ciLevel = 0.95,\n  alternative: 'two.sided' | 'less' | 'greater' = 'two.sided'\n): StatResult {\n  if (x1.length < 2 || x2.length < 2) throw new Error('tTestIndependent: need at least 2 per group')\n  const n1 = x1.length, n2 = x2.length\n  const m1 = _mean(x1), m2 = _mean(x2)\n  const v1 = _variance(x1), v2 = _variance(x2)\n\n  let df: number\n  let se: number\n\n  if (equalVariances) {\n    // Pooled variance (Student's)\n    const spSq = ((n1 - 1) * v1 + (n2 - 1) * v2) / (n1 + n2 - 2)\n    se = Math.sqrt(spSq * (1 / n1 + 1 / n2))\n    df = n1 + n2 - 2\n  } else {\n    // Welch-Satterthwaite df\n    se = Math.sqrt(v1 / n1 + v2 / n2)\n    const num = (v1 / n1 + v2 / n2) ** 2\n    const den = (v1 / n1) ** 2 / (n1 - 1) + (v2 / n2) ** 2 / (n2 - 1)\n    df = den > 0 ? num / den : n1 + n2 - 2\n  }\n\n  const t = se === 0 ? 0 : (m1 - m2) / se\n  const pFull = tDistPValue(t, df)  // two-tailed\n  const pValue = alternative === 'two.sided'\n    ? pFull\n    : alternative === 'less'\n      ? t < 0 ? pFull / 2 : 1 - pFull / 2\n      : t > 0 ? pFull / 2 : 1 - pFull / 2\n\n  // CI for mean difference\n  const tCrit = tDistQuantile(1 - (1 - ciLevel) / 2, df)\n  const diff = m1 - m2\n  const ci: readonly [number, number] = [diff - tCrit * se, diff + tCrit * se]\n\n  const effectSize = cohensD(x1, x2)\n  const formatted = formatTTest(t, df, pValue, effectSize.value, \"d\", ci, ciLevel)\n\n  return {\n    testName: equalVariances ? \"Student's t-test\" : \"Welch's t-test\",\n    statistic: t,\n    df,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel,\n    n: n1 + n2,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Paired samples t-test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Paired samples t-test.\n *\n * Cross-validated with R:\n * > t.test(c(1,2,3,4,5), c(2,4,6,8,10), paired = TRUE)\n * t = -3.873, df = 4, p-value = 0.01789\n */\nexport function tTestPaired(\n  x1: readonly number[],\n  x2: readonly number[],\n  ciLevel = 0.95\n): StatResult {\n  if (x1.length !== x2.length) throw new Error('tTestPaired: arrays must have equal length')\n  if (x1.length < 2) throw new Error('tTestPaired: need at least 2 pairs')\n\n  const diffs = x1.map((v, i) => v - (x2[i] ?? 0))\n  const n = diffs.length\n  const mDiff = _mean(diffs)\n  const seDiff = _se(diffs)\n  const df = n - 1\n  const t = seDiff === 0 ? 0 : mDiff / seDiff\n  const pValue = tDistPValue(t, df)\n  const tCrit = tDistQuantile(1 - (1 - ciLevel) / 2, df)\n  const ci: readonly [number, number] = [mDiff - tCrit * seDiff, mDiff + tCrit * seDiff]\n\n  const effectSize = cohensDPaired(diffs)\n  const formatted = formatTTest(t, df, pValue, effectSize.value, \"d\", ci, ciLevel)\n\n  return {\n    testName: 'Paired t-test',\n    statistic: t,\n    df,\n    pValue,\n    effectSize,\n    ci,\n    ciLevel,\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Levene's test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Levene's test for homogeneity of variances.\n *\n * Computes absolute deviations from each group's center, then runs\n * a one-way ANOVA on those deviations. A significant result (p < .05)\n * indicates unequal variances across groups.\n *\n * @param groups  Two or more groups with labels and values.\n * @param center  'median' (default, Brown-Forsythe variant \u2014 more robust)\n *                or 'mean' (original Levene).\n *\n * Cross-validated with R:\n * > car::leveneTest(y ~ group, center = median)\n * > # or manually:\n * > medians <- tapply(y, group, median)\n * > abs_dev <- abs(y - medians[group])\n * > anova(lm(abs_dev ~ group))\n */\nexport function leveneTest(\n  groups: readonly GroupData[],\n  center: 'median' | 'mean' = 'median'\n): StatResult {\n  if (groups.length < 2) throw new Error('leveneTest: need at least 2 groups')\n\n  const k = groups.length\n  const centerFn = center === 'median' ? _median : _mean\n\n  // Compute absolute deviations from each group's center\n  const devGroups: GroupData[] = groups.map(g => {\n    const c = centerFn(g.values)\n    return {\n      label: g.label,\n      values: g.values.map(v => Math.abs(v - c)),\n    }\n  })\n\n  // One-way ANOVA on the absolute deviations\n  const allDevs = devGroups.flatMap(g => [...g.values])\n  const n = allDevs.length\n  const grandMean = _mean(allDevs)\n\n  let ssBetween = 0\n  let ssWithin = 0\n  for (const g of devGroups) {\n    const gm = _mean(g.values)\n    ssBetween += g.values.length * (gm - grandMean) ** 2\n    ssWithin += g.values.reduce((s, v) => s + (v - gm) ** 2, 0)\n  }\n\n  const dfBetween = k - 1\n  const dfWithin = n - k\n  const msBetween = ssBetween / dfBetween\n  const msWithin = dfWithin > 0 ? ssWithin / dfWithin : 0\n  const F = msWithin > 0 ? msBetween / msWithin : (msBetween > 0 ? Infinity : 0)\n  const pValue = fDistPValue(F, dfBetween, dfWithin)\n\n  const testLabel = center === 'median' ? 'Brown-Forsythe' : \"Levene's\"\n  const formatted = `${testLabel}: F(${dfBetween}, ${dfWithin}) = ${F.toFixed(2)}, ${formatP(pValue)}`\n\n  return {\n    testName: `${testLabel} Test`,\n    statistic: F,\n    df: [dfBetween, dfWithin],\n    pValue,\n    effectSize: { value: 0, name: 'none', interpretation: 'negligible' },\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 One-way ANOVA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface ANOVAResult extends StatResult {\n  readonly groups: readonly {\n    readonly label: string\n    readonly n: number\n    readonly mean: number\n    readonly sd: number\n  }[]\n  readonly ssBetween: number\n  readonly ssWithin: number\n  readonly ssTotal: number\n  readonly msBetween: number\n  readonly msWithin: number\n  readonly dfBetween: number\n  readonly dfWithin: number\n  readonly levene: {\n    readonly statistic: number\n    readonly pValue: number\n    readonly df: readonly [number, number]\n    readonly homogeneous: boolean\n  }\n}\n\n/**\n * One-way ANOVA.\n *\n * Cross-validated with R:\n * > oneway.test(value ~ group, data = df, var.equal = TRUE)\n * > aov(value ~ group, data = df)\n */\nexport function oneWayANOVA(groups: readonly GroupData[]): ANOVAResult {\n  if (groups.length < 2) throw new Error('oneWayANOVA: need at least 2 groups')\n\n  const k = groups.length\n  const allValues = groups.flatMap(g => [...g.values])\n  const n = allValues.length\n  const grandMean = _mean(allValues)\n\n  let ssBetween = 0, ssWithin = 0\n  const groupStats = groups.map(g => {\n    const gm = _mean(g.values)\n    const gn = g.values.length\n    ssBetween += gn * (gm - grandMean) ** 2\n    ssWithin += g.values.reduce((s, v) => s + (v - gm) ** 2, 0)\n    return { label: g.label, n: gn, mean: gm, sd: _sd(g.values) }\n  })\n\n  const ssTotal = ssBetween + ssWithin\n  const dfBetween = k - 1\n  const dfWithin = n - k\n  const msBetween = ssBetween / dfBetween\n  const msWithin = ssWithin / dfWithin\n\n  const F = msWithin === 0 ? Infinity : msBetween / msWithin\n  const pValue = fDistPValue(F, dfBetween, dfWithin)\n\n  const omega = omegaSquared(ssBetween, ssTotal, dfBetween, msWithin)\n\n  // Levene's test (Brown-Forsythe variant) for homogeneity of variances\n  const lev = leveneTest(groups)\n  const levene = {\n    statistic: lev.statistic,\n    pValue: lev.pValue,\n    df: (lev.df as readonly [number, number]),\n    homogeneous: lev.pValue >= 0.05,\n  }\n\n  const formatted = formatANOVA(F, dfBetween, dfWithin, pValue, omega.value, '\u03C9\u00B2')\n\n  return {\n    testName: 'One-way ANOVA',\n    statistic: F,\n    df: [dfBetween, dfWithin],\n    pValue,\n    effectSize: omega,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted,\n    groups: groupStats,\n    ssBetween,\n    ssWithin,\n    ssTotal,\n    msBetween,\n    msWithin,\n    dfBetween,\n    dfWithin,\n    levene,\n  }\n}\n\n// \u2500\u2500\u2500 Mann-Whitney U test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Mann-Whitney U test (Wilcoxon rank-sum test).\n * Uses normal approximation for large n.\n *\n * Cross-validated with R:\n * > wilcox.test(c(1,2,3,4,5), c(3,4,5,6,7))\n * W = 5, p-value = 0.09502\n */\nexport function mannWhitneyU(\n  x1: readonly number[],\n  x2: readonly number[],\n  alternative: 'two.sided' | 'less' | 'greater' = 'two.sided'\n): StatResult {\n  if (x1.length < 1 || x2.length < 1) throw new Error('mannWhitneyU: empty group')\n  const n1 = x1.length, n2 = x2.length\n\n  // Combined ranks\n  const combined = [\n    ...x1.map((v, i) => ({ v, group: 1, i })),\n    ...x2.map((v, i) => ({ v, group: 2, i })),\n  ].sort((a, b) => a.v - b.v)\n\n  // Assign ranks with tie correction\n  const allCombined = rank(combined.map(d => d.v))\n  let R1 = 0\n  for (let i = 0; i < combined.length; i++) {\n    if (combined[i]!.group === 1) R1 += allCombined[i]!\n  }\n\n  const U1 = R1 - n1 * (n1 + 1) / 2\n\n  // Normal approximation with tie correction\n  const N = n1 + n2\n  const muU = n1 * n2 / 2\n\n  // Tie correction for variance\n  const allVals = combined.map(d => d.v)\n  const tieCountsU = new Map<number, number>()\n  for (const v of allVals) tieCountsU.set(v, (tieCountsU.get(v) ?? 0) + 1)\n  let tieCorr = 0\n  for (const t of tieCountsU.values()) tieCorr += t * t * t - t\n  const varU = (n1 * n2 / 12) * (N + 1 - tieCorr / (N * (N - 1)))\n\n  const z = varU === 0 ? 0 : (U1 - muU) / Math.sqrt(varU)\n  const zAbs = Math.abs(z)\n  const pNormal = 2 * (1 - normalCDFInline(zAbs))\n  const pValue = alternative === 'two.sided'\n    ? pNormal\n    : alternative === 'less'\n      ? z < 0 ? pNormal / 2 : 1 - pNormal / 2\n      : z > 0 ? pNormal / 2 : 1 - pNormal / 2\n\n  const effect = rankBiserial(U1, n1, n2)\n  const formatted = formatMannWhitney(U1, pValue, effect.value)\n\n  return {\n    testName: 'Mann-Whitney U',\n    statistic: U1,\n    df: 0,\n    pValue: Math.min(1, Math.max(0, pValue)),\n    effectSize: effect,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n: n1 + n2,\n    formatted,\n  }\n}\n\n// Inline normal CDF \u2014 uses erf(z/\u221A2) per A&S 26.2.17\nfunction normalCDFInline(z: number): number {\n  const x = Math.abs(z) / Math.SQRT2\n  const t = 1 / (1 + 0.3275911 * x)\n  const poly = t * (0.254829592 + t * (-0.284496736 + t * (1.421413741 + t * (-1.453152027 + t * 1.061405429))))\n  const erf = 1 - poly * Math.exp(-x * x)\n  return 0.5 * (1 + (z >= 0 ? erf : -erf))\n}\n\n/** Exact Wilcoxon signed-rank p-value via dynamic programming. */\nfunction wilcoxonExactP(W: number, n: number): number {\n  const maxW = n * (n + 1) / 2\n  // dist[w] = number of rank-sign assignments giving W+ = w\n  let dist = new Array<number>(maxW + 1).fill(0)\n  dist[0] = 1\n  for (let k = 1; k <= n; k++) {\n    const newDist = [...dist]\n    for (let w = k; w <= maxW; w++) {\n      newDist[w]! += dist[w - k]!\n    }\n    dist = newDist\n  }\n  const total = Math.pow(2, n)\n  // Two-sided: p = 2 * P(W+ <= W)\n  let cumP = 0\n  for (let w = 0; w <= W && w <= maxW; w++) {\n    cumP += (dist[w] ?? 0) / total\n  }\n  return Math.min(1, 2 * cumP)\n}\n\n// \u2500\u2500\u2500 Wilcoxon signed-rank test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Wilcoxon signed-rank test for paired data.\n *\n * Cross-validated with R:\n * > wilcox.test(c(1,2,3,4,5), c(2,4,6,8,10), paired = TRUE)\n * V = 0, p-value = 0.0625\n */\nexport function wilcoxonSignedRank(\n  x1: readonly number[],\n  x2: readonly number[]\n): StatResult {\n  if (x1.length !== x2.length) throw new Error('wilcoxonSignedRank: arrays must match length')\n  const diffs = x1.map((v, i) => v - (x2[i] ?? 0)).filter(d => d !== 0)\n  const n = diffs.length\n  if (n === 0) throw new Error('wilcoxonSignedRank: no non-zero differences')\n\n  const absDiffs = diffs.map(Math.abs)\n  const ranks_ = rank(absDiffs)\n\n  let Wplus = 0, Wminus = 0\n  for (let i = 0; i < n; i++) {\n    if ((diffs[i] ?? 0) > 0) Wplus += ranks_[i]!\n    else Wminus += ranks_[i]!\n  }\n  const W = Math.min(Wplus, Wminus)\n\n  // Use exact distribution for n \u2264 20, normal approximation otherwise\n  let pValue: number\n  if (n <= 20) {\n    pValue = wilcoxonExactP(W, n)\n  } else {\n    const muW = n * (n + 1) / 4\n    const varW = n * (n + 1) * (2 * n + 1) / 24\n    const z = varW === 0 ? 0 : (W + 0.5 - muW) / Math.sqrt(varW)  // continuity correction\n    pValue = 2 * (1 - normalCDFInline(Math.abs(z)))\n  }\n\n  const effect = { value: Wplus / (n * (n + 1) / 2) * 2 - 1, name: 'r (rank-biserial)', interpretation: 'small' as const }\n\n  return {\n    testName: 'Wilcoxon Signed-Rank',\n    statistic: W,\n    df: 0,\n    pValue: Math.min(1, Math.max(0, pValue)),\n    effectSize: effect,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted: `V = ${W}, ${formatP(pValue)}, r = ${effect.value.toFixed(2)}`,\n  }\n}\n\n// \u2500\u2500\u2500 Kruskal-Wallis test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Kruskal-Wallis H test (non-parametric one-way ANOVA).\n *\n * Cross-validated with R:\n * > kruskal.test(list(c(1,2,3), c(4,5,6), c(7,8,9)))\n * Kruskal-Wallis chi-squared = 7.2, df = 2, p-value = 0.02732\n */\nexport function kruskalWallis(groups: readonly GroupData[]): StatResult {\n  if (groups.length < 2) throw new Error('kruskalWallis: need at least 2 groups')\n\n  const k = groups.length\n  const allValues = groups.flatMap(g => [...g.values])\n  const n = allValues.length\n  const allRanks_ = rank(allValues)\n\n  let offset = 0\n  let H = 0\n  for (const g of groups) {\n    const gn = g.values.length\n    let Rj = 0\n    for (let i = 0; i < gn; i++) Rj += allRanks_[offset + i]!\n    H += Rj * Rj / gn\n    offset += gn\n  }\n  H = (12 / (n * (n + 1))) * H - 3 * (n + 1)\n\n  // Tie correction\n  const tieCounts = new Map<number, number>()\n  for (const v of allValues) tieCounts.set(v, (tieCounts.get(v) ?? 0) + 1)\n  let C = 0\n  for (const t of tieCounts.values()) C += t * t * t - t\n  const correction = 1 - C / (n * n * n - n)\n  if (correction > 0) H /= correction\n\n  const df = k - 1\n  const pValue = chiSqPValue(H, df)\n  const effect = etaSquaredKW(H, k, n)\n  const formatted = formatKruskalWallis(H, df, pValue, effect.value)\n\n  return {\n    testName: 'Kruskal-Wallis',\n    statistic: H,\n    df,\n    pValue,\n    effectSize: effect,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Friedman test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Friedman test for repeated measures (non-parametric ANOVA).\n * Data is a matrix: rows = subjects, columns = conditions.\n *\n * Cross-validated with R:\n * > friedman.test(matrix(c(1,2,3, 4,5,6, 7,8,9), nrow=3))\n */\nexport function friedmanTest(data: readonly (readonly number[])[]): StatResult {\n  const n = data.length  // subjects\n  if (n < 2) throw new Error('friedmanTest: need at least 2 subjects')\n  const k = data[0]!.length  // conditions\n  if (k < 2) throw new Error('friedmanTest: need at least 2 conditions')\n\n  // Rank within each row (subject)\n  let sumRankSq = 0\n  for (const row of data) {\n    const rowRanks = rank(row)\n    for (const r of rowRanks) sumRankSq += r * r\n  }\n\n  // Friedman statistic\n  const colRankSums = Array.from({ length: k }, (_, j) =>\n    data.reduce((s, row) => {\n      const rowRanks = rank(row)\n      return s + (rowRanks[j] ?? 0)\n    }, 0)\n  )\n  const Rj2sum = colRankSums.reduce((s, r) => s + r * r, 0)\n  const chi2 = 12 / (n * k * (k + 1)) * Rj2sum - 3 * n * (k + 1)\n\n  const df = k - 1\n  const pValue = chiSqPValue(chi2, df)\n  const w = chi2 / (n * (k - 1))  // Kendall's W\n\n  return {\n    testName: 'Friedman Test',\n    statistic: chi2,\n    df,\n    pValue,\n    effectSize: {\n      value: w,\n      name: \"Kendall's W\",\n      interpretation: w < 0.1 ? 'negligible' : w < 0.3 ? 'small' : w < 0.5 ? 'medium' : 'large',\n    },\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted: `\u03C7\u00B2_F(${df}) = ${chi2.toFixed(2)}, ${formatP(pValue)}, W = ${w.toFixed(2)}`,\n  }\n}\n\n// \u2500\u2500\u2500 Repeated Measures ANOVA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Helmert orthonormal contrast matrix ((k-1) \u00D7 k).\n * Row i (0-indexed): 1/\u221A((i+1)(i+2)) for j \u2264 i,\n *   -(i+1)/\u221A((i+1)(i+2)) for j = i+1, 0 otherwise.\n * Rows are orthonormal: C\u00B7C' = I_{k-1}.\n */\nfunction helmertContrasts(k: number): number[][] {\n  const C: number[][] = []\n  for (let i = 0; i < k - 1; i++) {\n    const row = new Array(k).fill(0) as number[]\n    const denom = Math.sqrt((i + 1) * (i + 2))\n    for (let j = 0; j <= i; j++) row[j] = 1 / denom\n    row[i + 1] = -(i + 1) / denom\n    C.push(row)\n  }\n  return C\n}\n\n/**\n * Sample covariance matrix (k \u00D7 k) from an n \u00D7 k data matrix.\n * Uses Bessel correction (n-1 denominator).\n */\nfunction covarianceMatrixCols(\n  data: readonly (readonly number[])[],\n  k: number\n): number[][] {\n  const n = data.length\n  const means: number[] = []\n  for (let j = 0; j < k; j++) {\n    let s = 0\n    for (let i = 0; i < n; i++) s += data[i]![j]!\n    means.push(s / n)\n  }\n  const cov: number[][] = Array.from({ length: k }, () => new Array(k).fill(0) as number[])\n  for (let a = 0; a < k; a++) {\n    for (let b = a; b < k; b++) {\n      let s = 0\n      for (let i = 0; i < n; i++) {\n        s += (data[i]![a]! - means[a]!) * (data[i]![b]! - means[b]!)\n      }\n      const val = s / (n - 1)\n      cov[a]![b] = val\n      cov[b]![a] = val\n    }\n  }\n  return cov\n}\n\n/**\n * Mauchly's test of sphericity for repeated measures designs.\n * Tests whether the covariance matrix of orthonormalized contrasts\n * is proportional to an identity matrix.\n *\n * @param data  Subjects \u00D7 conditions matrix (n \u00D7 k, k \u2265 3).\n * @returns { W, chiSq, df, pValue } where W is Mauchly's statistic.\n *\n * Reference: Mauchly (1940), \"Significance test for sphericity of a\n * normal n-variate distribution\"\n *\n * Cross-validated with R:\n * > library(ez)\n * > ezANOVA(data=df, dv=y, wid=subj, within=cond)$`Mauchly's Test for Sphericity`\n */\nexport function mauchlysTest(\n  data: readonly (readonly number[])[]\n): { readonly W: number; readonly chiSq: number; readonly df: number; readonly pValue: number } {\n  const n = data.length\n  const k = data[0]!.length\n  if (k < 3) throw new Error('mauchlysTest: need at least 3 conditions (k \u2265 3)')\n  if (n < 2) throw new Error('mauchlysTest: need at least 2 subjects')\n\n  const p = k - 1\n\n  // Covariance matrix of conditions (k \u00D7 k)\n  const sigma = covarianceMatrixCols(data, k)\n\n  // Helmert orthonormal contrasts (p \u00D7 k)\n  const C = helmertContrasts(k)\n\n  // S_star = C \u00D7 \u03A3 \u00D7 C' (p \u00D7 p)\n  const CMat = Matrix.fromArray(C)\n  const sigmaMat = Matrix.fromArray(sigma)\n  const S = CMat.multiply(sigmaMat).multiply(CMat.transpose())\n\n  // Eigenvalues of S_star (symmetric positive semi-definite)\n  const lambdas = S.eigen().values\n\n  // W = det(S) / (trace(S)/p)^p\n  // In log-space: ln(W) = \u03A3ln(\u03BB_i) - p\u00B7ln(\u03A3\u03BB_i/p)\n  const sumLambda = lambdas.reduce((s, v) => s + v, 0)\n  const meanLambda = sumLambda / p\n  const logW = lambdas.reduce((s, v) => s + Math.log(Math.max(v, 1e-300)), 0) - p * Math.log(meanLambda)\n  const W = Math.exp(logW)\n\n  // Box's chi-square approximation\n  // \u03C7\u00B2 = -(n - 1 - (2p\u00B2 + p + 2)/(6p)) \u00D7 ln(W)\n  const nu = n - 1 - (2 * p * p + p + 2) / (6 * p)\n  const chiSq = Math.max(0, -nu * logW)\n  const df = p * (p + 1) / 2 - 1\n  const pValue = chiSq > 0 && df > 0 ? chiSqPValue(chiSq, df) : 1\n\n  return { W, chiSq, df, pValue }\n}\n\n/**\n * Greenhouse-Geisser and Huynh-Feldt epsilon corrections for sphericity.\n *\n * @param data  Subjects \u00D7 conditions matrix (n \u00D7 k).\n * @returns { gg, hf } clamped to [1/(k-1), 1].\n *\n * Reference: Greenhouse & Geisser (1959); Huynh & Feldt (1976)\n */\nexport function epsilonCorrections(\n  data: readonly (readonly number[])[]\n): { readonly gg: number; readonly hf: number } {\n  const n = data.length\n  const k = data[0]!.length\n  const p = k - 1\n\n  // Covariance matrix of orthonormalized contrasts\n  const sigma = covarianceMatrixCols(data, k)\n  const C = helmertContrasts(k)\n  const CMat = Matrix.fromArray(C)\n  const sigmaMat = Matrix.fromArray(sigma)\n  const S = CMat.multiply(sigmaMat).multiply(CMat.transpose())\n\n  const lambdas = S.eigen().values\n  const sumLambda = lambdas.reduce((s, v) => s + v, 0)\n  const sumLambdaSq = lambdas.reduce((s, v) => s + v * v, 0)\n\n  // Greenhouse-Geisser: \u03B5_GG = (\u03A3\u03BB)\u00B2 / (p \u00D7 \u03A3\u03BB\u00B2)\n  const gg = sumLambdaSq > 0 ? (sumLambda * sumLambda) / (p * sumLambdaSq) : 1\n\n  // Huynh-Feldt: \u03B5_HF = (n(k-1)\u03B5_GG - 2) / ((k-1)(n - 1 - (k-1)\u03B5_GG))\n  const num = n * p * gg - 2\n  const den = p * (n - 1 - p * gg)\n  const hf = den > 0 ? num / den : 1\n\n  // Clamp to [1/(k-1), 1]\n  const lower = 1 / p\n  return {\n    gg: Math.max(lower, Math.min(1, gg)),\n    hf: Math.max(lower, Math.min(1, hf)),\n  }\n}\n\n/**\n * Repeated measures one-way ANOVA.\n *\n * Decomposes total variance into SS_subjects + SS_conditions + SS_error.\n * Tests whether condition means differ, accounting for within-subject correlation.\n * Automatically runs Mauchly's sphericity test (k \u2265 3) and applies\n * Greenhouse-Geisser correction when sphericity is violated (p < .05).\n *\n * @param data     n \u00D7 k matrix: data[i][j] = score for subject i in condition j.\n * @param options  { labels?: string[], ciLevel?: number }\n *\n * Cross-validated with R:\n * > fit <- aov(y ~ cond + Error(subj/cond), data=df)\n * > summary(fit)\n * > library(ez); ezANOVA(data=df, dv=y, wid=subj, within=cond)\n */\nexport function repeatedMeasuresANOVA(\n  data: readonly (readonly number[])[],\n  options?: { readonly labels?: readonly string[]; readonly ciLevel?: number }\n): RMANOVAResult {\n  const n = data.length\n  if (n < 2) throw new Error('repeatedMeasuresANOVA: need at least 2 subjects')\n  const k = data[0]!.length\n  if (k < 2) throw new Error('repeatedMeasuresANOVA: need at least 2 conditions')\n  for (let i = 1; i < n; i++) {\n    if (data[i]!.length !== k) {\n      throw new Error(`repeatedMeasuresANOVA: row ${i} has ${data[i]!.length} columns, expected ${k}`)\n    }\n  }\n\n  const ciLevel = options?.ciLevel ?? 0.95\n  const labels = options?.labels ?? Array.from({ length: k }, (_, i) => `C${i + 1}`)\n\n  // \u2500\u2500 Grand mean \u2500\u2500\n  let grandSum = 0\n  for (const row of data) for (const v of row) grandSum += v\n  const grandMean = grandSum / (n * k)\n\n  // \u2500\u2500 Condition means and descriptives \u2500\u2500\n  const condMeans: number[] = []\n  const condSds: number[] = []\n  for (let j = 0; j < k; j++) {\n    const col: number[] = []\n    for (let i = 0; i < n; i++) col.push(data[i]![j]!)\n    condMeans.push(_mean(col))\n    condSds.push(_sd(col))\n  }\n\n  // \u2500\u2500 Subject means \u2500\u2500\n  const subjMeans: number[] = data.map(row => _mean([...row]))\n\n  // \u2500\u2500 SS decomposition \u2500\u2500\n  // SS_total = \u03A3_ij (x_ij - grand_mean)\u00B2\n  let ssTotal = 0\n  for (const row of data) for (const v of row) ssTotal += (v - grandMean) ** 2\n\n  // SS_subjects = k \u00D7 \u03A3_i (subj_mean_i - grand_mean)\u00B2\n  let ssSubjects = 0\n  for (const sm of subjMeans) ssSubjects += k * (sm - grandMean) ** 2\n\n  // SS_conditions = n \u00D7 \u03A3_j (cond_mean_j - grand_mean)\u00B2\n  let ssConditions = 0\n  for (const cm of condMeans) ssConditions += n * (cm - grandMean) ** 2\n\n  // SS_error = SS_total - SS_subjects - SS_conditions (residual)\n  const ssError = ssTotal - ssSubjects - ssConditions\n\n  // \u2500\u2500 Degrees of freedom \u2500\u2500\n  const dfConditions = k - 1\n  const dfSubjects = n - 1\n  const dfError = dfConditions * dfSubjects\n\n  // \u2500\u2500 Mean squares & F \u2500\u2500\n  const msConditions = ssConditions / dfConditions\n  const msError = dfError > 0 ? ssError / dfError : 0\n  const F = msError > 0 ? msConditions / msError : (msConditions > 0 ? Infinity : 0)\n\n  // \u2500\u2500 Sphericity test & epsilon corrections (k \u2265 3 only) \u2500\u2500\n  let sphericity: RMANOVAResult['sphericity'] = null\n  let epsilonGG = 1\n  let epsilonHF = 1\n\n  if (k >= 3) {\n    try {\n      sphericity = mauchlysTest(data)\n      const eps = epsilonCorrections(data)\n      epsilonGG = eps.gg\n      epsilonHF = eps.hf\n    } catch {\n      // If sphericity test fails (e.g., singular matrix), assume sphericity\n      sphericity = null\n    }\n  }\n\n  // \u2500\u2500 Determine correction \u2500\u2500\n  const sphericityViolated = sphericity !== null && sphericity.pValue < 0.05\n  const correction: RMANOVAResult['correction'] = sphericityViolated ? 'Greenhouse-Geisser' : 'none'\n\n  // \u2500\u2500 Compute p-value (with correction if needed) \u2500\u2500\n  let df1 = dfConditions\n  let df2 = dfError\n  if (correction === 'Greenhouse-Geisser') {\n    df1 = epsilonGG * dfConditions\n    df2 = epsilonGG * dfError\n  }\n  const pValue = fDistPValue(F, df1, df2)\n\n  // \u2500\u2500 Effect size: partial eta-squared \u2500\u2500\n  // \u03B7\u00B2_p = SS_conditions / (SS_conditions + SS_error)\n  const partialEta2 = (ssConditions + ssError) > 0\n    ? ssConditions / (ssConditions + ssError)\n    : 0\n\n  const effectSize = {\n    value: partialEta2,\n    name: '\u03B7\u00B2_p',\n    interpretation: interpretEtaSq(partialEta2) as EffectInterpretation,\n  }\n\n  // \u2500\u2500 APA formatted string \u2500\u2500\n  const formatted = formatRMANOVA(\n    F, df1, df2, pValue, partialEta2, '\u03B7\u00B2_p',\n    correction !== 'none' ? correction : undefined\n  )\n\n  // \u2500\u2500 Condition descriptives \u2500\u2500\n  const conditions = labels.map((label, j) => ({\n    label,\n    mean: condMeans[j]!,\n    sd: condSds[j]!,\n    n,\n  }))\n\n  return {\n    testName: 'Repeated Measures ANOVA',\n    statistic: F,\n    df: [df1, df2],\n    pValue,\n    effectSize,\n    ci: [NaN, NaN],\n    ciLevel,\n    n: n * k,\n    formatted,\n    conditions,\n    ssConditions,\n    ssSubjects,\n    ssError,\n    ssTotal,\n    dfConditions,\n    dfSubjects,\n    dfError,\n    msConditions,\n    msError,\n    sphericity,\n    epsilonGG,\n    epsilonHF,\n    ...(correction !== 'none' ? { correctedDf: [df1, df2] as const } : {}),\n    correction,\n  }\n}\n\n// \u2500\u2500\u2500 Welch's ANOVA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Welch's one-way ANOVA for heteroscedastic groups.\n * Uses weighted F with Welch-Satterthwaite denominator df.\n * Reference: Welch (1951) \"On the comparison of several mean values\"\n *\n * Formula (matching R's oneway.test with var.equal=FALSE):\n *   w_j = n_j / s\u00B2_j\n *   mean_tilde = \u03A3(w_j * mean_j) / \u03A3(w_j)\n *   F_w = \u03A3 w_j*(mean_j - mean_tilde)\u00B2 / ((k-1) * (1 + 2*(k-2)/(k\u00B2-1) * \u039B))\n *   \u039B = \u03A3 (1 - w_j/\u03A3w)\u00B2 / (n_j - 1)\n *   df_den = (k\u00B2 - 1) / (3 * \u039B)\n *\n * Cross-validated with R:\n * > oneway.test(value ~ group, data = df, var.equal = FALSE)\n */\nexport function welchANOVA(groups: readonly GroupData[]): StatResult {\n  if (groups.length < 2) throw new Error('welchANOVA: need at least 2 groups')\n  const k = groups.length\n\n  // Per-group statistics\n  const ns = groups.map(g => g.values.length)\n  const means = groups.map(g => _mean(g.values))\n  const vars = groups.map(g => _variance(g.values))\n\n  // Weights: w_j = n_j / s\u00B2_j\n  const weights = ns.map((n, j) => {\n    const v = vars[j]!\n    return v > 0 ? n / v : 0\n  })\n  const sumW = weights.reduce((s, w) => s + w, 0)\n  if (sumW === 0) throw new Error('welchANOVA: all groups have zero variance')\n\n  // Weighted grand mean\n  const meanTilde = weights.reduce((s, w, j) => s + w * means[j]!, 0) / sumW\n\n  // Numerator sum: \u03A3 w_j * (mean_j - meanTilde)\u00B2\n  const numSum = weights.reduce((s, w, j) => s + w * (means[j]! - meanTilde) ** 2, 0)\n\n  // Lambda = \u03A3 (1 - w_j / sumW)\u00B2 / (n_j - 1)\n  let lambda = 0\n  for (let j = 0; j < k; j++) {\n    const dfj = ns[j]! - 1\n    if (dfj > 0) {\n      lambda += (1 - weights[j]! / sumW) ** 2 / dfj\n    }\n  }\n\n  // Welch's F: numerator / ((k-1) * denominator_correction)\n  const denomCorr = 1 + (2 * (k - 2) / (k * k - 1)) * lambda\n  const dfNum = k - 1\n  const Fw = numSum / (dfNum * denomCorr)\n\n  // Denominator df\n  const dfDen = (k * k - 1) / (3 * lambda)\n\n  const pValue = fDistPValue(Fw, dfNum, dfDen)\n\n  // Effect size: omega-squared (using standard SS decomposition)\n  const allValues = groups.flatMap(g => [...g.values])\n  const grandMean = _mean(allValues)\n  let ssBetween = 0\n  let ssTotal = 0\n  for (const g of groups) {\n    const gm = _mean(g.values)\n    ssBetween += g.values.length * (gm - grandMean) ** 2\n  }\n  for (const v of allValues) ssTotal += (v - grandMean) ** 2\n  const ssWithin = groups.reduce((s, g) => {\n    const gm = _mean(g.values)\n    return s + g.values.reduce((ss, v) => ss + (v - gm) ** 2, 0)\n  }, 0)\n  const msW = ssWithin / (allValues.length - k)\n  const omega = omegaSquared(ssBetween, ssTotal, dfNum, msW)\n\n  const formatted = formatANOVA(Fw, dfNum, dfDen, pValue, omega.value, '\u03C9\u00B2')\n\n  return {\n    testName: \"Welch's ANOVA\",\n    statistic: Fw,\n    df: [dfNum, dfDen],\n    pValue,\n    effectSize: omega,\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n: allValues.length,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Mood's Median Test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Mood's median test: non-parametric test for equal medians across groups.\n * Builds a 2\u00D7k contingency table (above vs at-or-below grand median)\n * and applies a chi-square test.\n *\n * Cross-validated with R:\n * > library(RVAideMemoire); mood.medtest(y ~ group, data = df)\n */\nexport function moodsMedianTest(groups: readonly GroupData[]): StatResult {\n  if (groups.length < 2) throw new Error('moodsMedianTest: need at least 2 groups')\n\n  const k = groups.length\n  const allValues = groups.flatMap(g => [...g.values])\n  const n = allValues.length\n  const grandMedian = _median(allValues)\n\n  // Build 2\u00D7k contingency table: row 0 = above, row 1 = at-or-below\n  const above: number[] = []\n  const atOrBelow: number[] = []\n  for (const g of groups) {\n    let a = 0, b = 0\n    for (const v of g.values) {\n      if (v > grandMedian) a++\n      else b++\n    }\n    above.push(a)\n    atOrBelow.push(b)\n  }\n\n  // Chi-square test on 2\u00D7k table\n  const rowTotals = [above.reduce((s, v) => s + v, 0), atOrBelow.reduce((s, v) => s + v, 0)]\n  const colTotals = groups.map(g => g.values.length)\n\n  let chiSq = 0\n  for (let j = 0; j < k; j++) {\n    const observed0 = above[j]!\n    const observed1 = atOrBelow[j]!\n    const expected0 = (rowTotals[0]! * colTotals[j]!) / n\n    const expected1 = (rowTotals[1]! * colTotals[j]!) / n\n    if (expected0 > 0) chiSq += (observed0 - expected0) ** 2 / expected0\n    if (expected1 > 0) chiSq += (observed1 - expected1) ** 2 / expected1\n  }\n\n  const df = k - 1\n  const pValue = chiSqPValue(chiSq, df)\n\n  // Effect size: Cram\u00E9r's V = sqrt(\u03C7\u00B2 / (n * min(r-1, c-1)))\n  // For 2\u00D7k table: min(2-1, k-1) = 1\n  const cramerV = n > 0 ? Math.sqrt(chiSq / n) : 0\n\n  const formatted = formatChiSq(chiSq, df, pValue, cramerV, \"V\")\n\n  return {\n    testName: \"Mood's Median Test\",\n    statistic: chiSq,\n    df,\n    pValue,\n    effectSize: {\n      value: cramerV,\n      name: \"Cram\u00E9r's V\",\n      interpretation: cramerV < 0.1 ? 'negligible' : cramerV < 0.3 ? 'small' : cramerV < 0.5 ? 'medium' : 'large',\n    },\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Cochran's Q Test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Cochran's Q test for related samples with binary outcomes.\n * Input: n\u00D7k binary matrix (subjects \u00D7 conditions, each entry 0 or 1).\n * Tests whether the proportion of successes differs across conditions.\n *\n * Q = k(k-1) * \u03A3(C_j - C\u0304)\u00B2 / (k * \u03A3R_i - \u03A3R_i\u00B2)\n * where C_j = column sums, R_i = row sums\n *\n * Cross-validated with R:\n * > library(RVAideMemoire); cochran.qtest(y ~ cond | subject, data = df)\n */\nexport function cochranQ(data: readonly (readonly number[])[]): StatResult {\n  const nSubjects = data.length\n  if (nSubjects < 2) throw new Error('cochranQ: need at least 2 subjects')\n  const k = data[0]!.length\n  if (k < 2) throw new Error('cochranQ: need at least 2 conditions')\n\n  // Column sums (C_j) and row sums (R_i)\n  const colSums: number[] = new Array(k).fill(0) as number[]\n  const rowSums: number[] = []\n\n  for (let i = 0; i < nSubjects; i++) {\n    let rowSum = 0\n    for (let j = 0; j < k; j++) {\n      const v = data[i]![j]!\n      colSums[j]! += v\n      rowSum += v\n    }\n    rowSums.push(rowSum)\n  }\n\n  const meanC = colSums.reduce((s, v) => s + v, 0) / k\n  const sumCjMinusMeanSq = colSums.reduce((s, c) => s + (c - meanC) ** 2, 0)\n  const sumRi = rowSums.reduce((s, r) => s + r, 0)\n  const sumRiSq = rowSums.reduce((s, r) => s + r * r, 0)\n\n  const denominator = k * sumRi - sumRiSq\n  if (denominator === 0) {\n    // All rows have the same sum \u2014 no variability, Q = 0\n    const formatted = formatCochranQ(0, k - 1, 1)\n    return {\n      testName: \"Cochran's Q\",\n      statistic: 0,\n      df: k - 1,\n      pValue: 1,\n      effectSize: { value: 0, name: \"W\", interpretation: 'negligible' },\n      ci: [NaN, NaN],\n      ciLevel: 0.95,\n      n: nSubjects,\n      formatted,\n    }\n  }\n\n  const Q = k * (k - 1) * sumCjMinusMeanSq / denominator\n  const df = k - 1\n  const pValue = chiSqPValue(Q, df)\n\n  // Effect size: W = Q / (n * (k - 1)), analogous to Kendall's W\n  const W = Q / (nSubjects * (k - 1))\n\n  const formatted = formatCochranQ(Q, df, pValue)\n\n  return {\n    testName: \"Cochran's Q\",\n    statistic: Q,\n    df,\n    pValue,\n    effectSize: {\n      value: W,\n      name: 'W',\n      interpretation: W < 0.1 ? 'negligible' : W < 0.3 ? 'small' : W < 0.5 ? 'medium' : 'large',\n    },\n    ci: [NaN, NaN],\n    ciLevel: 0.95,\n    n: nSubjects,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Two-Way ANOVA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Helper: build dummy-coded columns for a factor (reference = first level).\n * Treatment coding: each non-reference level gets a 0/1 indicator.\n * Returns a matrix of n rows \u00D7 (nLevels - 1) columns.\n */\nfunction buildDummies(\n  factor: readonly (string | number)[],\n  levels: readonly (string | number)[]\n): number[][] {\n  const n = factor.length\n  const cols = levels.length - 1  // reference coding\n  return Array.from({ length: n }, (_, i) => {\n    const row: number[] = []\n    for (let d = 0; d < cols; d++) {\n      row.push(factor[i] === levels[d + 1] ? 1 : 0)\n    }\n    return row\n  })\n}\n\n/**\n * Two-way factorial ANOVA.\n * Computes Type II SS by default via model-comparison (RSS of reduced vs full).\n *\n * @param y         Continuous outcome variable\n * @param factorA   First categorical factor (parallel to y)\n * @param factorB   Second categorical factor (parallel to y)\n * @param ssType    Type II (default) or Type III sums of squares\n *\n * Cross-validated with R:\n * > summary(aov(y ~ A * B, data = df))          # Type I\n * > library(car); Anova(lm(y ~ A * B), type=2)  # Type II\n */\nexport function twoWayANOVA(\n  y: readonly number[],\n  factorA: readonly (string | number)[],\n  factorB: readonly (string | number)[],\n  ssType: 2 | 3 = 2\n): TwoWayANOVAResult {\n  const n = y.length\n  if (n < 4) throw new Error('twoWayANOVA: need at least 4 observations')\n  if (factorA.length !== n || factorB.length !== n) {\n    throw new Error('twoWayANOVA: all arrays must have equal length')\n  }\n\n  const levelsA = [...new Set(factorA)].sort()\n  const levelsB = [...new Set(factorB)].sort()\n  if (levelsA.length < 2 || levelsB.length < 2) {\n    throw new Error('twoWayANOVA: each factor must have at least 2 levels')\n  }\n\n  // Build dummy columns for each factor\n  const dumA = buildDummies(factorA, levelsA)  // n \u00D7 (a-1)\n  const dumB = buildDummies(factorB, levelsB)  // n \u00D7 (b-1)\n\n  // Interaction: element-wise products of all dummy pairs\n  const dumAB: number[][] = Array.from({ length: n }, (_, i) => {\n    const row: number[] = []\n    for (let da = 0; da < levelsA.length - 1; da++) {\n      for (let db = 0; db < levelsB.length - 1; db++) {\n        row.push(dumA[i]![da]! * dumB[i]![db]!)\n      }\n    }\n    return row\n  })\n\n  // Full design matrix: intercept + A dummies + B dummies + A\u00D7B interaction\n  const buildMatrix = (includeA: boolean, includeB: boolean, includeAB: boolean): Matrix => {\n    const rows = Array.from({ length: n }, (_, i) => {\n      const row: number[] = [1]  // intercept\n      if (includeA) row.push(...dumA[i]!)\n      if (includeB) row.push(...dumB[i]!)\n      if (includeAB) row.push(...dumAB[i]!)\n      return row\n    })\n    return Matrix.fromArray(rows)\n  }\n\n  // RSS for each model\n  const XFull = buildMatrix(true, true, true)\n  const rssFull = computeRSS(XFull, y)\n\n  if (ssType === 2) {\n    // Type II: each main effect tested controlling for the other (not interaction).\n    // SS_A = RSS(B only) - RSS(A+B), SS_B = RSS(A only) - RSS(A+B)\n    // Interaction tested from full model: SS_AB = RSS(A+B) - RSS(full)\n    const rssBothMain = computeRSS(buildMatrix(true, true, false), y)\n    const rssNoA = computeRSS(buildMatrix(false, true, false), y)\n    const rssNoB = computeRSS(buildMatrix(true, false, false), y)\n    const ssA = rssNoA - rssBothMain\n    const ssB = rssNoB - rssBothMain\n    const ssAB = rssBothMain - rssFull\n\n    const dfA = levelsA.length - 1\n    const dfB = levelsB.length - 1\n    const dfAB = dfA * dfB\n    const dfResid = n - XFull.cols\n\n    const msResid = rssFull / dfResid\n    const ssTotal = y.reduce((s, v) => s + (v - _mean(y)) ** 2, 0)\n\n    const rows: ANOVATableRow[] = [\n      { source: 'A', ss: ssA, df: dfA, ms: ssA / dfA, F: msResid > 0 ? (ssA / dfA) / msResid : 0, pValue: fDistPValue((ssA / dfA) / Math.max(1e-15, msResid), dfA, dfResid), etaSq: ssTotal > 0 ? ssA / ssTotal : 0 },\n      { source: 'B', ss: ssB, df: dfB, ms: ssB / dfB, F: msResid > 0 ? (ssB / dfB) / msResid : 0, pValue: fDistPValue((ssB / dfB) / Math.max(1e-15, msResid), dfB, dfResid), etaSq: ssTotal > 0 ? ssB / ssTotal : 0 },\n      { source: 'A:B', ss: ssAB, df: dfAB, ms: ssAB / dfAB, F: msResid > 0 ? (ssAB / dfAB) / msResid : 0, pValue: fDistPValue((ssAB / dfAB) / Math.max(1e-15, msResid), dfAB, dfResid), etaSq: ssTotal > 0 ? ssAB / ssTotal : 0 },\n    ]\n\n    const formatted = rows.map(r => formatTwoWayANOVA(r.source, r.F, r.df, dfResid, r.pValue, r.etaSq)).join('; ')\n\n    return {\n      rows,\n      residual: { ss: rssFull, df: dfResid, ms: msResid },\n      total: { ss: ssTotal, df: n - 1 },\n      n,\n      formatted,\n    }\n  }\n\n  // Type III: each term tested by comparing full model to model without that term,\n  // keeping ALL other terms (including interaction when testing main effects).\n  // Uses treatment (dummy) coding to match R's car::Anova(type=3) default behavior.\n  // Note: with treatment coding, Type III SS_A tests whether non-reference levels of A\n  // differ from the reference level at the reference level of B.\n  const rssNoAFull = computeRSS(buildMatrix(false, true, true), y)\n  const rssNoBFull = computeRSS(buildMatrix(true, false, true), y)\n  const rssNoABFull = computeRSS(buildMatrix(true, true, false), y)\n\n  const ssA = rssNoAFull - rssFull\n  const ssB = rssNoBFull - rssFull\n  const ssAB = rssNoABFull - rssFull\n\n  const dfA = levelsA.length - 1\n  const dfB = levelsB.length - 1\n  const dfAB = dfA * dfB\n  const dfResid = n - XFull.cols\n\n  const msResid = rssFull / dfResid\n  const ssTotal = y.reduce((s, v) => s + (v - _mean(y)) ** 2, 0)\n\n  const rows: ANOVATableRow[] = [\n    { source: 'A', ss: ssA, df: dfA, ms: ssA / dfA, F: msResid > 0 ? (ssA / dfA) / msResid : 0, pValue: fDistPValue((ssA / dfA) / Math.max(1e-15, msResid), dfA, dfResid), etaSq: ssTotal > 0 ? ssA / ssTotal : 0 },\n    { source: 'B', ss: ssB, df: dfB, ms: ssB / dfB, F: msResid > 0 ? (ssB / dfB) / msResid : 0, pValue: fDistPValue((ssB / dfB) / Math.max(1e-15, msResid), dfB, dfResid), etaSq: ssTotal > 0 ? ssB / ssTotal : 0 },\n    { source: 'A:B', ss: ssAB, df: dfAB, ms: ssAB / dfAB, F: msResid > 0 ? (ssAB / dfAB) / msResid : 0, pValue: fDistPValue((ssAB / dfAB) / Math.max(1e-15, msResid), dfAB, dfResid), etaSq: ssTotal > 0 ? ssAB / ssTotal : 0 },\n  ]\n\n  const formatted = rows.map(r => formatTwoWayANOVA(r.source, r.F, r.df, dfResid, r.pValue, r.etaSq)).join('; ')\n\n  return {\n    rows,\n    residual: { ss: rssFull, df: dfResid, ms: msResid },\n    total: { ss: ssTotal, df: n - 1 },\n    n,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 ANCOVA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Analysis of Covariance (ANCOVA).\n * OLS regression with a dummy-coded factor + continuous covariate.\n * Type III SS via model comparison (drop each term from full model).\n * Computes adjusted group means at the grand mean of the covariate.\n *\n * @param y          Continuous outcome variable\n * @param factor     Categorical grouping factor (parallel to y)\n * @param covariate  Continuous covariate (parallel to y)\n *\n * Cross-validated with R:\n * > library(car); Anova(lm(y ~ group + covariate), type=3)\n * > library(emmeans); emmeans(lm(y ~ group + covariate), ~ group)\n */\nexport function ancova(\n  y: readonly number[],\n  factor: readonly (string | number)[],\n  covariate: readonly number[]\n): ANCOVAResult {\n  const n = y.length\n  if (n < 4) throw new Error('ancova: need at least 4 observations')\n  if (factor.length !== n || covariate.length !== n) {\n    throw new Error('ancova: all arrays must have equal length')\n  }\n\n  const levels = [...new Set(factor)]\n  if (levels.length < 2) throw new Error('ancova: factor must have at least 2 levels')\n\n  // Dummy columns for factor (reference = first level)\n  const dummies = buildDummies(factor, levels)  // n \u00D7 (nLevels - 1)\n  const nDum = levels.length - 1\n\n  // Full design matrix: intercept + dummies + covariate\n  const XFull = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...dummies[i]!, covariate[i]!])\n  )\n\n  // Reduced models for Type III SS\n  // No-factor model: intercept + covariate only\n  const XNoFactor = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, covariate[i]!])\n  )\n  // No-covariate model: intercept + dummies only\n  const XNoCov = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...dummies[i]!])\n  )\n\n  const rssFull = computeRSS(XFull, y)\n  const rssNoFactor = computeRSS(XNoFactor, y)\n  const rssNoCov = computeRSS(XNoCov, y)\n\n  const ssFactor = rssNoFactor - rssFull\n  const ssCov = rssNoCov - rssFull\n  const dfFactor = nDum\n  const dfCov = 1\n  const dfResid = n - XFull.cols\n\n  const msResid = rssFull / dfResid\n  const ssTotal = y.reduce((s, v) => s + (v - _mean(y)) ** 2, 0)\n\n  const FFactorVal = msResid > 0 ? (ssFactor / dfFactor) / msResid : 0\n  const FCovVal = msResid > 0 ? (ssCov / dfCov) / msResid : 0\n\n  const rows: ANOVATableRow[] = [\n    {\n      source: 'Factor',\n      ss: ssFactor,\n      df: dfFactor,\n      ms: ssFactor / dfFactor,\n      F: FFactorVal,\n      pValue: fDistPValue(FFactorVal, dfFactor, dfResid),\n      etaSq: ssTotal > 0 ? ssFactor / ssTotal : 0,\n    },\n    {\n      source: 'Covariate',\n      ss: ssCov,\n      df: dfCov,\n      ms: ssCov / dfCov,\n      F: FCovVal,\n      pValue: fDistPValue(FCovVal, dfCov, dfResid),\n      etaSq: ssTotal > 0 ? ssCov / ssTotal : 0,\n    },\n  ]\n\n  // Compute adjusted group means at grand mean of covariate\n  // Adjusted mean = group mean(y) - b_cov * (group mean(cov) - grand mean(cov))\n  // where b_cov is the covariate slope from the full model\n  const Xt = XFull.transpose()\n  const XtX = Xt.multiply(XFull)\n  const XtY = Xt.multiply(Matrix.colVec(y))\n  const betaM = XtX.inverse().multiply(XtY)\n  const bCov = betaM.get(XFull.cols - 1, 0)  // last column is covariate\n  const grandMeanCov = _mean(covariate)\n\n  const adjustedMeans = levels.map(level => {\n    const idx: number[] = []\n    for (let i = 0; i < n; i++) {\n      if (factor[i] === level) idx.push(i)\n    }\n    const groupMeanY = _mean(idx.map(i => y[i]!))\n    const groupMeanCov = _mean(idx.map(i => covariate[i]!))\n    return {\n      label: String(level),\n      adjustedMean: groupMeanY - bCov * (groupMeanCov - grandMeanCov),\n    }\n  })\n\n  const formatted = rows.map(r => formatANCOVA(r.source, r.F, r.df, dfResid, r.pValue, r.etaSq)).join('; ')\n\n  return {\n    rows,\n    residual: { ss: rssFull, df: dfResid, ms: msResid },\n    total: { ss: ssTotal, df: n - 1 },\n    adjustedMeans,\n    n,\n    formatted,\n  }\n}\n", "/**\n * Post-hoc tests for group comparisons.\n * Tukey HSD, Games-Howell, Dunn's test.\n */\n\nimport {\n  mean as _mean,\n  variance as _variance,\n  tDistQuantile,\n  rank,\n  adjustPValues,\n  pValueStudentizedRangeApprox,\n  normalSurvival,\n} from '../core/math.js'\nimport type { PairwiseResult, GroupData, PAdjMethod } from '../core/types.js'\n\n// \u2500\u2500\u2500 Tukey HSD \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Tukey's Honest Significant Difference test.\n * Assumes equal variances (uses pooled MSE from ANOVA).\n * Uses Studentized range distribution approximation.\n *\n * Cross-validated with R:\n * > TukeyHSD(aov(value ~ group, data = df))\n */\nexport function tukeyHSD(\n  groups: readonly GroupData[],\n  msWithin: number,\n  dfWithin: number,\n  ciLevel = 0.95\n): PairwiseResult[] {\n  const results: PairwiseResult[] = []\n  const alpha = 1 - ciLevel\n  const k = groups.length\n\n  for (let i = 0; i < k; i++) {\n    for (let j = i + 1; j < k; j++) {\n      const g1 = groups[i]!\n      const g2 = groups[j]!\n      const n1 = g1.values.length\n      const n2 = g2.values.length\n      const m1 = _mean(g1.values)\n      const m2 = _mean(g2.values)\n      const diff = m1 - m2\n\n      // SE = sqrt(MSE/2 * (1/n1 + 1/n2))\n      const se = Math.sqrt(msWithin / 2 * (1 / n1 + 1 / n2))\n      const q = se === 0 ? 0 : Math.abs(diff) / se  // studentized range statistic\n\n      // p-value via proper studentized range distribution\n      const pValue = pValueStudentizedRangeApprox(q, k, dfWithin)\n\n      // CI uses studentized range critical value approximation\n      // Use Bonferroni-corrected t as approximation for qtukey critical value\n      const tCrit = tDistQuantile(1 - alpha / (k * (k - 1)), dfWithin)\n      const ciHalf = tCrit * se\n      const ci: readonly [number, number] = [diff - ciHalf, diff + ciHalf]\n\n      results.push({\n        group1: g1.label,\n        group2: g2.label,\n        meanDiff: diff,\n        se,\n        statistic: q,\n        pValue,\n        pValueAdj: pValue,  // already family-wise corrected\n        ci,\n        significant: pValue < alpha,\n      })\n    }\n  }\n  return results\n}\n\n// \u2500\u2500\u2500 Games-Howell \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Games-Howell test \u2014 does not assume equal variances.\n * Use when Levene's test is significant or group sizes differ substantially.\n *\n * Cross-validated with R:\n * > rstatix::games_howell_test(df, value ~ group)\n */\nexport function gamesHowell(\n  groups: readonly GroupData[],\n  ciLevel = 0.95\n): PairwiseResult[] {\n  const results: PairwiseResult[] = []\n  const alpha = 1 - ciLevel\n  const k = groups.length\n\n  for (let i = 0; i < k; i++) {\n    for (let j = i + 1; j < k; j++) {\n      const g1 = groups[i]!\n      const g2 = groups[j]!\n      const n1 = g1.values.length\n      const n2 = g2.values.length\n      const m1 = _mean(g1.values)\n      const m2 = _mean(g2.values)\n      const v1 = _variance(g1.values)\n      const v2 = _variance(g2.values)\n      const diff = m1 - m2\n\n      // Welch SE (with /2 to match studentized range convention used by rstatix)\n      const se = Math.sqrt((v1 / n1 + v2 / n2) / 2)\n      const q = se === 0 ? 0 : Math.abs(diff) / se\n\n      // Welch-Satterthwaite df\n      const dfNum = (v1 / n1 + v2 / n2) ** 2\n      const dfDen = (v1 / n1) ** 2 / (n1 - 1) + (v2 / n2) ** 2 / (n2 - 1)\n      const df = dfDen > 0 ? dfNum / dfDen : n1 + n2 - 2\n\n      const pValue = pValueStudentizedRangeApprox(q, k, df)\n      const tCrit = tDistQuantile(1 - alpha / (k * (k - 1)), df)\n      const ciHalf = tCrit * se\n\n      results.push({\n        group1: g1.label,\n        group2: g2.label,\n        meanDiff: diff,\n        se,\n        statistic: q,\n        pValue,\n        pValueAdj: pValue,\n        ci: [diff - ciHalf, diff + ciHalf],\n        significant: pValue < alpha,\n      })\n    }\n  }\n  return results\n}\n\n// \u2500\u2500\u2500 Dunn's test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Dunn's post-hoc test following Kruskal-Wallis.\n * Uses rank sums and z-scores with adjustable p-value correction.\n *\n * Cross-validated with R:\n * > dunn.test::dunn.test(values, groups, method = \"bonferroni\")\n */\nexport function dunnTest(\n  groups: readonly GroupData[],\n  method: PAdjMethod = 'bonferroni'\n): PairwiseResult[] {\n  const k = groups.length\n  const allValues = groups.flatMap(g => [...g.values])\n  const n = allValues.length\n  const allRanks = rank(allValues)\n\n  // Rank sums and averages per group\n  let offset = 0\n  const groupRankMeans: number[] = []\n  const groupNs: number[] = []\n\n  for (const g of groups) {\n    const gn = g.values.length\n    let Rj = 0\n    for (let i = 0; i < gn; i++) Rj += allRanks[offset + i]!\n    groupRankMeans.push(Rj / gn)\n    groupNs.push(gn)\n    offset += gn\n  }\n\n  // Tie correction\n  const tieCounts = new Map<number, number>()\n  for (const v of allValues) tieCounts.set(v, (tieCounts.get(v) ?? 0) + 1)\n  let C = 0\n  for (const t of tieCounts.values()) C += t * t * t - t\n  const tieAdj = C / (12 * (n - 1))\n\n  // Variance of rank sums (with tie correction matching R's dunn.test)\n  const baseVar = n * (n + 1) / 12 - tieAdj\n\n  // Raw p-values\n  const rawPValues: number[] = []\n  const rawZs: number[] = []\n  const rawSEs: number[] = []\n  const pairs: Array<{ i: number; j: number }> = []\n\n  for (let i = 0; i < k; i++) {\n    for (let j = i + 1; j < k; j++) {\n      const diff = (groupRankMeans[i] ?? 0) - (groupRankMeans[j] ?? 0)\n      const se = Math.sqrt(\n        baseVar * (1 / (groupNs[i] ?? 1) + 1 / (groupNs[j] ?? 1))\n      )\n      const z = se === 0 ? 0 : diff / se\n      // One-tailed p-value matching R's dunn.test default (altp=FALSE)\n      // Uses normalSurvival for numerical stability in the tails\n      const p = normalSurvival(Math.abs(z))\n      rawPValues.push(p)\n      rawZs.push(z)\n      rawSEs.push(se)\n      pairs.push({ i, j })\n    }\n  }\n\n  // R's dunn.test implements Holm/BH without enforcing monotonicity (no cummax/cummin).\n  // Use adjustPValues for bonferroni (identical), but match dunn.test behavior for holm/BH.\n  const adjPValues = method === 'holm'\n    ? dunnStyleHolm(rawPValues)\n    : method === 'BH'\n    ? dunnStyleBH(rawPValues)\n    : adjustPValues(rawPValues, method)\n\n  return pairs.map(({ i, j }, idx) => ({\n    group1: groups[i]!.label,\n    group2: groups[j]!.label,\n    meanDiff: (groupRankMeans[i] ?? 0) - (groupRankMeans[j] ?? 0),\n    se: rawSEs[idx]!,\n    statistic: rawZs[idx]!,\n    pValue: rawPValues[idx]!,\n    pValueAdj: adjPValues[idx]!,\n    ci: [NaN, NaN] as readonly [number, number],\n    significant: (adjPValues[idx] ?? 1) < 0.05,\n  }))\n}\n\n// \u2500\u2500\u2500 Dunn-style Holm (no cummax) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Holm adjustment matching R's dunn.test behavior.\n * Unlike standard Holm (p.adjust), dunn.test does NOT enforce\n * monotonicity via cumulative maximum. It simply multiplies\n * each sorted p-value by (m+1-i) and caps at 1.\n */\nfunction dunnStyleHolm(pValues: readonly number[]): number[] {\n  const m = pValues.length\n  if (m === 0) return []\n  const order = pValues.map((p, i) => ({ p, i })).sort((a, b) => a.p - b.p)\n  const adj = new Array<number>(m)\n  for (let k = 0; k < m; k++) {\n    const { p, i } = order[k]!\n    adj[i] = Math.min(1, p * (m - k))\n  }\n  return adj\n}\n\n/**\n * BH (Benjamini-Hochberg) adjustment matching R's dunn.test behavior.\n * Unlike standard BH (p.adjust), dunn.test does NOT enforce\n * monotonicity via cumulative minimum.\n */\nfunction dunnStyleBH(pValues: readonly number[]): number[] {\n  const m = pValues.length\n  if (m === 0) return []\n  const order = pValues.map((p, i) => ({ p, i })).sort((a, b) => b.p - a.p) // descending\n  const adj = new Array<number>(m)\n  for (let k = 0; k < m; k++) {\n    const { p, i } = order[k]!\n    const rank = m - k // rank from smallest (1-indexed)\n    adj[i] = Math.min(1, p * m / rank)\n  }\n  return adj\n}\n", "/**\n * Correlation analysis module.\n * Pearson, Spearman, Kendall tau-b, partial correlation, correlation matrix.\n */\n\nimport {\n  mean as _mean,\n  sd as _sd,\n  cov,\n  rank,\n  tDistPValue,\n  normalQuantile,\n  normalSurvival,\n  pKendallExact,\n  pSpearmanExact,\n  roundTo,\n} from '../core/math.js'\nimport { formatCorrelation, interpretR } from '../core/apa.js'\nimport type { StatResult, EffectInterpretation } from '../core/types.js'\nimport { Matrix } from '../core/matrix.js'\n\n// \u2500\u2500\u2500 Pearson correlation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Pearson product-moment correlation coefficient.\n *\n * Cross-validated with R:\n * > cor.test(c(1,2,3,4,5), c(2,4,1,5,3))\n * t = 0.6547, df = 3, p-value = 0.5607, r = 0.3536\n * 95% CI = [-0.6154, 0.9059]\n */\nexport function pearsonCorrelation(\n  x: readonly number[],\n  y: readonly number[],\n  ciLevel = 0.95\n): StatResult {\n  if (x.length !== y.length) throw new Error('pearsonCorrelation: arrays must have equal length')\n  const n = x.length\n  if (n < 3) throw new Error('pearsonCorrelation: need at least 3 observations')\n\n  const sdX = _sd(x), sdY = _sd(y)\n  if (sdX === 0 || sdY === 0) throw new Error('pearsonCorrelation: zero variance in input')\n\n  const r = cov(x, y) / (sdX * sdY)\n  const rClamped = Math.max(-1, Math.min(1, r))\n\n  const df = n - 2\n  const t = Math.abs(rClamped) === 1 ? Infinity : rClamped * Math.sqrt(df / (1 - rClamped * rClamped))\n  const pValue = tDistPValue(t, df)\n\n  // Fisher z-transform CI\n  const ci = fisherZCI(rClamped, n, ciLevel)\n\n  return {\n    testName: 'Pearson r',\n    statistic: roundTo(rClamped, 4),\n    df,\n    pValue: roundTo(pValue, 4),\n    effectSize: {\n      value: rClamped,\n      name: \"Pearson r\",\n      interpretation: interpretR(rClamped) as EffectInterpretation,\n    },\n    ci,\n    ciLevel,\n    n,\n    formatted: formatCorrelation(rClamped, df, pValue, ci, 'r', ciLevel),\n  }\n}\n\n/** Fisher z-transform confidence interval for Pearson r. */\nfunction fisherZCI(r: number, n: number, ciLevel: number): readonly [number, number] {\n  const z = Math.log((1 + r) / (1 - r)) / 2  // Fisher's z\n  const se = 1 / Math.sqrt(n - 3)\n  const zCrit = normalQuantile(1 - (1 - ciLevel) / 2)\n  const lo = z - zCrit * se\n  const hi = z + zCrit * se\n  // Back-transform\n  return [\n    Math.tanh(lo),\n    Math.tanh(hi),\n  ]\n}\n\n// \u2500\u2500\u2500 Spearman correlation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Spearman rank correlation.\n *\n * Cross-validated with R:\n * > cor.test(c(1,2,3,4,5), c(5,6,7,8,7), method = \"spearman\")\n * rho = 0.8211, p-value = 0.08852\n */\nexport function spearmanCorrelation(\n  x: readonly number[],\n  y: readonly number[],\n  ciLevel = 0.95\n): StatResult {\n  if (x.length !== y.length) throw new Error('spearmanCorrelation: arrays must have equal length')\n  const n = x.length\n  if (n < 3) throw new Error('spearmanCorrelation: need at least 3 observations')\n\n  // Pearson r on ranks\n  const rx = rank(x), ry = rank(y)\n  const rhoResult = pearsonCorrelation(rx, ry, ciLevel)\n  const rho = rhoResult.statistic\n\n  // Check for ties in ranks\n  const hasTies = new Set(rx).size < n || new Set(ry).size < n\n\n  // Exact/Edgeworth p-value for n \u2264 1290 without ties (matching R's cor.test)\n  // R uses AS89 (prho.c): exact enumeration for n \u2264 9, Edgeworth series for n \u2265 10\n  let pValue = rhoResult.pValue\n  if (!hasTies && n <= 1290) {\n    // Compute D = \u03A3(d_i\u00B2) directly from ranks (avoid rounding through rho)\n    let D = 0\n    for (let i = 0; i < n; i++) {\n      const d = rx[i]! - ry[i]!\n      D += d * d\n    }\n    const q = (n * n * n - n) / 6 // expected D under H0\n\n    // Two-sided test matching R's cor.test logic:\n    // R calls pspearman(q, n, lower.tail) which passes round(q) + 2*lower.tail to C_pRho\n    // prho computes P(S >= is) [upper] or P(S < is) [lower]\n    let p: number\n    if (D > q) {\n      // Negative correlation: upper tail P(S >= D)\n      p = pSpearmanExact(Math.round(D), n, false)\n    } else {\n      // Positive correlation: lower tail P(S < D+2) = P(S <= D)\n      p = pSpearmanExact(Math.round(D) + 2, n, true)\n    }\n    pValue = Math.min(2 * p, 1)\n  }\n\n  return {\n    ...rhoResult,\n    pValue,\n    testName: \"Spearman's \u03C1\",\n    effectSize: {\n      ...rhoResult.effectSize,\n      name: \"Spearman's \u03C1\",\n    },\n    formatted: formatCorrelation(rho, typeof rhoResult.df === 'number' ? rhoResult.df : 0, pValue, rhoResult.ci, '\u03C1', ciLevel),\n  }\n}\n\n// \u2500\u2500\u2500 Kendall's tau-b \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Kendall's tau-b correlation.\n *\n * Cross-validated with R:\n * > cor.test(c(1,2,3,4,5), c(5,6,7,8,7), method = \"kendall\")\n * tau = 0.7378, p-value = 0.1041\n */\nexport function kendallTau(\n  x: readonly number[],\n  y: readonly number[],\n  ciLevel = 0.95\n): StatResult {\n  if (x.length !== y.length) throw new Error('kendallTau: arrays must have equal length')\n  const n = x.length\n  if (n < 3) throw new Error('kendallTau: need at least 3 observations')\n\n  let concordant = 0, discordant = 0\n  let tiesX = 0, tiesY = 0\n\n  for (let i = 0; i < n; i++) {\n    for (let j = i + 1; j < n; j++) {\n      const dx = (x[i] ?? 0) - (x[j] ?? 0)\n      const dy = (y[i] ?? 0) - (y[j] ?? 0)\n      const sign = Math.sign(dx * dy)\n      if (sign > 0) concordant++\n      else if (sign < 0) discordant++\n      if (dx === 0) tiesX++\n      if (dy === 0) tiesY++\n    }\n  }\n\n  const n2 = n * (n - 1) / 2\n  const tau = (concordant - discordant) / Math.sqrt((n2 - tiesX) * (n2 - tiesY))\n\n  // Tie-corrected variance formula \u2014 Kendall (1970)\n  // Compute tie group sizes for X and Y\n  const xCounts = new Map<number, number>()\n  const yCounts = new Map<number, number>()\n  for (let i = 0; i < n; i++) {\n    const xv = x[i]!\n    const yv = y[i]!\n    xCounts.set(xv, (xCounts.get(xv) ?? 0) + 1)\n    yCounts.set(yv, (yCounts.get(yv) ?? 0) + 1)\n  }\n\n  const v0 = n * (n - 1) * (2 * n + 5)\n  let vt = 0  // tie correction for X\n  let vu = 0  // tie correction for Y\n  let v1t = 0 // t_i * (t_i - 1)\n  let v1u = 0 // u_j * (u_j - 1)\n  let v2t = 0 // t_i * (t_i - 1) * (t_i - 2)\n  let v2u = 0 // u_j * (u_j - 1) * (u_j - 2)\n\n  for (const t of xCounts.values()) {\n    vt += t * (t - 1) * (2 * t + 5)\n    v1t += t * (t - 1)\n    v2t += t * (t - 1) * (t - 2)\n  }\n  for (const u of yCounts.values()) {\n    vu += u * (u - 1) * (2 * u + 5)\n    v1u += u * (u - 1)\n    v2u += u * (u - 1) * (u - 2)\n  }\n\n  const sigma2 = (v0 - vt - vu) / 18\n    + (v1t * v1u) / (2 * n * (n - 1))\n    + (v2t * v2u) / (9 * n * (n - 1) * (n - 2))\n\n  const z = (concordant - discordant) / Math.sqrt(sigma2)\n\n  // Check for ties\n  const hasTies = tiesX > 0 || tiesY > 0\n\n  // Exact p-value for n < 50 without ties (matching R's cor.test)\n  let pValue: number\n  if (!hasTies && n < 50) {\n    // T = number of concordant pairs = (S + n2) / 2 where S = concordant - discordant\n    const S = concordant - discordant\n    const T = (S + n2) / 2\n    // Two-sided: P(tau >= |observed|) = P(T >= T_obs) + P(T <= n2 - T_obs)\n    // By symmetry: p = 2 * min(P(T <= T_obs), P(T >= T_obs))\n    const pLower = pKendallExact(Math.round(T), n)\n    const pUpper = 1 - pKendallExact(Math.round(T) - 1, n)\n    pValue = Math.min(1, 2 * Math.min(pLower, pUpper))\n  } else {\n    pValue = 2 * normalSurvival(Math.abs(z))\n  }\n\n  // CI via Fisher z approximation (approximate for Kendall)\n  const ci = fisherZCI(tau, n, ciLevel)\n  const df = n - 2\n\n  return {\n    testName: \"Kendall's \u03C4\",\n    statistic: roundTo(tau, 4),\n    df,\n    pValue: roundTo(pValue, 4),\n    effectSize: {\n      value: tau,\n      name: \"Kendall's \u03C4\",\n      interpretation: interpretR(tau) as EffectInterpretation,\n    },\n    ci,\n    ciLevel,\n    n,\n    formatted: formatCorrelation(tau, df, pValue, ci, '\u03C4', ciLevel),\n  }\n}\n\n// \u2500\u2500\u2500 Partial correlation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Partial correlation between x and y controlling for z.\n * r_xy.z = (r_xy - r_xz \u00B7 r_yz) / sqrt((1 - r_xz\u00B2)(1 - r_yz\u00B2))\n *\n * Cross-validated with R:\n * > ppcor::pcor.test(x, y, z)\n */\nexport function partialCorrelation(\n  x: readonly number[],\n  y: readonly number[],\n  controls: readonly (readonly number[])[]\n): StatResult {\n  if (x.length !== y.length) throw new Error('partialCorrelation: arrays must have equal length')\n\n  // Use OLS residuals: residualize x and y on controls\n  const xRes = residualize(x, controls)\n  const yRes = residualize(y, controls)\n  const result = pearsonCorrelation(xRes, yRes)\n\n  // Correct degrees of freedom: df = n - 2 - q (q = number of control variables)\n  const n = x.length\n  const q = controls.length\n  const correctedDf = n - 2 - q\n  if (correctedDf < 1) return result  // can't correct if df < 1\n\n  const r = result.effectSize.value\n  const t = Math.abs(r) === 1 ? Infinity : r * Math.sqrt(correctedDf / (1 - r * r))\n  const pValue = tDistPValue(t, correctedDf)\n\n  return {\n    ...result,\n    df: correctedDf,\n    pValue: roundTo(pValue, 4),\n    formatted: formatCorrelation(result.statistic, correctedDf, pValue, result.ci, 'r', result.ciLevel),\n  }\n}\n\n/** Compute OLS residuals of y regressed on predictors. */\nfunction residualize(y: readonly number[], predictors: readonly (readonly number[])[]): number[] {\n  if (predictors.length === 0) return [...y]\n  const n = y.length\n  // Design matrix: [1, x1, x2, ...]\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predictors.map(p => p[i] ?? 0)])\n  )\n  const Xt = X.transpose()\n  const XtX = Xt.multiply(X)\n  const XtY = Xt.multiply(Matrix.colVec(y))\n  const beta = XtX.inverse().multiply(XtY)\n  const fitted = X.multiply(beta)\n  return Array.from({ length: n }, (_, i) => (y[i] ?? 0) - fitted.get(i, 0))\n}\n\n// \u2500\u2500\u2500 Correlation matrix \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface CorrelationMatrix {\n  readonly r: readonly (readonly number[])[]\n  readonly pValues: readonly (readonly number[])[]\n  readonly n: number\n  readonly labels: readonly string[]\n}\n\n/**\n * Compute pairwise correlation matrix with p-values.\n * Method: 'pearson' | 'spearman' | 'kendall'\n */\nexport function correlationMatrix(\n  data: readonly (readonly number[])[],\n  labels?: readonly string[],\n  method: 'pearson' | 'spearman' | 'kendall' = 'pearson'\n): CorrelationMatrix {\n  const k = data.length\n  if (k < 2) throw new Error('correlationMatrix: need at least 2 variables')\n  const n = data[0]!.length\n\n  const corrFn = method === 'pearson'\n    ? pearsonCorrelation\n    : method === 'spearman'\n      ? spearmanCorrelation\n      : kendallTau\n\n  const r: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      if (i === j) return 1\n      if (j < i) return 0  // fill below diagonal later\n      try {\n        return corrFn(data[i]!, data[j]!).effectSize.value\n      } catch {\n        return NaN\n      }\n    })\n  )\n\n  const pValues: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      if (i === j) return NaN\n      if (j < i) return 0\n      try {\n        return corrFn(data[i]!, data[j]!).pValue\n      } catch {\n        return NaN\n      }\n    })\n  )\n\n  // Fill lower triangle (symmetric)\n  for (let i = 0; i < k; i++) {\n    for (let j = 0; j < i; j++) {\n      r[i]![j] = r[j]![i]!\n      pValues[i]![j] = pValues[j]![i]!\n    }\n  }\n\n  return {\n    r,\n    pValues,\n    n,\n    labels: labels ?? Array.from({ length: k }, (_, i) => `Var${i + 1}`),\n  }\n}\n\n// \u2500\u2500\u2500 Point-Biserial correlation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Point-biserial correlation between a binary variable and a continuous variable.\n * Validates binary is 0/1, delegates to Pearson, renames to r_pb.\n *\n * Cross-validated with R:\n * > cor.test(binary, continuous)\n * # Point-biserial is just Pearson r when one var is binary\n */\nexport function pointBiserialCorrelation(\n  binary: readonly number[],\n  continuous: readonly number[],\n  ciLevel = 0.95\n): StatResult {\n  // validate binary is all 0 or 1\n  for (const v of binary) {\n    if (v !== 0 && v !== 1) throw new Error('pointBiserialCorrelation: binary must contain only 0 and 1')\n  }\n  const result = pearsonCorrelation(binary, continuous, ciLevel)\n  return {\n    ...result,\n    testName: 'Point-biserial r',\n    effectSize: {\n      ...result.effectSize,\n      name: 'r_pb',\n    },\n    formatted: formatCorrelation(result.statistic, typeof result.df === 'number' ? result.df : 0, result.pValue, result.ci, 'r_pb', ciLevel),\n  }\n}\n", "/**\n * Data preprocessing for clustering and PCA.\n *\n * Provides center, standardize, log, and sqrt transforms with inverse.\n * Uses mean/sd from core/math.ts.\n *\n * Cross-validate with R:\n * > scale(data)                      # standardize\n * > scale(data, scale = FALSE)       # center only\n * > log(data)                        # log transform\n * > sqrt(data)                       # sqrt transform\n */\n\nimport { mean as _mean, sd as _sd } from '../core/math.js'\n\n// \u2500\u2500\u2500 Types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport type PreprocessMethod = 'none' | 'center' | 'standardize' | 'log' | 'sqrt'\n\nexport interface PreprocessOptions {\n  readonly method?: PreprocessMethod\n}\n\nexport interface PreprocessResult {\n  readonly data: readonly (readonly number[])[]\n  readonly colMeans: readonly number[]\n  readonly colSDs: readonly number[]\n  readonly method: PreprocessMethod\n  readonly centered: boolean\n  readonly scaled: boolean\n}\n\n// \u2500\u2500\u2500 Preprocessing \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Preprocess a numeric data matrix.\n *\n * - 'none':        pass-through (colMeans/colSDs still computed for reference)\n * - 'center':      subtract column mean (R: scale(x, scale=FALSE))\n * - 'standardize': subtract mean, divide by SD (R: scale(x))\n * - 'log':         natural log (requires all values > 0)\n * - 'sqrt':        square root (requires all values >= 0)\n *\n * Zero-variance columns get SD = 1 to avoid division by zero.\n *\n * @param data - N \u00D7 D numeric matrix\n * @param options - preprocessing configuration\n * @returns PreprocessResult with transformed data and parameters\n */\nexport function preprocessData(\n  data: readonly (readonly number[])[],\n  options?: PreprocessOptions\n): PreprocessResult {\n  const n = data.length\n  if (n === 0) throw new Error('preprocessData: data cannot be empty')\n  const d = data[0]!.length\n\n  const method = options?.method ?? 'none'\n\n  // For log/sqrt, transform first then compute means/SDs on transformed data\n  if (method === 'log') {\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < d; j++) {\n        if (data[i]![j]! <= 0) {\n          throw new Error(`preprocessData: log requires all values > 0, found ${data[i]![j]} at row ${i}, col ${j}`)\n        }\n      }\n    }\n    const transformed = data.map(row => row.map(v => Math.log(v)))\n    const colMeans = computeColMeans(transformed, n, d)\n    const colSDs = computeColSDs(transformed, colMeans, n, d)\n    return { data: transformed, colMeans, colSDs, method, centered: false, scaled: false }\n  }\n\n  if (method === 'sqrt') {\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < d; j++) {\n        if (data[i]![j]! < 0) {\n          throw new Error(`preprocessData: sqrt requires all values >= 0, found ${data[i]![j]} at row ${i}, col ${j}`)\n        }\n      }\n    }\n    const transformed = data.map(row => row.map(v => Math.sqrt(v)))\n    const colMeans = computeColMeans(transformed, n, d)\n    const colSDs = computeColSDs(transformed, colMeans, n, d)\n    return { data: transformed, colMeans, colSDs, method, centered: false, scaled: false }\n  }\n\n  // Compute column means\n  const colMeans = computeColMeans(data, n, d)\n\n  // Compute column SDs (Bessel-corrected, matching R scale())\n  const colSDs = computeColSDs(data, colMeans, n, d)\n\n  if (method === 'none') {\n    return { data, colMeans, colSDs, method, centered: false, scaled: false }\n  }\n\n  if (method === 'center') {\n    const centered = data.map(row =>\n      row.map((v, j) => v - colMeans[j]!)\n    )\n    return { data: centered, colMeans, colSDs, method, centered: true, scaled: false }\n  }\n\n  // method === 'standardize'\n  // Zero-variance columns: SD = 1 (centered but not divided)\n  const safeSDs = colSDs.map(s => s === 0 ? 1 : s)\n  const standardized = data.map(row =>\n    row.map((v, j) => (v - colMeans[j]!) / safeSDs[j]!)\n  )\n  return { data: standardized, colMeans, colSDs: safeSDs, method, centered: true, scaled: true }\n}\n\n// \u2500\u2500\u2500 Inverse Transform \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Inverse transform preprocessed data back to the original scale.\n *\n * @param data - N \u00D7 D preprocessed matrix\n * @param params - the PreprocessResult containing transform parameters\n * @returns data in original scale\n */\nexport function inverseTransform(\n  data: readonly (readonly number[])[],\n  params: PreprocessResult\n): readonly (readonly number[])[] {\n  const { method, colMeans, colSDs } = params\n\n  if (method === 'none') return data\n\n  if (method === 'log') {\n    return data.map(row => row.map(v => Math.exp(v)))\n  }\n\n  if (method === 'sqrt') {\n    return data.map(row => row.map(v => v * v))\n  }\n\n  if (method === 'center') {\n    return data.map(row =>\n      row.map((v, j) => v + colMeans[j]!)\n    )\n  }\n\n  // method === 'standardize'\n  return data.map(row =>\n    row.map((v, j) => v * colSDs[j]! + colMeans[j]!)\n  )\n}\n\n// \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction computeColMeans(\n  data: readonly (readonly number[])[],\n  n: number,\n  d: number\n): number[] {\n  return Array.from({ length: d }, (_, j) => {\n    let sum = 0\n    for (let i = 0; i < n; i++) sum += data[i]![j]!\n    return sum / n\n  })\n}\n\nfunction computeColSDs(\n  data: readonly (readonly number[])[],\n  colMeans: readonly number[],\n  n: number,\n  d: number\n): number[] {\n  if (n < 2) return new Array(d).fill(0) as number[]\n  return Array.from({ length: d }, (_, j) => {\n    let ss = 0\n    for (let i = 0; i < n; i++) {\n      const diff = data[i]![j]! - colMeans[j]!\n      ss += diff * diff\n    }\n    return Math.sqrt(ss / (n - 1))\n  })\n}\n", "/**\n * PCA (Principal Component Analysis) via SVD.\n * Also provides varimax rotation and factor loading computation.\n */\n\nimport { Matrix } from '../core/matrix.js'\nimport type { PCAResult } from '../core/types.js'\nimport { preprocessData } from './preprocess.js'\n\n// \u2500\u2500\u2500 PCA via SVD \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * PCA via SVD on the standardized data matrix.\n * Equivalent to eigen-decomposition of the correlation matrix.\n *\n * Cross-validated with R:\n * > prcomp(data, scale. = TRUE)\n * > summary(pca)  # check proportion of variance explained\n */\nexport function runPCA(\n  data: readonly (readonly number[])[],\n  nComponents?: number,\n  scale = true\n): PCAResult {\n  if (data.length < 2) throw new Error('runPCA: need at least 2 observations')\n  const n = data.length\n  const k = data[0]!.length\n  if (k < 2) throw new Error('runPCA: need at least 2 variables')\n\n  const pp = preprocessData(data, { method: scale ? 'standardize' : 'center' })\n  const X = Matrix.fromArray(pp.data as number[][])\n\n  // Compute correlation (or covariance) matrix R = X'X / (n-1)\n  const Xt = X.transpose()\n  const R = Xt.multiply(X).scale(1 / (n - 1))\n\n  // Eigendecomposition of R \u2014 gives eigenvalues and eigenvectors directly\n  const { values: eigVals, vectors: eigVecs } = R.eigen()\n\n  const nc = nComponents ?? Math.min(n - 1, k)\n  const eigenvalues = eigVals.slice(0, nc)\n  // Use trace of R (sum of diagonal) for total variance \u2014 numerically exact for standardized data\n  let totalVar = 0\n  for (let i = 0; i < k; i++) totalVar += R.get(i, i)\n\n  // Loadings = eigenvectors (columns are principal components, rows are variables)\n  const loadings: number[][] = Array.from({ length: k }, (_, varIdx) =>\n    Array.from({ length: nc }, (_, compIdx) => eigVecs.get(varIdx, compIdx))\n  )\n\n  // Scores = X * V (n \u00D7 nc)\n  const Vk = Matrix.fromArray(\n    Array.from({ length: k }, (_, i) => Array.from({ length: nc }, (_, j) => eigVecs.get(i, j)))\n  )\n  const scoresM = X.multiply(Vk)  // n \u00D7 nc\n  const scores: number[][] = Array.from({ length: n }, (_, i) =>\n    Array.from({ length: nc }, (_, j) => scoresM.get(i, j))\n  )\n\n  const varianceExplained = eigenvalues.map(e => totalVar > 0 ? e / totalVar : 0)\n  const cumulativeVariance = varianceExplained.reduce<number[]>((acc, v, i) => {\n    acc.push((acc[i - 1] ?? 0) + v)\n    return acc\n  }, [])\n\n  return {\n    loadings,\n    scores,\n    eigenvalues,\n    varianceExplained,\n    cumulativeVariance,\n    nComponents: nc,\n  }\n}\n\n// \u2500\u2500\u2500 Varimax rotation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Varimax rotation of a loading/eigenvector matrix.\n * Maximizes the variance of squared loadings within each factor.\n * Uses SVD-based update (same algorithm as R's stats::varimax).\n *\n * Kaiser normalization (normalize=true, the default) rescales each row\n * to unit length before rotation and restores afterwards, matching R's\n * varimax(x, normalize=TRUE) default.\n *\n * Reference: Kaiser (1958), Psychometrika 23:187-200\n *\n * Cross-validated with R:\n * > varimax(pca$rotation[, 1:3])\n */\nexport function varimaxRotation(\n  loadings: readonly (readonly number[])[],\n  maxIter = 1000,\n  tol = 1e-5,\n  normalize = true\n): { rotatedLoadings: number[][]; rotationMatrix: number[][] } {\n  const p = loadings.length        // variables (rows)\n  const nc = loadings[0]!.length   // components (columns)\n  if (nc < 2) {\n    return {\n      rotatedLoadings: loadings.map(row => [...row]),\n      rotationMatrix: [[1]],\n    }\n  }\n\n  // Convert to mutable array\n  let X: number[][] = loadings.map(row => [...row])\n\n  // Kaiser normalization: divide each row by its communality (row norm)\n  let sc: number[] | null = null\n  if (normalize) {\n    sc = X.map(row => Math.sqrt(row.reduce((s, v) => s + v * v, 0)))\n    X = X.map((row, i) => {\n      const h = sc![i]!\n      return h > 0 ? row.map(v => v / h) : [...row]\n    })\n  }\n\n  // SVD-based varimax iteration (matches R's stats::varimax exactly)\n  let T: number[][] = Array.from({ length: nc }, (_, i) =>\n    Array.from({ length: nc }, (_, j) => (i === j ? 1 : 0))\n  )\n\n  let d = 0\n  for (let iter = 0; iter < maxIter; iter++) {\n    // Z = X * T  (rotated loadings)\n    const Z: number[][] = X.map(row => {\n      const out = new Array(nc).fill(0) as number[]\n      for (let j = 0; j < nc; j++) {\n        let s = 0\n        for (let l = 0; l < nc; l++) s += row[l]! * T[l]![j]!\n        out[j] = s\n      }\n      return out\n    })\n\n    // B = X' * (Z^3 - Z * diag(colSums(Z^2) / p))\n    // First compute colSums(Z^2) / p\n    const colSumSq = new Array(nc).fill(0) as number[]\n    for (let i = 0; i < p; i++) {\n      for (let j = 0; j < nc; j++) colSumSq[j]! += Z[i]![j]! * Z[i]![j]!\n    }\n    for (let j = 0; j < nc; j++) colSumSq[j]! /= p\n\n    // Compute the target: Z^3 - Z * diag(colSumSq)\n    const target: number[][] = Z.map(row =>\n      row.map((v, j) => v * v * v - v * colSumSq[j]!)\n    )\n\n    // B = X' * target (nc \u00D7 nc)\n    const B: number[][] = Array.from({ length: nc }, (_, i) => {\n      const out = new Array(nc).fill(0) as number[]\n      for (let j = 0; j < nc; j++) {\n        let s = 0\n        for (let r = 0; r < p; r++) s += X[r]![i]! * target[r]![j]!\n        out[j] = s\n      }\n      return out\n    })\n\n    // Polar decomposition of B via eigendecomposition:\n    // B = T \u00B7 P where T is orthogonal, P = (B'B)^{1/2}\n    // T = B \u00B7 (B'B)^{-1/2}\n    // Convergence criterion: d = sum(singular values) = trace(P)\n    const Bm = Matrix.fromArray(B)\n    const BtB = Bm.transpose().multiply(Bm)  // nc \u00D7 nc, symmetric PSD\n    const { values: eigVals, vectors: eigVecs } = BtB.eigen()\n\n    // (B'B)^{-1/2} = Q \u00B7 diag(1/sqrt(\u03BB)) \u00B7 Q'\n    // Also compute sum(sqrt(\u03BB)) for convergence (= sum of singular values)\n    let dNew = 0\n    const invSqrt: number[] = eigVals.map(lambda => {\n      const sv = Math.sqrt(Math.max(0, lambda))\n      dNew += sv\n      return sv > 1e-15 ? 1 / sv : 0\n    })\n\n    // Compute (B'B)^{-1/2} = Q * diag(invSqrt) * Q'\n    const invSqrtBtB: number[][] = Array.from({ length: nc }, (_, i) => {\n      const row = new Array(nc).fill(0) as number[]\n      for (let j = 0; j < nc; j++) {\n        let s = 0\n        for (let l = 0; l < nc; l++) s += eigVecs.get(i, l) * invSqrt[l]! * eigVecs.get(j, l)\n        row[j] = s\n      }\n      return row\n    })\n\n    // T = B * (B'B)^{-1/2}\n    const Tnew: number[][] = Array.from({ length: nc }, (_, i) => {\n      const row = new Array(nc).fill(0) as number[]\n      for (let j = 0; j < nc; j++) {\n        let s = 0\n        for (let l = 0; l < nc; l++) s += B[i]![l]! * invSqrtBtB[l]![j]!\n        row[j] = s\n      }\n      return row\n    })\n    T = Tnew\n\n    const dPast = d\n    d = dNew\n    if (d < dPast * (1 + tol)) break\n  }\n\n  // Final rotation: Z = X * T\n  let Z: number[][] = X.map(row => {\n    const out = new Array(nc).fill(0) as number[]\n    for (let j = 0; j < nc; j++) {\n      let s = 0\n      for (let l = 0; l < nc; l++) s += row[l]! * T[l]![j]!\n      out[j] = s\n    }\n    return out\n  })\n\n  // Kaiser de-normalization: multiply each row back by its communality\n  if (normalize && sc) {\n    Z = Z.map((row, i) => {\n      const h = sc![i]!\n      return row.map(v => v * h)\n    })\n  }\n\n  return { rotatedLoadings: Z, rotationMatrix: T }\n}\n\n// \u2500\u2500\u2500 Scree data \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface ScreeData {\n  readonly components: readonly number[]\n  readonly eigenvalues: readonly number[]\n  readonly varianceExplained: readonly number[]\n  readonly cumulativeVariance: readonly number[]\n}\n\n/** Extract scree plot data from a PCA result. */\nexport function screeData(pca: PCAResult): ScreeData {\n  return {\n    components: Array.from({ length: pca.nComponents }, (_, i) => i + 1),\n    eigenvalues: pca.eigenvalues,\n    varianceExplained: pca.varianceExplained,\n    cumulativeVariance: pca.cumulativeVariance,\n  }\n}\n", "/**\n * Linear Mixed Models (LMM) via REML or ML.\n * Model: y = X\u03B2 + Zb + \u03B5\n *   b ~ N(0, G), \u03B5 ~ N(0, \u03C3\u00B2_e \u00B7 I)\n * G is the random-effects covariance (intercept + optional slopes).\n *\n * Parameterization: log-Cholesky for G/\u03C3\u00B2_e (lme4 style).\n * Optimization: multi-start Nelder-Mead on profiled log-likelihood.\n *\n * Supports:\n *   - Random intercepts (default)\n *   - Random slopes via Cholesky parameterization of G\n *   - REML (default) or ML estimation\n *   - Nakagawa R\u00B2 (marginal and conditional)\n *   - Model comparison via likelihood ratio test (compareLMM)\n *\n * Cross-validated with R:\n * > lme4::lmer(y ~ x + (1|group), data = df, REML = TRUE)\n * > lme4::lmer(y ~ x + (1 + x|group), data = df, REML = TRUE)\n */\n\nimport { Matrix } from '../core/matrix.js'\nimport { nelderMead, tDistPValue, tDistQuantile, chiSqPValue, roundTo, variance as computeVariance } from '../core/math.js'\nimport { formatLMM } from '../core/apa.js'\nimport type { LMMResult, FixedEffect } from '../core/types.js'\n\n// \u2500\u2500\u2500 Data structure \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface LMMInput {\n  readonly outcome: readonly number[]\n  readonly fixedPredictors: Readonly<Record<string, readonly number[]>>\n  readonly groupId: readonly (string | number)[]\n  readonly randomSlopes?: readonly string[]  // which fixed predictors also get random slopes\n  readonly method?: 'REML' | 'ML'\n  readonly ciLevel?: number\n}\n\n// \u2500\u2500\u2500 Model comparison result \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface LMMComparison {\n  readonly chiSq: number\n  readonly df: number\n  readonly pValue: number\n  readonly preferred: 'model1' | 'model2'\n  readonly warning?: string\n}\n\n// \u2500\u2500\u2500 Internal helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Build the relative Cholesky factor L (q\u00D7q lower-triangular) from \u03B8 parameters.\n * \u03B8 layout: [log(L[0,0]), L[1,0], log(L[1,1]), L[2,0], L[2,1], log(L[2,2]), ...]\n * Diagonal elements are exp(\u03B8) to ensure positivity.\n */\nfunction buildCholFactor(theta: readonly number[], q: number): Matrix {\n  const data = new Array(q * q).fill(0)\n  let idx = 0\n  for (let i = 0; i < q; i++) {\n    for (let j = 0; j <= i; j++) {\n      if (i === j) {\n        data[i * q + j] = Math.exp(theta[idx]!)\n      } else {\n        data[i * q + j] = theta[idx]!\n      }\n      idx++\n    }\n  }\n  return new Matrix(q, q, data)\n}\n\n/**\n * Build the extended random-effects design matrix Z_ext (n \u00D7 nGroups*q).\n * For each group j and random effect k:\n *   Z_ext[i, j*q + 0] = 1 if obs i in group j (intercept)\n *   Z_ext[i, j*q + k] = slopePredictors[k-1][i] if obs i in group j, else 0\n */\nfunction buildExtendedZ(\n  n: number,\n  groupId: readonly (string | number)[],\n  groupLevels: readonly (string | number)[],\n  slopePredictors: readonly (readonly number[])[]\n): Matrix {\n  const nGroups = groupLevels.length\n  const q = 1 + slopePredictors.length\n  const gq = nGroups * q\n  const data = new Array(n * gq).fill(0)\n\n  for (let i = 0; i < n; i++) {\n    const gIdx = groupLevels.indexOf(groupId[i]!)\n    if (gIdx < 0) continue\n    // Intercept column for this group\n    data[i * gq + gIdx * q] = 1\n    // Slope columns\n    for (let k = 0; k < slopePredictors.length; k++) {\n      data[i * gq + gIdx * q + (k + 1)] = slopePredictors[k]![i]!\n    }\n  }\n  return new Matrix(n, gq, data)\n}\n\n/**\n * Compute A = Z_ext \u00B7 (I_g \u2297 L) efficiently without forming the block-diagonal.\n * A[i, j*q+k] = \u03A3_{m=k..q-1} Z_ext[i, j*q+m] \u00B7 L[m, k]\n */\nfunction buildA(Z_ext: Matrix, L: Matrix, nGroups: number, q: number, n: number): Matrix {\n  const gq = nGroups * q\n  const data = new Array(n * gq).fill(0)\n  for (let i = 0; i < n; i++) {\n    for (let j = 0; j < nGroups; j++) {\n      for (let k = 0; k < q; k++) {\n        let val = 0\n        for (let m = k; m < q; m++) {\n          val += Z_ext.get(i, j * q + m) * L.get(m, k)\n        }\n        data[i * gq + j * q + k] = val\n      }\n    }\n  }\n  return new Matrix(n, gq, data)\n}\n\n/**\n * Profiled log-likelihood for LMM (generalized for any q random effects).\n *\n * Parameterization follows lme4:\n *   \u03A8 = L\u00B7L' is the relative covariance (G/\u03C3\u00B2)\n *   V_scaled = I + Z\u00B7(I_g\u2297L)\u00B7(I_g\u2297L)'\u00B7Z' = I + A\u00B7A'\n *   V_scaled\u207B\u00B9 = I \u2212 A\u00B7D\u207B\u00B9\u00B7A'  where D = I + A'A  (Woodbury)\n *   \u03C3\u00B2 profiled out analytically\n *\n * REML: \u03C3\u00B2 = e'V\u207B\u00B9e / (n-p);  \u2113 = \u2212\u00BD[(n-p)log(\u03C3\u00B2) + log|D| + log|X'V\u207B\u00B9X|]\n * ML:   \u03C3\u00B2 = e'V\u207B\u00B9e / n;      \u2113 = \u2212\u00BD[n\u00B7log(\u03C3\u00B2) + log|D|]\n */\nfunction profileLogLik(\n  theta: readonly number[],\n  y: readonly number[],\n  X: Matrix,\n  Z_ext: Matrix,\n  q: number,\n  nGroups: number,\n  method: 'REML' | 'ML'\n): number {\n  const n = y.length\n  const p = X.cols\n  const gq = nGroups * q\n\n  const L = buildCholFactor(theta, q)\n  const A = buildA(Z_ext, L, nGroups, q, n)\n\n  // D = I_{gq} + A'A\n  const At = A.transpose()\n  const D = Matrix.identity(gq).add(At.multiply(A))\n\n  let DInv: Matrix\n  let logDetD: number\n  try {\n    DInv = D.inverse()\n    logDetD = D.logDet()\n  } catch {\n    return Infinity\n  }\n\n  // Apply V_scaled\u207B\u00B9 via Woodbury: Vinv\u00B7v = v \u2212 A\u00B7D\u207B\u00B9\u00B7A'\u00B7v\n  // Compute Vinv\u00B7y and Vinv\u00B7X efficiently (never forming the n\u00D7n matrix)\n  const AtY = At.multiply(Matrix.colVec(y))         // gq\u00D71\n  const ADInvAtY = A.multiply(DInv.multiply(AtY))   // n\u00D71\n  const VinvY = Array.from({ length: n }, (_, i) => (y[i] ?? 0) - ADInvAtY.get(i, 0))\n\n  const AtX = At.multiply(X)                         // gq\u00D7p\n  const ADInvAtX = A.multiply(DInv.multiply(AtX))    // n\u00D7p\n  const VinvX = X.subtract(ADInvAtX)                 // n\u00D7p\n\n  // X'V\u207B\u00B9X  and  X'V\u207B\u00B9y\n  const Xt = X.transpose()\n  const XtVinvX = Xt.multiply(VinvX)                 // p\u00D7p\n  const XtVinvY = Xt.multiply(Matrix.colVec(VinvY))  // p\u00D71\n\n  let XtVinvXInv: Matrix\n  let logDetXVX: number\n  try {\n    XtVinvXInv = XtVinvX.inverse()\n    logDetXVX = XtVinvX.logDet()\n  } catch {\n    return Infinity\n  }\n\n  // GLS \u03B2\u0302\n  const beta = XtVinvXInv.multiply(XtVinvY)         // p\u00D71\n\n  // Residuals and quadratic form  e'V\u207B\u00B9e\n  const Xbeta = X.multiply(beta)\n  const e = Array.from({ length: n }, (_, i) => (y[i] ?? 0) - Xbeta.get(i, 0))\n  // V\u207B\u00B9e = VinvY \u2212 VinvX\u00B7\u03B2\u0302\n  const VinvXbeta = VinvX.multiply(beta)             // n\u00D71\n  const VinvE = VinvY.map((v, i) => v - VinvXbeta.get(i, 0))\n  const quadForm = e.reduce((s, ei, i) => s + ei * VinvE[i]!, 0)\n\n  if (quadForm <= 0) return Infinity\n\n  let sigma2: number\n  let logLik: number\n\n  if (method === 'REML') {\n    sigma2 = quadForm / (n - p)\n    logLik = -0.5 * ((n - p) * Math.log(sigma2) + logDetD + logDetXVX)\n  } else {\n    sigma2 = quadForm / n\n    logLik = -0.5 * (n * Math.log(sigma2) + logDetD)\n  }\n\n  return -logLik  // return negLogLik (we minimize)\n}\n\n// \u2500\u2500\u2500 Main LMM function \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Fit a linear mixed model with random intercepts and optional random slopes.\n *\n * Cross-validated with R lme4:\n * > mod <- lmer(y ~ x + (1|group), data = df, REML = TRUE)\n * > mod <- lmer(y ~ x + (1 + x|group), data = df, REML = TRUE)\n * > fixef(mod); VarCorr(mod); logLik(mod); AIC(mod)\n * > MuMIn::r.squaredGLMM(mod)\n */\nexport function runLMM(input: LMMInput): LMMResult {\n  const { outcome: y, fixedPredictors, groupId, randomSlopes, method = 'REML', ciLevel = 0.95 } = input\n  const n = y.length\n  if (n < 5) throw new Error('runLMM: need at least 5 observations')\n  if (groupId.length !== n) throw new Error('runLMM: groupId must have same length as outcome')\n\n  // Identify groups\n  const groupLevels = [...new Set(groupId)]\n  const nGroups = groupLevels.length\n  if (nGroups < 2) throw new Error('runLMM: need at least 2 groups')\n\n  // Fixed-effects design matrix X (n \u00D7 p), with intercept\n  const predNames = Object.keys(fixedPredictors)\n  const p = predNames.length + 1\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [\n      1,\n      ...predNames.map(name => (fixedPredictors[name] ?? [])[i] ?? 0),\n    ])\n  )\n\n  // Validate and gather slope predictors\n  const slopeNames = randomSlopes ?? []\n  for (const s of slopeNames) {\n    if (!(s in fixedPredictors)) {\n      throw new Error(`runLMM: random slope '${s}' not found in fixedPredictors`)\n    }\n  }\n  const slopePreds = slopeNames.map(s => fixedPredictors[s]!)\n  const q = 1 + slopeNames.length  // number of random effects per group\n  const nTheta = q * (q + 1) / 2   // log-Cholesky parameters\n\n  // Build extended Z matrix\n  const Z_ext = buildExtendedZ(n, groupId, groupLevels, slopePreds)\n\n  // \u2500\u2500 Optimization: multi-start Nelder-Mead \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const objFn = (theta: readonly number[]) =>\n    profileLogLik(theta, y, X, Z_ext, q, nGroups, method)\n\n  // Generate starting values: perturb the diagonal elements\n  const diagIndices: number[] = []\n  let idx = 0\n  for (let i = 0; i < q; i++) {\n    for (let j = 0; j <= i; j++) {\n      if (i === j) diagIndices.push(idx)\n      idx++\n    }\n  }\n\n  const startDiagValues = [-2, -1, 0, 1, 2]\n  let bestResult = nelderMead(objFn, new Array(nTheta).fill(0), { maxIter: 2000, tol: 1e-8 })\n\n  for (const dv of startDiagValues) {\n    const start = new Array(nTheta).fill(0)\n    for (const di of diagIndices) start[di] = dv\n    const cand = nelderMead(objFn, start, { maxIter: 2000, tol: 1e-8 })\n    if (cand.fval < bestResult.fval) bestResult = cand\n  }\n\n  // \u2500\u2500 Extract results at optimum \u03B8 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const optTheta = bestResult.x\n  const L = buildCholFactor(optTheta, q)\n  const A = buildA(Z_ext, L, nGroups, q, n)\n\n  // Re-do the full computation at the optimum to extract all quantities\n  const gq = nGroups * q\n  const At = A.transpose()\n  const D = Matrix.identity(gq).add(At.multiply(A))\n\n  let DInv: Matrix\n  let logDetD: number\n  try {\n    DInv = D.inverse()\n    logDetD = D.logDet()\n  } catch {\n    // Should not happen at the optimum, but guard anyway\n    DInv = Matrix.identity(gq)\n    logDetD = 0\n  }\n\n  // V_scaled\u207B\u00B9 applied to y and X\n  const AtY = At.multiply(Matrix.colVec(y))\n  const ADInvAtY = A.multiply(DInv.multiply(AtY))\n  const VinvY = Array.from({ length: n }, (_, i) => (y[i] ?? 0) - ADInvAtY.get(i, 0))\n\n  const AtX = At.multiply(X)\n  const ADInvAtX = A.multiply(DInv.multiply(AtX))\n  const VinvX = X.subtract(ADInvAtX)\n\n  const Xt = X.transpose()\n  const XtVinvX = Xt.multiply(VinvX)\n  const XtVinvY = Xt.multiply(Matrix.colVec(VinvY))\n\n  let XtVinvXInv: Matrix\n  let logDetXVX: number\n  try {\n    XtVinvXInv = XtVinvX.inverse()\n    logDetXVX = XtVinvX.logDet()\n  } catch {\n    XtVinvXInv = Matrix.identity(p)\n    logDetXVX = 0\n  }\n\n  // GLS \u03B2\u0302\n  const betaM = XtVinvXInv.multiply(XtVinvY)\n  const beta = Array.from({ length: p }, (_, i) => betaM.get(i, 0))\n\n  // Residuals and quadratic form\n  const Xbeta = X.multiply(betaM)\n  const e = Array.from({ length: n }, (_, i) => (y[i] ?? 0) - Xbeta.get(i, 0))\n  const VinvXbeta = VinvX.multiply(betaM)\n  const VinvE = VinvY.map((v, i) => v - VinvXbeta.get(i, 0))\n  const quadForm = e.reduce((s, ei, i) => s + ei * VinvE[i]!, 0)\n\n  // Profiled \u03C3\u00B2\n  const denom = method === 'REML' ? (n - p) : n\n  const sigma2 = Math.max(1e-8, quadForm / denom)\n\n  // Reconstruct G = \u03C3\u00B2 \u00B7 L\u00B7L' (the actual random-effects covariance)\n  const LLt = L.multiply(L.transpose())\n  const G = LLt.scale(sigma2)\n\n  // \u2500\u2500 Variance components \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const sigmab2 = G.get(0, 0)   // random intercept variance\n  const sigmae2 = sigma2          // residual variance\n\n  const slopeVarRecord: Record<string, number> = {}\n  for (let k = 0; k < slopeNames.length; k++) {\n    slopeVarRecord[slopeNames[k]!] = roundTo(G.get(k + 1, k + 1), 6)\n  }\n\n  // Random correlations (from G): correlation between effect i and j\n  const randomCorrs: Record<string, number> = {}\n  for (let i = 0; i < q; i++) {\n    for (let j = i + 1; j < q; j++) {\n      const si = Math.sqrt(G.get(i, i))\n      const sj = Math.sqrt(G.get(j, j))\n      if (si > 1e-10 && sj > 1e-10) {\n        const iName = i === 0 ? '(Intercept)' : slopeNames[i - 1]!\n        const jName = j === 0 ? '(Intercept)' : slopeNames[j - 1]!\n        randomCorrs[`${iName}:${jName}`] = roundTo(G.get(i, j) / (si * sj), 6)\n      }\n    }\n  }\n\n  // \u2500\u2500 Fixed effects with SEs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  // Var(\u03B2\u0302) = \u03C3\u00B2 \u00B7 (X'V_scaled\u207B\u00B9X)\u207B\u00B9\n  const covBeta = XtVinvXInv.scale(sigma2)\n\n  // Degrees of freedom (Satterthwaite approximation)\n  const df = Math.max(1, n - p - nGroups + 1)\n  const tCrit = tDistQuantile(1 - (1 - ciLevel) / 2, df)\n\n  const fixedEffectNames = ['(Intercept)', ...predNames]\n  const fixedEffects: FixedEffect[] = beta.map((b, i) => {\n    const seVal = Math.sqrt(Math.max(0, covBeta.get(i, i)))\n    const t = seVal === 0 ? 0 : b / seVal\n    const pVal = tDistPValue(t, df)\n    return {\n      name: fixedEffectNames[i] ?? `\u03B2${i}`,\n      estimate: roundTo(b, 6),\n      se: roundTo(seVal, 6),\n      tValue: roundTo(t, 4),\n      pValue: roundTo(pVal, 4),\n      ci: [roundTo(b - tCrit * seVal, 6), roundTo(b + tCrit * seVal, 6)],\n    }\n  })\n\n  // \u2500\u2500 ICC \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const icc = sigmab2 / (sigmab2 + sigmae2)\n\n  // \u2500\u2500 Log-likelihood (with normalizing constant for R compatibility) \u2500\u2500\u2500\u2500\u2500\n\n  const dfLogLik = method === 'REML' ? (n - p) : n\n  const negLogLikProfiled = method === 'REML'\n    ? 0.5 * ((n - p) * Math.log(sigma2) + logDetD + logDetXVX)\n    : 0.5 * (n * Math.log(sigma2) + logDetD)\n  const normConst = 0.5 * dfLogLik * (1 + Math.log(2 * Math.PI))\n  const logLik = -negLogLikProfiled - normConst\n\n  // Number of parameters: p fixed + q(q+1)/2 covariance + 1 residual\n  const nParams = p + nTheta + 1\n\n  const aic = -2 * logLik + 2 * nParams\n  const bic = -2 * logLik + Math.log(n) * nParams\n\n  // \u2500\u2500 Nakagawa R\u00B2 (marginal and conditional) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Reference: Nakagawa & Schielzeth (2013), Johnson (2014)\n  // \u03C3\u00B2_f = variance of fixed-effects predictions X\u03B2\u0302\n  // \u03C3\u00B2_r = mean of z_i'Gz_i over observations (random effects variance)\n  // R\u00B2_m = \u03C3\u00B2_f / (\u03C3\u00B2_f + \u03C3\u00B2_r + \u03C3\u00B2_e)\n  // R\u00B2_c = (\u03C3\u00B2_f + \u03C3\u00B2_r) / (\u03C3\u00B2_f + \u03C3\u00B2_r + \u03C3\u00B2_e)\n\n  const fixedPred = Array.from({ length: n }, (_, i) => Xbeta.get(i, 0))\n  const sigma2_f = computeVariance(fixedPred)\n\n  // Compute \u03C3\u00B2_r = (1/n) \u03A3_i z_i'Gz_i  where z_i = [1, x_i1, x_i2, ...]\n  let sigma2_r = 0\n  for (let i = 0; i < n; i++) {\n    // z_i is the q-vector of random-effect predictors for observation i\n    // z_i[0] = 1 (intercept), z_i[k] = slopePreds[k-1][i]\n    for (let a = 0; a < q; a++) {\n      for (let b = 0; b < q; b++) {\n        const za = a === 0 ? 1 : slopePreds[a - 1]![i]!\n        const zb = b === 0 ? 1 : slopePreds[b - 1]![i]!\n        sigma2_r += za * G.get(a, b) * zb\n      }\n    }\n  }\n  sigma2_r /= n\n\n  const totalVar = sigma2_f + sigma2_r + sigmae2\n  const r2Marginal = totalVar > 0 ? sigma2_f / totalVar : 0\n  const r2Conditional = totalVar > 0 ? (sigma2_f + sigma2_r) / totalVar : 0\n\n  // \u2500\u2500 Formatted output \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const formatted = formatLMM(icc, aic, bic, logLik)\n\n  return {\n    fixedEffects,\n    varianceComponents: {\n      intercept: roundTo(sigmab2, 6),\n      residual: roundTo(sigmae2, 6),\n      ...(slopeNames.length > 0 ? { slopes: slopeVarRecord } : {}),\n    },\n    ...(Object.keys(randomCorrs).length > 0 ? { randomCorrelations: randomCorrs } : {}),\n    icc: roundTo(icc, 6),\n    logLik: roundTo(logLik, 4),\n    aic: roundTo(aic, 2),\n    bic: roundTo(bic, 2),\n    nObs: n,\n    nGroups,\n    nParams,\n    method,\n    r2Marginal: roundTo(r2Marginal, 6),\n    r2Conditional: roundTo(r2Conditional, 6),\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Model comparison via LRT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compare two LMM models via likelihood ratio test (LRT).\n * Both models should be fitted with ML for valid comparison.\n * The model with more parameters is treated as the \"full\" model.\n *\n * Cross-validated with R:\n * > anova(mod1, mod2)\n *\n * @returns LRT statistic, df, p-value, and which model is preferred\n */\nexport function compareLMM(model1: LMMResult, model2: LMMResult): LMMComparison {\n  // Determine which is the fuller model\n  const [reduced, full] = model1.nParams <= model2.nParams\n    ? [model1, model2]\n    : [model2, model1]\n  const preferred = model1.nParams <= model2.nParams ? 'model2' : 'model1'\n\n  const chiSq = Math.max(0, -2 * (reduced.logLik - full.logLik))\n  const df = Math.abs(full.nParams - reduced.nParams)\n\n  if (df === 0) {\n    return {\n      chiSq: 0,\n      df: 0,\n      pValue: 1,\n      preferred: 'model1',\n      warning: 'Models have the same number of parameters',\n    }\n  }\n\n  const pValue = chiSqPValue(chiSq, df)\n\n  // Warn if REML was used (REML likelihoods not comparable for different fixed effects)\n  let warning: string | undefined\n  if (model1.method === 'REML' || model2.method === 'REML') {\n    warning = 'REML likelihoods are not comparable for models with different fixed effects. Use ML for valid comparison.'\n  }\n\n  return {\n    chiSq: roundTo(chiSq, 4),\n    df,\n    pValue: roundTo(pValue, 4),\n    preferred: pValue < 0.05 ? preferred : (model1.nParams <= model2.nParams ? 'model1' : 'model2'),\n    ...(warning !== undefined ? { warning } : {}),\n  }\n}\n\n// \u2500\u2500\u2500 BLUPs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute BLUPs (Best Linear Unbiased Predictors) \u2014 the random intercepts.\n * b_hat = \u03C3\u00B2_b Z'V^{-1}(y - X\u03B2)\n */\nexport function computeBLUPs(\n  input: LMMInput,\n  result: LMMResult\n): ReadonlyArray<{ group: string | number; blup: number }> {\n  const { outcome: y, fixedPredictors, groupId } = input\n  const n = y.length\n  const groupLevels = [...new Set(groupId)]\n  const predNames = Object.keys(fixedPredictors)\n\n  const sigmab2 = result.varianceComponents.intercept\n  const sigmae2 = result.varianceComponents.residual\n\n  const X = Matrix.fromArray(\n    Array.from({ length: n }, (_, i) => [1, ...predNames.map(name => (fixedPredictors[name] ?? [])[i] ?? 0)])\n  )\n  // Fixed fitted values\n  const beta = result.fixedEffects.map(fe => fe.estimate)\n  const Xbeta = X.multiply(Matrix.colVec(beta))\n  const residuals = Array.from({ length: n }, (_, i) => (y[i] ?? 0) - Xbeta.get(i, 0))\n\n  // BLUPs: b = \u03C3\u00B2_b Z' V^{-1} e \u2248 (\u03C3\u00B2_b/\u03C3\u00B2_e) Z' (I - ZD^{-1}Z') e / \u03C3\u00B2_e\n  // Simple approximation for random intercepts: b_j = \u03C8/(1+\u03C8\u00B7n_j) * \u03A3_{i in j} e_i\n  // where \u03C8 = \u03C3\u00B2_b/\u03C3\u00B2_e\n  const psi = sigmab2 / sigmae2\n  return groupLevels.map((g) => {\n    const indices = Array.from({ length: n }, (_, i) => i).filter(i => groupId[i] === g)\n    const sumResid = indices.reduce((s, i) => s + (residuals[i] ?? 0), 0)\n    const nj = indices.length\n    const blup = (psi / (1 + psi * nj)) * sumResid\n    return { group: g, blup: roundTo(blup, 6) }\n  })\n}\n", "/**\n * Field-based analysis dispatch.\n * Pass named fields with declared types; analyze() selects and runs the\n * right statistical test automatically.\n */\n\nimport type {\n  StatResult,\n  FrequencyTestResult,\n  DescriptiveResult,\n  PairwiseResult,\n  GroupData,\n  FieldType,\n  Field,\n  NumericField,\n  GroupField,\n  AnalyzeOptions,\n  AnalysisResult,\n} from '../core/types.js'\n\nimport {\n  tTestIndependent,\n  tTestPaired,\n  oneWayANOVA,\n  kruskalWallis,\n  mannWhitneyU,\n  wilcoxonSignedRank,\n} from './comparison.js'\nimport type { ANOVAResult } from './comparison.js'\nimport { tukeyHSD, dunnTest } from './post-hoc.js'\nimport { chiSquareTest, fisherExactTest, contingencyTable } from './frequency.js'\nimport { describe as computeDescribe, shapiroWilk } from './descriptive.js'\n\n// \u2500\u2500\u2500 Internal resolved options \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ninterface ResolvedOptions {\n  ciLevel: number\n  paired: boolean\n  pAdjMethod: NonNullable<AnalyzeOptions['pAdjMethod']>\n  forceTest: string | undefined\n  equalVariances: boolean\n  normalityAlpha: number\n}\n\nconst DEFAULTS: ResolvedOptions = {\n  ciLevel: 0.95,\n  paired: false,\n  pAdjMethod: 'holm',\n  forceTest: undefined,\n  equalVariances: false,\n  normalityAlpha: 0.05,\n}\n\n// \u2500\u2500\u2500 detectFieldType \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Infer the FieldType of an array of raw values.\n *\n * Rules (in order):\n *   1. If every value is a finite number and exactly 2 unique values both\n *      in {0, 1} \u2192 'binary'\n *   2. If every value is a finite number \u2192 'numeric'\n *   3. If there are exactly 2 unique string/mixed values \u2192 'binary'\n *   4. Otherwise \u2192 'categorical'\n *\n * @param values - Raw column values (string | number), length \u2265 1\n * @returns Inferred FieldType\n *\n * @example\n * detectFieldType([0, 1, 0, 1])      // \u2192 'binary'\n * detectFieldType([1.2, 3.4, 5.6])   // \u2192 'numeric'\n * detectFieldType(['A','B','A','C'])  // \u2192 'categorical'\n * detectFieldType(['yes','no'])       // \u2192 'binary'\n */\nexport function detectFieldType(values: readonly (string | number)[]): FieldType {\n  if (values.length === 0) return 'categorical'\n\n  const allFiniteNumber = values.every(v => typeof v === 'number' && isFinite(v as number))\n\n  if (allFiniteNumber) {\n    const nums = values as readonly number[]\n    const unique = new Set(nums)\n    if (unique.size === 2) {\n      const sorted = [...unique].sort((a, b) => a - b)\n      if (sorted[0] === 0 && sorted[1] === 1) return 'binary'\n    }\n    return 'numeric'\n  }\n\n  const unique = new Set(values)\n  return unique.size === 2 ? 'binary' : 'categorical'\n}\n\n// \u2500\u2500\u2500 splitGroups \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Split a numeric outcome array into per-group vectors using a parallel\n * label array. Returns GroupData[] sorted by label (string sort).\n *\n * @param outcome - Numeric observations, length n\n * @param labels  - Group label for each observation, length n (parallel)\n * @returns Array of { label, values }, one per unique label, sorted\n * @throws Error if outcome.length !== labels.length\n */\nfunction splitGroups(\n  outcome: readonly number[],\n  labels: readonly (string | number)[]\n): GroupData[] {\n  if (outcome.length !== labels.length) {\n    throw new Error(\n      `analyze: outcome length (${outcome.length}) !== predictor length (${labels.length})`\n    )\n  }\n\n  const map = new Map<string, number[]>()\n  for (let i = 0; i < labels.length; i++) {\n    const key = String(labels[i])\n    if (!map.has(key)) map.set(key, [])\n    map.get(key)!.push(outcome[i]!)\n  }\n\n  return [...map.entries()]\n    .sort(([a], [b]) => (a < b ? -1 : a > b ? 1 : 0))\n    .map(([label, values]) => ({ label, values }))\n}\n\n// \u2500\u2500\u2500 checkNormality \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Run Shapiro-Wilk on each group. Returns per-group W and p-value,\n * plus a boolean indicating whether ALL groups pass normality.\n *\n * Groups with n < 3 or n > 50 are treated as normal (SW undefined /\n * overly sensitive at large n; CLT applies).\n *\n * @param groups - GroupData[] from splitGroups()\n * @param alpha  - Significance threshold (default 0.05)\n */\nfunction checkNormality(\n  groups: readonly GroupData[],\n  alpha = 0.05\n): { allNormal: boolean; results: ReadonlyArray<{ group: string; W: number; p: number }> } {\n  const results = groups.map(g => {\n    const n = g.values.length\n    if (n < 3 || n > 50) {\n      // Treat as normal: SW undefined for n<3, overly sensitive for large n\n      return { group: g.label, W: 1, p: 1 }\n    }\n    const sw = shapiroWilk(g.values)\n    return { group: g.label, W: sw.statistic, p: sw.pValue }\n  })\n\n  const allNormal = results.every(r => r.p >= alpha)\n  return { allNormal, results }\n}\n\n// \u2500\u2500\u2500 selectTest \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Choose the appropriate test name given field types, groups, and options.\n *\n * Dispatch table:\n *   numeric + binary, paired=false \u2192 't-test-independent' (or 'mann-whitney')\n *   numeric + binary, paired=true  \u2192 't-test-paired'      (or 'wilcoxon')\n *   numeric + categorical (3+)     \u2192 'one-way-anova'      (or 'kruskal-wallis')\n *   binary/categorical + any       \u2192 'chi-square'\n *   numeric + none                 \u2192 'describe-only'\n */\nfunction selectTest(\n  outcomeFt: FieldType,\n  predictorFt: FieldType | undefined,\n  groups: readonly GroupData[],\n  opts: ResolvedOptions\n): string {\n  // forceTest overrides all auto-selection\n  if (opts.forceTest) return opts.forceTest\n\n  if (outcomeFt === 'numeric') {\n    if (predictorFt === undefined) return 'describe-only'\n\n    if (predictorFt === 'binary') {\n      const { allNormal } = checkNormality(groups, opts.normalityAlpha)\n      if (opts.paired) {\n        return allNormal ? 't-test-paired' : 'wilcoxon'\n      }\n      return allNormal ? 't-test-independent' : 'mann-whitney'\n    }\n\n    if (predictorFt === 'categorical') {\n      const { allNormal } = checkNormality(groups, opts.normalityAlpha)\n      return allNormal ? 'one-way-anova' : 'kruskal-wallis'\n    }\n\n    throw new Error(\n      `analyze: unsupported predictor type '${predictorFt}' for numeric outcome. ` +\n        `Use 'binary' or 'categorical'.`\n    )\n  }\n\n  // binary or categorical outcome \u2192 frequency test\n  return 'chi-square'\n}\n\n// \u2500\u2500\u2500 analyze \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * High-level statistical dispatch: pass fields, get the right test result.\n *\n * Automatically:\n *   - Detects field types from the declared .type property\n *   - Splits numeric outcome by group labels\n *   - Selects parametric vs non-parametric via Shapiro-Wilk\n *   - Runs the selected test with remaining options forwarded\n *   - Computes descriptive statistics for numeric outcomes\n *   - Runs post-hoc tests when 3+ groups are present\n *\n * @param outcome   - The outcome/dependent variable field\n * @param predictor - The grouping/independent variable field (optional)\n * @param opts      - Tuning options (all optional)\n *\n * @returns AnalysisResult with test name, StatResult, optional descriptives,\n *          optional posthoc, and the normality check used for routing.\n *\n * @throws Error if outcome and predictor have different lengths\n * @throws Error if paired=true but group sizes are unequal\n * @throws Error if forceTest names an unknown test\n *\n * @example \u2014 independent t-test (auto-detected)\n * analyze(\n *   { type: 'numeric', name: 'score', values: [72, 85, 90, 68, 77] },\n *   { type: 'binary',  name: 'group', values: ['A','B','A','B','A'] }\n * )\n *\n * @example \u2014 force Kruskal-Wallis\n * analyze(\n *   { type: 'numeric',     name: 'rt',   values: [...] },\n *   { type: 'categorical', name: 'cond', values: [...] },\n *   { forceTest: 'kruskal-wallis' }\n * )\n *\n * @example \u2014 paired t-test\n * analyze(\n *   { type: 'numeric', name: 'post', values: [80, 85, 90] },\n *   { type: 'binary',  name: 'time', values: ['pre','post','pre'] },\n *   { paired: true }\n * )\n */\nexport function analyze(\n  outcome: Field,\n  predictor?: Field,\n  opts?: AnalyzeOptions\n): AnalysisResult {\n  const options: ResolvedOptions = { ...DEFAULTS, ...opts }\n\n  // \u2500\u2500 Categorical / binary outcome \u2192 frequency test \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (outcome.type === 'binary' || outcome.type === 'categorical') {\n    if (predictor === undefined) {\n      throw new Error(\n        `analyze: categorical/binary outcome requires a predictor for frequency tests`\n      )\n    }\n\n    const groupOutcome = outcome as GroupField\n    const groupPredictor = predictor as GroupField | NumericField\n\n    const { table } = contingencyTable(\n      groupOutcome.values,\n      groupPredictor.values as readonly (string | number)[]\n    )\n\n    const testName = options.forceTest ?? 'chi-square'\n    let result: StatResult | FrequencyTestResult\n\n    if (testName === 'fisher') {\n      if (table.length !== 2 || table[0]!.length !== 2) {\n        throw new Error(`analyze: Fisher's exact test requires a 2\u00D72 table`)\n      }\n      result = fisherExactTest(table[0]![0]!, table[0]![1]!, table[1]![0]!, table[1]![1]!)\n    } else {\n      // chi-square; auto-fallback to Fisher for 2\u00D72 with expected counts < 5\n      if (!options.forceTest && table.length === 2 && table[0]!.length === 2) {\n        const n = table[0]![0]! + table[0]![1]! + table[1]![0]! + table[1]![1]!\n        const r0 = table[0]![0]! + table[0]![1]!\n        const r1 = n - r0\n        const c0 = table[0]![0]! + table[1]![0]!\n        const c1 = n - c0\n        const anyLowExpected =\n          (r0 * c0) / n < 5 ||\n          (r0 * c1) / n < 5 ||\n          (r1 * c0) / n < 5 ||\n          (r1 * c1) / n < 5\n\n        if (anyLowExpected) {\n          result = fisherExactTest(table[0]![0]!, table[0]![1]!, table[1]![0]!, table[1]![1]!)\n          return {\n            test: result.testName,\n            outcome: outcome.name,\n            predictor: predictor.name,\n            result,\n          }\n        }\n      }\n      result = chiSquareTest(table)\n    }\n\n    return {\n      test: result.testName,\n      outcome: outcome.name,\n      predictor: predictor.name,\n      result,\n    }\n  }\n\n  // \u2500\u2500 Numeric outcome \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const numericOutcome = outcome as NumericField\n  const numericValues = numericOutcome.values\n\n  // No predictor \u2192 descriptive statistics only\n  if (predictor === undefined) {\n    const desc = computeDescribe(numericValues, options.ciLevel)\n    const dummyResult: StatResult = {\n      testName: 'Descriptive statistics',\n      statistic: NaN,\n      df: 0,\n      pValue: NaN,\n      effectSize: { value: NaN, name: 'none', interpretation: 'negligible' },\n      ci: [NaN, NaN],\n      ciLevel: options.ciLevel,\n      n: numericValues.length,\n      formatted: desc.formatted,\n    }\n    return {\n      test: 'descriptive',\n      outcome: outcome.name,\n      result: dummyResult,\n      descriptives: [desc],\n    }\n  }\n\n  // Split outcome values by predictor labels\n  const groups = splitGroups(numericValues, predictor.values as readonly (string | number)[])\n\n  // Normality check (used for routing; always computed for the result)\n  const normalityCheck = checkNormality(groups, options.normalityAlpha)\n\n  // Select test\n  const selectedTest = selectTest(outcome.type, predictor.type, groups, options)\n\n  // Run selected test\n  let result: StatResult | FrequencyTestResult\n  let posthoc: PairwiseResult[] | undefined\n\n  if (selectedTest === 't-test-independent' || selectedTest === 'mann-whitney') {\n    if (groups.length !== 2) {\n      throw new Error(\n        `analyze: '${selectedTest}' requires exactly 2 groups, got ${groups.length}`\n      )\n    }\n    const [g1, g2] = groups as [GroupData, GroupData]\n\n    if (selectedTest === 't-test-independent') {\n      result = tTestIndependent(g1.values, g2.values, options.equalVariances, options.ciLevel)\n    } else {\n      result = mannWhitneyU(g1.values, g2.values)\n    }\n  } else if (selectedTest === 't-test-paired' || selectedTest === 'wilcoxon') {\n    if (groups.length !== 2) {\n      throw new Error(\n        `analyze: '${selectedTest}' requires exactly 2 groups, got ${groups.length}`\n      )\n    }\n    const [g1, g2] = groups as [GroupData, GroupData]\n\n    if (g1.values.length !== g2.values.length) {\n      throw new Error(\n        `analyze: paired=true but group sizes are unequal ` +\n          `(${g1.label}: ${g1.values.length}, ${g2.label}: ${g2.values.length})`\n      )\n    }\n\n    if (selectedTest === 't-test-paired') {\n      result = tTestPaired(g1.values, g2.values, options.ciLevel)\n    } else {\n      result = wilcoxonSignedRank(g1.values, g2.values)\n    }\n  } else if (selectedTest === 'one-way-anova') {\n    const anovaResult = oneWayANOVA(groups) as ANOVAResult\n    result = anovaResult\n    posthoc = tukeyHSD(groups, anovaResult.msWithin, anovaResult.dfWithin, options.ciLevel)\n  } else if (selectedTest === 'kruskal-wallis') {\n    result = kruskalWallis(groups)\n    posthoc = dunnTest(groups, options.pAdjMethod)\n  } else if (selectedTest === 'chi-square' || selectedTest === 'fisher') {\n    throw new Error(\n      `analyze: '${selectedTest}' is not applicable to numeric outcomes`\n    )\n  } else {\n    throw new Error(`analyze: unknown test '${selectedTest}'`)\n  }\n\n  // Descriptive statistics for each group\n  const descriptives: DescriptiveResult[] = groups.map(g =>\n    computeDescribe(g.values, options.ciLevel)\n  )\n\n  return {\n    test: result.testName,\n    outcome: outcome.name,\n    predictor: predictor.name,\n    result,\n    descriptives,\n    // Only include optional fields when they have a value (exactOptionalPropertyTypes)\n    ...(posthoc !== undefined && { posthoc }),\n    normality: normalityCheck.results,\n  }\n}\n", "/**\n * Clustering & Mixture Models: GMM, LCA, LTA, K-Means.\n *\n * - GMM: Gaussian Mixture with EM, K-Means++ init, mclust-style covariance constraints\n * - LCA: Latent Class Analysis for binary data (MLE, matches poLCA)\n * - LTA: Latent Transition Analysis (Hidden Markov LCA) with Baum-Welch in log-space\n * - K-Means: Lloyd's algorithm with K-Means++ init and empty-cluster re-seeding\n *\n * All functions are deterministic via a seeded PRNG (default seed: 42).\n * Cross-validate against: mclust (GMM), poLCA (LCA), seqHMM (LTA), stats::kmeans (K-Means).\n */\n\nimport { roundTo } from '../core/math.js'\nimport { Matrix } from '../core/matrix.js'\nimport { PRNG } from '../core/prng.js'\n\n// \u2500\u2500\u2500 Constants \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nconst LOG_2PI = Math.log(2 * Math.PI)\nconst MIN_PROB = 1e-300\n\n// \u2500\u2500\u2500 Shared Utilities \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction logSumExp(arr: ArrayLike<number>): number {\n  let max = -Infinity\n  for (let i = 0; i < arr.length; i++) {\n    if (arr[i]! > max) max = arr[i]!\n  }\n  if (max === -Infinity) return -Infinity\n  let sum = 0\n  for (let i = 0; i < arr.length; i++) sum += Math.exp(arr[i]! - max)\n  return max + Math.log(sum)\n}\n\n/** Raw entropy E = -sum_i sum_k (z_ik * log(z_ik)). Used for ICL = BIC + 2E. */\nfunction computeRawEntropy(resp: ArrayLike<number>[], k: number): number {\n  let ent = 0\n  for (let i = 0; i < resp.length; i++) {\n    for (let j = 0; j < k; j++) {\n      const z = resp[i]![j]!\n      if (z > MIN_PROB) ent -= z * Math.log(z)\n    }\n  }\n  return ent\n}\n\n/** Normalized entropy = 1 - E / (N * log(K)), in [0,1]. 1 = perfect separation. */\nfunction computeNormalizedEntropy(resp: ArrayLike<number>[], k: number): number {\n  if (k <= 1) return 1  // trivial case: one cluster\n  const rawE = computeRawEntropy(resp, k)\n  const n = resp.length\n  const denom = n * Math.log(k)\n  return denom > 0 ? 1 - rawE / denom : 1\n}\n\nfunction computeAvePP(resp: ArrayLike<number>[], k: number): number[] {\n  const sums = new Float64Array(k)\n  const counts = new Float64Array(k)\n  for (let i = 0; i < resp.length; i++) {\n    let maxP = -1, best = 0\n    for (let j = 0; j < k; j++) {\n      if (resp[i]![j]! > maxP) { maxP = resp[i]![j]!; best = j }\n    }\n    sums[best]! += maxP\n    counts[best]!++\n  }\n  return Array.from(sums).map((s, i) => counts[i]! > 0 ? s / counts[i]! : 0)\n}\n\n// \u2500\u2500\u2500 Types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport type CovarianceModel = 'VVV' | 'EEE' | 'VVI' | 'EEI' | 'VII' | 'EII'\n\nexport interface ClusterDiagnostics {\n  readonly converged: boolean\n  readonly iterations: number\n  readonly logLikelihood: number\n  readonly df: number\n  readonly aic: number\n  readonly bic: number\n  readonly icl: number\n  readonly entropy: number\n  readonly avepp: readonly number[]\n  readonly formatted: string\n}\n\nexport interface GMMOptions {\n  readonly k: number\n  readonly model?: CovarianceModel\n  readonly seed?: number\n  readonly tol?: number\n  readonly maxIter?: number\n  readonly regCovar?: number\n}\n\nexport interface GMMResult {\n  readonly weights: readonly number[]\n  readonly means: readonly number[][]\n  readonly covariances: readonly Matrix[]\n  readonly posteriors: readonly (readonly number[])[]\n  readonly labels: readonly number[]\n  readonly diagnostics: ClusterDiagnostics\n}\n\nexport interface LCAOptions {\n  readonly k: number\n  readonly seed?: number\n  readonly tol?: number\n  readonly maxIter?: number\n}\n\nexport interface LCAResult {\n  readonly rho: readonly (readonly number[])[]\n  readonly priorWeights: readonly number[]\n  readonly posteriors: readonly (readonly number[])[]\n  readonly labels: readonly number[]\n  readonly diagnostics: ClusterDiagnostics\n}\n\nexport interface LTAOptions {\n  readonly k: number\n  readonly seed?: number\n  readonly tol?: number\n  readonly maxIter?: number\n}\n\nexport interface LTAResult {\n  readonly pi: readonly number[]\n  readonly tau: readonly (readonly number[])[]\n  readonly rho: readonly (readonly number[])[]\n  readonly trajectories: readonly (readonly number[])[]\n  readonly posteriors: readonly (readonly (readonly number[])[])[]\n  readonly diagnostics: ClusterDiagnostics\n}\n\nexport interface KMeansOptions {\n  readonly k: number\n  readonly seed?: number\n  readonly maxIter?: number\n  readonly tol?: number\n}\n\nexport interface KMeansResult {\n  readonly centroids: readonly (readonly number[])[]\n  readonly labels: readonly number[]\n  readonly inertia: number\n  readonly converged: boolean\n  readonly iterations: number\n}\n\n// \u2500\u2500\u2500 K-Means++ Initialization \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction kMeansPlusPlus(\n  data: readonly (readonly number[])[],\n  k: number,\n  rng: PRNG\n): number[][] {\n  const n = data.length\n  const d = data[0]!.length\n  const means: number[][] = [[...data[Math.floor(rng.next() * n)]!]]\n  const dists = new Float64Array(n).fill(Infinity)\n\n  for (let j = 1; j < k; j++) {\n    const lastMean = means[j - 1]!\n    let sumSqDist = 0\n\n    for (let i = 0; i < n; i++) {\n      const pt = data[i]!\n      let dSq = 0\n      for (let dim = 0; dim < d; dim++) {\n        const diff = pt[dim]! - lastMean[dim]!\n        dSq += diff * diff\n      }\n      if (dSq < dists[i]!) dists[i] = dSq\n      sumSqDist += dists[i]!\n    }\n\n    let target = rng.next() * sumSqDist\n    let cumulative = 0\n    for (let i = 0; i < n; i++) {\n      cumulative += dists[i]!\n      if (cumulative >= target) {\n        means.push([...data[i]!])\n        break\n      }\n    }\n    // Safety: if rounding prevents selection, pick last point\n    if (means.length <= j) means.push([...data[n - 1]!])\n  }\n  return means\n}\n\n// \u2500\u2500\u2500 Multivariate Normal Log-PDF \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Log-PDF of multivariate normal using eigendecomposition.\n * \u03A3 = U \u00B7 diag(S) \u00B7 U^T, so \u03A3^{-1} = U \u00B7 diag(1/S) \u00B7 U^T.\n * Mahalanobis distance = \u03A3 (U^T \u00B7 (x-\u03BC))_i\u00B2 / S_i.\n */\nfunction mvnLogPdf(\n  x: readonly number[],\n  mu: readonly number[],\n  uFlat: readonly number[],  // U eigenvector matrix, row-major\n  eigenvals: readonly number[],\n  d: number\n): number {\n  let mahal = 0\n  let logDet = 0\n  for (let i = 0; i < d; i++) {\n    // Project (x - mu) onto i-th eigenvector (column i of U)\n    let yi = 0\n    for (let j = 0; j < d; j++) {\n      yi += uFlat[j * d + i]! * (x[j]! - mu[j]!)\n    }\n    const eig = eigenvals[i]!\n    mahal += (yi * yi) / eig\n    logDet += Math.log(eig)\n  }\n  return -0.5 * (d * LOG_2PI + logDet + mahal)\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// GMM\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/**\n * Fit a Gaussian Mixture Model via Expectation-Maximization.\n *\n * Supports mclust-style covariance constraints:\n * - VVV: Variable volume, variable shape, variable orientation (full covariance per component)\n * - EEE: Equal volume, equal shape, equal orientation (single pooled covariance)\n * - VVI: Variable volume, variable shape, identity orientation (diagonal, per component)\n * - EEI: Equal volume, equal shape, identity orientation (single shared diagonal)\n * - VII: Variable volume, identity shape, identity orientation (spherical, per component)\n * - EII: Equal volume, identity shape, identity orientation (single shared scalar \u00D7 I)\n *\n * @param data - N \u00D7 D numeric data matrix (array of observation arrays)\n * @param options - GMM configuration\n * @returns GMMResult with weights, means, covariances, posteriors, labels, diagnostics\n *\n * Cross-validate with R:\n * > library(mclust)\n * > fit <- Mclust(data, G=3, modelNames=\"VVV\")\n * > fit$parameters$mean\n * > fit$parameters$variance$sigma\n * > fit$BIC\n */\nexport function fitGMM(\n  data: readonly (readonly number[])[],\n  options: GMMOptions\n): GMMResult {\n  const n = data.length\n  if (n === 0) throw new Error('fitGMM: data cannot be empty')\n  const d = data[0]!.length\n  const k = options.k\n  if (k < 1) throw new Error('fitGMM: k must be >= 1')\n  if (k > n) throw new Error('fitGMM: k cannot exceed n')\n\n  const modelType = options.model ?? 'VVV'\n  const rng = new PRNG(options.seed ?? 42)\n  const tol = options.tol ?? 1e-6\n  const maxIter = options.maxIter ?? 200\n  const regCovar = options.regCovar ?? 1e-6\n\n  // Initialize with K-Means++\n  const means = kMeansPlusPlus(data, k, rng)\n  const weights = new Float64Array(k).fill(1 / k)\n  const resp = Array.from({ length: n }, () => new Float64Array(k))\n\n  // Eigenvalues (S) and eigenvector flats (U) per component\n  const I = Matrix.identity(d)\n  const iFlat = I.toFlat()\n  const uFlats: number[][] = Array.from({ length: k }, () => [...iFlat])\n  const eigenvals: number[][] = Array.from({ length: k }, () => new Array<number>(d).fill(1))\n\n  // Initialize eigenvalues from global variance\n  let globalVar = regCovar\n  const colMeans: number[] = Array.from({ length: d }, (_, j) => {\n    let s = 0\n    for (let i = 0; i < n; i++) s += data[i]![j]!\n    return s / n\n  })\n  for (let i = 0; i < n; i++) {\n    for (let dim = 0; dim < d; dim++) {\n      globalVar += ((data[i]![dim]! - colMeans[dim]!) ** 2) / (n * d)\n    }\n  }\n  for (let j = 0; j < k; j++) eigenvals[j]!.fill(globalVar)\n\n  // EM loop\n  let prevLogL = -Infinity\n  let converged = false\n  let iter = 0\n\n  for (; iter < maxIter; iter++) {\n    // E-step: compute responsibilities\n    let currentLogL = 0\n    const logLiks = new Float64Array(k)\n\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < k; j++) {\n        logLiks[j] = Math.log(Math.max(weights[j]!, MIN_PROB)) +\n          mvnLogPdf(data[i]!, means[j]!, uFlats[j]!, eigenvals[j]!, d)\n      }\n      const marg = logSumExp(logLiks)\n      currentLogL += marg\n      for (let j = 0; j < k; j++) {\n        resp[i]![j] = Math.exp(logLiks[j]! - marg)\n      }\n    }\n\n    if (Math.abs(currentLogL - prevLogL) < tol) {\n      converged = true\n      break\n    }\n    prevLogL = currentLogL\n\n    // M-step: update weights, means, covariances\n    const Nk = new Float64Array(k)\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < k; j++) Nk[j]! += resp[i]![j]!\n    }\n\n    // Pooled covariance accumulator for EEE/EEI/EII models\n    const needPool = modelType === 'EEE' || modelType === 'EEI' || modelType === 'EII'\n    const pool: number[][] | null = needPool\n      ? Array.from({ length: d }, () => new Array<number>(d).fill(0))\n      : null\n\n    for (let j = 0; j < k; j++) {\n      const nk = Math.max(Nk[j]!, MIN_PROB)\n      weights[j] = Nk[j]! / n\n\n      // Update means\n      const mu = means[j]!\n      mu.fill(0)\n      for (let i = 0; i < n; i++) {\n        const r = resp[i]![j]!\n        for (let dim = 0; dim < d; dim++) mu[dim]! += r * data[i]![dim]!\n      }\n      for (let dim = 0; dim < d; dim++) mu[dim]! /= nk\n\n      // Compute empirical covariance\n      const cov: number[][] = Array.from({ length: d }, () => new Array<number>(d).fill(0))\n      for (let i = 0; i < n; i++) {\n        const r = resp[i]![j]!\n        for (let r_idx = 0; r_idx < d; r_idx++) {\n          const dr = data[i]![r_idx]! - mu[r_idx]!\n          for (let c_idx = r_idx; c_idx < d; c_idx++) {\n            const val = r * dr * (data[i]![c_idx]! - mu[c_idx]!)\n            cov[r_idx]![c_idx]! += val\n          }\n        }\n      }\n      // Symmetrize and regularize\n      for (let r_idx = 0; r_idx < d; r_idx++) {\n        for (let c_idx = r_idx; c_idx < d; c_idx++) {\n          cov[r_idx]![c_idx]! /= nk\n          cov[c_idx]![r_idx] = cov[r_idx]![c_idx]!\n        }\n        cov[r_idx]![r_idx]! += regCovar\n      }\n\n      // Accumulate pool for EEE/EEI/EII\n      if (pool) {\n        const w = weights[j]!\n        for (let r_idx = 0; r_idx < d; r_idx++) {\n          for (let c_idx = 0; c_idx < d; c_idx++) {\n            pool[r_idx]![c_idx]! += w * cov[r_idx]![c_idx]!\n          }\n        }\n      }\n\n      // Apply per-component constraints (VVV, VVI, VII)\n      if (modelType === 'VVV') {\n        const { values, vectors } = Matrix.fromArray(cov).eigen()\n        eigenvals[j] = values.map(v => Math.max(v, regCovar))\n        uFlats[j] = vectors.toFlat()\n      } else if (modelType === 'VVI') {\n        // Diagonal covariance \u2014 eigenvalues are diagonal entries, U = I\n        for (let dim = 0; dim < d; dim++) eigenvals[j]![dim] = cov[dim]![dim]!\n        uFlats[j] = [...iFlat]\n      } else if (modelType === 'VII') {\n        // Spherical \u2014 single variance = trace(\u03A3) / d\n        let trace = 0\n        for (let dim = 0; dim < d; dim++) trace += cov[dim]![dim]!\n        eigenvals[j]!.fill(trace / d)\n        uFlats[j] = [...iFlat]\n      }\n      // EEE/EEI/EII applied after pool is complete (below)\n    }\n\n    // Apply pooled constraints\n    if (pool) {\n      if (modelType === 'EEE') {\n        const { values, vectors } = Matrix.fromArray(pool).eigen()\n        const sharedEig = values.map(v => Math.max(v, regCovar))\n        const sharedU = vectors.toFlat()\n        for (let j = 0; j < k; j++) {\n          eigenvals[j] = [...sharedEig]\n          uFlats[j] = [...sharedU]\n        }\n      } else if (modelType === 'EEI') {\n        // Shared diagonal\n        const sharedDiag = new Array<number>(d)\n        for (let dim = 0; dim < d; dim++) sharedDiag[dim] = Math.max(pool[dim]![dim]!, regCovar)\n        for (let j = 0; j < k; j++) {\n          eigenvals[j] = [...sharedDiag]\n          uFlats[j] = [...iFlat]\n        }\n      } else if (modelType === 'EII') {\n        // Shared scalar \u00D7 I\n        let trace = 0\n        for (let dim = 0; dim < d; dim++) trace += pool[dim]![dim]!\n        const scalar = Math.max(trace / d, regCovar)\n        for (let j = 0; j < k; j++) {\n          eigenvals[j]!.fill(scalar)\n          uFlats[j] = [...iFlat]\n        }\n      }\n    }\n  }\n\n  // Hard labels\n  const labels: number[] = new Array(n)\n  for (let i = 0; i < n; i++) {\n    let maxP = -1, best = 0\n    for (let j = 0; j < k; j++) {\n      if (resp[i]![j]! > maxP) { maxP = resp[i]![j]!; best = j }\n    }\n    labels[i] = best\n  }\n\n  // Reconstruct covariance matrices: \u03A3 = U \u00B7 diag(S) \u00B7 U^T\n  const covariances = eigenvals.map((eig, j) => {\n    const U = new Matrix(d, d, uFlats[j]!)\n    const D = Matrix.fromArray(Array.from({ length: d }, (_, r) =>\n      Array.from({ length: d }, (_, c) => r === c ? eig[r]! : 0)\n    ))\n    return U.multiply(D).multiply(U.transpose())\n  })\n\n  // Diagnostics\n  const logL = prevLogL === -Infinity ? 0 : prevLogL\n  const dfMap: Record<CovarianceModel, number> = {\n    'VVV': k * d * (d + 1) / 2,\n    'EEE': d * (d + 1) / 2,\n    'VVI': k * d,\n    'EEI': d,\n    'VII': k,\n    'EII': 1,\n  }\n  const df = (k - 1) + (k * d) + dfMap[modelType]\n  const rawEntropy = computeRawEntropy(resp, k)\n  const entropy = computeNormalizedEntropy(resp, k)\n  const bic = df * Math.log(n) - 2 * logL\n  const aic = 2 * df - 2 * logL\n  const icl = bic + 2 * rawEntropy\n\n  return {\n    weights: Array.from(weights),\n    means: means.map(m => [...m]),\n    covariances,\n    posteriors: resp.map(r => Array.from(r)),\n    labels,\n    diagnostics: {\n      converged,\n      iterations: iter,\n      logLikelihood: logL,\n      df,\n      aic,\n      bic,\n      icl,\n      entropy,\n      avepp: computeAvePP(resp, k),\n      formatted: `GMM (K = ${k}, ${modelType}): BIC = ${roundTo(bic, 1)}, AIC = ${roundTo(aic, 1)}, LL = ${roundTo(logL, 1)}, AvePP = [${computeAvePP(resp, k).map(v => roundTo(v, 2)).join(', ')}]`,\n    },\n  }\n}\n\n/**\n * Predict cluster assignments for new data given a fitted GMM.\n */\nexport function predictGMM(\n  data: readonly (readonly number[])[],\n  result: GMMResult\n): { readonly labels: readonly number[]; readonly posteriors: readonly (readonly number[])[] } {\n  const k = result.weights.length\n  const d = result.means[0]!.length\n  const uFlats = result.covariances.map(cov => {\n    const { vectors } = cov.eigen()\n    return vectors.toFlat()\n  })\n  const eigVals = result.covariances.map(cov => {\n    const { values } = cov.eigen()\n    return values.map(v => Math.max(v, 1e-12))\n  })\n\n  const n = data.length\n  const labels: number[] = new Array(n)\n  const posteriors: number[][] = new Array(n)\n  const logLiks = new Float64Array(k)\n\n  for (let i = 0; i < n; i++) {\n    for (let j = 0; j < k; j++) {\n      logLiks[j] = Math.log(Math.max(result.weights[j]!, MIN_PROB)) +\n        mvnLogPdf(data[i]!, result.means[j]!, uFlats[j]!, eigVals[j]!, d)\n    }\n    const marg = logSumExp(logLiks)\n    const post = new Array<number>(k)\n    let maxP = -1, best = 0\n    for (let j = 0; j < k; j++) {\n      post[j] = Math.exp(logLiks[j]! - marg)\n      if (post[j]! > maxP) { maxP = post[j]!; best = j }\n    }\n    labels[i] = best\n    posteriors[i] = post\n  }\n  return { labels, posteriors }\n}\n\n/**\n * Automatic model selection: fit GMM across a grid of K and covariance models,\n * return the model with the lowest BIC.\n *\n * @param data - N \u00D7 D data matrix\n * @param kRange - Array of K values to try (default [1,2,3,4,5])\n * @param models - Array of covariance models to try (default all 6)\n * @returns The GMMResult with the lowest BIC\n */\nexport function findBestGMM(\n  data: readonly (readonly number[])[],\n  kRange: readonly number[] = [1, 2, 3, 4, 5],\n  models: readonly CovarianceModel[] = ['VVV', 'EEE', 'VVI', 'EEI', 'VII', 'EII']\n): GMMResult {\n  let best: GMMResult | null = null\n  for (const k of kRange) {\n    for (const model of models) {\n      try {\n        const res = fitGMM(data, { k, model })\n        if (!best || res.diagnostics.bic < best.diagnostics.bic) best = res\n      } catch {\n        // Some model/k combos may fail (e.g., singular covariance) \u2014 skip\n      }\n    }\n  }\n  if (!best) throw new Error('findBestGMM: all model fits failed')\n  return best\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// LCA\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/**\n * Fit a Latent Class Analysis model for binary data.\n *\n * Uses EM with Bernoulli emission model and Beta(1,1) (uniform) prior smoothing.\n *\n * @param data - N \u00D7 M binary matrix (0/1 values)\n * @param options - LCA configuration\n * @returns LCAResult with rho (item-response probabilities), priorWeights, posteriors, labels\n *\n * Cross-validate with R:\n * > library(poLCA)\n * > f <- cbind(V1, V2, V3, ...) ~ 1\n * > fit <- poLCA(f, data, nclass=3, nrep=1, probs.start=...)\n * > fit$probs\n */\nexport function fitLCA(\n  data: readonly (readonly number[])[],\n  options: LCAOptions\n): LCAResult {\n  const n = data.length\n  if (n === 0) throw new Error('fitLCA: data cannot be empty')\n  const m = data[0]!.length\n  const k = options.k\n  if (k < 1) throw new Error('fitLCA: k must be >= 1')\n\n  const rng = new PRNG(options.seed ?? 42)\n  const tol = options.tol ?? 1e-6\n  const maxIter = options.maxIter ?? 200\n\n  // Initialize rho randomly in (0.1, 0.9)\n  const rho: number[][] = Array.from({ length: k }, () =>\n    Array.from({ length: m }, () => 0.1 + rng.next() * 0.8)\n  )\n  const weights = new Float64Array(k).fill(1 / k)\n  const resp = Array.from({ length: n }, () => new Float64Array(k))\n\n  let prevLogL = -Infinity\n  let converged = false\n  let iter = 0\n\n  for (; iter < maxIter; iter++) {\n    // E-step\n    let currentLogL = 0\n    const logLiks = new Float64Array(k)\n\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < k; j++) {\n        let ll = Math.log(Math.max(weights[j]!, MIN_PROB))\n        for (let d = 0; d < m; d++) {\n          const r = Math.max(Math.min(rho[j]![d]!, 1 - 1e-12), 1e-12)\n          ll += data[i]![d] === 1 ? Math.log(r) : Math.log(1 - r)\n        }\n        logLiks[j] = ll\n      }\n      const marg = logSumExp(logLiks)\n      currentLogL += marg\n      for (let j = 0; j < k; j++) resp[i]![j] = Math.exp(logLiks[j]! - marg)\n    }\n\n    if (Math.abs(currentLogL - prevLogL) < tol) {\n      converged = true\n      break\n    }\n    prevLogL = currentLogL\n\n    // M-step\n    const Nk = new Float64Array(k)\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < k; j++) Nk[j]! += resp[i]![j]!\n    }\n\n    for (let j = 0; j < k; j++) {\n      weights[j] = Nk[j]! / n\n      const sumW = Nk[j]!\n      for (let d = 0; d < m; d++) {\n        let sumX = 0\n        for (let i = 0; i < n; i++) {\n          if (data[i]![d] === 1) sumX += resp[i]![j]!\n        }\n        // MLE with minimal floor to prevent log(0)\n        rho[j]![d] = Math.max(Math.min(sumX / sumW, 1 - 1e-10), 1e-10)\n      }\n    }\n  }\n\n  // Hard labels\n  const labels: number[] = new Array(n)\n  for (let i = 0; i < n; i++) {\n    let maxP = -1, best = 0\n    for (let j = 0; j < k; j++) {\n      if (resp[i]![j]! > maxP) { maxP = resp[i]![j]!; best = j }\n    }\n    labels[i] = best\n  }\n\n  const logL = prevLogL === -Infinity ? 0 : prevLogL\n  const df = (k - 1) + (k * m)\n  const rawEntropy = computeRawEntropy(resp, k)\n  const entropy = computeNormalizedEntropy(resp, k)\n  const bic = df * Math.log(n) - 2 * logL\n  const aic = 2 * df - 2 * logL\n  const icl = bic + 2 * rawEntropy\n\n  return {\n    rho: rho.map(r => [...r]),\n    priorWeights: Array.from(weights),\n    posteriors: resp.map(r => Array.from(r)),\n    labels,\n    diagnostics: {\n      converged,\n      iterations: iter,\n      logLikelihood: logL,\n      df,\n      aic,\n      bic,\n      icl,\n      entropy,\n      avepp: computeAvePP(resp, k),\n      formatted: `LCA (K = ${k}): BIC = ${roundTo(bic, 1)}, AIC = ${roundTo(aic, 1)}, LL = ${roundTo(logL, 1)}`,\n    },\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// LTA (Latent Transition Analysis \u2014 Hidden Markov LCA)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/**\n * Compute log emission probability for observation x given state s.\n * Uses Bernoulli model in log-space to prevent underflow.\n */\nfunction logEmission(\n  x: readonly number[],\n  rho_s: readonly number[],\n  m: number\n): number {\n  let ll = 0\n  for (let d = 0; d < m; d++) {\n    const r = Math.max(Math.min(rho_s[d]!, 1 - 1e-12), 1e-12)\n    ll += x[d] === 1 ? Math.log(r) : Math.log(1 - r)\n  }\n  return ll\n}\n\n/**\n * Fit a Latent Transition Analysis model (categorical Hidden Markov Model).\n *\n * Uses Baum-Welch (EM) in log-space for numerical stability.\n * Measurement model is time-invariant (measurement invariance assumption).\n * Viterbi decoding provides most-likely state trajectories.\n *\n * @param data - N \u00D7 T \u00D7 M binary tensor (subjects \u00D7 timepoints \u00D7 items)\n * @param options - LTA configuration\n * @returns LTAResult with pi, tau, rho, trajectories, posteriors, diagnostics\n *\n * Cross-validate with R:\n * > library(seqHMM)\n * > # or manual forward-backward on small synthetic example\n */\nexport function fitLTA(\n  data: readonly (readonly (readonly number[])[])[],\n  options: LTAOptions\n): LTAResult {\n  const n = data.length\n  if (n === 0) throw new Error('fitLTA: data cannot be empty')\n  const T = data[0]!.length\n  if (T < 2) throw new Error('fitLTA: requires at least 2 timepoints')\n  const m = data[0]![0]!.length\n  const k = options.k\n  if (k < 2) throw new Error('fitLTA: k must be >= 2')\n\n  const rng = new PRNG(options.seed ?? 42)\n  const tol = options.tol ?? 1e-6\n  const maxIter = options.maxIter ?? 200\n\n  // Initialize parameters\n  const pi = new Float64Array(k).fill(1 / k)\n  const tau: number[][] = Array.from({ length: k }, (_, j) =>\n    Array.from({ length: k }, (_, l) => j === l ? 0.8 : 0.2 / (k - 1))\n  )\n  const rho: number[][] = Array.from({ length: k }, () =>\n    Array.from({ length: m }, () => 0.1 + rng.next() * 0.8)\n  )\n\n  let prevLogL = -Infinity\n  let converged = false\n  let iter = 0\n\n  // Store gamma from last iteration for diagnostics\n  let finalGamma: number[][][] = []\n\n  for (; iter < maxIter; iter++) {\n    let currentLogL = 0\n\n    // Accumulators for M-step\n    const piAcc = new Float64Array(k)\n    const tauNum: number[][] = Array.from({ length: k }, () => new Array<number>(k).fill(0))\n    const tauDen = new Float64Array(k)\n    const rhoNum: number[][] = Array.from({ length: k }, () => new Array<number>(m).fill(0))\n    const rhoDen = new Float64Array(k)\n\n    const iterGamma: number[][][] = new Array(n)\n\n    for (let i = 0; i < n; i++) {\n      // Pre-compute log emissions: T \u00D7 K\n      const logB: number[][] = Array.from({ length: T }, (_, t) =>\n        Array.from({ length: k }, (_, s) => logEmission(data[i]![t]!, rho[s]!, m))\n      )\n\n      // Forward pass (log-alpha)\n      const logAlpha: number[][] = Array.from({ length: T }, () => new Array<number>(k))\n      for (let s = 0; s < k; s++) {\n        logAlpha[0]![s] = Math.log(Math.max(pi[s]!, MIN_PROB)) + logB[0]![s]!\n      }\n      for (let t = 1; t < T; t++) {\n        for (let s = 0; s < k; s++) {\n          const trans = new Float64Array(k)\n          for (let p = 0; p < k; p++) {\n            trans[p] = logAlpha[t - 1]![p]! + Math.log(Math.max(tau[p]![s]!, MIN_PROB))\n          }\n          logAlpha[t]![s] = logB[t]![s]! + logSumExp(trans)\n        }\n      }\n\n      // Subject log-likelihood\n      const subjLL = logSumExp(logAlpha[T - 1]!)\n      currentLogL += subjLL\n\n      // Backward pass (log-beta)\n      const logBeta: number[][] = Array.from({ length: T }, () => new Array<number>(k))\n      for (let s = 0; s < k; s++) logBeta[T - 1]![s] = 0\n      for (let t = T - 2; t >= 0; t--) {\n        for (let s = 0; s < k; s++) {\n          const combined = new Float64Array(k)\n          for (let next = 0; next < k; next++) {\n            combined[next] = Math.log(Math.max(tau[s]![next]!, MIN_PROB)) +\n              logB[t + 1]![next]! + logBeta[t + 1]![next]!\n          }\n          logBeta[t]![s] = logSumExp(combined)\n        }\n      }\n\n      // Posterior marginals (gamma)\n      const gamma: number[][] = Array.from({ length: T }, () => new Array<number>(k))\n      for (let t = 0; t < T; t++) {\n        const logRow = new Float64Array(k)\n        for (let s = 0; s < k; s++) logRow[s] = logAlpha[t]![s]! + logBeta[t]![s]!\n        const den = logSumExp(logRow)\n        for (let s = 0; s < k; s++) gamma[t]![s] = Math.exp(logRow[s]! - den)\n      }\n      iterGamma[i] = gamma\n\n      // Xi: transition posteriors\n      for (let t = 0; t < T - 1; t++) {\n        const logXi = new Float64Array(k * k)\n        for (let j = 0; j < k; j++) {\n          for (let l = 0; l < k; l++) {\n            logXi[j * k + l] = logAlpha[t]![j]! +\n              Math.log(Math.max(tau[j]![l]!, MIN_PROB)) +\n              logB[t + 1]![l]! + logBeta[t + 1]![l]!\n          }\n        }\n        const xiDen = logSumExp(logXi)\n        for (let j = 0; j < k; j++) {\n          for (let l = 0; l < k; l++) {\n            tauNum[j]![l]! += Math.exp(logXi[j * k + l]! - xiDen)\n          }\n        }\n      }\n\n      // Accumulate for M-step\n      for (let s = 0; s < k; s++) piAcc[s]! += gamma[0]![s]!\n      for (let t = 0; t < T - 1; t++) {\n        for (let s = 0; s < k; s++) tauDen[s]! += gamma[t]![s]!\n      }\n      for (let t = 0; t < T; t++) {\n        for (let s = 0; s < k; s++) {\n          rhoDen[s]! += gamma[t]![s]!\n          for (let d = 0; d < m; d++) {\n            if (data[i]![t]![d] === 1) rhoNum[s]![d]! += gamma[t]![s]!\n          }\n        }\n      }\n    }\n\n    finalGamma = iterGamma\n\n    if (Math.abs(currentLogL - prevLogL) < tol) {\n      converged = true\n      break\n    }\n    prevLogL = currentLogL\n\n    // M-step: update pi, tau, rho\n    for (let s = 0; s < k; s++) {\n      pi[s] = (piAcc[s]! + 1) / (n + k)  // Dirichlet(1) smoothing\n    }\n    for (let j = 0; j < k; j++) {\n      const den = tauDen[j]!\n      for (let l = 0; l < k; l++) {\n        tau[j]![l] = (tauNum[j]![l]! + 0.1) / (den + 0.1 * k)  // Light smoothing\n      }\n    }\n    for (let s = 0; s < k; s++) {\n      const den = rhoDen[s]!\n      for (let d = 0; d < m; d++) {\n        rho[s]![d] = Math.max(Math.min(rhoNum[s]![d]! / den, 1 - 1e-10), 1e-10)\n      }\n    }\n  }\n\n  // Viterbi decoding\n  const trajectories: number[][] = data.map(subj => {\n    const vt: number[][] = Array.from({ length: T }, () => new Array<number>(k))\n    const ptr: number[][] = Array.from({ length: T }, () => new Array<number>(k))\n\n    for (let s = 0; s < k; s++) {\n      vt[0]![s] = Math.log(Math.max(pi[s]!, MIN_PROB)) + logEmission(subj[0]!, rho[s]!, m)\n    }\n    for (let t = 1; t < T; t++) {\n      for (let s = 0; s < k; s++) {\n        const emit = logEmission(subj[t]!, rho[s]!, m)\n        let maxVal = -Infinity, bestP = 0\n        for (let p = 0; p < k; p++) {\n          const sc = vt[t - 1]![p]! + Math.log(Math.max(tau[p]![s]!, MIN_PROB))\n          if (sc > maxVal) { maxVal = sc; bestP = p }\n        }\n        vt[t]![s] = emit + maxVal\n        ptr[t]![s] = bestP\n      }\n    }\n\n    const path = new Array<number>(T)\n    let maxFinal = -Infinity, bestFinal = 0\n    for (let s = 0; s < k; s++) {\n      if (vt[T - 1]![s]! > maxFinal) { maxFinal = vt[T - 1]![s]!; bestFinal = s }\n    }\n    path[T - 1] = bestFinal\n    for (let t = T - 2; t >= 0; t--) {\n      path[t] = ptr[t + 1]![path[t + 1]!]!\n    }\n    return path\n  })\n\n  // Diagnostics\n  const logL = prevLogL === -Infinity ? 0 : prevLogL\n  const df = (k - 1) + k * (k - 1) + k * m\n\n  // Flatten gamma for entropy/avepp computation\n  const flatGamma: number[][] = []\n  for (let i = 0; i < n; i++) {\n    for (let t = 0; t < T; t++) {\n      flatGamma.push(finalGamma[i]![t]!)\n    }\n  }\n  const rawEntropy = computeRawEntropy(flatGamma, k)\n  const entropy = computeNormalizedEntropy(flatGamma, k)\n  const bic = df * Math.log(n) - 2 * logL\n  const aic = 2 * df - 2 * logL\n  const icl = bic + 2 * rawEntropy\n\n  return {\n    pi: Array.from(pi),\n    tau: tau.map(row => [...row]),\n    rho: rho.map(r => [...r]),\n    trajectories,\n    posteriors: finalGamma.map(subj => subj.map(t => [...t])),\n    diagnostics: {\n      converged,\n      iterations: iter,\n      logLikelihood: logL,\n      df,\n      aic,\n      bic,\n      icl,\n      entropy,\n      avepp: computeAvePP(flatGamma, k),\n      formatted: `LTA (K = ${k}, T = ${T}): BIC = ${roundTo(bic, 1)}, AIC = ${roundTo(aic, 1)}, LL = ${roundTo(logL, 1)}`,\n    },\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// K-Means\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/**\n * K-Means clustering with K-Means++ initialization and empty-cluster re-seeding.\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param options - K-Means configuration\n * @returns KMeansResult with centroids, labels, inertia\n *\n * Cross-validate with R:\n * > km <- kmeans(data, centers=3, nstart=1, algorithm=\"Lloyd\")\n * > km$centers; km$cluster; km$tot.withinss\n */\nexport function runKMeans(\n  data: readonly (readonly number[])[],\n  options: KMeansOptions\n): KMeansResult {\n  const n = data.length\n  if (n === 0) throw new Error('runKMeans: data cannot be empty')\n  const d = data[0]!.length\n  const k = options.k\n  if (k < 1) throw new Error('runKMeans: k must be >= 1')\n  if (k > n) throw new Error('runKMeans: k cannot exceed n')\n\n  const rng = new PRNG(options.seed ?? 42)\n  const maxIter = options.maxIter ?? 300\n  const tol = options.tol ?? 1e-6\n\n  const centroids = kMeansPlusPlus(data, k, rng)\n  const labels = new Array<number>(n).fill(0)\n\n  let converged = false\n  let iter = 0\n  let inertia = 0\n\n  for (; iter < maxIter; iter++) {\n    const nextCentroids: number[][] = Array.from({ length: k }, () => new Array<number>(d).fill(0))\n    const counts = new Array<number>(k).fill(0)\n    inertia = 0\n\n    // Assignment step\n    for (let i = 0; i < n; i++) {\n      let minD = Infinity, bestK = 0\n      for (let j = 0; j < k; j++) {\n        let dist = 0\n        for (let dim = 0; dim < d; dim++) {\n          const diff = data[i]![dim]! - centroids[j]![dim]!\n          dist += diff * diff\n        }\n        if (dist < minD) { minD = dist; bestK = j }\n      }\n      labels[i] = bestK\n      counts[bestK]!++\n      inertia += minD\n      for (let dim = 0; dim < d; dim++) nextCentroids[bestK]![dim]! += data[i]![dim]!\n    }\n\n    // Update step with empty-cluster re-seeding\n    let shiftSq = 0\n    for (let j = 0; j < k; j++) {\n      if (counts[j] === 0) {\n        // Re-seed: assign the farthest point from its current centroid\n        let maxDist = -1, farIdx = 0\n        for (let i = 0; i < n; i++) {\n          let di = 0\n          for (let dim = 0; dim < d; dim++) {\n            const diff = data[i]![dim]! - centroids[labels[i]!]![dim]!\n            di += diff * diff\n          }\n          if (di > maxDist) { maxDist = di; farIdx = i }\n        }\n        for (let dim = 0; dim < d; dim++) {\n          const updated = data[farIdx]![dim]!\n          const diff = updated - centroids[j]![dim]!\n          shiftSq += diff * diff\n          centroids[j]![dim] = updated\n        }\n      } else {\n        for (let dim = 0; dim < d; dim++) {\n          const updated = nextCentroids[j]![dim]! / counts[j]!\n          const diff = updated - centroids[j]![dim]!\n          shiftSq += diff * diff\n          centroids[j]![dim] = updated\n        }\n      }\n    }\n\n    if (shiftSq < tol) {\n      converged = true\n      break\n    }\n  }\n\n  return {\n    centroids: centroids.map(c => [...c]),\n    labels,\n    inertia,\n    converged,\n    iterations: iter,\n  }\n}\n\n/**\n * Predict cluster assignments for new data given fitted K-Means centroids.\n */\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Range-fitting (auto-K selection)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/** A single entry from fitting GMM at one K value. */\nexport interface GMMRangeEntry {\n  readonly k: number\n  readonly model: CovarianceModel\n  readonly result: GMMResult\n}\n\n/** A single entry from fitting KMeans at one K value. */\nexport interface KMeansRangeEntry {\n  readonly k: number\n  readonly result: KMeansResult\n}\n\n/**\n * Fit GMM for each K in kRange and return results sorted by K.\n * Skips failed fits (singular covariance etc). Throws only if ALL fail.\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param kRange - Array of K values to try, e.g. [2,3,4,5,6,7,8,9,10]\n * @param model - Covariance model (default 'VVV')\n * @returns GMMRangeEntry[] sorted by K\n */\nexport function fitGMMRange(\n  data: readonly (readonly number[])[],\n  kRange: readonly number[],\n  model: CovarianceModel = 'VVV',\n): readonly GMMRangeEntry[] {\n  const entries: GMMRangeEntry[] = []\n  for (const k of kRange) {\n    try {\n      const result = fitGMM(data, { k, model, seed: 42 })\n      entries.push({ k, model, result })\n    } catch {\n      // Skip failed fits (e.g. k > n, singular covariance)\n    }\n  }\n  if (entries.length === 0) throw new Error('fitGMMRange: all fits failed')\n  return entries.sort((a, b) => a.k - b.k)\n}\n\n/**\n * Fit KMeans for each K in kRange and return results sorted by K.\n * Skips failed fits. Throws only if ALL fail.\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param kRange - Array of K values to try\n * @returns KMeansRangeEntry[] sorted by K\n */\nexport function fitKMeansRange(\n  data: readonly (readonly number[])[],\n  kRange: readonly number[],\n): readonly KMeansRangeEntry[] {\n  const entries: KMeansRangeEntry[] = []\n  for (const k of kRange) {\n    try {\n      const result = runKMeans(data, { k, seed: 42 })\n      entries.push({ k, result })\n    } catch {\n      // Skip failed fits\n    }\n  }\n  if (entries.length === 0) throw new Error('fitKMeansRange: all fits failed')\n  return entries.sort((a, b) => a.k - b.k)\n}\n\nexport function predictKMeans(\n  data: readonly (readonly number[])[],\n  centroids: readonly (readonly number[])[]\n): readonly number[] {\n  const k = centroids.length\n  const d = centroids[0]!.length\n  return data.map(pt => {\n    let minD = Infinity, best = 0\n    for (let j = 0; j < k; j++) {\n      let dist = 0\n      for (let dim = 0; dim < d; dim++) {\n        const diff = pt[dim]! - centroids[j]![dim]!\n        dist += diff * diff\n      }\n      if (dist < minD) { minD = dist; best = j }\n    }\n    return best\n  })\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Shared Utilities: Distance Matrix & Silhouette\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n/**\n * Compute Euclidean distance matrix (N \u00D7 N, row-major Float64Array).\n *\n * @param data - N \u00D7 D numeric data matrix\n * @returns flat Float64Array of size N*N with dist[i*N+j] = euclidean(i,j)\n *\n * Cross-validate with R:\n * > as.matrix(dist(data))\n */\nexport function euclideanDistMatrix(\n  data: readonly (readonly number[])[]\n): Float64Array {\n  const n = data.length\n  const d = data[0]?.length ?? 0\n  const dist = new Float64Array(n * n)\n\n  for (let i = 0; i < n; i++) {\n    for (let j = i + 1; j < n; j++) {\n      let sq = 0\n      for (let dim = 0; dim < d; dim++) {\n        const diff = data[i]![dim]! - data[j]![dim]!\n        sq += diff * diff\n      }\n      const val = Math.sqrt(sq)\n      dist[i * n + j] = val\n      dist[j * n + i] = val\n    }\n  }\n  return dist\n}\n\n/**\n * Compute silhouette scores for each point (excluding noise labels = -1).\n *\n * For each non-noise point i:\n *   a(i) = mean dist to points in same cluster\n *   b(i) = min over other clusters of mean dist to that cluster\n *   s(i) = (b(i) - a(i)) / max(a(i), b(i))\n *\n * @param data - N \u00D7 D data matrix\n * @param labels - cluster assignments (0-indexed, -1 = noise)\n * @returns scores per point (NaN for noise) and mean silhouette (excluding noise)\n *\n * Cross-validate with R:\n * > library(cluster)\n * > silhouette(labels, dist(data))\n */\nexport function silhouetteScores(\n  data: readonly (readonly number[])[],\n  labels: readonly number[]\n): { readonly scores: readonly number[]; readonly mean: number } {\n  const n = data.length\n  const dist = euclideanDistMatrix(data)\n\n  // Find unique non-noise labels\n  const labelSet = new Set<number>()\n  for (let i = 0; i < n; i++) {\n    if (labels[i]! >= 0) labelSet.add(labels[i]!)\n  }\n  const uniqueLabels = [...labelSet].sort((a, b) => a - b)\n  const nClusters = uniqueLabels.length\n\n  if (nClusters < 2) {\n    // Silhouette undefined for < 2 clusters\n    return { scores: new Array(n).fill(0) as number[], mean: 0 }\n  }\n\n  const scores: number[] = new Array(n).fill(NaN) as number[]\n  let sumSil = 0\n  let countNonNoise = 0\n\n  for (let i = 0; i < n; i++) {\n    const ci = labels[i]!\n    if (ci < 0) continue // noise\n\n    // a(i) = mean distance to same cluster\n    let aSum = 0, aCount = 0\n    for (let j = 0; j < n; j++) {\n      if (j === i || labels[j] !== ci) continue\n      aSum += dist[i * n + j]!\n      aCount++\n    }\n    const ai = aCount > 0 ? aSum / aCount : 0\n\n    // b(i) = min mean-distance to other clusters\n    let bi = Infinity\n    for (const cl of uniqueLabels) {\n      if (cl === ci) continue\n      let bSum = 0, bCount = 0\n      for (let j = 0; j < n; j++) {\n        if (labels[j] !== cl) continue\n        bSum += dist[i * n + j]!\n        bCount++\n      }\n      if (bCount > 0) {\n        const meanDist = bSum / bCount\n        if (meanDist < bi) bi = meanDist\n      }\n    }\n\n    const maxAB = Math.max(ai, bi)\n    scores[i] = maxAB > 0 ? (bi - ai) / maxAB : 0\n    sumSil += scores[i]!\n    countNonNoise++\n  }\n\n  return {\n    scores,\n    mean: countNonNoise > 0 ? sumSil / countNonNoise : 0,\n  }\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// DBSCAN\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type PointType = 'core' | 'border' | 'noise'\n\nexport interface DBSCANOptions {\n  readonly eps: number\n  readonly minPts: number\n  readonly seed?: number\n  readonly preprocess?: 'none' | 'center' | 'standardize' | 'log' | 'sqrt'\n}\n\nexport interface DBSCANResult {\n  readonly labels: readonly number[]           // -1 = noise, 0-indexed clusters\n  readonly pointTypes: readonly PointType[]\n  readonly nClusters: number\n  readonly nNoise: number\n  readonly clusterSizes: readonly number[]\n  readonly silhouette: { readonly scores: readonly number[]; readonly mean: number }\n  readonly formatted: string\n}\n\n/**\n * DBSCAN clustering (Ester et al. 1996).\n *\n * Algorithm:\n * 1. For each point, compute eps-neighborhood via distance scan.\n * 2. Core points: |neighbors| >= minPts. BFS expansion from cores.\n * 3. Border points: not core, but within eps of a core point.\n * 4. Noise: neither core nor border.\n *\n * Labels: -1 = noise, 0, 1, 2, ... = cluster IDs (0-indexed).\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param options - DBSCAN configuration (eps, minPts)\n * @returns DBSCANResult with labels, point types, silhouette\n *\n * Cross-validate with R:\n * > library(dbscan)\n * > db <- dbscan(data, eps = 1.5, minPts = 5)\n * > db$cluster  # R: 0=noise, 1-indexed \u2192 Carm: -1=noise, 0-indexed\n */\nexport function runDBSCAN(\n  data: readonly (readonly number[])[],\n  options: DBSCANOptions\n): DBSCANResult {\n  const n = data.length\n  if (n === 0) throw new Error('runDBSCAN: data cannot be empty')\n  const { eps, minPts } = options\n  if (eps <= 0) throw new Error('runDBSCAN: eps must be > 0')\n  if (minPts < 1) throw new Error('runDBSCAN: minPts must be >= 1')\n\n  // Compute pairwise distance matrix\n  const dist = euclideanDistMatrix(data)\n\n  // Find eps-neighborhoods\n  const neighbors: number[][] = new Array(n)\n  for (let i = 0; i < n; i++) {\n    const nb: number[] = []\n    for (let j = 0; j < n; j++) {\n      if (dist[i * n + j]! <= eps) nb.push(j)\n    }\n    neighbors[i] = nb\n  }\n\n  // Identify core points\n  const isCore = new Uint8Array(n)\n  for (let i = 0; i < n; i++) {\n    if (neighbors[i]!.length >= minPts) isCore[i] = 1\n  }\n\n  // BFS cluster expansion\n  const labels = new Int32Array(n).fill(-1)  // -1 = unvisited/noise\n  let clusterId = 0\n\n  for (let i = 0; i < n; i++) {\n    if (!isCore[i] || labels[i] !== -1) continue\n\n    // Start new cluster from this core point\n    const queue: number[] = [i]\n    labels[i] = clusterId\n\n    let head = 0\n    while (head < queue.length) {\n      const current = queue[head]!\n      head++\n\n      for (const nb of neighbors[current]!) {\n        if (labels[nb] === -1) {\n          labels[nb] = clusterId\n          // If neighbor is also core, expand from it\n          if (isCore[nb]) queue.push(nb)\n        }\n      }\n    }\n    clusterId++\n  }\n\n  // Classify point types\n  const pointTypes: PointType[] = new Array(n)\n  for (let i = 0; i < n; i++) {\n    if (isCore[i]) {\n      pointTypes[i] = 'core'\n    } else if (labels[i]! >= 0) {\n      pointTypes[i] = 'border'\n    } else {\n      pointTypes[i] = 'noise'\n    }\n  }\n\n  // Cluster sizes\n  const nClusters = clusterId\n  const clusterSizes = new Array<number>(nClusters).fill(0)\n  let nNoise = 0\n  for (let i = 0; i < n; i++) {\n    if (labels[i]! >= 0) clusterSizes[labels[i]!]!++\n    else nNoise++\n  }\n\n  // Silhouette (only if >= 2 clusters and some non-noise points)\n  const sil = nClusters >= 2\n    ? silhouetteScores(data, Array.from(labels))\n    : { scores: new Array(n).fill(NaN) as number[], mean: NaN }\n\n  const formatted = `DBSCAN (eps = ${roundTo(eps, 3)}, minPts = ${minPts}): ${nClusters} clusters, ${nNoise} noise points, silhouette = ${isNaN(sil.mean) ? 'N/A' : roundTo(sil.mean, 3)}`\n\n  return {\n    labels: Array.from(labels),\n    pointTypes,\n    nClusters,\n    nNoise,\n    clusterSizes,\n    silhouette: sil,\n    formatted,\n  }\n}\n\n/**\n * Compute k-distance plot data for epsilon estimation.\n *\n * For each point, compute the distance to its k-th nearest neighbor,\n * then return these distances sorted in ascending order.\n * The \"elbow\" in the sorted plot suggests a good epsilon.\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param k - neighbor index (typically minPts)\n * @returns sorted k-NN distances (ascending)\n *\n * Cross-validate with R:\n * > library(dbscan)\n * > kNNdist(data, k = 5)  # sorted externally\n */\nexport function kDistancePlot(\n  data: readonly (readonly number[])[],\n  k: number\n): readonly number[] {\n  const n = data.length\n  if (k < 1 || k >= n) throw new Error(`kDistancePlot: k must be in [1, n-1], got ${k}`)\n\n  const dist = euclideanDistMatrix(data)\n  const kDists: number[] = new Array(n)\n\n  for (let i = 0; i < n; i++) {\n    // Collect distances from point i to all others\n    const dists: number[] = new Array(n - 1)\n    let idx = 0\n    for (let j = 0; j < n; j++) {\n      if (j !== i) dists[idx++] = dist[i * n + j]!\n    }\n    dists.sort((a, b) => a - b)\n    kDists[i] = dists[k - 1]!  // k-th nearest (0-indexed, so k-1)\n  }\n\n  return kDists.sort((a, b) => a - b)\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// Hierarchical Agglomerative Clustering (HAC)\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nexport type LinkageMethod = 'single' | 'complete' | 'average' | 'ward'\n\nexport interface HACOptions {\n  readonly linkage?: LinkageMethod\n  readonly preprocess?: 'none' | 'center' | 'standardize' | 'log' | 'sqrt'\n}\n\nexport interface HACMerge {\n  readonly a: number   // index of first cluster merged (0..n-1 = obs, n+ = intermediate)\n  readonly b: number   // index of second cluster merged\n  readonly height: number  // merge height\n}\n\nexport interface HACResult {\n  readonly merges: readonly HACMerge[]\n  readonly heights: readonly number[]\n  readonly order: readonly number[]   // leaf order for dendrogram (DFS)\n  readonly copheneticCorrelation: number\n  readonly formatted: string\n}\n\n/**\n * Hierarchical agglomerative clustering using Lance-Williams recurrence.\n *\n * Linkage methods and their Lance-Williams coefficients:\n * | Method   | \u03B1_i           | \u03B1_j           | \u03B2        | \u03B3    |\n * |----------|---------------|---------------|----------|------|\n * | single   | 0.5           | 0.5           | 0        | -0.5 |\n * | complete | 0.5           | 0.5           | 0        | 0.5  |\n * | average  | n_i/(n_i+n_j) | n_j/(n_i+n_j) | 0        | 0    |\n * | ward     | (n_i+n_k)/N_t | (n_j+n_k)/N_t | -n_k/N_t | 0    |\n *\n * Ward's method uses squared Euclidean distances internally.\n * Final merge heights are sqrt(distance) to match R's hclust(method=\"ward.D2\").\n *\n * @param data - N \u00D7 D numeric data matrix\n * @param options - linkage method (default: ward)\n * @returns HACResult with merges, heights, leaf order, cophenetic correlation\n *\n * Cross-validate with R:\n * > hc <- hclust(dist(data), method = \"ward.D2\")\n * > hc$merge; hc$height; hc$order\n * > cor(cophenetic(hc), dist(data))\n */\nexport function runHierarchical(\n  data: readonly (readonly number[])[],\n  options?: HACOptions\n): HACResult {\n  const n = data.length\n  if (n < 2) throw new Error('runHierarchical: need at least 2 observations')\n\n  const linkage = options?.linkage ?? 'ward'\n\n  // Compute initial pairwise distance matrix (Euclidean)\n  const origDist = euclideanDistMatrix(data)\n\n  // For ward, we work with squared distances internally\n  const useSquared = linkage === 'ward'\n  // Active distance matrix \u2014 condensed upper triangle\n  // We use a full N\u00D7N mutable copy for simplicity during merges\n  const D = new Float64Array(n * n)\n  for (let i = 0; i < n; i++) {\n    for (let j = i + 1; j < n; j++) {\n      const val = useSquared\n        ? origDist[i * n + j]! * origDist[i * n + j]!\n        : origDist[i * n + j]!\n      D[i * n + j] = val\n      D[j * n + i] = val\n    }\n  }\n\n  // Cluster sizes\n  const sizes = new Float64Array(2 * n - 1)\n  for (let i = 0; i < n; i++) sizes[i] = 1\n\n  // Active cluster set\n  const active = new Set<number>()\n  for (let i = 0; i < n; i++) active.add(i)\n\n  // Merge tracking\n  const merges: HACMerge[] = []\n  const mergeHeights: number[] = []\n\n  // Current dimension for distance lookups (grows as we add merged clusters)\n  // We'll extend D as needed using a map for merged cluster distances\n  const distMap = new Map<string, number>()\n\n  function getDist(a: number, b: number): number {\n    if (a < n && b < n) return D[a * n + b]!\n    const key = a < b ? `${a},${b}` : `${b},${a}`\n    return distMap.get(key) ?? Infinity\n  }\n\n  function setDist(a: number, b: number, val: number): void {\n    if (a < n && b < n) {\n      D[a * n + b] = val\n      D[b * n + a] = val\n    } else {\n      const key = a < b ? `${a},${b}` : `${b},${a}`\n      distMap.set(key, val)\n    }\n  }\n\n  let nextCluster = n  // merged clusters start at index n\n\n  for (let step = 0; step < n - 1; step++) {\n    // Find closest pair among active clusters\n    let minDist = Infinity\n    let mergeA = -1, mergeB = -1\n    const activeArr = [...active]\n    for (let ii = 0; ii < activeArr.length; ii++) {\n      const ci = activeArr[ii]!\n      for (let jj = ii + 1; jj < activeArr.length; jj++) {\n        const cj = activeArr[jj]!\n        const d = getDist(ci, cj)\n        if (d < minDist) {\n          minDist = d\n          mergeA = ci\n          mergeB = cj\n        }\n      }\n    }\n\n    // Record merge height\n    const height = useSquared ? Math.sqrt(minDist) : minDist\n    merges.push({ a: mergeA, b: mergeB, height })\n    mergeHeights.push(height)\n\n    // New merged cluster\n    const newCluster = nextCluster++\n    sizes[newCluster] = sizes[mergeA]! + sizes[mergeB]!\n    active.delete(mergeA)\n    active.delete(mergeB)\n\n    // Update distances to new cluster via Lance-Williams\n    const ni = sizes[mergeA]!\n    const nj = sizes[mergeB]!\n\n    for (const ck of active) {\n      const nk = sizes[ck]!\n      const dik = getDist(mergeA, ck)\n      const djk = getDist(mergeB, ck)\n      const dij = getDist(mergeA, mergeB)\n\n      let newDist: number\n      if (linkage === 'single') {\n        newDist = 0.5 * dik + 0.5 * djk - 0.5 * Math.abs(dik - djk)\n      } else if (linkage === 'complete') {\n        newDist = 0.5 * dik + 0.5 * djk + 0.5 * Math.abs(dik - djk)\n      } else if (linkage === 'average') {\n        const ai = ni / (ni + nj)\n        const aj = nj / (ni + nj)\n        newDist = ai * dik + aj * djk\n      } else {\n        // ward\n        const nt = ni + nj + nk\n        newDist = ((ni + nk) / nt) * dik + ((nj + nk) / nt) * djk - (nk / nt) * dij\n      }\n      setDist(newCluster, ck, newDist)\n    }\n\n    active.add(newCluster)\n  }\n\n  // Build leaf order via DFS of the dendrogram tree\n  const order = buildLeafOrder(merges, n)\n\n  // Cophenetic correlation\n  const cophCorr = computeCopheneticCorrelation(merges, n, origDist)\n\n  const formatted = `HAC (${linkage}): ${n} observations, cophenetic r = ${roundTo(cophCorr, 3)}`\n\n  return {\n    merges,\n    heights: mergeHeights,\n    order,\n    copheneticCorrelation: cophCorr,\n    formatted,\n  }\n}\n\n/**\n * Cut a dendrogram at K clusters.\n *\n * @param result - HACResult from runHierarchical\n * @param k - number of clusters desired\n * @returns 0-indexed cluster labels\n *\n * Cross-validate with R:\n * > cutree(hc, k = 3)  # R is 1-indexed \u2192 Carm 0-indexed\n */\nexport function cutTree(\n  result: HACResult,\n  k: number\n): readonly number[] {\n  const nMerges = result.merges.length\n  const n = nMerges + 1\n  if (k < 1 || k > n) throw new Error(`cutTree: k must be in [1, ${n}], got ${k}`)\n\n  // Apply the first (n - k) merges using union-find\n  const parent = new Int32Array(2 * n - 1)\n  for (let i = 0; i < 2 * n - 1; i++) parent[i] = i\n\n  function find(x: number): number {\n    while (parent[x] !== x) {\n      parent[x] = parent[parent[x]!]!\n      x = parent[x]!\n    }\n    return x\n  }\n\n  const nMergesToApply = n - k\n  for (let s = 0; s < nMergesToApply; s++) {\n    const merge = result.merges[s]!\n    const newCluster = n + s\n    parent[find(merge.a)] = newCluster\n    parent[find(merge.b)] = newCluster\n  }\n\n  // Assign labels: find root of each original observation\n  const rootToLabel = new Map<number, number>()\n  let nextLabel = 0\n  const labels = new Array<number>(n)\n\n  for (let i = 0; i < n; i++) {\n    const root = find(i)\n    let label = rootToLabel.get(root)\n    if (label === undefined) {\n      label = nextLabel++\n      rootToLabel.set(root, label)\n    }\n    labels[i] = label\n  }\n\n  return labels\n}\n\n/**\n * Cut a dendrogram at a specific height.\n *\n * @param result - HACResult from runHierarchical\n * @param h - height threshold\n * @returns 0-indexed cluster labels\n *\n * Cross-validate with R:\n * > cutree(hc, h = 5.0)\n */\nexport function cutTreeHeight(\n  result: HACResult,\n  h: number\n): readonly number[] {\n  const nMerges = result.merges.length\n  const n = nMerges + 1\n\n  // Apply all merges with height <= h\n  const parent = new Int32Array(2 * n - 1)\n  for (let i = 0; i < 2 * n - 1; i++) parent[i] = i\n\n  function find(x: number): number {\n    while (parent[x] !== x) {\n      parent[x] = parent[parent[x]!]!\n      x = parent[x]!\n    }\n    return x\n  }\n\n  for (let s = 0; s < nMerges; s++) {\n    const merge = result.merges[s]!\n    if (merge.height > h) break\n    const newCluster = n + s\n    parent[find(merge.a)] = newCluster\n    parent[find(merge.b)] = newCluster\n  }\n\n  const rootToLabel = new Map<number, number>()\n  let nextLabel = 0\n  const labels = new Array<number>(n)\n\n  for (let i = 0; i < n; i++) {\n    const root = find(i)\n    let label = rootToLabel.get(root)\n    if (label === undefined) {\n      label = nextLabel++\n      rootToLabel.set(root, label)\n    }\n    labels[i] = label\n  }\n\n  return labels\n}\n\n// \u2500\u2500\u2500 HAC helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Build leaf order via DFS traversal of the dendrogram. */\nfunction buildLeafOrder(merges: readonly HACMerge[], n: number): number[] {\n  // Build tree structure: children[nodeId] = [left, right]\n  const children = new Map<number, [number, number]>()\n  for (let s = 0; s < merges.length; s++) {\n    const merge = merges[s]!\n    const nodeId = n + s\n    children.set(nodeId, [merge.a, merge.b])\n  }\n\n  const root = n + merges.length - 1\n  const order: number[] = []\n\n  function dfs(node: number): void {\n    const ch = children.get(node)\n    if (ch) {\n      dfs(ch[0])\n      dfs(ch[1])\n    } else {\n      order.push(node)\n    }\n  }\n\n  dfs(root)\n  return order\n}\n\n/**\n * Compute cophenetic correlation: Pearson(original distances, cophenetic distances).\n * The cophenetic distance between two points is the merge height at which\n * they first join the same cluster.\n */\nfunction computeCopheneticCorrelation(\n  merges: readonly HACMerge[],\n  n: number,\n  origDist: Float64Array\n): number {\n  // Build union-find to track when pairs merge\n  const parent = new Int32Array(2 * n - 1)\n  for (let i = 0; i < 2 * n - 1; i++) parent[i] = i\n\n  function find(x: number): number {\n    while (parent[x] !== x) {\n      parent[x] = parent[parent[x]!]!\n      x = parent[x]!\n    }\n    return x\n  }\n\n  // Members of each active cluster node\n  const members = new Map<number, number[]>()\n  for (let i = 0; i < n; i++) members.set(i, [i])\n\n  // Cophenetic distance matrix (flat upper triangle)\n  const nPairs = n * (n - 1) / 2\n  const cophDist = new Float64Array(nPairs)\n  const origFlat = new Float64Array(nPairs)\n\n  // Fill original flat distances\n  let idx = 0\n  for (let i = 0; i < n; i++) {\n    for (let j = i + 1; j < n; j++) {\n      origFlat[idx] = origDist[i * n + j]!\n      idx++\n    }\n  }\n\n  // Process merges\n  for (let s = 0; s < merges.length; s++) {\n    const merge = merges[s]!\n    const newCluster = n + s\n    const rootA = find(merge.a)\n    const rootB = find(merge.b)\n    const membersA = members.get(rootA) ?? []\n    const membersB = members.get(rootB) ?? []\n\n    // Set cophenetic distance for all pairs (one from A, one from B)\n    for (const a of membersA) {\n      for (const b of membersB) {\n        const i = Math.min(a, b)\n        const j = Math.max(a, b)\n        // Flat index: sum of (n-1) + (n-2) + ... + (n-i) + (j - i - 1)\n        const flatIdx = i * n - i * (i + 1) / 2 + (j - i - 1)\n        cophDist[flatIdx] = merge.height\n      }\n    }\n\n    // Union\n    parent[rootA] = newCluster\n    parent[rootB] = newCluster\n    members.set(newCluster, [...membersA, ...membersB])\n    members.delete(rootA)\n    members.delete(rootB)\n  }\n\n  // Pearson correlation between origFlat and cophDist\n  return pearsonR(origFlat, cophDist, nPairs)\n}\n\n/** Pearson correlation between two Float64Arrays. */\nfunction pearsonR(x: Float64Array, y: Float64Array, n: number): number {\n  let sx = 0, sy = 0, sxx = 0, syy = 0, sxy = 0\n  for (let i = 0; i < n; i++) {\n    sx += x[i]!\n    sy += y[i]!\n    sxx += x[i]! * x[i]!\n    syy += y[i]! * y[i]!\n    sxy += x[i]! * y[i]!\n  }\n  const num = n * sxy - sx * sy\n  const den = Math.sqrt((n * sxx - sx * sx) * (n * syy - sy * sy))\n  return den > 0 ? num / den : 0\n}\n", "/**\n * Factor Analysis module for Carm.\n * Exploratory Factor Analysis (EFA), Confirmatory Factor Analysis (CFA),\n * and psychometric diagnostics (KMO, Bartlett, MAP, Parallel Analysis).\n *\n * All functions are pure \u2014 no DOM, no D3, no side effects.\n * Uses splitmix32 PRNG for deterministic reproducibility.\n *\n * Algorithms adapted from:\n * - Iterated PAF: Gorsuch (1983), Factor Analysis (2nd ed.)\n * - ML extraction: J\u00F6reskog (1967), Psychometrika 32(4)\n * - Varimax: Kaiser (1958), Psychometrika 23:187-200\n * - Oblimin/Promax: Jennrich (2002), Psychometrika 67(1)\n * - CFA: Bollen (1989), Structural Equations with Latent Variables\n * - Fit indices: Browne & Cudeck (1993), Hu & Bentler (1999)\n */\n\nimport { Matrix } from '../core/matrix.js'\nimport {\n  normalCDF,\n  chiSqPValue,\n  roundTo,\n  nelderMead,\n} from '../core/math.js'\nimport { formatCFAFit } from '../core/apa.js'\nimport type {\n  FactorFit,\n  ParameterEstimate,\n  FADiagnostics,\n  FAResult,\n  CFAResult,\n} from '../core/types.js'\nimport { PRNG } from '../core/prng.js'\n\n/** Box-Muller transform for normal random variates using splitmix32. */\nfunction prngNormal(rng: PRNG): number {\n  let u = 0, v = 0\n  while (u === 0) u = rng.next()\n  while (v === 0) v = rng.next()\n  return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v)\n}\n\n/**\n * Generate a Haar-distributed random orthogonal k\u00D7k matrix.\n * Uses Modified Gram-Schmidt QR decomposition with sign correction,\n * matching GPArotation::Random.Start() and lavaan::lav_matrix_rotate_gen().\n *\n * Algorithm:\n *   1. Fill k\u00D7k matrix with N(0,1)\n *   2. Modified Gram-Schmidt \u2192 Q, R\n *   3. Sign correction: Q[:,j] *= sign(R[j][j])\n */\nfunction randomOrthogonalMatrix(k: number, rng: PRNG): number[][] {\n  // Step 1: fill with N(0,1)\n  const M: number[][] = Array.from({ length: k }, () =>\n    Array.from({ length: k }, () => prngNormal(rng))\n  )\n\n  // Step 2: Modified Gram-Schmidt QR\n  const Q: number[][] = M.map(r => [...r])\n  const Rdiag = new Float64Array(k)\n\n  for (let j = 0; j < k; j++) {\n    // Subtract projections of previous columns\n    for (let prev = 0; prev < j; prev++) {\n      let dot = 0\n      for (let i = 0; i < k; i++) dot += Q[i]![j]! * Q[i]![prev]!\n      for (let i = 0; i < k; i++) Q[i]![j] = Q[i]![j]! - dot * Q[i]![prev]!\n    }\n    // Normalize column j\n    let norm = 0\n    for (let i = 0; i < k; i++) norm += Q[i]![j]! ** 2\n    norm = Math.sqrt(norm)\n    Rdiag[j] = norm\n    if (norm > 1e-15) {\n      for (let i = 0; i < k; i++) Q[i]![j] = Q[i]![j]! / norm\n    }\n  }\n\n  // Step 3: Sign correction \u2014 Q[:,j] *= sign(R[j][j])\n  for (let j = 0; j < k; j++) {\n    if (Rdiag[j]! < 0) {\n      for (let i = 0; i < k; i++) Q[i]![j] = -Q[i]![j]!\n    }\n  }\n\n  return Q\n}\n\n// \u2500\u2500\u2500 Correlation Matrix \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute Pearson correlation matrix from raw data using Float64Array accumulators.\n * Returns a Matrix (d \u00D7 d).\n */\nfunction computeCorrelationMatrix(\n  data: readonly (readonly number[])[],\n  n: number,\n  d: number\n): { R: Matrix; sds: Float64Array } {\n  const means = new Float64Array(d)\n  const sds = new Float64Array(d)\n\n  for (let i = 0; i < n; i++) {\n    const row = data[i]!\n    for (let j = 0; j < d; j++) means[j] = means[j]! + row[j]! / n\n  }\n  for (let i = 0; i < n; i++) {\n    const row = data[i]!\n    for (let j = 0; j < d; j++) sds[j] = sds[j]! + (row[j]! - means[j]!) ** 2\n  }\n  for (let j = 0; j < d; j++) sds[j] = Math.sqrt(sds[j]! / (n - 1))\n\n  const R: number[][] = Array.from({ length: d }, () => new Array<number>(d).fill(0))\n  for (let r = 0; r < d; r++) {\n    R[r]![r] = 1.0\n    for (let c = r + 1; c < d; c++) {\n      let sum = 0\n      const sdR = sds[r]! || 1\n      const sdC = sds[c]! || 1\n      for (let i = 0; i < n; i++) {\n        sum += ((data[i]![r]! - means[r]!) / sdR) * ((data[i]![c]! - means[c]!) / sdC)\n      }\n      const val = sum / (n - 1)\n      R[r]![c] = val\n      R[c]![r] = val\n    }\n  }\n  return { R: Matrix.fromArray(R), sds }\n}\n\n// \u2500\u2500\u2500 Options interfaces \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface EFAOptions {\n  readonly nFactors?: number               // auto-detect via parallel analysis if omitted\n  readonly extraction?: 'paf' | 'ml'       // default: 'ml'\n  readonly rotation?: 'varimax' | 'oblimin' | 'promax' | 'quartimin' | 'geomin' | 'quartimax' | 'target' | 'none'  // default: 'promax'\n  readonly geominDelta?: number              // geomin epsilon/delta (default: 0.001, matches lavaan)\n  readonly targetMatrix?: readonly (readonly number[])[]   // p\u00D7k target loadings for target rotation\n  readonly targetWeight?: readonly (readonly number[])[]   // p\u00D7k weights (1=specified, 0=free) for target rotation\n  readonly seed?: number                   // default: 42 (for parallel analysis)\n  readonly maxIter?: number                // default: 1000\n  readonly tol?: number                    // default: 1e-6\n  readonly randomStarts?: number           // default: 50\n  readonly variableNames?: readonly string[]\n}\n\nexport interface CFAOptions {\n  readonly maxIter?: number     // default: 1000\n  readonly tol?: number         // default: 1e-6\n  readonly variableNames?: readonly string[]\n  readonly factorNames?: readonly string[]\n}\n\nexport interface FADiagnosticsOptions {\n  readonly seed?: number                  // default: 42\n  readonly parallelIterations?: number    // default: 100\n}\n\n// \u2500\u2500\u2500 Fit Statistics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute CFA/EFA fit indices from observed (S) and implied (Sigma) covariance matrices.\n * Uses Wishart ML discrepancy: F = log|\u03A3| + tr(\u03A3\u207B\u00B9S) - log|S| - d\n *\n * When nFactors is provided, applies the Bartlett (1950) correction to the chi-square\n * statistic: \u03C7\u00B2 = (n - 1 - (2p+5)/6 - 2k/3) \u00D7 F_ml, matching R psych::fa().\n * When nFactors is omitted (CFA), uses uncorrected \u03C7\u00B2 = (n - 1) \u00D7 F_ml.\n */\nfunction computeFit(\n  S: Matrix,\n  Sigma: Matrix,\n  n: number,\n  d: number,\n  nFreeParams: number,\n  nFactors?: number\n): FactorFit {\n  // ML discrepancy\n  let logDetSigma: number, logDetS: number\n  try {\n    logDetSigma = Sigma.logDet()\n  } catch {\n    // Fallback via eigen if Cholesky fails\n    const ev = Sigma.eigen().values\n    logDetSigma = ev.reduce((s, v) => s + Math.log(Math.max(v, 1e-15)), 0)\n  }\n  try {\n    logDetS = S.logDet()\n  } catch {\n    const ev = S.eigen().values\n    logDetS = ev.reduce((s, v) => s + Math.log(Math.max(v, 1e-15)), 0)\n  }\n\n  let traceVal: number\n  try {\n    traceVal = Sigma.inverse().multiply(S).trace()\n  } catch {\n    traceVal = Sigma.pseudoInverse().multiply(S).trace()\n  }\n\n  const F_ml = Math.max(0, logDetSigma + traceVal - logDetS - d)\n  // Bartlett (1950) correction for EFA: \u03C7\u00B2 = (n - 1 - (2p+5)/6 - 2k/3) \u00D7 F_ml\n  // Without correction (CFA): \u03C7\u00B2 = (n - 1) \u00D7 F_ml\n  const bartlettN = nFactors !== undefined\n    ? n - 1 - (2 * d + 5) / 6 - (2 * nFactors) / 3\n    : n - 1\n  const chiSq = Math.max(0, bartlettN * F_ml)\n\n  // Degrees of freedom\n  const totalElements = d * (d + 1) / 2\n  const df = Math.max(0, totalElements - nFreeParams)\n  const pValue = df > 0 ? chiSqPValue(chiSq, df) : 1\n\n  // Null model: diagonal (independence) \u2014 F_null = log|diag(S)| + tr(diag(S)\u207B\u00B9 \u00B7 S) - log|S| - d\n  let logDetDiagS = 0\n  let traceNull = 0\n  for (let i = 0; i < d; i++) {\n    const diagVal = Math.max(S.get(i, i), 1e-15)\n    logDetDiagS += Math.log(diagVal)\n    traceNull += S.get(i, i) / diagVal  // = 1 for each diagonal, but off-diag / diag contributes via full trace\n  }\n  // Actually: diag(S)\u207B\u00B9 \u00B7 S trace = sum_ij S_ij / S_ii for same row\n  // Simpler: F_null from diagonal model\n  const diagArr: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: d }, (_, j) => i === j ? S.get(i, i) : 0)\n  )\n  const diagMat = Matrix.fromArray(diagArr)\n  let traceNullFull: number\n  try {\n    traceNullFull = diagMat.inverse().multiply(S).trace()\n  } catch {\n    traceNullFull = d // fallback\n  }\n  const F_null = Math.max(0, logDetDiagS + traceNullFull - logDetS - d)\n  // Null model also uses Bartlett correction (but without the 2k/3 factor term)\n  const bartlettNNull = nFactors !== undefined\n    ? n - 1 - (2 * d + 5) / 6\n    : n - 1\n  const chiSqNull = bartlettNNull * F_null\n  const dfNull = d * (d - 1) / 2\n\n  // RMSEA with 90% CI (Browne & Cudeck 1993)\n  const ncp = Math.max(chiSq - df, 0)\n  const rmsea = df > 0 ? Math.sqrt(ncp / (df * (n - 1))) : 0\n\n  // RMSEA 90% CI via chi-square non-centrality parameter bounds\n  let rmseaLo = 0, rmseaHi = rmsea * 2\n  if (df > 0) {\n    // Lower bound: find \u03BB_L such that P(\u03C7\u00B2 \u2265 chiSq | df, \u03BB_L) = 0.95\n    // Upper bound: find \u03BB_U such that P(\u03C7\u00B2 \u2265 chiSq | df, \u03BB_U) = 0.05\n    // Approximate: use Steiger (1990) approach\n    const ncpLo = Math.max(chiSq - df - 1.645 * Math.sqrt(2 * df), 0)\n    const ncpHi = Math.max(chiSq - df + 1.645 * Math.sqrt(2 * df), 0)\n    rmseaLo = Math.sqrt(Math.max(ncpLo / (df * (n - 1)), 0))\n    rmseaHi = Math.sqrt(ncpHi / (df * (n - 1)))\n  }\n\n  // CFI (Bentler 1990)\n  const ncpNull = Math.max(chiSqNull - dfNull, 0)\n  const cfi = ncpNull > 0 ? Math.max(0, Math.min(1, 1 - ncp / ncpNull)) : 1\n\n  // TLI / NNFI (Tucker & Lewis 1973)\n  // Not clamped to [0,1] \u2014 TLI can exceed 1 when model fits better than expected\n  const tli = df > 0 && dfNull > 0\n    ? ((chiSqNull / dfNull) - (chiSq / df)) / ((chiSqNull / dfNull) - 1)\n    : 1\n\n  // SRMR (standardized root mean square residual)\n  let srmrSum = 0\n  let srmrCount = 0\n  for (let i = 0; i < d; i++) {\n    for (let j = 0; j <= i; j++) {\n      const sij = S.get(i, j)\n      const sigij = Sigma.get(i, j)\n      const denom = Math.sqrt(S.get(i, i) * S.get(j, j))\n      const r_obs = denom > 0 ? sij / denom : 0\n      const r_imp = denom > 0 ? sigij / denom : 0\n      srmrSum += (r_obs - r_imp) ** 2\n      srmrCount++\n    }\n  }\n  const srmr = Math.sqrt(srmrSum / srmrCount)\n\n  // AIC, BIC\n  const aic = chiSq + 2 * nFreeParams\n  const bic = chiSq + nFreeParams * Math.log(n)\n\n  return {\n    chiSq,\n    df,\n    pValue,\n    rmsea,\n    rmseaCI: [rmseaLo, rmseaHi] as const,\n    cfi,\n    tli,\n    srmr,\n    aic,\n    bic,\n  }\n}\n\n// \u2500\u2500\u2500 Iterated PAF Extraction \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Iterated Principal Axis Factoring.\n * Extracts k factors from the correlation matrix by iterating eigendecomposition\n * of the reduced correlation matrix (communalities on diagonal) until convergence.\n *\n * Reference: Gorsuch (1983), Factor Analysis, 2nd ed.\n */\nfunction extractPAF(\n  R: Matrix,\n  k: number,\n  maxIter: number,\n  tol: number\n): { loadings: number[][]; communalities: Float64Array } {\n  const d = R.rows\n\n  // Initialize communalities from SMC (squared multiple correlation)\n  const h2 = new Float64Array(d)\n  try {\n    const invR = R.inverse()\n    for (let i = 0; i < d; i++) h2[i] = Math.max(0.01, 1 - 1 / Math.max(invR.get(i, i), 1e-12))\n  } catch {\n    for (let i = 0; i < d; i++) h2[i] = 0.5\n  }\n\n  const loadings: number[][] = Array.from({ length: d }, () => new Array<number>(k).fill(0))\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    // Build reduced correlation matrix (communalities on diagonal)\n    const adjR: number[][] = R.toArray()\n    for (let i = 0; i < d; i++) adjR[i]![i] = h2[i]!\n    const adjM = Matrix.fromArray(adjR)\n\n    const { values, vectors } = adjM.eigen()\n    // eigen() returns sorted descending already\n\n    const oldH2 = new Float64Array(h2)\n\n    // Extract top k factors\n    for (let f = 0; f < k; f++) {\n      const eigenVal = Math.max(values[f]!, 0)\n      const scale = Math.sqrt(eigenVal)\n      for (let r = 0; r < d; r++) {\n        loadings[r]![f] = vectors.get(r, f) * scale\n      }\n    }\n\n    // Update communalities\n    let maxDelta = 0\n    for (let r = 0; r < d; r++) {\n      let sum = 0\n      for (let f = 0; f < k; f++) sum += loadings[r]![f]! ** 2\n      // Allow near-Heywood cases (communality close to 1) \u2014 only clamp for numerical stability\n      h2[r] = Math.max(0.001, Math.min(0.9999, sum))\n      maxDelta = Math.max(maxDelta, Math.abs(h2[r]! - oldH2[r]!))\n    }\n    if (maxDelta < tol) break\n  }\n\n  // Canonical sign convention: match LAPACK's dsyev (used by R)\n  for (let f = 0; f < k; f++) {\n    let maxAbs = 0, maxIdx = 0\n    for (let i = 0; i < d; i++) {\n      const a = Math.abs(loadings[i]![f]!)\n      if (a > maxAbs) { maxAbs = a; maxIdx = i }\n    }\n    if (loadings[maxIdx]![f]! < 0) {\n      for (let i = 0; i < d; i++) loadings[i]![f] = -loadings[i]![f]!\n    }\n  }\n\n  return { loadings, communalities: h2 }\n}\n\n// \u2500\u2500\u2500 ML Extraction \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Maximum Likelihood factor extraction.\n * Two-phase optimization matching R's factanal():\n *\n * Phase 1: J\u00F6reskog gradient descent on uniquenesses with eigendecomposition\n *   for loadings. Fast convergence to near-optimum.\n *\n * Phase 2: Nelder-Mead refinement on R's exact concentrated ML objective\n *   (FAfn). Polishes uniquenesses to match R's L-BFGS-B result.\n *\n * The concentrated objective (R's FAfn):\n *   F(\u03A8) = -\u03A3_{j>k} (log \u03BB_j - \u03BB_j) + k - d\n * where \u03BB_j are eigenvalues of \u03A8^{-1/2} R \u03A8^{-1/2}.\n *\n * Reference: R stats::factanal (src/library/stats/R/factanal.R)\n * Reference: J\u00F6reskog (1967), Psychometrika 32(4):443-482\n */\nfunction extractML(\n  R: Matrix,\n  k: number,\n  maxIter: number,\n  tol: number\n): { loadings: number[][]; communalities: Float64Array } {\n  const d = R.rows\n  const Rarr = R.toArray()\n\n  // Initialize uniquenesses using R's factanal formula:\n  // start <- (1 - 0.5 * nfactors/p) * diag(solve(S))^(-1)\n  // diag(solve(S))^(-1) = 1/R^{-1}_ii = uniqueness estimate from SMC\n  const Theta = new Float64Array(d)\n  try {\n    const invR = R.inverse()\n    const factor = 1 - 0.5 * k / d\n    for (let i = 0; i < d; i++) Theta[i] = Math.max(0.005, Math.min(0.995, factor / Math.max(invR.get(i, i), 1e-12)))\n  } catch {\n    for (let i = 0; i < d; i++) Theta[i] = 0.5\n  }\n\n  /**\n   * Extract loadings from eigendecomposition of scaled correlation:\n   * \u0398^{-1/2} R \u0398^{-1/2} \u2192 take top k eigenvalues/vectors\n   * L = \u0398^{1/2} V diag(sqrt(max(\u03BB-1, 0)))\n   */\n  function extractLoadingsFromTheta(theta: Float64Array): number[][] {\n    const scaledR: number[][] = Array.from({ length: d }, (_, i) =>\n      Array.from({ length: d }, (_, j) => {\n        const si = 1 / Math.sqrt(Math.max(theta[i]!, 1e-12))\n        const sj = 1 / Math.sqrt(Math.max(theta[j]!, 1e-12))\n        return Rarr[i]![j]! * si * sj\n      })\n    )\n    const { values, vectors } = Matrix.fromArray(scaledR).eigen()\n    const L: number[][] = Array.from({ length: d }, () => new Array<number>(k).fill(0))\n    for (let f = 0; f < k; f++) {\n      const ev = Math.max(values[f]! - 1, 0)\n      const scale = Math.sqrt(ev)\n      for (let i = 0; i < d; i++) {\n        L[i]![f] = Math.sqrt(Math.max(theta[i]!, 1e-12)) * vectors.get(i, f) * scale\n      }\n    }\n    return L\n  }\n\n  // \u2500\u2500 Phase 1: J\u00F6reskog gradient descent (fast initial convergence) \u2500\u2500\n  const lr0 = 0.02\n  const lrMin = 0.001\n  let L: number[][] = extractLoadingsFromTheta(Theta)\n  const vTheta = new Float64Array(d)\n  const momentum = 0.8\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    const lr = lrMin + (lr0 - lrMin) * 0.5 * (1 + Math.cos(Math.PI * iter / maxIter))\n    L = extractLoadingsFromTheta(Theta)\n\n    // Build \u03A3 and its inverse\n    const sigmaArr: number[][] = Array.from({ length: d }, (_, i) =>\n      Array.from({ length: d }, (_, j) => {\n        let sum = 0\n        for (let f = 0; f < k; f++) sum += L[i]![f]! * L[j]![f]!\n        return sum + (i === j ? Theta[i]! : 0)\n      })\n    )\n    const Sigma = Matrix.fromArray(sigmaArr)\n    let invSigma: Matrix\n    try { invSigma = Sigma.inverse() } catch { invSigma = Sigma.pseudoInverse() }\n\n    // Gradient: (\u03A3\u207B\u00B9(\u03A3 - R)\u03A3\u207B\u00B9)_ii\n    const Delta = invSigma.multiply(Sigma.subtract(R)).multiply(invSigma)\n    let maxGrad = 0\n    for (let i = 0; i < d; i++) {\n      const grad = Delta.get(i, i)\n      maxGrad = Math.max(maxGrad, Math.abs(grad))\n      const v = momentum * vTheta[i]! - lr * grad\n      vTheta[i] = v\n      Theta[i] = Math.max(0.005, Math.min(0.995, Theta[i]! + v))\n    }\n    if (maxGrad < tol) break\n  }\n\n  // \u2500\u2500 Phase 2: Nelder-Mead polish on R's exact concentrated objective \u2500\u2500\n  // F(\u03A8) = -\u03A3_{j>k} (log \u03BB_j - \u03BB_j) + k - d\n  // where \u03BB_j = eigenvalues of \u03A8^{-1/2} R \u03A8^{-1/2}\n  function concentratedML(x: readonly number[]): number {\n    const scaledR: number[][] = Array.from({ length: d }, (_, i) =>\n      Array.from({ length: d }, (_, j) => {\n        const psi_i = Math.max(x[i]!, 0.005)\n        const psi_j = Math.max(x[j]!, 0.005)\n        return Rarr[i]![j]! / (Math.sqrt(psi_i) * Math.sqrt(psi_j))\n      })\n    )\n    const { values } = Matrix.fromArray(scaledR).eigen()\n    let sum = 0\n    for (let j = k; j < d; j++) {\n      const ev = Math.max(values[j]!, 1e-15)\n      sum += Math.log(ev) - ev\n    }\n    // Add penalty for out-of-bounds (death penalty for Nelder-Mead)\n    let penalty = 0\n    for (let i = 0; i < d; i++) {\n      if (x[i]! < 0.005 || x[i]! > 0.995) penalty += 1000\n    }\n    return -sum + k - d + penalty\n  }\n\n  const psi0 = Array.from(Theta)\n  const nmResult = nelderMead(concentratedML, psi0, {\n    maxIter: 5000 * d,\n    tol: 1e-10,\n  })\n\n  // Use Nelder-Mead result, clamped to bounds\n  const finalTheta = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    finalTheta[i] = Math.max(0.005, Math.min(0.995, nmResult.x[i]!))\n  }\n\n  // Extract final loadings from polished uniquenesses\n  L = extractLoadingsFromTheta(finalTheta)\n\n  // Canonical sign convention: for each factor column, ensure the element\n  // with the largest absolute value is positive. This matches LAPACK's dsyev\n  // convention used by R's eigen() and factanal, and ensures geomin/oblimin\n  // gradient descent starts from the same orientation as R.\n  for (let f = 0; f < k; f++) {\n    let maxAbs = 0, maxIdx = 0\n    for (let i = 0; i < d; i++) {\n      const a = Math.abs(L[i]![f]!)\n      if (a > maxAbs) { maxAbs = a; maxIdx = i }\n    }\n    if (L[maxIdx]![f]! < 0) {\n      for (let i = 0; i < d; i++) L[i]![f] = -L[i]![f]!\n    }\n  }\n\n  const h2 = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    let sum = 0\n    for (let f = 0; f < k; f++) sum += L[i]![f]! ** 2\n    h2[i] = Math.max(0.001, Math.min(0.9999, sum))\n  }\n\n  return { loadings: L, communalities: h2 }\n}\n\n// \u2500\u2500\u2500 Rotation Engine \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Varimax rotation matching R's stats::varimax() exactly.\n *\n * Algorithm (from R src/library/stats/R/factanal.R):\n *   1. Kaiser-normalize rows: x = L / rowNorms\n *   2. Iterate:\n *      z = x * T\n *      B = x' * (z\u00B3 - z * diag(colSums(z\u00B2)/p))\n *      Polar decomposition of B: T = U * V' from SVD(B)\n *      Converge when sum(singularValues) stops increasing\n *   3. Denormalize: z * rowNorms\n *\n * The SVD of the k\u00D7k matrix B is computed via eigendecomposition of B'B\n * (polar decomposition), avoiding the Jacobi one-sided SVD which has\n * accuracy issues for small matrices.\n *\n * Reference: Kaiser (1958), Psychometrika 23:187-200\n */\nfunction rotateVarimax(\n  L: number[][],\n  maxIter: number,\n  tol: number\n): { rotated: number[][]; T: number[][] } {\n  const p = L.length\n  const k = L[0]!.length\n\n  if (k < 2) return { rotated: L.map(r => [...r]), T: [[1]] }\n\n  // Kaiser normalization: normalize each row by communality (row norm)\n  const sc = new Float64Array(p)\n  for (let i = 0; i < p; i++) {\n    let ss = 0\n    for (let j = 0; j < k; j++) ss += L[i]![j]! ** 2\n    sc[i] = Math.sqrt(ss || 1e-15)\n  }\n  const x: number[][] = L.map((row, i) => row.map(v => v / sc[i]!))\n\n  // Initialize T = Identity (k \u00D7 k)\n  let T: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n  )\n\n  let dPast = 0\n  for (let iter = 0; iter < Math.min(maxIter, 1000); iter++) {\n    // z = x * T  (p \u00D7 k)\n    const z: number[][] = Array.from({ length: p }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let m = 0; m < k; m++) s += x[i]![m]! * T[m]![j]!\n        return s\n      })\n    )\n\n    // colSums(z\u00B2) / p\n    const csz2 = new Float64Array(k)\n    for (let j = 0; j < k; j++) {\n      let s = 0\n      for (let i = 0; i < p; i++) s += z[i]![j]! ** 2\n      csz2[j] = s / p\n    }\n\n    // B = x' * (z\u00B3 - z * diag(csz2))   (k \u00D7 k)\n    // target[i][j] = z[i][j]\u00B3 - z[i][j] * csz2[j]\n    // B[r][c] = \u03A3_i x[i][r] * target[i][c]\n    const B: number[][] = Array.from({ length: k }, (_, r) =>\n      Array.from({ length: k }, (_, c) => {\n        let s = 0\n        for (let i = 0; i < p; i++) {\n          const zij = z[i]![c]!\n          s += x[i]![r]! * (zij * zij * zij - zij * csz2[c]!)\n        }\n        return s\n      })\n    )\n\n    // SVD of B via polar decomposition using eigendecomposition of B'B\n    // B'B is k\u00D7k symmetric \u2192 eigendecompose \u2192 V, \u03C3\u00B2\n    // T = B * V * diag(1/\u03C3) * V'  (polar factor)\n    const BtB: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let m = 0; m < k; m++) s += B[m]![i]! * B[m]![j]!\n        return s\n      })\n    )\n    const { values: sigma2, vectors: Vmat } = Matrix.fromArray(BtB).eigen()\n\n    // Singular values = sqrt(eigenvalues of B'B)\n    const svals = new Float64Array(k)\n    for (let j = 0; j < k; j++) svals[j] = Math.sqrt(Math.max(sigma2[j]!, 0))\n\n    // T_new = B * V * diag(1/\u03C3) * V'\n    // Step 1: BV = B * V  (k \u00D7 k)\n    const Varr = Vmat.toArray()\n    const BV: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let m = 0; m < k; m++) s += B[i]![m]! * Varr[m]![j]!\n        return s\n      })\n    )\n\n    // Step 2: BV * diag(1/\u03C3)  \u2192 this gives U (left singular vectors)\n    for (let j = 0; j < k; j++) {\n      const invS = svals[j]! > 1e-15 ? 1 / svals[j]! : 0\n      for (let i = 0; i < k; i++) BV[i]![j] = BV[i]![j]! * invS\n    }\n\n    // Step 3: T = U * V'  (k \u00D7 k)\n    T = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let m = 0; m < k; m++) s += BV[i]![m]! * Varr[j]![m]!\n        return s\n      })\n    )\n\n    // Convergence: sum of singular values (matches R's criterion)\n    let dNew = 0\n    for (let j = 0; j < k; j++) dNew += svals[j]!\n    if (dNew < dPast * (1 + tol)) break\n    dPast = dNew\n  }\n\n  // Final rotated loadings = x * T, then denormalize by row norms\n  const rot: number[][] = Array.from({ length: p }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      let s = 0\n      for (let m = 0; m < k; m++) s += x[i]![m]! * T[m]![j]!\n      return s * sc[i]!\n    })\n  )\n\n  return { rotated: rot, T }\n}\n\n// \u2500\u2500\u2500 Oblique rotation criteria \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Criterion + gradient for a rotation method, evaluated on rotated loadings L. */\ninterface CriterionResult {\n  readonly f: number            // criterion value to minimize\n  readonly Gq: number[][]       // gradient \u2202f/\u2202L (p \u00D7 k)\n}\n\n/**\n * Oblimin criterion (gamma = 0 \u2192 quartimin, gamma = 0.5 \u2192 biquartimin).\n * f = (1/4) \u03A3_i \u03A3_{j\u2260m} \u03BB\u00B2_ij \u03BB\u00B2_im \u2212 (\u03B3/4d) \u03A3_j \u03A3_m (\u03A3_i \u03BB\u00B2_ij)(\u03A3_i \u03BB\u00B2_im) for j\u2260m\n * Gq_ij = \u03BB_ij (\u03A3_{m\u2260j} \u03BB\u00B2_im \u2212 (\u03B3/d) \u03A3_m \u03BB\u00B2_im)\n * Reference: Jennrich (2002), Psychometrika 67(1):7-27\n */\nfunction criterionOblimin(L: number[][], gamma: number): CriterionResult {\n  const p = L.length, k = L[0]!.length\n  const Gq: number[][] = Array.from({ length: p }, () => new Array<number>(k).fill(0))\n  let f = 0\n  for (let i = 0; i < p; i++) {\n    let rowSumSq = 0\n    for (let m = 0; m < k; m++) rowSumSq += L[i]![m]! ** 2\n    for (let j = 0; j < k; j++) {\n      const lij = L[i]![j]!\n      const otherSumSq = rowSumSq - lij * lij\n      Gq[i]![j] = lij * (otherSumSq - (gamma / p) * rowSumSq)\n      f += lij * lij * otherSumSq\n    }\n  }\n  f /= 4\n  return { f, Gq }\n}\n\n/**\n * Geomin criterion.\n * f = \u03A3_i [\u03A0_j (\u03BB\u00B2_ij + \u03B4)]^(1/k)\n * Gq_ij = (2/k) \u00D7 \u03BB_ij / (\u03BB\u00B2_ij + \u03B4) \u00D7 [\u03A0_m (\u03BB\u00B2_im + \u03B4)]^(1/k)\n *\n * Reference: Yates (1987); Browne (2001), Psychometrika 66(3):289-307\n * Implementation matches R GPArotation::vgQ.geomin exactly.\n */\nfunction criterionGeomin(L: number[][], delta: number): CriterionResult {\n  const p = L.length, k = L[0]!.length\n  const Gq: number[][] = Array.from({ length: p }, () => new Array<number>(k).fill(0))\n  let f = 0\n  for (let i = 0; i < p; i++) {\n    // pro_i = exp( (1/k) * \u03A3_j log(\u03BB\u00B2_ij + \u03B4) ) = [\u03A0_j (\u03BB\u00B2_ij + \u03B4)]^(1/k)\n    let logSum = 0\n    for (let j = 0; j < k; j++) logSum += Math.log(L[i]![j]! ** 2 + delta)\n    const pro = Math.exp(logSum / k)\n    f += pro\n    for (let j = 0; j < k; j++) {\n      Gq[i]![j] = (2 / k) * L[i]![j]! / (L[i]![j]! ** 2 + delta) * pro\n    }\n  }\n  return { f, Gq }\n}\n\n/**\n * Quartimax criterion.\n * f = -(1/4) \u03A3_ij \u03BB\u2074_ij\n * Gq_ij = -\u03BB\u00B3_ij\n *\n * Reference: Neuhaus & Wrigley (1954), JASA 49:325-332\n * Implementation matches R GPArotation::vgQ.quartimax exactly.\n */\nfunction criterionQuartimax(L: number[][]): CriterionResult {\n  const p = L.length, k = L[0]!.length\n  const Gq: number[][] = Array.from({ length: p }, () => new Array<number>(k).fill(0))\n  let f = 0\n  for (let i = 0; i < p; i++) {\n    for (let j = 0; j < k; j++) {\n      const lij = L[i]![j]!\n      const l2 = lij * lij\n      f -= l2 * l2\n      Gq[i]![j] = -(lij * l2)  // -\u03BB\u00B3\n    }\n  }\n  f /= 4\n  return { f, Gq }\n}\n\n/**\n * Target rotation criterion (partially specified target / Procrustes).\n * f = \u03A3_ij w\u00B2_ij (\u03BB_ij - h_ij)\u00B2\n * Gq_ij = 2 w\u00B2_ij (\u03BB_ij - h_ij)\n *\n * When weight is omitted, all w=1 (full target, equivalent to vgQ.targetQ).\n * When weight has 0s for unspecified cells, only specified cells contribute.\n *\n * Reference: Browne (1972), Psychometrika 37(2):123-138\n * Implementation matches R GPArotation::vgQ.pst (partially specified target).\n */\nfunction criterionTarget(\n  L: number[][],\n  target: readonly (readonly number[])[],\n  weight?: readonly (readonly number[])[]\n): CriterionResult {\n  const p = L.length, k = L[0]!.length\n  const Gq: number[][] = Array.from({ length: p }, () => new Array<number>(k).fill(0))\n  let f = 0\n  for (let i = 0; i < p; i++) {\n    for (let j = 0; j < k; j++) {\n      const w = weight ? weight[i]![j]! : 1\n      const w2 = w * w\n      const diff = L[i]![j]! - target[i]![j]!\n      f += w2 * diff * diff\n      Gq[i]![j] = 2 * w2 * diff\n    }\n  }\n  return { f, Gq }\n}\n\n/**\n * General oblique rotation via gradient projection (GPFoblq).\n * Matches R's GPArotation::GPFoblq algorithm exactly:\n *   - Rotated loadings: L = A \u00D7 inv(T)'  (oblique parameterization)\n *   - Gradient w.r.t. T: G = \u2212(L' \u00D7 Gq \u00D7 T^{-1})'  (using L, not A)\n *   - Oblique projection: Gp = G \u2212 T \u00D7 diag(colSums(T \u2299 G))\n *   - Armijo line search with column normalization\n *   - Always take step after line search (even if Armijo not satisfied)\n *   - Phi = T' \u00D7 T\n *\n * Reference: Bernaards & Jennrich (2005), \"Gradient projection algorithms\n *   and software for arbitrary rotation criteria in factor analysis.\"\n *   Educational and Psychological Measurement, 65(5):676-696.\n * Implementation: R GPArotation::GPFoblq (v2024.3-1)\n */\nfunction gpfOblq(\n  A: number[][],\n  criterion: (L: number[][]) => CriterionResult,\n  maxIter: number,\n  tol: number,\n  Tinit?: number[][],\n  reflect: boolean = true\n): { rotated: number[][]; T: number[][]; Phi: number[][]; f: number } {\n  const k = A[0]!.length\n  const Amat = Matrix.fromArray(A)\n\n  // Initialize T from Tinit or default to I_{k\u00D7k}\n  let Tarr: number[][] = Tinit\n    ? Tinit.map(r => [...r])\n    : Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n      )\n  let Tmat = Matrix.fromArray(Tarr)\n\n  // Initial rotated loadings: L = A \u00D7 inv(T)'\n  // When T = I this is just A; when T \u2260 I we must compute the actual rotation\n  let Larr: number[][]\n  if (Tinit) {\n    let invT: Matrix\n    try {\n      invT = Tmat.inverse()\n    } catch {\n      invT = Tmat.pseudoInverse()\n    }\n    Larr = Amat.multiply(invT.transpose()).toArray()\n  } else {\n    Larr = A.map(r => [...r])\n  }\n\n  // Evaluate criterion\n  let vgQ = criterion(Larr)\n  let f = vgQ.f\n\n  // Initial gradient: R uses G <- -t(t(L) %*% VgQ$Gq %*% solve(Tmat))\n  // At T=I this is -(L' \u00D7 Gq \u00D7 I)' = -(L' \u00D7 Gq)'\n  let G = computeGPFoblqGradient(Larr, vgQ.Gq, Tmat)\n\n  let al = 1.0\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    // Oblique projection: Gp = G - T \u00D7 diag(colSums(T \u2299 G))\n    const colSumTG = new Float64Array(k)\n    for (let j = 0; j < k; j++) {\n      let s = 0\n      for (let i = 0; i < k; i++) s += Tarr[i]![j]! * G[i]![j]!\n      colSumTG[j] = s\n    }\n    const Gp: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => G[i]![j]! - Tarr[i]![j]! * colSumTG[j]!)\n    )\n\n    // Convergence: s = ||Gp||_F\n    let s2 = 0\n    for (let i = 0; i < k; i++)\n      for (let j = 0; j < k; j++) s2 += Gp[i]![j]! ** 2\n    const s = Math.sqrt(s2)\n    if (s < tol) break\n\n    // Line search with backtracking (Armijo condition)\n    // R: al <- 2*al; for(i in 0:10) { ... if(improvement > 0.5*s^2*al) break; al <- al/2 }\n    // Then ALWAYS updates Tmat <- Tt; f <- VgQt$f; G <- ... (even if Armijo not met)\n    al = 2 * al\n    let Tmatt: number[][] = Tarr\n    let TmattMat = Tmat\n    let Lnew = Larr\n    let vgQnew = vgQ\n\n    for (let lsIter = 0; lsIter <= 10; lsIter++) {\n      // X = T - al * Gp\n      const X: number[][] = Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => Tarr[i]![j]! - al * Gp[i]![j]!)\n      )\n\n      // Normalize columns: v = 1/||col_j||, Tt = X \u00D7 diag(v)\n      for (let j = 0; j < k; j++) {\n        let ss = 0\n        for (let i = 0; i < k; i++) ss += X[i]![j]! ** 2\n        const invNorm = 1 / Math.sqrt(ss || 1e-15)\n        for (let i = 0; i < k; i++) X[i]![j] = X[i]![j]! * invNorm\n      }\n\n      // L = A \u00D7 inv(Tt)'\n      const Ttmat = Matrix.fromArray(X)\n      let invTt: Matrix\n      try {\n        invTt = Ttmat.inverse()\n      } catch {\n        invTt = Ttmat.pseudoInverse()\n      }\n      Lnew = Amat.multiply(invTt.transpose()).toArray()\n\n      // Evaluate criterion\n      vgQnew = criterion(Lnew)\n      Tmatt = X\n      TmattMat = Ttmat\n\n      const improvement = f - vgQnew.f\n      if (improvement > 0.5 * s2 * al) break\n      al = al / 2\n    }\n\n    // R: ALWAYS update after line search (even if Armijo not satisfied)\n    // Tmat <- Tmatt; f <- VgQt$f; G <- -t(t(L) %*% VgQt$Gq %*% solve(Tmatt))\n    Tarr = Tmatt\n    Tmat = TmattMat\n    Larr = Lnew\n    f = vgQnew.f\n    G = computeGPFoblqGradient(Lnew, vgQnew.Gq, TmattMat)\n  }\n\n  // Factor correlation matrix: Phi = T' \u00D7 T\n  const Phi: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      let s = 0\n      for (let l = 0; l < k; l++) s += Tarr[l]![i]! * Tarr[l]![j]!\n      return s\n    })\n  )\n\n  // Reflect columns: flip factor if sum of loadings is negative (lavaan default)\n  // lavaan::lav_matrix_rotate.R performs this after rotation to ensure\n  // primary loadings are positive, improving interpretability and matching\n  // lavaan's basin selection behavior.\n  // Disabled for target rotation: reflection can move loadings away from the\n  // target and invalidates the criterion value used for multi-start selection.\n  if (reflect) {\n    for (let j = 0; j < k; j++) {\n      let colSum = 0\n      for (let i = 0; i < Larr.length; i++) colSum += Larr[i]![j]!\n      if (colSum < 0) {\n        // Flip loadings column j\n        for (let i = 0; i < Larr.length; i++) Larr[i]![j] = -Larr[i]![j]!\n        // Flip corresponding Phi row and column (off-diagonals only)\n        for (let m = 0; m < k; m++) {\n          if (m !== j) {\n            Phi[j]![m] = -Phi[j]![m]!\n            Phi[m]![j] = -Phi[m]![j]!\n          }\n        }\n      }\n    }\n  }\n\n  return { rotated: Larr, T: Tarr, Phi, f }\n}\n\n/**\n * Compute gradient of criterion w.r.t. rotation matrix T.\n * R: G <- -t(t(L) %*% VgQt$Gq %*% solve(Tmatt))\n *    = -(L' \u00D7 Gq \u00D7 T^{-1})'\n * Note: uses L (rotated loadings) and T^{-1}, NOT A and inv(T').\n */\nfunction computeGPFoblqGradient(L: number[][], Gq: number[][], Tmat: Matrix): number[][] {\n  const Lmat = Matrix.fromArray(L)\n  const GqMat = Matrix.fromArray(Gq)\n  let invT: Matrix\n  try {\n    invT = Tmat.inverse()\n  } catch {\n    invT = Tmat.pseudoInverse()\n  }\n  // inner = L' \u00D7 Gq \u00D7 T^{-1}  (k\u00D7p \u00D7 p\u00D7k \u00D7 k\u00D7k = k\u00D7k)\n  const inner = Lmat.transpose().multiply(GqMat).multiply(invT)\n  // G = -inner^T\n  const G: number[][] = Array.from({ length: inner.rows }, (_, i) =>\n    Array.from({ length: inner.cols }, (_, j) => -inner.get(j, i))\n  )\n  return G\n}\n\n/**\n * General orthogonal rotation via gradient projection (GPForth).\n * Matches R's GPArotation::GPForth algorithm:\n *   - Rotated loadings: L = A \u00D7 T  (orthogonal parameterization)\n *   - Gradient w.r.t. T: G = A' \u00D7 Gq\n *   - Orthogonal projection: Gp = G \u2212 T \u00D7 sym(T'G)\n *     where sym(M) = (M + M') / 2\n *   - Step update via SVD: T = U \u00D7 V'  (polar decomposition of X = T \u2212 \u03B1\u00B7Gp)\n *   - Phi = I (identity \u2014 orthogonal rotation)\n *\n * Reference: Bernaards & Jennrich (2005), \"Gradient projection algorithms\n *   and software for arbitrary rotation criteria in factor analysis.\"\n *   Educational and Psychological Measurement, 65(5):676-696.\n * Implementation: R GPArotation::GPForth (v2024.3-1)\n */\nfunction gpfOrth(\n  A: number[][],\n  criterion: (L: number[][]) => CriterionResult,\n  maxIter: number,\n  tol: number,\n  Tinit?: number[][]\n): { rotated: number[][]; T: number[][]; Phi: number[][]; f: number } {\n  const p = A.length\n  const k = A[0]!.length\n\n  // Initialize T from Tinit or default to I_{k\u00D7k}\n  let Tarr: number[][] = Tinit\n    ? Tinit.map(r => [...r])\n    : Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n      )\n\n  // Initial rotated loadings: L = A \u00D7 T\n  let Larr: number[][] = Array.from({ length: p }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      let s = 0\n      for (let m = 0; m < k; m++) s += A[i]![m]! * Tarr[m]![j]!\n      return s\n    })\n  )\n\n  // Evaluate criterion\n  let vgQ = criterion(Larr)\n  let f = vgQ.f\n\n  // Initial gradient: G = A' \u00D7 Gq  (k\u00D7p \u00D7 p\u00D7k = k\u00D7k)\n  let G: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      let s = 0\n      for (let r = 0; r < p; r++) s += A[r]![i]! * vgQ.Gq[r]![j]!\n      return s\n    })\n  )\n\n  let al = 1.0\n\n  for (let iter = 0; iter < maxIter; iter++) {\n    // Orthogonal projection: Gp = G - T \u00D7 sym(T'G)\n    // M = T'G  (k\u00D7k)\n    const M: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let r = 0; r < k; r++) s += Tarr[r]![i]! * G[r]![j]!\n        return s\n      })\n    )\n    // sym(M) = (M + M') / 2\n    const sym: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => (M[i]![j]! + M[j]![i]!) / 2)\n    )\n    // Gp = G - T \u00D7 sym\n    const Gp: number[][] = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let s = 0\n        for (let m = 0; m < k; m++) s += Tarr[i]![m]! * sym[m]![j]!\n        return G[i]![j]! - s\n      })\n    )\n\n    // Convergence: s = ||Gp||_F\n    let s2 = 0\n    for (let i = 0; i < k; i++)\n      for (let j = 0; j < k; j++) s2 += Gp[i]![j]! ** 2\n    const s = Math.sqrt(s2)\n    if (s < tol) break\n\n    // Line search with backtracking (Armijo condition)\n    al = 2 * al\n    let Tnew: number[][] = Tarr\n    let Lnew = Larr\n    let vgQnew = vgQ\n\n    for (let lsIter = 0; lsIter <= 10; lsIter++) {\n      // X = T - al * Gp\n      const X: number[][] = Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => Tarr[i]![j]! - al * Gp[i]![j]!)\n      )\n\n      // SVD of X \u2192 T_new = U \u00D7 V'  (polar decomposition, ensures orthogonality)\n      const Xmat = Matrix.fromArray(X)\n      const { U: Umat, V: Vmat } = Xmat.svd()\n      const Uarr = Umat.toArray()\n      const Varr = Vmat.toArray()\n\n      // T_new = U \u00D7 V'\n      const Tt: number[][] = Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => {\n          let ss = 0\n          for (let m = 0; m < k; m++) ss += Uarr[i]![m]! * Varr[j]![m]!\n          return ss\n        })\n      )\n\n      // L_new = A \u00D7 T_new\n      Lnew = Array.from({ length: p }, (_, i) =>\n        Array.from({ length: k }, (_, j) => {\n          let ss = 0\n          for (let m = 0; m < k; m++) ss += A[i]![m]! * Tt[m]![j]!\n          return ss\n        })\n      )\n\n      // Evaluate criterion\n      vgQnew = criterion(Lnew)\n      Tnew = Tt\n\n      const improvement = f - vgQnew.f\n      if (improvement > 0.5 * s2 * al) break\n      al = al / 2\n    }\n\n    // Always update after line search (even if Armijo not satisfied)\n    Tarr = Tnew\n    Larr = Lnew\n    f = vgQnew.f\n\n    // G = A' \u00D7 Gq\n    G = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => {\n        let ss = 0\n        for (let r = 0; r < p; r++) ss += A[r]![i]! * vgQnew.Gq[r]![j]!\n        return ss\n      })\n    )\n  }\n\n  // Phi = I for orthogonal rotation\n  const Phi: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n  )\n\n  // Reflect columns: flip factor if sum of loadings is negative\n  for (let j = 0; j < k; j++) {\n    let colSum = 0\n    for (let i = 0; i < Larr.length; i++) colSum += Larr[i]![j]!\n    if (colSum < 0) {\n      for (let i = 0; i < Larr.length; i++) Larr[i]![j] = -Larr[i]![j]!\n    }\n  }\n\n  return { rotated: Larr, T: Tarr, Phi, f }\n}\n\n/**\n * Promax rotation: outer Kaiser normalization \u2192 varimax \u2192 power target \u2192 Procrustes.\n * Matches R's psych::fa(rotate=\"promax\") which calls psych::kaiser(loadings, rotate=\"Promax\"):\n *   0. OUTER Kaiser: h\u00B2 = rowSums(L\u00B2), normalize rows to unit norm\n *   1. Varimax rotation on normalized loadings \u2192 V, T_var\n *   2. Target Q = V \u2299 |V|^(m\u22121)\n *   3. Regression U = (V'V)^{-1} V' Q (on varimax loadings, not original)\n *   4. Normalize: d = diag((U'U)^{-1}), U = U diag(\u221Ad)\n *   5. Rotated = V \u00D7 U_norm\n *   6. Denormalize: rotated = rotated * \u221Ah\u00B2\n *   7. Compound rotation = T_var \u00D7 U_norm\n *\n * The outer Kaiser normalization is CRITICAL: psych::fa dispatches promax via\n * psych::kaiser() which normalizes loadings by communality before rotation.\n * This changes the promax target Q nonlinearly, producing different results\n * than stats::promax() or psych::Promax() applied directly.\n *\n * Reference: Hendrickson & White (1964), JASA 59:258-264\n * Implementation: R psych::kaiser + stats::promax (src/library/stats/R/factanal.R)\n */\nfunction rotatePromax(\n  L: number[][],\n  power: number,\n  maxIter: number,\n  tol: number\n): { rotated: number[][]; T: number[][]; Phi: number[][] } {\n  const d = L.length\n  const k = L[0]!.length\n\n  // Step 0: OUTER Kaiser normalization (psych::kaiser)\n  // h2 <- diag(f %*% t(f))  \u2014 communalities (row sums of squared loadings)\n  // weighted <- f / sqrt(h2) \u2014 normalize each row to unit norm\n  const h2 = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    let sum = 0\n    for (let j = 0; j < k; j++) sum += L[i]![j]! * L[i]![j]!\n    h2[i] = sum\n  }\n  const sqrtH2 = new Float64Array(d)\n  for (let i = 0; i < d; i++) sqrtH2[i] = Math.sqrt(Math.max(h2[i]!, 1e-15))\n\n  const L_norm: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: k }, (_, j) => L[i]![j]! / sqrtH2[i]!)\n  )\n\n  // Step 1: Varimax rotation on NORMALIZED loadings\n  const { rotated: vari, T: T_varimax } = rotateVarimax(L_norm, maxIter, tol)\n\n  // Step 2: Target Q = V * |V|^(m-1) where V = varimax loadings (normalized)\n  const Q: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      const val = vari[i]![j]!\n      return Math.sign(val) * Math.abs(val) ** power\n    })\n  )\n\n  // Step 3: Regression on varimax loadings: U = (V'V)^{-1} V' Q\n  // This matches R's lm.fit(x, Q)$coefficients where x = varimax loadings\n  const Vmat = Matrix.fromArray(vari)\n  const Qmat = Matrix.fromArray(Q)\n  let VtV_inv: Matrix\n  try {\n    VtV_inv = Vmat.transpose().multiply(Vmat).inverse()\n  } catch {\n    VtV_inv = Vmat.transpose().multiply(Vmat).pseudoInverse()\n  }\n  const U = VtV_inv.multiply(Vmat.transpose()).multiply(Qmat)\n  const Uarr = U.toArray()\n\n  // Step 4: R normalization: d = diag(solve(t(U) %*% U)), U = U %*% diag(sqrt(d))\n  // This scales each column j by sqrt((U'U)^{-1}_{jj})\n  const UtU = U.transpose().multiply(U)\n  let UtU_inv: Matrix\n  try {\n    UtU_inv = UtU.inverse()\n  } catch {\n    UtU_inv = UtU.pseudoInverse()\n  }\n  for (let j = 0; j < k; j++) {\n    const d_j = Math.max(UtU_inv.get(j, j), 1e-15)\n    const scale = Math.sqrt(d_j)\n    for (let i = 0; i < k; i++) Uarr[i]![j] = Uarr[i]![j]! * scale\n  }\n\n  // Step 5: Rotated loadings = V * U_normalized (still in normalized space)\n  const Umat = Matrix.fromArray(Uarr)\n  const rotatedNorm = Vmat.multiply(Umat).toArray()\n\n  // Step 6: DENORMALIZE \u2014 multiply back by \u221Ah\u00B2 (psych::kaiser: rotated$loadings * sqrt(h2))\n  const rotated: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: k }, (_, j) => rotatedNorm[i]![j]! * sqrtH2[i]!)\n  )\n\n  // Step 7: Compound rotation matrix = T_varimax * U_normalized\n  // This matches R's: U <- xx$rotmat %*% U\n  const TvarMat = Matrix.fromArray(T_varimax)\n  const Tcompound = TvarMat.multiply(Umat)\n  const Tarr = Tcompound.toArray()\n\n  // Step 8: Phi = T_compound^{-1} * (T_compound^{-1})'\n  let invT: Matrix\n  try {\n    invT = Tcompound.inverse()\n  } catch {\n    invT = Tcompound.pseudoInverse()\n  }\n  const PhiMat = invT.multiply(invT.transpose())\n  const Phi = PhiMat.toArray()\n\n  return { rotated, T: Tarr, Phi }\n}\n\n/**\n * Dispatch rotation by method name.\n * Returns rotated loadings and factor correlation matrix (Phi).\n * Phi is identity for orthogonal rotations.\n */\nfunction applyRotation(\n  loadings: number[][],\n  method: string,\n  maxIter: number,\n  tol: number,\n  geominDelta: number = 0.001,\n  randomStarts: number = 1,\n  seed: number = 42,\n  targetMatrix?: readonly (readonly number[])[],\n  targetWeight?: readonly (readonly number[])[]\n): { rotated: number[][]; Phi: number[][] } {\n  const k = loadings[0]!.length\n\n  if (method === 'none') {\n    const Phi = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n    )\n    return { rotated: loadings.map(r => [...r]), Phi }\n  }\n\n  if (method === 'varimax') {\n    const { rotated } = rotateVarimax(loadings, maxIter, tol)\n    const Phi = Array.from({ length: k }, (_, i) =>\n      Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n    )\n    return { rotated, Phi }\n  }\n\n  if (method === 'oblimin' || method === 'quartimin') {\n    const gamma = method === 'quartimin' ? 0 : 0\n    const criterionFn = (L: number[][]) => criterionOblimin(L, gamma)\n    return gpfOblqWithRandomStarts(loadings, criterionFn, maxIter, tol, k, randomStarts, seed)\n  }\n\n  if (method === 'geomin') {\n    const criterionFn = (L: number[][]) => criterionGeomin(L, geominDelta)\n    return gpfOblqWithRandomStarts(loadings, criterionFn, maxIter, tol, k, randomStarts, seed)\n  }\n\n  if (method === 'quartimax') {\n    return gpfOrthWithRandomStarts(loadings, criterionQuartimax, maxIter, tol, k, randomStarts, seed)\n  }\n\n  if (method === 'target') {\n    if (!targetMatrix) throw new Error('runEFA: target rotation requires targetMatrix')\n    const criterionFn = (L: number[][]) => criterionTarget(L, targetMatrix, targetWeight)\n    // reflect=false: column reflection can move loadings away from target and\n    // invalidate criterion values used for multi-start selection\n    return gpfOblqWithRandomStarts(loadings, criterionFn, maxIter, tol, k, randomStarts, seed, false)\n  }\n\n  if (method === 'promax') {\n    const { rotated, Phi } = rotatePromax(loadings, 4, maxIter, tol)\n    return { rotated, Phi }\n  }\n\n  throw new Error(`runEFA: unknown rotation method '${method}'`)\n}\n\n/**\n * Compute the QR start matrix: Q from QR(A^T).\n * Using T = Q as a starting rotation produces lower-triangular initial loadings,\n * matching lavaan's Cholesky-parameterized starting point.\n * This ensures the multi-start rotation explores lavaan's convergence basin.\n */\nfunction qrStartMatrix(A: number[][], k: number): number[][] | null {\n  // QR(A^T): A^T is k\u00D7p, columns of A^T = rows of A.\n  // Orthogonalize the first k columns of A^T (= first k rows of A).\n  // Q[row][col] = A^T[row][col] = A[col][row]\n  if (A.length < k) return null // not enough rows\n\n  const Q: number[][] = Array.from({ length: k }, (_, row) =>\n    Array.from({ length: k }, (_, col) => A[col]![row]!)\n  )\n\n  // Modified Gram-Schmidt on columns\n  for (let j = 0; j < k; j++) {\n    for (let prev = 0; prev < j; prev++) {\n      let dot = 0\n      for (let i = 0; i < k; i++) dot += Q[i]![j]! * Q[i]![prev]!\n      for (let i = 0; i < k; i++) Q[i]![j] = Q[i]![j]! - dot * Q[i]![prev]!\n    }\n    let norm2 = 0\n    for (let i = 0; i < k; i++) norm2 += Q[i]![j]! ** 2\n    const norm = Math.sqrt(norm2)\n    if (norm < 1e-15) return null // degenerate \u2014 first k rows not full rank\n    for (let i = 0; i < k; i++) Q[i]![j] = Q[i]![j]! / norm\n  }\n\n  return Q\n}\n\n/**\n * Run gpfOblq with optional random starting matrices.\n * Start 0 always uses T=I (deterministic, matches R/GPArotation).\n * Start 1 uses T from QR(A^T) \u2014 lower-triangular start matching lavaan.\n * Start 2 uses T from varimax \u2014 orthogonal simple-structure initialization.\n * Starts 3..randomStarts-1 use Haar-distributed random orthogonal matrices.\n * Returns the solution with the lowest criterion value.\n */\nfunction gpfOblqWithRandomStarts(\n  loadings: number[][],\n  criterionFn: (L: number[][]) => CriterionResult,\n  maxIter: number,\n  tol: number,\n  k: number,\n  randomStarts: number,\n  seed: number,\n  reflect: boolean = true\n): { rotated: number[][]; Phi: number[][] } {\n  // Start 0: T = I (always, for backward compatibility with GPArotation)\n  let best = gpfOblq(loadings, criterionFn, maxIter, tol, undefined, reflect)\n\n  // Start 1: T = Q from QR(A^T) \u2014 lower-triangular start matching lavaan\n  const Tqr = qrStartMatrix(loadings, k)\n  if (Tqr) {\n    const result = gpfOblq(loadings, criterionFn, maxIter, tol, Tqr, reflect)\n    if (result.f < best.f) best = result\n  }\n\n  // Start 2: T from varimax \u2014 varimax finds an orthogonal simple-structure\n  // solution that is often close to the geomin oblique optimum; using it as\n  // a starting point explores a basin that pure random starts may miss.\n  {\n    const vmx = rotateVarimax(loadings, maxIter, tol)\n    const result = gpfOblq(loadings, criterionFn, maxIter, tol, vmx.T, reflect)\n    if (result.f < best.f) best = result\n  }\n\n  if (randomStarts > 3) {\n    const rng = new PRNG(seed)\n    for (let s = 3; s < randomStarts; s++) {\n      const Trand = randomOrthogonalMatrix(k, rng)\n      const result = gpfOblq(loadings, criterionFn, maxIter, tol, Trand, reflect)\n      if (result.f < best.f) best = result\n    }\n  }\n\n  return { rotated: best.rotated, Phi: best.Phi }\n}\n\n/**\n * Run gpfOrth with optional random starting matrices.\n * Start 0 always uses T=I (deterministic, matches R/GPArotation).\n * Start 1 uses T from QR(A^T) \u2014 lower-triangular start.\n * Start 2 uses T from varimax \u2014 orthogonal simple-structure initialization.\n * Starts 3..randomStarts-1 use Haar-distributed random orthogonal matrices.\n * Returns the solution with the lowest criterion value.\n */\nfunction gpfOrthWithRandomStarts(\n  loadings: number[][],\n  criterionFn: (L: number[][]) => CriterionResult,\n  maxIter: number,\n  tol: number,\n  k: number,\n  randomStarts: number,\n  seed: number\n): { rotated: number[][]; Phi: number[][] } {\n  // Start 0: T = I\n  let best = gpfOrth(loadings, criterionFn, maxIter, tol)\n\n  // Start 1: T = Q from QR(A^T)\n  const Tqr = qrStartMatrix(loadings, k)\n  if (Tqr) {\n    const result = gpfOrth(loadings, criterionFn, maxIter, tol, Tqr)\n    if (result.f < best.f) best = result\n  }\n\n  // Start 2: T from varimax\n  {\n    const vmx = rotateVarimax(loadings, maxIter, tol)\n    const result = gpfOrth(loadings, criterionFn, maxIter, tol, vmx.T)\n    if (result.f < best.f) best = result\n  }\n\n  if (randomStarts > 3) {\n    const rng = new PRNG(seed)\n    for (let s = 3; s < randomStarts; s++) {\n      const Trand = randomOrthogonalMatrix(k, rng)\n      const result = gpfOrth(loadings, criterionFn, maxIter, tol, Trand)\n      if (result.f < best.f) best = result\n    }\n  }\n\n  return { rotated: best.rotated, Phi: best.Phi }\n}\n\n// \u2500\u2500\u2500 Velicer's MAP \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Velicer's Minimum Average Partial correlation test.\n * Determines the number of factors by finding the minimum average\n * squared partial correlation after extracting 0..d-1 components.\n *\n * Reference: Velicer (1976), Psychometrika 41(3):321-327\n */\nfunction velicerMAP(R: Matrix): number {\n  const d = R.rows\n  const { values, vectors } = R.eigen()\n  // values and vectors are already sorted descending by eigen()\n\n  let bestK = 0\n  let minMap = Infinity\n\n  for (let k = 0; k < d - 1; k++) {\n    // Build loading matrix L from top k+1 eigenvectors\n    const Larr: number[][] = Array.from({ length: d }, (_, i) =>\n      Array.from({ length: k + 1 }, (_, j) =>\n        vectors.get(i, j) * Math.sqrt(Math.max(values[j]!, 0))\n      )\n    )\n    const Lmat = Matrix.fromArray(Larr)\n    const R_star = R.subtract(Lmat.multiply(Lmat.transpose()))\n\n    // Convert residual to correlation\n    const C_star: number[][] = Array.from({ length: d }, (_, i) =>\n      Array.from({ length: d }, (_, j) => {\n        const denom = Math.sqrt(Math.abs(R_star.get(i, i)) * Math.abs(R_star.get(j, j)))\n        return denom > 1e-15 ? R_star.get(i, j) / denom : (i === j ? 1 : 0)\n      })\n    )\n\n    // Average squared partial correlation (off-diagonal)\n    let sumSq = 0\n    for (let r = 0; r < d; r++) {\n      for (let c = 0; c < r; c++) sumSq += C_star[r]![c]! ** 2\n    }\n    const mapVal = sumSq / (d * (d - 1) / 2)\n    if (mapVal < minMap) {\n      minMap = mapVal\n      bestK = k + 1\n    }\n  }\n  return bestK\n}\n\n// \u2500\u2500\u2500 Parallel Analysis \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Monte Carlo parallel analysis.\n * Generates random normal data matrices, computes their correlation eigenvalues,\n * and returns the 95th percentile as the threshold for factor retention.\n *\n * Reference: Horn (1965), Psychometrika 30(2):179-185\n */\nfunction parallelAnalysis(\n  observedEigenvalues: readonly number[],\n  n: number,\n  d: number,\n  iterations: number,\n  rng: PRNG\n): { simulated: readonly number[]; suggested: number } {\n  // Store all simulated eigenvalues: iterations \u00D7 d\n  const allEigens: number[][] = Array.from({ length: d }, () => new Array<number>(iterations).fill(0))\n\n  for (let iter = 0; iter < iterations; iter++) {\n    // Generate random normal data (n \u00D7 d)\n    const randomData: number[][] = Array.from({ length: n }, () =>\n      Array.from({ length: d }, () => prngNormal(rng))\n    )\n    const { R: randR } = computeCorrelationMatrix(randomData, n, d)\n    const randEig = randR.eigen().values  // sorted descending\n    for (let i = 0; i < d; i++) {\n      allEigens[i]![iter] = randEig[i]!\n    }\n  }\n\n  // 95th percentile for each eigenvalue position\n  const simulated = allEigens.map(eigArray => {\n    const sorted = [...eigArray].sort((a, b) => a - b)\n    const idx = Math.floor(0.95 * iterations)\n    return sorted[Math.min(idx, iterations - 1)]!\n  })\n\n  // Number of factors: observed > simulated threshold\n  let suggested = 0\n  for (let i = 0; i < d; i++) {\n    if (observedEigenvalues[i]! > simulated[i]!) suggested++\n    else break\n  }\n\n  return { simulated, suggested: Math.max(1, suggested) }\n}\n\n// \u2500\u2500\u2500 KMO & Bartlett \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Kaiser-Meyer-Olkin sampling adequacy and Bartlett's test of sphericity.\n *\n * KMO uses the anti-image correlation matrix.\n * Bartlett's test: \u03C7\u00B2 = -[(n-1) - (2d+5)/6] \u00D7 log|R|\n *\n * Reference:\n * - Kaiser (1974), Educational & Psychological Measurement 34:111-117\n * - Bartlett (1950), British Journal of Statistical Psychology 3:77-85\n */\nfunction computeKMOBartlett(\n  R: Matrix,\n  n: number,\n  d: number\n): { kmo: number; kmoPerItem: readonly number[]; bartlett: { chiSq: number; df: number; pValue: number } } {\n  let invR: Matrix\n  try {\n    invR = R.inverse()\n  } catch {\n    invR = R.pseudoInverse()\n  }\n\n  // Anti-image correlation: S\u00B2 R\u207B\u00B9 S\u00B2 where S\u00B2 = diag(1/R\u207B\u00B9_ii)\n  const S2diag = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    S2diag[i] = 1 / Math.max(invR.get(i, i), 1e-12)\n  }\n\n  // anti-image_ij = -R\u207B\u00B9_ij / sqrt(R\u207B\u00B9_ii \u00D7 R\u207B\u00B9_jj) for i \u2260 j\n  const antiImage: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: d }, (_, j) => {\n      if (i === j) return 1\n      return -invR.get(i, j) / Math.sqrt(Math.max(invR.get(i, i) * invR.get(j, j), 1e-12))\n    })\n  )\n\n  let rSum = 0, qSum = 0\n  const msaItems = new Float64Array(d)\n\n  for (let i = 0; i < d; i++) {\n    let rIdx = 0, qIdx = 0\n    for (let j = 0; j < d; j++) {\n      if (i === j) continue\n      rIdx += R.get(i, j) ** 2\n      qIdx += antiImage[i]![j]! ** 2\n    }\n    msaItems[i] = rIdx / Math.max(rIdx + qIdx, 1e-12)\n    rSum += rIdx\n    qSum += qIdx\n  }\n\n  const kmo = rSum / Math.max(rSum + qSum, 1e-12)\n\n  // Bartlett's test\n  let logDetR: number\n  try {\n    logDetR = R.logDet()\n  } catch {\n    const ev = R.eigen().values\n    logDetR = ev.reduce((s, v) => s + Math.log(Math.max(v, 1e-15)), 0)\n  }\n  const chiSq = -((n - 1) - (2 * d + 5) / 6) * logDetR\n  const df = d * (d - 1) / 2\n  const pValue = chiSqPValue(Math.max(chiSq, 0), df)\n\n  return {\n    kmo,\n    kmoPerItem: Array.from(msaItems),\n    bartlett: {\n      chiSq: Math.max(chiSq, 0),\n      df,\n      pValue,\n    },\n  }\n}\n\n// \u2500\u2500\u2500 Implied Covariance (for CFA) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** \u03A3 = \u039B \u03A6 \u039B' + \u0398  where \u0398 is diagonal uniquenesses */\nfunction computeImpliedCov(\n  L: number[][],\n  Phi: number[][],\n  Theta: Float64Array\n): Matrix {\n  const d = L.length\n  const k = L[0]!.length\n  const sigma: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: d }, (_, j) => {\n      let sum = 0\n      for (let f1 = 0; f1 < k; f1++) {\n        for (let f2 = 0; f2 < k; f2++) {\n          sum += L[i]![f1]! * Phi[f1]![f2]! * L[j]![f2]!\n        }\n      }\n      return sum + (i === j ? Theta[i]! : 0)\n    })\n  )\n  return Matrix.fromArray(sigma)\n}\n\n// \u2500\u2500\u2500 CFA ML Optimizer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * CFA via ML estimation with Armijo backtracking line search.\n * Estimates loadings, uniquenesses, and factor covariances simultaneously.\n *\n * Reference: Bollen (1989), Structural Equations with Latent Variables, ch. 4\n */\nfunction cfaOptimize(\n  S: Matrix,\n  model: Readonly<Record<string, readonly number[]>>,\n  d: number,\n  maxIter: number,\n  tol: number\n): {\n  L: number[][]\n  Theta: Float64Array\n  Phi: number[][]\n  converged: boolean\n  iterations: number\n} {\n  const factors = Object.keys(model)\n  const k = factors.length\n\n  // Initialize loadings\n  const L: number[][] = Array.from({ length: d }, () => new Array<number>(k).fill(0))\n  const Theta = new Float64Array(d).fill(0.5)\n  const Phi: number[][] = Array.from({ length: k }, (_, i) =>\n    Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n  )\n\n  // Set initial loadings to 0.7 for specified items\n  factors.forEach((f, c) => {\n    const items = model[f]!\n    for (const r of items) {\n      if (r < d) L[r]![c] = 0.7\n    }\n  })\n\n  let converged = false\n  let iter = 0\n  const c1 = 1e-4  // Armijo sufficient decrease parameter\n\n  /** Wishart ML discrepancy */\n  function objective(Lc: number[][], Phic: number[][], Thetac: Float64Array): number {\n    const Sigma = computeImpliedCov(Lc, Phic, Thetac)\n    let logDetSigma: number\n    try {\n      logDetSigma = Sigma.logDet()\n    } catch {\n      return 1e10\n    }\n    let logDetS: number\n    try {\n      logDetS = S.logDet()\n    } catch {\n      return 1e10\n    }\n    let trVal: number\n    try {\n      trVal = Sigma.inverse().multiply(S).trace()\n    } catch {\n      return 1e10\n    }\n    return Math.max(0, logDetSigma + trVal - logDetS - d)\n  }\n\n  for (iter = 0; iter < maxIter; iter++) {\n    const Sigma = computeImpliedCov(L, Phi, Theta)\n\n    let invSigma: Matrix\n    try {\n      invSigma = Sigma.inverse()\n    } catch {\n      try {\n        invSigma = Sigma.pseudoInverse()\n      } catch {\n        break\n      }\n    }\n\n    // Delta = \u03A3\u207B\u00B9(\u03A3 - S)\u03A3\u207B\u00B9\n    const Delta = invSigma.multiply(Sigma.subtract(S)).multiply(invSigma)\n\n    // Gradient w.r.t. loadings: dF/d\u039B = 2\u0394\u039B\u03A6\n    const LMat = Matrix.fromArray(L)\n    const PhiMat = Matrix.fromArray(Phi)\n    const gL = Delta.multiply(LMat).multiply(PhiMat).scale(2)\n\n    // Gradient w.r.t. factor covariances: dF/d\u03A6 = \u039B'\u0394\u039B\n    const gPhi = LMat.transpose().multiply(Delta).multiply(LMat)\n\n    const currentLoss = objective(L, Phi, Theta)\n    let alpha = 1.0\n    let armijoSatisfied = false\n\n    while (!armijoSatisfied && alpha > 1e-6) {\n      let maxGrad = 0\n      let dirDotGrad = 0\n\n      // Trial update loadings\n      const nextL: number[][] = Array.from({ length: d }, () => new Array<number>(k).fill(0))\n      factors.forEach((f, c) => {\n        for (const r of model[f]!) {\n          if (r >= d) continue\n          const grad = gL.get(r, c)\n          maxGrad = Math.max(maxGrad, Math.abs(grad))\n          nextL[r]![c] = L[r]![c]! - alpha * grad\n          dirDotGrad += grad * (-grad)\n        }\n      })\n\n      // Trial update uniquenesses\n      const nextTheta = new Float64Array(d)\n      for (let i = 0; i < d; i++) {\n        const grad = Delta.get(i, i)\n        maxGrad = Math.max(maxGrad, Math.abs(grad))\n        nextTheta[i] = Math.max(0.001, Theta[i]! - alpha * grad)\n        dirDotGrad += grad * (-grad)\n      }\n\n      // Trial update factor covariances\n      const nextPhi: number[][] = Array.from({ length: k }, (_, i) =>\n        Array.from({ length: k }, (_, j) => (i === j ? 1 : 0))\n      )\n      for (let r = 0; r < k; r++) {\n        for (let c = 0; c < r; c++) {\n          const grad = gPhi.get(r, c) + gPhi.get(c, r)\n          maxGrad = Math.max(maxGrad, Math.abs(grad))\n          const updated = Math.max(-0.99, Math.min(0.99, Phi[r]![c]! - alpha * grad))\n          nextPhi[r]![c] = updated\n          nextPhi[c]![r] = updated\n          dirDotGrad += grad * (-grad)\n        }\n      }\n\n      if (maxGrad < tol) {\n        converged = true\n        break\n      }\n\n      const nextLoss = objective(nextL, nextPhi, nextTheta)\n\n      if (nextLoss <= currentLoss + c1 * alpha * dirDotGrad) {\n        armijoSatisfied = true\n        // Accept update\n        for (let i = 0; i < d; i++) {\n          for (let j = 0; j < k; j++) L[i]![j] = nextL[i]![j]!\n          Theta[i] = nextTheta[i]!\n        }\n        for (let i = 0; i < k; i++) {\n          for (let j = 0; j < k; j++) Phi[i]![j] = nextPhi[i]![j]!\n        }\n      } else {\n        alpha *= 0.5\n      }\n    }\n\n    if (converged) break\n    if (!armijoSatisfied) break  // line search failed\n  }\n\n  return { L, Theta, Phi, converged, iterations: iter }\n}\n\n// \u2500\u2500\u2500 Fisher Information for CFA Standard Errors \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute standard errors for CFA parameters using the expected information matrix.\n * SE = sqrt( 2/(n-1) * diag(I\u207B\u00B9) ) where I is the Fisher information.\n *\n * We use the sandwich-form observed information:\n * I_\u03B8\u03B8' = (n-1)/2 * (\u2202\u03C3/\u2202\u03B8)' (\u03A3\u207B\u00B9 \u2297 \u03A3\u207B\u00B9) (\u2202\u03C3/\u2202\u03B8)\n *\n * For simplicity, we use numerical differentiation of the gradient.\n */\nfunction cfaStandardErrors(\n  L: number[][],\n  Phi: number[][],\n  Theta: Float64Array,\n  S: Matrix,\n  model: Readonly<Record<string, readonly number[]>>,\n  n: number,\n  d: number\n): {\n  loadingSE: number[][]\n  thetaSE: Float64Array\n  phiSE: number[][]\n} {\n  const factors = Object.keys(model)\n  const k = factors.length\n\n  // Collect free parameters into a vector\n  const params: { type: 'loading' | 'theta' | 'phi'; i: number; j: number }[] = []\n  factors.forEach((f, c) => {\n    for (const r of model[f]!) {\n      if (r < d) params.push({ type: 'loading', i: r, j: c })\n    }\n  })\n  for (let i = 0; i < d; i++) params.push({ type: 'theta', i, j: 0 })\n  for (let r = 0; r < k; r++) {\n    for (let c = 0; c < r; c++) params.push({ type: 'phi', i: r, j: c })\n  }\n\n  const nParams = params.length\n\n  // Helper: get/set parameter value\n  function getParam(idx: number): number {\n    const p = params[idx]!\n    if (p.type === 'loading') return L[p.i]![p.j]!\n    if (p.type === 'theta') return Theta[p.i]!\n    return Phi[p.i]![p.j]!\n  }\n\n  function setParam(idx: number, val: number): void {\n    const p = params[idx]!\n    if (p.type === 'loading') L[p.i]![p.j] = val\n    else if (p.type === 'theta') Theta[p.i] = val\n    else { Phi[p.i]![p.j] = val; Phi[p.j]![p.i] = val }\n  }\n\n  // Compute objective at current parameters\n  function obj(): number {\n    const Sigma = computeImpliedCov(L, Phi, Theta)\n    try {\n      const logDetSig = Sigma.logDet()\n      const logDetS = S.logDet()\n      const tr = Sigma.inverse().multiply(S).trace()\n      return Math.max(0, logDetSig + tr - logDetS - d)\n    } catch {\n      return 1e10\n    }\n  }\n\n  // Numerical Hessian via central finite differences\n  const h = 1e-4\n  const hessian: number[][] = Array.from({ length: nParams }, () =>\n    new Array<number>(nParams).fill(0)\n  )\n\n  for (let i = 0; i < nParams; i++) {\n    for (let j = i; j < nParams; j++) {\n      const vi = getParam(i)\n      const vj = getParam(j)\n\n      if (i === j) {\n        // Diagonal: f(x+h) - 2f(x) + f(x-h) / h\u00B2\n        setParam(i, vi + h)\n        const fPlus = obj()\n        setParam(i, vi - h)\n        const fMinus = obj()\n        setParam(i, vi)\n        const f0 = obj()\n        hessian[i]![i] = (fPlus - 2 * f0 + fMinus) / (h * h)\n      } else {\n        // Off-diagonal\n        setParam(i, vi + h); setParam(j, vj + h)\n        const fpp = obj()\n        setParam(i, vi + h); setParam(j, vj - h)\n        const fpm = obj()\n        setParam(i, vi - h); setParam(j, vj + h)\n        const fmp = obj()\n        setParam(i, vi - h); setParam(j, vj - h)\n        const fmm = obj()\n        setParam(i, vi); setParam(j, vj)\n\n        hessian[i]![j] = (fpp - fpm - fmp + fmm) / (4 * h * h)\n        hessian[j]![i] = hessian[i]![j]!\n      }\n    }\n  }\n\n  // Information matrix = (n-1)/2 * Hessian\n  const infoArr: number[][] = hessian.map(row =>\n    row.map(v => ((n - 1) / 2) * v)\n  )\n\n  // Invert to get variance-covariance of estimates\n  let covMat: Matrix\n  try {\n    covMat = Matrix.fromArray(infoArr).inverse()\n  } catch {\n    try {\n      covMat = Matrix.fromArray(infoArr).pseudoInverse()\n    } catch {\n      // Fallback: return rough SEs\n      const loadingSE = Array.from({ length: d }, () => new Array<number>(k).fill(0.05))\n      const thetaSE = new Float64Array(d).fill(0.05)\n      const phiSE = Array.from({ length: k }, () => new Array<number>(k).fill(0.05))\n      return { loadingSE, thetaSE, phiSE }\n    }\n  }\n\n  // Extract SEs\n  const loadingSE: number[][] = Array.from({ length: d }, () => new Array<number>(k).fill(0))\n  const thetaSE = new Float64Array(d)\n  const phiSE: number[][] = Array.from({ length: k }, () => new Array<number>(k).fill(0))\n\n  for (let idx = 0; idx < nParams; idx++) {\n    const variance = Math.max(covMat.get(idx, idx), 0)\n    const se = Math.sqrt(variance)\n    const p = params[idx]!\n    if (p.type === 'loading') loadingSE[p.i]![p.j] = se\n    else if (p.type === 'theta') thetaSE[p.i] = se\n    else phiSE[p.i]![p.j] = se\n  }\n\n  return { loadingSE, thetaSE, phiSE }\n}\n\n// \u2500\u2500\u2500 Public API: runFADiagnostics \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute factor analysis diagnostics: KMO, Bartlett's test,\n * Velicer's MAP, and parallel analysis.\n *\n * Cross-validated with R:\n * > library(psych)\n * > KMO(data)\n * > cortest.bartlett(cor(data), n = nrow(data))\n * > fa.parallel(data, fm = \"ml\", fa = \"fa\")\n */\nexport function runFADiagnostics(\n  data: readonly (readonly number[])[],\n  options?: FADiagnosticsOptions\n): FADiagnostics {\n  const n = data.length\n  if (n < 3) throw new Error('runFADiagnostics: need at least 3 observations')\n  const d = data[0]!.length\n  if (d < 2) throw new Error('runFADiagnostics: need at least 2 variables')\n\n  const seed = options?.seed ?? 42\n  const iterations = options?.parallelIterations ?? 100\n  const rng = new PRNG(seed)\n\n  const { R } = computeCorrelationMatrix(data, n, d)\n\n  // KMO & Bartlett\n  const { kmo, kmoPerItem, bartlett } = computeKMOBartlett(R, n, d)\n\n  // Eigenvalues of correlation matrix (for scree and parallel analysis)\n  const eigenvalues = R.eigen().values  // sorted descending\n\n  // Parallel Analysis\n  const { simulated, suggested: parallelSuggested } = parallelAnalysis(\n    eigenvalues, n, d, iterations, rng\n  )\n\n  // Velicer's MAP\n  const mapSuggested = velicerMAP(R)\n\n  return {\n    kmo,\n    kmoPerItem,\n    bartlett,\n    mapSuggested,\n    parallelEigenvalues: [...eigenvalues],\n    parallelSimulated: [...simulated],\n    parallelSuggested,\n  }\n}\n\n// \u2500\u2500\u2500 Public API: runEFA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Exploratory Factor Analysis with extraction (PAF or ML) and rotation.\n *\n * Cross-validated with R:\n * > library(psych)\n * > fa(data, nfactors = 3, fm = \"ml\", rotate = \"promax\")\n * > fa(data, nfactors = 3, fm = \"minres\", rotate = \"varimax\")\n */\nexport function runEFA(\n  data: readonly (readonly number[])[],\n  options?: EFAOptions\n): FAResult {\n  const n = data.length\n  if (n < 3) throw new Error('runEFA: need at least 3 observations')\n  const d = data[0]!.length\n  if (d < 2) throw new Error('runEFA: need at least 2 variables')\n\n  const extraction = options?.extraction ?? 'ml'\n  const rotation = options?.rotation ?? 'promax'\n  const geominDelta = options?.geominDelta ?? 0.001\n  const maxIter = options?.maxIter ?? 1000\n  const tol = options?.tol ?? 1e-6\n  const seed = options?.seed ?? 42\n  const randomStarts = options?.randomStarts ?? 50\n\n  const { R } = computeCorrelationMatrix(data, n, d)\n  const eigenvalues = R.eigen().values  // sorted descending\n\n  // Determine number of factors\n  let nFactors = options?.nFactors\n  if (nFactors === undefined) {\n    const rng = new PRNG(seed)\n    const { suggested } = parallelAnalysis(eigenvalues, n, d, 100, rng)\n    nFactors = suggested\n  }\n  if (nFactors < 1) throw new Error('runEFA: nFactors must be at least 1')\n  if (nFactors >= d) throw new Error('runEFA: nFactors must be less than number of variables')\n\n  // Validate target rotation\n  if (rotation === 'target') {\n    if (!options?.targetMatrix) {\n      throw new Error('runEFA: target rotation requires targetMatrix (p \u00D7 k)')\n    }\n    if (options.targetMatrix.length !== d) {\n      throw new Error(`runEFA: targetMatrix must have ${d} rows (one per variable), got ${options.targetMatrix.length}`)\n    }\n    if (options.targetMatrix[0]!.length !== nFactors) {\n      throw new Error(`runEFA: targetMatrix must have ${nFactors} columns (one per factor), got ${options.targetMatrix[0]!.length}`)\n    }\n    if (options.targetWeight) {\n      if (options.targetWeight.length !== d || options.targetWeight[0]!.length !== nFactors) {\n        throw new Error(`runEFA: targetWeight dimensions must match targetMatrix (${d} \u00D7 ${nFactors})`)\n      }\n    }\n  }\n\n  // Extract\n  const extracted = extraction === 'ml'\n    ? extractML(R, nFactors, maxIter, tol)\n    : extractPAF(R, nFactors, maxIter, tol)\n\n  // Model-implied standardization (matches lavaan's std.ov=TRUE default)\n  // lavaan rotates standardized loadings: A = \u039B / sqrt(ov_var), where\n  // ov_var_i = h\u00B2_i + \u03C8_i (model-implied variance per variable).\n  // For a correlation matrix input, ov_var \u2248 1.0 but not exactly.\n  // The per-variable deviation from 1.0 gives each row a different weight\n  // in the geomin criterion, shifting which basin GPA enters.\n  const ovVar = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    let h2 = 0\n    for (let j = 0; j < nFactors; j++) h2 += extracted.loadings[i]![j]! ** 2\n    // \u03C8_i = 1 - h\u00B2 for correlation matrix (uniqueness from extraction)\n    const psi = 1 - Math.min(h2, 0.999)\n    ovVar[i] = h2 + psi  // should \u2248 1.0 for correlation matrix\n  }\n\n  // Standardize by model-implied SD before rotation\n  const loadingsForRotation = extracted.loadings.map((row, i) => {\n    const scale = Math.sqrt(ovVar[i]!)\n    return row.map(v => v / scale)\n  })\n\n  // Standardize target matrix alongside loadings (same scale transformation)\n  let targetForRotation: readonly (readonly number[])[] | undefined\n  if (options?.targetMatrix) {\n    targetForRotation = options.targetMatrix.map((row, i) => {\n      const scale = Math.sqrt(ovVar[i]!)\n      return row.map(v => v / scale)\n    })\n  }\n\n  const { rotated: rotatedStd, Phi } = applyRotation(\n    loadingsForRotation, rotation, maxIter, tol, geominDelta, randomStarts, seed,\n    targetForRotation, options?.targetWeight\n  )\n\n  // De-standardize after rotation (restore original scale)\n  const rotated = rotatedStd.map((row, i) => {\n    const scale = Math.sqrt(ovVar[i]!)\n    return row.map(v => v * scale)\n  })\n\n  // Compute communalities and uniqueness from rotated solution + Phi\n  const communalities = new Float64Array(d)\n  const uniqueness = new Float64Array(d)\n  for (let i = 0; i < d; i++) {\n    let comm = 0\n    for (let f1 = 0; f1 < nFactors; f1++) {\n      for (let f2 = 0; f2 < nFactors; f2++) {\n        comm += rotated[i]![f1]! * Phi[f1]![f2]! * rotated[i]![f2]!\n      }\n    }\n    communalities[i] = Math.max(0.001, Math.min(0.9999, comm))\n    uniqueness[i] = 1 - communalities[i]!\n  }\n\n  // Build implied covariance for fit statistics\n  const thetaArr = new Float64Array(d)\n  for (let i = 0; i < d; i++) thetaArr[i] = Math.max(0.001, uniqueness[i]!)\n  const impliedSigma = computeImpliedCov(rotated, Phi, thetaArr)\n\n  // Count free parameters for EFA df calculation\n  // In EFA, the unrotated ML solution has k(k-1)/2 identification constraints\n  // (Anderson\u2013Rubin conditions), so free params = loadings + uniquenesses - constraints.\n  // Rotation is post-hoc and does not affect the chi-square test df.\n  const nLoadingParams = d * nFactors\n  const nUniqueParams = d\n  const nRotationConstraints = nFactors * (nFactors - 1) / 2\n  const nFreeParams = nLoadingParams + nUniqueParams - nRotationConstraints\n\n  const fit = computeFit(R, impliedSigma, n, d, nFreeParams, nFactors)\n\n  // Standardized loadings: \u03BB_std = \u03BB * sqrt(\u03C6_jj) / sqrt(\u03C3_ii)\n  const stdLoadings: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: nFactors }, (_, j) => {\n      const sigmaII = impliedSigma.get(i, i)\n      return rotated[i]![j]! * Math.sqrt(Phi[j]![j]!) / Math.sqrt(Math.max(sigmaII, 1e-12))\n    })\n  )\n\n  // Variable and factor names\n  const variableNames = options?.variableNames\n    ?? Array.from({ length: d }, (_, i) => `V${i + 1}`)\n  const factorNames = Array.from({ length: nFactors }, (_, i) => `F${i + 1}`)\n\n  const formatted = `EFA (${extraction}/${rotation}): ${formatCFAFit(fit)}`\n\n  return {\n    loadings: rotated,\n    standardizedLoadings: stdLoadings,\n    uniqueness: Array.from(uniqueness),\n    communalities: Array.from(communalities),\n    factorCorrelations: Phi,\n    fit,\n    eigenvalues: [...eigenvalues],\n    nFactors,\n    rotation,\n    extraction,\n    variableNames,\n    factorNames,\n    formatted,\n  }\n}\n\n// \u2500\u2500\u2500 Public API: runCFA \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Confirmatory Factor Analysis via ML estimation.\n *\n * Model is specified as a record: { F1: [0, 1, 2], F2: [3, 4, 5] }\n * where keys are factor names and values are 0-indexed item indices.\n *\n * Cross-validated with R:\n * > library(lavaan)\n * > model <- 'F1 =~ x1 + x2 + x3\\n F2 =~ x4 + x5 + x6'\n * > fit <- cfa(model, data)\n * > standardizedSolution(fit)\n * > fitMeasures(fit, c(\"chisq\", \"df\", \"pvalue\", \"rmsea\", \"cfi\", \"tli\", \"srmr\"))\n */\nexport function runCFA(\n  data: readonly (readonly number[])[],\n  model: Readonly<Record<string, readonly number[]>>,\n  options?: CFAOptions\n): CFAResult {\n  const n = data.length\n  if (n < 3) throw new Error('runCFA: need at least 3 observations')\n  const d = data[0]!.length\n  if (d < 2) throw new Error('runCFA: need at least 2 variables')\n\n  const factors = Object.keys(model)\n  const k = factors.length\n  if (k < 1) throw new Error('runCFA: model must specify at least 1 factor')\n\n  const maxIter = options?.maxIter ?? 1000\n  const tolVal = options?.tol ?? 1e-6\n\n  const { R: S } = computeCorrelationMatrix(data, n, d)\n\n  // Optimize CFA\n  const { L, Theta, Phi } = cfaOptimize(S, model, d, maxIter, tolVal)\n\n  // Implied covariance\n  const impliedSigma = computeImpliedCov(L, Phi, Theta)\n\n  // Count free parameters for df calculation\n  let nLoadingParams = 0\n  factors.forEach((f) => { nLoadingParams += model[f]!.length })\n  const nUniqueParams = d\n  const nCovParams = k * (k - 1) / 2\n  const nFreeParams = nLoadingParams + nUniqueParams + nCovParams\n\n  const fit = computeFit(S, impliedSigma, n, d, nFreeParams)\n\n  // Standard errors\n  // Make deep copies for SE computation (it mutates L/Phi/Theta temporarily)\n  const Lcopy: number[][] = L.map(r => [...r])\n  const Phicopy: number[][] = Phi.map(r => [...r])\n  const Thetacopy = new Float64Array(Theta)\n  const { loadingSE, thetaSE, phiSE } = cfaStandardErrors(\n    Lcopy, Phicopy, Thetacopy, S, model, n, d\n  )\n\n  // Build parameter estimates\n  const paramLoadings: ParameterEstimate[][] = factors.map((f, c) =>\n    model[f]!.map((r) => {\n      if (r >= d) {\n        return { estimate: 0, se: 0, z: 0, pValue: 1, stdAll: 0 }\n      }\n      const est = L[r]![c]!\n      const se = Math.max(loadingSE[r]![c]!, 1e-6)\n      const z = est / se\n      const pValue = 2 * (1 - normalCDF(Math.abs(z)))\n      const sigmaII = Math.max(impliedSigma.get(r, r), 1e-12)\n      const stdAll = est * Math.sqrt(Phi[c]![c]!) / Math.sqrt(sigmaII)\n      return { estimate: roundTo(est, 4), se: roundTo(se, 4), z: roundTo(z, 3), pValue: roundTo(pValue, 4), stdAll: roundTo(stdAll, 4) }\n    })\n  )\n\n  const paramUniqueness: ParameterEstimate[] = Array.from(Theta).map((est, i) => {\n    const se = Math.max(thetaSE[i]!, 1e-6)\n    const z = est / se\n    const pValue = 2 * (1 - normalCDF(Math.abs(z)))\n    const sigmaII = Math.max(impliedSigma.get(i, i), 1e-12)\n    const stdAll = est / sigmaII\n    return { estimate: roundTo(est, 4), se: roundTo(se, 4), z: roundTo(z, 3), pValue: roundTo(pValue, 4), stdAll: roundTo(stdAll, 4) }\n  })\n\n  const paramCov: ParameterEstimate[][] = Array.from({ length: k }, (_, r) =>\n    Array.from({ length: k }, (_, c) => {\n      if (r === c) {\n        return { estimate: 1, se: 0, z: Infinity, pValue: 0, stdAll: 1 }\n      }\n      const est = Phi[r]![c]!\n      const se = Math.max(phiSE[r]![c]! || phiSE[c]![r]!, 1e-6)\n      const z = est / se\n      const pValue = 2 * (1 - normalCDF(Math.abs(z)))\n      return { estimate: roundTo(est, 4), se: roundTo(se, 4), z: roundTo(z, 3), pValue: roundTo(pValue, 4), stdAll: roundTo(est, 4) }\n    })\n  )\n\n  // Communalities and uniqueness\n  const communalities = Array.from(Theta).map(t => roundTo(1 - t, 4))\n  const uniquenessArr = Array.from(Theta).map(t => roundTo(t, 4))\n\n  // Standardized loadings\n  const stdLoadings: number[][] = Array.from({ length: d }, (_, i) =>\n    Array.from({ length: k }, (_, j) => {\n      const sigmaII = Math.max(impliedSigma.get(i, i), 1e-12)\n      return roundTo(L[i]![j]! * Math.sqrt(Phi[j]![j]!) / Math.sqrt(sigmaII), 4)\n    })\n  )\n\n  // Eigenvalues of correlation matrix\n  const eigenvalues = S.eigen().values.map(v => roundTo(v, 4))\n\n  const variableNames = options?.variableNames\n    ?? Array.from({ length: d }, (_, i) => `V${i + 1}`)\n  const factorNames = options?.factorNames ?? factors\n\n  const formatted = `CFA: ${formatCFAFit(fit)}`\n\n  return {\n    loadings: L,\n    standardizedLoadings: stdLoadings,\n    uniqueness: uniquenessArr,\n    communalities,\n    factorCorrelations: Phi,\n    fit,\n    eigenvalues,\n    nFactors: k,\n    rotation: 'none',\n    extraction: 'ml',\n    variableNames,\n    factorNames,\n    formatted,\n    parameterEstimates: {\n      loadings: paramLoadings,\n      uniquenesses: paramUniqueness,\n      factorCovariances: paramCov,\n    },\n    model,\n  }\n}\n", "/**\n * Bootstrap confidence interval estimation.\n * Percentile and BCa methods with seeded PRNG for reproducibility.\n */\n\nimport { quantile, normalQuantile, normalCDF, mean as _mean } from '../core/math.js'\nimport { PRNG } from '../core/prng.js'\nimport { formatStat, formatCI } from '../core/apa.js'\nimport type { BootstrapCIResult } from '../core/types.js'\n\n/**\n * Bootstrap CI for a single-sample statistic.\n * @param data       Input data array\n * @param statFn     Function that computes the statistic from a data array\n * @param options    { nBoot, ciLevel, method, seed }\n *\n * Cross-validated with R:\n * > library(boot)\n * > b <- boot(data, function(d,i) mean(d[i]), R=2000)\n * > boot.ci(b, type=\"perc\")\n * > boot.ci(b, type=\"bca\")\n */\nexport function bootstrapCI(\n  data: readonly number[],\n  statFn: (d: readonly number[]) => number,\n  options?: {\n    readonly nBoot?: number\n    readonly ciLevel?: number\n    readonly method?: 'percentile' | 'bca'\n    readonly seed?: number\n  }\n): BootstrapCIResult {\n  const nBoot = options?.nBoot ?? 2000\n  const ciLevel = options?.ciLevel ?? 0.95\n  const method = options?.method ?? 'percentile'\n  const seed = options?.seed ?? 42\n  const n = data.length\n  if (n === 0) throw new Error('bootstrapCI: empty data')\n\n  const rng = new PRNG(seed)\n  const estimate = statFn(data)\n\n  // Generate bootstrap replicates\n  const bootStats: number[] = []\n  const sample = new Array<number>(n)\n  for (let b = 0; b < nBoot; b++) {\n    for (let i = 0; i < n; i++) {\n      sample[i] = data[Math.floor(rng.next() * n)]!\n    }\n    bootStats.push(statFn(sample))\n  }\n  bootStats.sort((a, b) => a - b)\n\n  const bootMean = _mean(bootStats)\n  const se = Math.sqrt(bootStats.reduce((s, v) => s + (v - bootMean) ** 2, 0) / (nBoot - 1))\n  const alpha = 1 - ciLevel\n\n  let ci: readonly [number, number]\n  if (method === 'bca') {\n    // BCa: bias-correction and acceleration\n    // z0 = Phi^-1(proportion of boot stats < estimate)\n    const nBelow = bootStats.filter(v => v < estimate).length\n    const z0 = normalQuantile(Math.max(0.0001, Math.min(0.9999, nBelow / nBoot)))\n\n    // acceleration: jackknife\n    const jackStats: number[] = []\n    for (let i = 0; i < n; i++) {\n      const jk = [...data.slice(0, i), ...data.slice(i + 1)]\n      jackStats.push(statFn(jk))\n    }\n    const jkMean = _mean(jackStats)\n    let num3 = 0, denom2 = 0\n    for (const j of jackStats) {\n      const diff = jkMean - j\n      num3 += diff ** 3\n      denom2 += diff ** 2\n    }\n    const acc = denom2 > 0 ? num3 / (6 * Math.pow(denom2, 1.5)) : 0\n\n    // Adjusted percentiles\n    const zAlpha = normalQuantile(alpha / 2)\n    const zUpper = normalQuantile(1 - alpha / 2)\n    const a1 = normalCDF(z0 + (z0 + zAlpha) / (1 - acc * (z0 + zAlpha)))\n    const a2 = normalCDF(z0 + (z0 + zUpper) / (1 - acc * (z0 + zUpper)))\n\n    const lo = quantile(bootStats, Math.max(0, Math.min(1, a1)))\n    const hi = quantile(bootStats, Math.max(0, Math.min(1, a2)))\n    ci = [lo, hi]\n  } else {\n    // Percentile method\n    ci = [\n      quantile(bootStats, alpha / 2),\n      quantile(bootStats, 1 - alpha / 2),\n    ]\n  }\n\n  const ciPct = Math.round(ciLevel * 100)\n  const formatted = `estimate = ${formatStat(estimate)}, ${ciPct}% CI ${formatCI(ci)}, SE_boot = ${formatStat(se)}`\n\n  return { estimate, ci, se, ciLevel, nBoot, method, formatted }\n}\n\n/**\n * Bootstrap CI for a two-sample statistic.\n * @param x1       First sample\n * @param x2       Second sample\n * @param statFn   Function that computes the statistic from two data arrays\n * @param options  { nBoot, ciLevel, seed }\n *\n * Cross-validated with R:\n * > library(boot)\n * > b <- boot(cbind(x1,x2), function(d,i) mean(d[i,1])-mean(d[i,2]), R=2000)\n * > boot.ci(b, type=\"perc\")\n */\nexport function bootstrapCITwoSample(\n  x1: readonly number[],\n  x2: readonly number[],\n  statFn: (a: readonly number[], b: readonly number[]) => number,\n  options?: {\n    readonly nBoot?: number\n    readonly ciLevel?: number\n    readonly seed?: number\n  }\n): BootstrapCIResult {\n  const nBoot = options?.nBoot ?? 2000\n  const ciLevel = options?.ciLevel ?? 0.95\n  const seed = options?.seed ?? 42\n  const n1 = x1.length, n2 = x2.length\n  if (n1 === 0 || n2 === 0) throw new Error('bootstrapCITwoSample: empty sample')\n\n  const rng = new PRNG(seed)\n  const estimate = statFn(x1, x2)\n\n  const bootStats: number[] = []\n  const s1 = new Array<number>(n1)\n  const s2 = new Array<number>(n2)\n  for (let b = 0; b < nBoot; b++) {\n    for (let i = 0; i < n1; i++) s1[i] = x1[Math.floor(rng.next() * n1)]!\n    for (let i = 0; i < n2; i++) s2[i] = x2[Math.floor(rng.next() * n2)]!\n    bootStats.push(statFn(s1, s2))\n  }\n  bootStats.sort((a, b) => a - b)\n\n  const bootMean = _mean(bootStats)\n  const se = Math.sqrt(bootStats.reduce((s, v) => s + (v - bootMean) ** 2, 0) / (nBoot - 1))\n  const alpha = 1 - ciLevel\n  const ci: readonly [number, number] = [\n    quantile(bootStats, alpha / 2),\n    quantile(bootStats, 1 - alpha / 2),\n  ]\n\n  const ciPct = Math.round(ciLevel * 100)\n  const formatted = `estimate = ${formatStat(estimate)}, ${ciPct}% CI ${formatCI(ci)}, SE_boot = ${formatStat(se)}`\n\n  return { estimate, ci, se, ciLevel, nBoot, method: 'percentile', formatted }\n}\n", "/**\n * Default (light) theme for Carm visualizations.\n * Modern palette inspired by Tableau / Observable Plot design language.\n * Clean typography + generous whitespace + beautiful colors.\n */\n\n/**\n * Carm modern palette \u2014 8 perceptually distinct, visually beautiful colors.\n * Based on Tableau 10 (gold standard qualitative palette) with the pale yellow\n * replaced by dusty mauve for better legibility on white backgrounds.\n */\nexport const CARM_PALETTE = [\n  '#4e79a7',  // cornflower blue\n  '#f28e2b',  // amber orange\n  '#e15759',  // soft crimson\n  '#76b7b2',  // dusty teal\n  '#59a14f',  // forest green\n  '#af7aa1',  // dusty mauve\n  '#ff9da7',  // rose pink\n  '#9c755f',  // warm umber\n] as const\n\n/** @deprecated Use CARM_PALETTE. Kept for backwards compatibility. */\nexport const OKABE_ITO = CARM_PALETTE\n\nexport type ThemeName = 'light' | 'dark'\n\nexport interface CarmTheme {\n  readonly background: string\n  readonly surface: string\n  readonly text: string\n  readonly textMuted: string\n  readonly textAnnotation: string\n  readonly gridLine: string\n  readonly axisLine: string\n  readonly colors: readonly string[]\n  readonly fontFamily: string\n  readonly fontFamilyMono: string\n  readonly fontSize: number\n  readonly fontSizeSmall: number\n  readonly fontSizeTitle: number\n  readonly marginTop: number\n  readonly marginRight: number\n  readonly marginBottom: number\n  readonly marginLeft: number\n  readonly pointOpacity: number\n  readonly violinOpacity: number\n  readonly ciOpacity: number\n}\n\nexport const DEFAULT_THEME: CarmTheme = {\n  background: '#ffffff',\n  surface: '#f8f9fa',\n  text: '#1a1a2e',\n  textMuted: '#6c757d',\n  textAnnotation: '#495057',\n  gridLine: '#eaeef3',\n  axisLine: '#c4cdd6',\n  colors: CARM_PALETTE,\n  fontFamily: \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif\",\n  fontFamilyMono: \"'JetBrains Mono', 'Fira Code', 'Cascadia Code', Menlo, Consolas, monospace\",\n  fontSize: 12,\n  fontSizeSmall: 11,\n  fontSizeTitle: 16,\n  marginTop: 58,\n  marginRight: 32,\n  marginBottom: 84,\n  marginLeft: 64,\n  pointOpacity: 0.55,\n  violinOpacity: 0.72,\n  ciOpacity: 0.15,\n}\n\nexport const DARK_THEME: CarmTheme = {\n  ...DEFAULT_THEME,\n  background: '#14142b',\n  surface: '#1e1e3f',\n  text: '#e9ecef',\n  textMuted: '#9aa5b1',\n  textAnnotation: '#ced4da',\n  gridLine: '#252548',\n  axisLine: '#3d3d6b',\n}\n\n/** Inject CSS custom properties into a container element. */\nexport function applyTheme(container: HTMLElement, theme: CarmTheme = DEFAULT_THEME): void {\n  const vars: Record<string, string> = {\n    '--js-bg': theme.background,\n    '--js-surface': theme.surface,\n    '--js-text': theme.text,\n    '--js-text-muted': theme.textMuted,\n    '--js-text-annotation': theme.textAnnotation,\n    '--js-grid': theme.gridLine,\n    '--js-axis': theme.axisLine,\n    '--js-font': theme.fontFamily,\n    '--js-font-mono': theme.fontFamilyMono,\n    '--js-font-size': `${theme.fontSize}px`,\n    '--js-font-size-sm': `${theme.fontSizeSmall}px`,\n    '--js-font-size-title': `${theme.fontSizeTitle}px`,\n  }\n  theme.colors.forEach((c, i) => { vars[`--js-color-${i}`] = c })\n  for (const [k, v] of Object.entries(vars)) {\n    container.style.setProperty(k, v)\n  }\n  container.style.background = theme.background\n}\n\n/** Get a color from the palette by index (wraps around). */\nexport function getColor(index: number, theme: CarmTheme = DEFAULT_THEME): string {\n  return theme.colors[index % theme.colors.length]!\n}\n\n/** D3-compatible color scale from theme palette. */\nexport function themeColorScale(theme: CarmTheme = DEFAULT_THEME): (i: number) => string {\n  return (i: number) => getColor(i, theme)\n}\n", "/**\n * Hover tooltip component.\n * Shows a floating tooltip near the cursor with formatted content.\n */\n\nimport type { CarmTheme } from '../themes/default.js'\nimport { DEFAULT_THEME } from '../themes/default.js'\n\nlet tooltipEl: HTMLDivElement | null = null\n\nfunction ensureTooltip(): HTMLDivElement {\n  if (!tooltipEl) {\n    tooltipEl = document.createElement('div')\n    tooltipEl.id = 'carm-tooltip'\n    tooltipEl.style.cssText = `\n      position: fixed;\n      pointer-events: none;\n      z-index: 9999;\n      padding: 8px 12px;\n      border-radius: 6px;\n      font-size: 12px;\n      line-height: 1.5;\n      max-width: 240px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      opacity: 0;\n      transition: opacity 0.15s ease;\n    `\n    document.body.appendChild(tooltipEl)\n  }\n  return tooltipEl\n}\n\nexport function showTooltip(\n  event: MouseEvent,\n  content: string,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  const el = ensureTooltip()\n  el.innerHTML = content\n  el.style.background = theme.surface\n  el.style.color = theme.text\n  el.style.border = `1px solid ${theme.gridLine}`\n  el.style.fontFamily = theme.fontFamily\n\n  const x = event.clientX + 14\n  const y = event.clientY - 28\n  const viewW = window.innerWidth\n  const elW = 240\n\n  el.style.left = `${Math.min(x, viewW - elW - 8)}px`\n  el.style.top = `${Math.max(y, 8)}px`\n  el.style.opacity = '1'\n}\n\nexport function hideTooltip(): void {\n  if (tooltipEl) tooltipEl.style.opacity = '0'\n}\n\nexport function formatTooltipRow(label: string, value: string | number): string {\n  return `<div style=\"display:flex;justify-content:space-between;gap:12px\">\n    <span style=\"opacity:0.7\">${label}</span>\n    <strong>${typeof value === 'number' ? value.toFixed(3) : value}</strong>\n  </div>`\n}\n", "/**\n * Statistical annotation helpers for D3 plots.\n * Renders APA text, regression equations, and stat result boxes.\n */\n\nimport type * as d3 from 'd3'\nimport type { CarmTheme } from '../themes/default.js'\nimport { DEFAULT_THEME } from '../themes/default.js'\n\ntype SVGSelection = d3.Selection<SVGSVGElement, unknown, null, undefined>\ntype GSelection = d3.Selection<SVGGElement, unknown, null, undefined>\n\n/**\n * Add a title + statistical subtitle at the top of an SVG.\n *\n * Layout (y positions, px from SVG top):\n *   20 \u2014 decorative accent bar (2\u00D720 px, theme color)\n *   22 \u2014 title baseline  (16 px bold, near-black)\n *   43 \u2014 subtitle baseline (11 px italic sans-serif, slate)\n *\n * Theme marginTop should be \u2265 58 so the plot area starts below the subtitle.\n */\nexport function addSubtitle(\n  svg: SVGSelection,\n  title: string,\n  subtitle: string,\n  _width: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  // Slim accent bar \u2014 left edge decoration\n  svg.append('rect')\n    .attr('x', 20)\n    .attr('y', 10)\n    .attr('width', 3)\n    .attr('height', 22)\n    .attr('rx', 1.5)\n    .attr('fill', theme.colors[0] ?? '#4e79a7')\n\n  // Title \u2014 left-aligned (indented past the accent bar)\n  svg.append('text')\n    .attr('class', 'plot-title')\n    .attr('x', 30)\n    .attr('y', 26)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeTitle)\n    .attr('font-weight', '700')\n    .attr('letter-spacing', '-0.3')\n    .attr('fill', theme.text)\n    .text(title)\n\n  // Subtitle \u2014 left-aligned, italic, regular (not mono), slate color\n  if (subtitle) {\n    svg.append('text')\n      .attr('class', 'plot-subtitle')\n      .attr('x', 30)\n      .attr('y', 45)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('font-style', 'italic')\n      .attr('fill', theme.textAnnotation)\n      .text(subtitle)\n  }\n}\n\n/**\n * Add an italic caption at the bottom-left of the SVG.\n * Used for data source, method notes, sample size.\n */\nexport function addCaption(\n  svg: SVGSelection,\n  text: string,\n  _width: number,\n  height: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  svg.append('text')\n    .attr('x', 20)\n    .attr('y', height - 8)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('fill', theme.textMuted)\n    .style('font-style', 'italic')\n    .text(text)\n}\n\n/**\n * Add a regression equation text annotation on the plot area.\n * Uses monospace font so numbers align cleanly.\n */\nexport function addRegressionEquation(\n  g: GSelection,\n  intercept: number,\n  slope: number,\n  r2: number,\n  x: number,\n  y: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  const sign = slope >= 0 ? '+' : '\u2212'\n  const eq = `\u0177 = ${intercept.toFixed(2)} ${sign} ${Math.abs(slope).toFixed(2)}x   R\u00B2 = ${r2.toFixed(3)}`\n\n  // Pill background\n  const padX = 8, padY = 4\n  const textW = eq.length * 6.2 + padX * 2\n  const textH = 14 + padY * 2\n  g.append('rect')\n    .attr('x', x - padX)\n    .attr('y', y - textH + padY)\n    .attr('width', textW)\n    .attr('height', textH)\n    .attr('rx', 4)\n    .attr('fill', theme.surface)\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1)\n\n  g.append('text')\n    .attr('x', x)\n    .attr('y', y)\n    .attr('font-family', theme.fontFamilyMono)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('fill', theme.textAnnotation)\n    .text(eq)\n}\n\n/**\n * Add an n= label below a group's x-position.\n */\nexport function addNLabel(\n  g: GSelection,\n  n: number,\n  x: number,\n  y: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  g.append('text')\n    .attr('x', x)\n    .attr('y', y)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('fill', theme.textMuted)\n    .text(`n = ${n}`)\n}\n\n/**\n * Add a stat annotation box (pill) directly on the plot area.\n * E.g. AUC = 0.82, r = .91, p < .001\n */\nexport function addStatBadge(\n  g: GSelection,\n  lines: string[],\n  x: number,\n  y: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  const lineH = 14\n  const padX = 10, padY = 6\n  const maxLen = Math.max(...lines.map(l => l.length))\n  const bw = maxLen * 6.4 + padX * 2\n  const bh = lines.length * lineH + padY * 2\n\n  g.append('rect')\n    .attr('x', x)\n    .attr('y', y)\n    .attr('width', bw)\n    .attr('height', bh)\n    .attr('rx', 5)\n    .attr('fill', theme.surface)\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1)\n    .attr('opacity', 0.92)\n\n  lines.forEach((line, i) => {\n    g.append('text')\n      .attr('x', x + padX)\n      .attr('y', y + padY + (i + 1) * lineH - 2)\n      .attr('font-family', theme.fontFamilyMono)\n      .attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.textAnnotation)\n      .text(line)\n  })\n}\n", "/**\n * Significance bracket layout for group comparison plots.\n * Renders stacked brackets above groups with p-value labels.\n * Non-overlapping bracket stacking algorithm.\n */\n\nimport type * as d3 from 'd3'\nimport type { PairwiseResult } from '../../core/types.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { DEFAULT_THEME } from '../themes/default.js'\n\nexport interface BracketConfig {\n  readonly groupPositions: ReadonlyMap<string, number>  // group label \u2192 x-center\n  readonly yBase: number              // y coordinate of the top of data (plot top)\n  readonly bracketHeight: number      // vertical space per bracket level\n  readonly significantOnly: boolean   // show only p < 0.05 brackets\n  readonly numericP?: boolean         // true = \"p = .025\", false = \"***\" stars (default true)\n}\n\n/** Format p-value for bracket label. */\nfunction formatBracketP(p: number, numeric: boolean): string {\n  if (numeric) {\n    if (p < 0.001) return 'p < .001'\n    return `p = ${p.toFixed(3).replace(/^0\\./, '.')}`\n  }\n  if (p < 0.001) return '***'\n  if (p < 0.01)  return '**'\n  if (p < 0.05)  return '*'\n  return 'ns'\n}\n\n/**\n * Render significance brackets onto an SVG group.\n * Uses greedy level-assignment to avoid bracket overlap.\n */\nexport function renderBrackets(\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  comparisons: readonly PairwiseResult[],\n  config: BracketConfig,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  const toShow = config.significantOnly\n    ? comparisons.filter(c => c.significant)\n    : comparisons\n\n  if (toShow.length === 0) return\n\n  // Greedy level assignment: assign each bracket to the lowest level that doesn't overlap\n  interface Bracket {\n    x1: number\n    x2: number\n    p: number\n    label: string\n    level: number\n  }\n\n  const brackets: Bracket[] = toShow.map(c => ({\n    x1: Math.min(\n      config.groupPositions.get(c.group1) ?? 0,\n      config.groupPositions.get(c.group2) ?? 0\n    ),\n    x2: Math.max(\n      config.groupPositions.get(c.group1) ?? 0,\n      config.groupPositions.get(c.group2) ?? 0\n    ),\n    p: c.pValueAdj,\n    label: formatBracketP(c.pValueAdj, config.numericP !== false),\n    level: 0,\n  })).sort((a, b) => (a.x2 - a.x1) - (b.x2 - b.x1))  // shortest first\n\n  // Assign levels greedily\n  const levelMaxX: number[] = []\n  for (const bracket of brackets) {\n    let level = 0\n    while ((levelMaxX[level] ?? -Infinity) >= bracket.x1 - 5) {\n      level++\n    }\n    bracket.level = level\n    levelMaxX[level] = bracket.x2\n  }\n\n  // Draw brackets\n  for (const b of brackets) {\n    const y = config.yBase - b.level * config.bracketHeight - 12\n    const tipLen = 6\n    const color = b.label === 'ns' ? theme.textMuted : theme.text\n\n    // Horizontal line\n    g.append('line')\n      .attr('x1', b.x1).attr('x2', b.x2)\n      .attr('y1', y).attr('y2', y)\n      .attr('stroke', color)\n      .attr('stroke-width', 1.2)\n\n    // Left tick\n    g.append('line')\n      .attr('x1', b.x1).attr('x2', b.x1)\n      .attr('y1', y).attr('y2', y + tipLen)\n      .attr('stroke', color)\n      .attr('stroke-width', 1.2)\n\n    // Right tick\n    g.append('line')\n      .attr('x1', b.x2).attr('x2', b.x2)\n      .attr('y1', y).attr('y2', y + tipLen)\n      .attr('stroke', color)\n      .attr('stroke-width', 1.2)\n\n    // Label\n    g.append('text')\n      .attr('x', (b.x1 + b.x2) / 2)\n      .attr('y', y - 3)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', color)\n      .text(b.label)\n  }\n}\n\n/** Total bracket height needed (to set top margin). */\nexport function totalBracketHeight(\n  comparisons: readonly PairwiseResult[],\n  significantOnly: boolean,\n  bracketHeight: number\n): number {\n  const n = significantOnly ? comparisons.filter(c => c.significant).length : comparisons.length\n  return n * bracketHeight + 20\n}\n", "/**\n * Smart axis rendering for Carm plots.\n * Auto tick formatting, minimal grid, clean style.\n */\n\nimport type * as d3 from 'd3'\nimport type { CarmTheme } from '../themes/default.js'\nimport { DEFAULT_THEME } from '../themes/default.js'\n\ntype AnyScale = d3.ScaleLinear<number, number> | d3.ScaleBand<string>\n\n/** Render a styled x-axis with label. */\nexport function renderXAxis(\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  _scale: AnyScale,\n  height: number,\n  label: string,\n  width: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  g.append('g')\n    .attr('transform', `translate(0,${height})`)\n    .call((g_: d3.Selection<SVGGElement, unknown, null, undefined>) => {\n      g_.selectAll('line').attr('stroke', theme.axisLine)\n      g_.selectAll('path').attr('stroke', theme.axisLine)\n      g_.selectAll('text')\n        .attr('fill', theme.text)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSize)\n    })\n\n  // Axis label\n  g.append('text')\n    .attr('x', width / 2)\n    .attr('y', height + 48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(label)\n}\n\n/** Render a styled y-axis with label. */\nexport function renderYAxis(\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  _scale: d3.ScaleLinear<number, number>,\n  height: number,\n  label: string,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  g.append('g')\n    .call(d3Axis => {\n      // Will be called with actual d3 in the plot\n      void d3Axis\n    })\n\n  // Y-axis label\n  g.append('text')\n    .attr('transform', 'rotate(-90)')\n    .attr('x', -height / 2)\n    .attr('y', -52)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(label)\n}\n\n/** Render horizontal grid lines. */\nexport function renderGridLines(\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  scale: d3.ScaleLinear<number, number>,\n  width: number,\n  theme: CarmTheme = DEFAULT_THEME\n): void {\n  const ticks = scale.ticks(6)\n  g.selectAll('.grid-line')\n    .data(ticks)\n    .join('line')\n    .attr('class', 'grid-line')\n    .attr('x1', 0)\n    .attr('x2', width)\n    .attr('y1', scale)\n    .attr('y2', scale)\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1)\n}\n", "/**\n * Violin + Box + Jitter combo plot (ggbetweenstats style).\n * Shows distribution shape (violin), summary (box), individual points (jitter),\n * and significance brackets between groups.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption, addNLabel } from '../components/annotations.js'\nimport { renderBrackets } from '../components/brackets.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult, PairwiseResult, GroupData } from '../../core/types.js'\nimport { mean as _mean, sd as _sd, quantile } from '../../core/math.js'\n\nexport interface ViolinBoxConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showJitter?: boolean\n  readonly showBrackets?: boolean\n  readonly significantBracketsOnly?: boolean\n  readonly jitterWidth?: number\n  readonly violinBandwidth?: number\n  readonly showN?: boolean\n  readonly showMean?: boolean\n  readonly showMedian?: boolean\n  readonly numericP?: boolean\n}\n\nexport interface ViolinBoxData {\n  readonly groups: readonly GroupData[]\n  readonly testResult?: StatResult\n  readonly pairwise?: readonly PairwiseResult[]\n}\n\n/**\n * Render a violin + box + jitter plot.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - group data + optional stat results\n * @param config - visual configuration\n */\nexport function renderViolinBox(\n  container: HTMLElement,\n  data: ViolinBoxData,\n  config: ViolinBoxConfig = {}\n): void {\n  // Load d3 dynamically to work as peer dependency\n  import('d3').then(d3 => renderViolinBoxD3(d3, container, data, config))\n}\n\nfunction renderViolinBoxD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ViolinBoxData,\n  config: ViolinBoxConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = {\n    top: theme.marginTop + (data.pairwise?.length ?? 0) * 20,\n    right: theme.marginRight,\n    bottom: theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  // Clear container\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  // Title + subtitle\n  if (config.title || data.testResult) {\n    addSubtitle(\n      svg,\n      config.title ?? 'Group Comparison',\n      data.testResult?.formatted ?? '',\n      W,\n      theme\n    )\n  }\n\n  const g = svg.append('g')\n    .attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // Scales\n  const labels = data.groups.map(gr => gr.label)\n  const xScale = d3.scaleBand<string>()\n    .domain(labels)\n    .range([0, width])\n    .padding(0.2)\n\n  const allValues = data.groups.flatMap(gr => [...gr.values])\n  const [yMin, yMax] = d3.extent(allValues) as [number, number]\n  const yPad = (yMax - yMin) * 0.1\n  const yScale = d3.scaleLinear()\n    .domain([yMin - yPad, yMax + yPad])\n    .range([height, 0])\n    .nice()\n\n  // Grid lines\n  g.selectAll('.grid')\n    .data(yScale.ticks(6))\n    .join('line')\n    .attr('class', 'grid')\n    .attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1)\n\n  // Axes\n  g.append('g')\n    .attr('transform', `translate(0,${height})`)\n    .call(d3.axisBottom(xScale))\n    .selectAll('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  g.append('g')\n    .call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  // Axis labels\n  g.append('text')\n    .attr('x', width / 2)\n    .attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(config.xLabel ?? '')\n\n  g.append('text')\n    .attr('transform', 'rotate(-90)')\n    .attr('x', -height / 2)\n    .attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(config.yLabel ?? 'Value')\n\n  // Draw each group: violin \u2192 box \u2192 jitter\n  data.groups.forEach((gr, gi) => {\n    const cx = (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2\n    const color = getColor(gi, theme)\n    const bw = config.violinBandwidth ?? (yMax - yMin) / 20\n\n    // Violin (KDE approximation)\n    const kdePoints = kernelDensityEstimate(gr.values, yScale.ticks(60), bw)\n    const maxDensity = Math.max(...kdePoints.map(p => p[1]))\n    const violinWidth = xScale.bandwidth() * 0.45\n    const violinScale = maxDensity > 0 ? violinWidth / maxDensity : 1\n\n    const areaFn = d3.area<[number, number]>()\n      .x0(d => cx - d[1] * violinScale)\n      .x1(d => cx + d[1] * violinScale)\n      .y(d => yScale(d[0]))\n      .curve(d3.curveCatmullRom)\n\n    g.append('path')\n      .datum(kdePoints)\n      .attr('d', areaFn)\n      .attr('fill', color)\n      .attr('opacity', theme.violinOpacity)\n      .attr('stroke', color)\n      .attr('stroke-width', 1)\n\n    // Box plot stats\n    const q1 = quantile(gr.values, 0.25)\n    const med = quantile(gr.values, 0.5)\n    const q3 = quantile(gr.values, 0.75)\n    const iqr = q3 - q1\n    const whiskerLo = Math.min(...gr.values.filter(v => v >= q1 - 1.5 * iqr))\n    const whiskerHi = Math.max(...gr.values.filter(v => v <= q3 + 1.5 * iqr))\n    const boxW = xScale.bandwidth() * 0.2\n\n    // Whiskers\n    g.append('line').attr('x1', cx).attr('x2', cx)\n      .attr('y1', yScale(whiskerLo)).attr('y2', yScale(q1))\n      .attr('stroke', color).attr('stroke-width', 1.5)\n    g.append('line').attr('x1', cx).attr('x2', cx)\n      .attr('y1', yScale(q3)).attr('y2', yScale(whiskerHi))\n      .attr('stroke', color).attr('stroke-width', 1.5)\n\n    // Box\n    g.append('rect')\n      .attr('x', cx - boxW / 2).attr('width', boxW)\n      .attr('y', yScale(q3)).attr('height', yScale(q1) - yScale(q3))\n      .attr('fill', theme.background)\n      .attr('stroke', color)\n      .attr('stroke-width', 2)\n\n    // Median line + value\n    if (config.showMedian !== false) {\n      g.append('line').attr('x1', cx - boxW / 2).attr('x2', cx + boxW / 2)\n        .attr('y1', yScale(med)).attr('y2', yScale(med))\n        .attr('stroke', color).attr('stroke-width', 2.5)\n      g.append('text')\n        .attr('x', cx + boxW / 2 + 4).attr('y', yScale(med) + 3.5)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textAnnotation).text(med.toFixed(2))\n    }\n\n    // Mean diamond marker + value\n    if (config.showMean) {\n      const groupMean = gr.values.reduce((s, v) => s + v, 0) / gr.values.length\n      const my = yScale(groupMean)\n      const ds = 5\n      g.append('polygon')\n        .attr('points', `${cx},${my - ds} ${cx + ds},${my} ${cx},${my + ds} ${cx - ds},${my}`)\n        .attr('fill', 'white').attr('stroke', color).attr('stroke-width', 1.5)\n\n      // Only show mean value label if median label is hidden or far enough away\n      const medY = yScale(med)\n      const tooClose = config.showMedian !== false && Math.abs(my - medY) < 14\n      if (!tooClose) {\n        g.append('text')\n          .attr('x', cx + ds + 4).attr('y', my + 3.5)\n          .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n          .attr('fill', theme.textAnnotation).text(groupMean.toFixed(2))\n      }\n    }\n\n    // Jitter points\n    if (config.showJitter !== false) {\n      const jw = (config.jitterWidth ?? 0.15) * xScale.bandwidth()\n      const seed = gi * 12345\n      gr.values.forEach((v, vi) => {\n        const jx = cx + (pseudoRandom(seed + vi) - 0.5) * jw\n        g.append('circle')\n          .attr('cx', jx).attr('cy', yScale(v))\n          .attr('r', 3)\n          .attr('fill', color)\n          .attr('opacity', theme.pointOpacity)\n          .attr('stroke', 'none')\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event, [\n              formatTooltipRow('Group', gr.label),\n              formatTooltipRow('Value', v.toFixed(3)),\n            ].join(''), theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    }\n\n    // n label\n    if (config.showN !== false) {\n      addNLabel(g, gr.values.length, cx, height + 60, theme)\n    }\n  })\n\n  // Significance brackets\n  if (config.showBrackets !== false && data.pairwise && data.pairwise.length > 0) {\n    const posMap = new Map(\n      data.groups.map(gr => [gr.label, (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2])\n    )\n    renderBrackets(g, data.pairwise, {\n      groupPositions: posMap,\n      yBase: 0,\n      bracketHeight: 22,\n      significantOnly: config.significantBracketsOnly ?? false,\n      ...(config.numericP !== undefined && { numericP: config.numericP }),\n    }, theme)\n  }\n\n  // Caption\n  if (config.caption) {\n    addCaption(svg, config.caption, W, H, theme)\n  }\n}\n\n// \u2500\u2500\u2500 KDE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction kernelDensityEstimate(data: readonly number[], xPoints: number[], bandwidth: number): Array<[number, number]> {\n  return xPoints.map(x => {\n    const density = data.reduce((sum, xi) => sum + gaussianKernel((x - xi) / bandwidth), 0) / (data.length * bandwidth)\n    return [x, density] as [number, number]\n  })\n}\n\nfunction gaussianKernel(u: number): number {\n  return Math.exp(-0.5 * u * u) / Math.sqrt(2 * Math.PI)\n}\n\nfunction pseudoRandom(seed: number): number {\n  const x = Math.sin(seed) * 10000\n  return x - Math.floor(x)\n}\n", "/**\n * Scatter plot with regression line, CI band, and marginal distributions.\n * ggscatterstats style: stat result in subtitle, regression equation on plot.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption, addRegressionEquation } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult, RegressionResult } from '../../core/types.js'\n\nexport interface ScatterStatsConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showMarginals?: boolean\n  readonly showCI?: boolean\n  readonly pointSize?: number\n  readonly showEquation?: boolean\n}\n\nexport interface ScatterStatsData {\n  readonly x: readonly number[]\n  readonly y: readonly number[]\n  readonly labels?: readonly string[]\n  readonly correlationResult?: StatResult\n  readonly regressionResult?: RegressionResult\n}\n\nexport function renderScatterStats(\n  container: HTMLElement,\n  data: ScatterStatsData,\n  config: ScatterStatsConfig = {}\n): void {\n  import('d3').then(d3 => renderScatterD3(d3, container, data, config))\n}\n\nfunction renderScatterD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ScatterStatsData,\n  config: ScatterStatsConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight + 40, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W).attr('height', H)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Scatter Plot', data.correlationResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const [xMin, xMax] = d3.extent(data.x) as [number, number]\n  const [yMin, yMax] = d3.extent(data.y) as [number, number]\n  const xPad = (xMax - xMin) * 0.05\n  const yPad = (yMax - yMin) * 0.05\n\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll('.grid-h').data(yScale.ticks(6)).join('line')\n    .attr('class', 'grid-h').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  // Labels\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'X')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Y')\n\n  // Regression line + CI band\n  if (data.regressionResult) {\n    const coefs = data.regressionResult.coefficients\n    const b0 = coefs[0]?.estimate ?? 0\n    const b1 = coefs[1]?.estimate ?? 1\n    const r2 = data.regressionResult.r2\n\n    const xRange = xScale.domain()\n    const lineData: Array<[number, number]> = [\n      [xRange[0]!, b0 + b1 * xRange[0]!],\n      [xRange[1]!, b0 + b1 * xRange[1]!],\n    ]\n\n    if (config.showCI !== false) {\n      // Approximate CI band using residual SE\n      const n = data.x.length\n      const se_reg = Math.sqrt(data.regressionResult.residuals.reduce((s, r) => s + r * r, 0) / (n - 2))\n      const xMean = data.x.reduce((s, v) => s + v, 0) / n\n      const sxx = data.x.reduce((s, v) => s + (v - xMean) ** 2, 0)\n\n      const ciPoints = xScale.ticks(50).map(x => {\n        const yHat = b0 + b1 * x\n        const h = 1 / n + (x - xMean) ** 2 / sxx\n        const halfCI = 1.96 * se_reg * Math.sqrt(h)\n        return { x, lo: yHat - halfCI, hi: yHat + halfCI }\n      })\n\n      const area = d3.area<typeof ciPoints[0]>()\n        .x(d => xScale(d.x)).y0(d => yScale(d.lo)).y1(d => yScale(d.hi))\n        .curve(d3.curveBasis)\n\n      g.append('path').datum(ciPoints).attr('d', area)\n        .attr('fill', getColor(0, theme)).attr('opacity', theme.ciOpacity)\n    }\n\n    g.append('line')\n      .attr('x1', xScale(lineData[0]![0]!)).attr('x2', xScale(lineData[1]![0]!))\n      .attr('y1', yScale(lineData[0]![1]!)).attr('y2', yScale(lineData[1]![1]!))\n      .attr('stroke', getColor(0, theme)).attr('stroke-width', 2)\n\n    if (config.showEquation !== false) {\n      addRegressionEquation(g as unknown as D3.Selection<SVGGElement, unknown, null, undefined>, b0, b1, r2, 10, 20, theme)\n    }\n  }\n\n  // Data points\n  const color = getColor(0, theme)\n  data.x.forEach((xi, i) => {\n    const yi = data.y[i] ?? 0\n    g.append('circle')\n      .attr('cx', xScale(xi)).attr('cy', yScale(yi))\n      .attr('r', config.pointSize ?? 4)\n      .attr('fill', color).attr('opacity', theme.pointOpacity)\n      .attr('stroke', theme.background).attr('stroke-width', 0.5)\n      .on('mouseover', (event: MouseEvent) => {\n        const rows = [formatTooltipRow(config.xLabel ?? 'X', xi.toFixed(3)), formatTooltipRow(config.yLabel ?? 'Y', yi.toFixed(3))]\n        if (data.labels?.[i]) rows.unshift(`<strong>${data.labels[i]}</strong>`)\n        showTooltip(event, rows.join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Histogram with density overlay and optional normality curve.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport type { DescriptiveResult } from '../../core/types.js'\n\nexport interface HistogramConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly bins?: number\n  readonly showDensity?: boolean\n  readonly showNormalCurve?: boolean\n  readonly color?: string\n}\n\nexport interface HistogramData {\n  readonly values: readonly number[]\n  readonly descriptives?: DescriptiveResult\n}\n\nexport function renderHistogram(\n  container: HTMLElement,\n  data: HistogramData,\n  config: HistogramConfig = {}\n): void {\n  import('d3').then(d3 => renderHistogramD3(d3, container, data, config))\n}\n\nfunction renderHistogramD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: HistogramData,\n  config: HistogramConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 400\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Distribution',\n    data.descriptives ? `M = ${data.descriptives.mean.toFixed(2)}, SD = ${data.descriptives.sd.toFixed(2)}, n = ${data.descriptives.n}` : '',\n    W, theme\n  )\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const [xMin, xMax] = d3.extent(data.values) as [number, number]\n  const xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, width]).nice()\n\n  const nBins = config.bins ?? Math.ceil(Math.sqrt(data.values.length))\n  const histogram = d3.bin().domain(xScale.domain() as [number, number]).thresholds(nBins)\n  const bins = histogram(data.values as number[])\n\n  const maxCount = Math.max(...bins.map(b => b.length))\n  const yScale = d3.scaleLinear().domain([0, maxCount * 1.1]).range([height, 0])\n\n  // Grid\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Bars\n  const barColor = config.color ?? getColor(0, theme)\n  g.selectAll('.bar').data(bins).join('rect')\n    .attr('class', 'bar')\n    .attr('x', b => xScale(b.x0!))\n    .attr('y', b => yScale(b.length))\n    .attr('width', b => Math.max(0, xScale(b.x1!) - xScale(b.x0!) - 1))\n    .attr('height', b => height - yScale(b.length))\n    .attr('fill', barColor).attr('opacity', 0.7)\n    .attr('stroke', theme.background).attr('stroke-width', 0.5)\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Value')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text('Count')\n\n  // Normal curve overlay\n  if (config.showNormalCurve !== false && data.descriptives) {\n    const m = data.descriptives.mean\n    const s = data.descriptives.sd\n    const n = data.descriptives.n\n    const binWidth = bins[0]?.x1! - bins[0]?.x0!\n    const scale_ = n * binWidth  // scale density to count\n\n    const xTicks = d3.range(xMin, xMax, (xMax - xMin) / 100)\n    const normalPoints = xTicks.map(x => ({\n      x,\n      y: scale_ * Math.exp(-0.5 * ((x - m) / s) ** 2) / (s * Math.sqrt(2 * Math.PI)),\n    }))\n\n    const line = d3.line<typeof normalPoints[0]>()\n      .x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveBasis)\n\n    g.append('path').datum(normalPoints).attr('d', line)\n      .attr('fill', 'none').attr('stroke', getColor(4, theme))\n      .attr('stroke-width', 2).attr('stroke-dasharray', '6,3')\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Annotated bar chart with counts, percentages, and significance brackets.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport type { StatResult, FrequencyRow } from '../../core/types.js'\n\nexport interface BarStatsConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showPercentages?: boolean\n  readonly showCounts?: boolean\n  readonly orientation?: 'vertical' | 'horizontal'\n}\n\nexport interface BarStatsData {\n  readonly rows: readonly FrequencyRow[]\n  readonly testResult?: StatResult\n}\n\nexport function renderBarStats(\n  container: HTMLElement,\n  data: BarStatsData,\n  config: BarStatsConfig = {}\n): void {\n  import('d3').then(d3 => renderBarD3(d3, container, data, config))\n}\n\nfunction renderBarD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: BarStatsData,\n  config: BarStatsConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 400\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Frequency', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const categories = data.rows.map(r => String(r.value))\n  const maxCount = Math.max(...data.rows.map(r => r.count))\n\n  const xScale = d3.scaleBand<string>().domain(categories).range([0, width]).padding(0.25)\n  const yScale = d3.scaleLinear().domain([0, maxCount * 1.15]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Bars\n  g.selectAll('.bar').data(data.rows).join('rect')\n    .attr('class', 'bar')\n    .attr('x', row => xScale(String(row.value)) ?? 0)\n    .attr('y', row => yScale(row.count))\n    .attr('width', xScale.bandwidth())\n    .attr('height', row => height - yScale(row.count))\n    .attr('fill', (_, i) => getColor(i, theme))\n    .attr('rx', 2)\n\n  // Count labels\n  if (config.showCounts !== false) {\n    g.selectAll('.label-count').data(data.rows).join('text')\n      .attr('class', 'label-count')\n      .attr('x', row => (xScale(String(row.value)) ?? 0) + xScale.bandwidth() / 2)\n      .attr('y', row => yScale(row.count) - 4)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(row => `${row.count}`)\n  }\n\n  // Percentage labels\n  if (config.showPercentages !== false) {\n    g.selectAll('.label-pct').data(data.rows).join('text')\n      .attr('class', 'label-pct')\n      .attr('x', row => (xScale(String(row.value)) ?? 0) + xScale.bandwidth() / 2)\n      .attr('y', row => yScale(row.count) - 16)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.textMuted)\n      .text(row => `(${(row.relative * 100).toFixed(1)}%)`)\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Category')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Count')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Correlation heatmap (correlogram) with significance stars and clustering.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { CorrelationMatrix } from '../../stats/correlation.js'\n\nexport interface CorrelogramConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showValues?: boolean\n  readonly showSignificance?: boolean\n  readonly showLegend?: boolean\n}\n\nexport function renderCorrelogram(\n  container: HTMLElement,\n  data: CorrelationMatrix,\n  config: CorrelogramConfig = {}\n): void {\n  import('d3').then(d3 => renderCorrelogramD3(d3, container, data, config))\n}\n\nfunction renderCorrelogramD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: CorrelationMatrix,\n  config: CorrelogramConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const k = data.labels.length\n  const cellSize = Math.min(\n    Math.floor((config.width ?? 500) / (k + 2)),\n    Math.floor((config.height ?? 500) / (k + 2)),\n    70\n  )\n  const W = cellSize * k + 120\n  const H = cellSize * k + 100\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Correlation Matrix', '', W, theme)\n\n  const margin = { top: 60, right: 20, bottom: 20, left: 80 }\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // Color scale: blue (\u22121) \u2192 white \u2192 red (+1)\n  const colorScale = d3.scaleSequential()\n    .domain([-1, 1])\n    .interpolator(d3.interpolateRdBu)\n\n  // Draw cells\n  for (let i = 0; i < k; i++) {\n    for (let j = 0; j < k; j++) {\n      const r = data.r[i]?.[j] ?? 0\n      const p = data.pValues[i]?.[j] ?? 1\n\n      g.append('rect')\n        .attr('x', j * cellSize).attr('y', i * cellSize)\n        .attr('width', cellSize - 2).attr('height', cellSize - 2)\n        .attr('rx', 3)\n        .attr('fill', i === j ? theme.surface : colorScale(r))\n        .on('mouseover', (event: MouseEvent) => {\n          if (i !== j) {\n            showTooltip(event, [\n              formatTooltipRow(`${data.labels[i]} \u00D7 ${data.labels[j]}`, ''),\n              formatTooltipRow('r', r.toFixed(3)),\n              formatTooltipRow('p', p < 0.001 ? '< .001' : p.toFixed(3)),\n            ].join(''), theme)\n          }\n        })\n        .on('mouseout', hideTooltip)\n\n      // Value text\n      if (config.showValues !== false && i !== j) {\n        g.append('text')\n          .attr('x', j * cellSize + cellSize / 2)\n          .attr('y', i * cellSize + cellSize / 2 + 1)\n          .attr('text-anchor', 'middle').attr('dominant-baseline', 'middle')\n          .attr('font-family', theme.fontFamilyMono).attr('font-size', Math.min(theme.fontSizeSmall, cellSize / 3))\n          .attr('fill', Math.abs(r) > 0.6 ? '#fff' : theme.text)\n          .text(r.toFixed(2))\n      }\n\n      // Significance stars\n      if (config.showSignificance !== false && i !== j && !isNaN(p)) {\n        const stars = p < 0.001 ? '***' : p < 0.01 ? '**' : p < 0.05 ? '*' : ''\n        if (stars) {\n          g.append('text')\n            .attr('x', j * cellSize + cellSize / 2)\n            .attr('y', i * cellSize + cellSize - 4)\n            .attr('text-anchor', 'middle')\n            .attr('font-size', 8)\n            .attr('fill', Math.abs(r) > 0.6 ? '#fff' : theme.textMuted)\n            .text(stars)\n        }\n      }\n    }\n  }\n\n  // Row labels (left)\n  data.labels.forEach((lbl, i) => {\n    g.append('text')\n      .attr('x', -6).attr('y', i * cellSize + cellSize / 2)\n      .attr('text-anchor', 'end').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(lbl)\n  })\n\n  // Column labels (top)\n  data.labels.forEach((lbl, j) => {\n    g.append('text')\n      .attr('x', j * cellSize + cellSize / 2).attr('y', -8)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(lbl)\n  })\n\n  // Color legend (gradient bar)\n  if (config.showLegend !== false) {\n    const legendW = 80, legendH = 12\n    const legendX = W - 120, legendY = H - 35\n    const defs = svg.append('defs')\n    const gradId = 'corr-grad-' + Math.random().toString(36).slice(2)\n    const grad = defs.append('linearGradient').attr('id', gradId)\n    const stops = [-1, -0.5, 0, 0.5, 1]\n    stops.forEach(v => {\n      grad.append('stop')\n        .attr('offset', `${((v + 1) / 2 * 100).toFixed(0)}%`)\n        .attr('stop-color', colorScale(v))\n    })\n    svg.append('rect').attr('x', legendX).attr('y', legendY)\n      .attr('width', legendW).attr('height', legendH)\n      .attr('fill', `url(#${gradId})`)\n    svg.append('text').attr('x', legendX).attr('y', legendY + legendH + 10)\n      .attr('font-size', 9).attr('fill', theme.textMuted).text('\u22121')\n    svg.append('text').attr('x', legendX + legendW / 2).attr('y', legendY + legendH + 10)\n      .attr('text-anchor', 'middle').attr('font-size', 9).attr('fill', theme.textMuted).text('0')\n    svg.append('text').attr('x', legendX + legendW).attr('y', legendY + legendH + 10)\n      .attr('text-anchor', 'end').attr('font-size', 9).attr('fill', theme.textMuted).text('+1')\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Coefficient dot-and-whisker plot (ggcoefstats style).\n * Shows regression/LMM coefficients with CI bars and p-value annotations.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport type { RegressionCoef } from '../../core/types.js'\n\nexport interface CoefPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showZeroLine?: boolean\n  readonly excludeIntercept?: boolean\n}\n\nexport function renderCoefPlot(\n  container: HTMLElement,\n  coefficients: readonly RegressionCoef[],\n  config: CoefPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderCoefD3(d3, container, coefficients, config))\n}\n\nfunction renderCoefD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  coefficientsAll: readonly RegressionCoef[],\n  config: CoefPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const coefs = config.excludeIntercept !== false\n    ? coefficientsAll.filter(c => c.name !== '(Intercept)')\n    : coefficientsAll\n\n  const k = coefs.length\n  const W = config.width ?? 500\n  const H = config.height ?? Math.max(k * 40 + 100, 200)\n  const margin = { top: theme.marginTop, right: theme.marginRight + 60, bottom: theme.marginBottom, left: 120 }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Coefficient Plot', '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allX = coefs.flatMap(c => [c.ci[0], c.ci[1], c.estimate])\n  const [xMin, xMax] = d3.extent(allX) as [number, number]\n  const xPad = (xMax - xMin) * 0.1\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n\n  const yScale = d3.scaleBand<string>()\n    .domain([...coefs].reverse().map(c => c.name))\n    .range([0, height]).padding(0.3)\n\n  // Zero line\n  if (config.showZeroLine !== false) {\n    const x0 = xScale(0)\n    g.append('line').attr('x1', x0).attr('x2', x0)\n      .attr('y1', 0).attr('y2', height)\n      .attr('stroke', theme.axisLine).attr('stroke-dasharray', '4,2').attr('stroke-width', 1)\n  }\n\n  // Gridlines\n  g.selectAll('.grid').data(xScale.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', d => xScale(d)).attr('x2', d => xScale(d))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // CI bars + dots\n  coefs.forEach((coef, _i) => {\n    const cy = (yScale(coef.name) ?? 0) + yScale.bandwidth() / 2\n    const significant = coef.pValue < 0.05\n    const color = significant ? getColor(0, theme) : theme.textMuted\n\n    // CI bar\n    g.append('line')\n      .attr('x1', xScale(coef.ci[0])).attr('x2', xScale(coef.ci[1]))\n      .attr('y1', cy).attr('y2', cy)\n      .attr('stroke', color).attr('stroke-width', 2.5).attr('opacity', 0.6)\n\n    // Dot\n    g.append('circle')\n      .attr('cx', xScale(coef.estimate)).attr('cy', cy)\n      .attr('r', 5).attr('fill', color)\n\n    // P-value label on right\n    const pLabel = coef.pValue < 0.001 ? 'p < .001' : `p = ${coef.pValue.toFixed(3)}`\n    g.append('text')\n      .attr('x', width + 5).attr('y', cy + 4)\n      .attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.textMuted).text(pLabel)\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Estimate (95% CI)')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * QQ plot (quantile-quantile plot) with confidence band.\n * Tests normality assumption visually.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { normalQuantile, sortAsc } from '../../core/math.js'\n\nexport interface QQPlotConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showCI?: boolean\n}\n\nexport function renderQQPlot(\n  container: HTMLElement,\n  values: readonly number[],\n  config: QQPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderQQD3(d3, container, values, config))\n}\n\nfunction renderQQD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  values: readonly number[],\n  config: QQPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 400\n  const H = config.height ?? 400\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  const n = values.length\n  const sorted = sortAsc(values)\n  const mean_ = sorted.reduce((s, v) => s + v, 0) / n\n  const sd_ = Math.sqrt(sorted.reduce((s, v) => s + (v - mean_) ** 2, 0) / (n - 1))\n\n  // Theoretical quantiles (Blom positions)\n  const points = sorted.map((y, i) => {\n    const p = (i + 1 - 0.375) / (n + 0.25)\n    const x = normalQuantile(Math.max(0.0001, Math.min(0.9999, p)))\n    return { x, y }\n  })\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'QQ Plot', 'Normal probability plot', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const xExtent = d3.extent(points.map(p => p.x)) as [number, number]\n  const yExtent = d3.extent(points.map(p => p.y)) as [number, number]\n  const xPad = (xExtent[1] - xExtent[0]) * 0.05\n  const yPad = (yExtent[1] - yExtent[0]) * 0.05\n\n  const xScale = d3.scaleLinear().domain([xExtent[0] - xPad, xExtent[1] + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleLinear().domain([yExtent[0] - yPad, yExtent[1] + yPad]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Theoretical reference line: y = mean + sd * x\n  const xDom = xScale.domain()\n  const xd0 = xDom[0] ?? 0, xd1 = xDom[1] ?? 1\n  g.append('line')\n    .attr('x1', xScale(xd0)).attr('x2', xScale(xd1))\n    .attr('y1', yScale(mean_ + sd_ * xd0)).attr('y2', yScale(mean_ + sd_ * xd1))\n    .attr('stroke', getColor(4, theme)).attr('stroke-width', 2).attr('stroke-dasharray', '6,3')\n\n  // Confidence band (approximate 95% simultaneous CI using Kolmogorov-Smirnov bounds)\n  if (config.showCI !== false) {\n    const CI_MULT = 1.36 / Math.sqrt(n)  // 95% KS bound\n    const bandData = points.map(p => ({\n      x: p.x,\n      lo: (mean_ + sd_ * p.x) - CI_MULT * sd_ * Math.sqrt(n),\n      hi: (mean_ + sd_ * p.x) + CI_MULT * sd_ * Math.sqrt(n),\n    }))\n\n    const area = d3.area<typeof bandData[0]>()\n      .x(d => xScale(d.x)).y0(d => yScale(d.lo)).y1(d => yScale(d.hi))\n    g.append('path').datum(bandData).attr('d', area)\n      .attr('fill', getColor(4, theme)).attr('opacity', theme.ciOpacity)\n  }\n\n  // Data points\n  g.selectAll('.qq-point').data(points).join('circle')\n    .attr('class', 'qq-point')\n    .attr('cx', p => xScale(p.x)).attr('cy', p => yScale(p.y))\n    .attr('r', 3).attr('fill', getColor(0, theme))\n    .attr('opacity', theme.pointOpacity)\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text('Theoretical Quantiles')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text('Sample Quantiles')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * 4-panel regression diagnostics plot:\n * 1. Residuals vs Fitted\n * 2. QQ of residuals\n * 3. Scale-Location (sqrt|residuals| vs fitted)\n * 4. Residuals vs Leverage\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport type { RegressionResult } from '../../core/types.js'\nimport { normalQuantile, sortAsc, mean as _mean } from '../../core/math.js'\n\nexport interface ResidualPanelConfig {\n  readonly title?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport function renderResidualPanel(\n  container: HTMLElement,\n  result: RegressionResult,\n  leverage: readonly number[],\n  config: ResidualPanelConfig = {}\n): void {\n  import('d3').then(d3 => renderResidualD3(d3, container, result, leverage, config))\n}\n\nfunction renderResidualD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  result: RegressionResult,\n  leverage: readonly number[],\n  config: ResidualPanelConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 700\n  const H = config.height ?? 600\n  const panelW = W / 2, panelH = H / 2\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  // Title\n  svg.append('text').attr('x', W / 2).attr('y', 18)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeTitle).attr('font-weight', '600').attr('fill', theme.text)\n    .text(config.title ?? 'Regression Diagnostics')\n\n  const color = getColor(0, theme)\n  const panels = [\n    { title: 'Residuals vs Fitted', row: 0, col: 0 },\n    { title: 'Normal Q-Q', row: 0, col: 1 },\n    { title: 'Scale-Location', row: 1, col: 0 },\n    { title: 'Residuals vs Leverage', row: 1, col: 1 },\n  ]\n\n  const margin = { top: 40, right: 20, bottom: 50, left: 50 }\n  const pw = panelW - margin.left - margin.right\n  const ph = panelH - margin.top - margin.bottom\n\n  panels.forEach((panel, idx) => {\n    const ox = panel.col * panelW + margin.left\n    const oy = panel.row * panelH + margin.top + 25\n    const g = svg.append('g').attr('transform', `translate(${ox},${oy})`)\n\n    g.append('text').attr('x', pw / 2).attr('y', -18)\n      .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize).attr('font-weight', '600').attr('fill', theme.text)\n      .text(panel.title)\n\n    let xData: readonly number[]\n    let yData: readonly number[]\n\n    if (idx === 0) {\n      xData = result.fitted; yData = result.residuals\n    } else if (idx === 1) {\n      // QQ\n      const sorted = sortAsc(result.residuals)\n      const n = sorted.length\n      yData = sorted\n      xData = sorted.map((_, i) => {\n        const p = (i + 1 - 0.375) / (n + 0.25)\n        return normalQuantile(Math.max(0.0001, Math.min(0.9999, p)))\n      })\n    } else if (idx === 2) {\n      xData = result.fitted\n      yData = result.residuals.map(r => Math.sqrt(Math.abs(r)))\n    } else {\n      xData = leverage; yData = result.residuals\n    }\n\n    const xExt = d3.extent([...xData]) as [number, number]\n    const yExt = d3.extent([...yData]) as [number, number]\n    const xPad = (xExt[1] - xExt[0]) * 0.05\n    const yPad = (yExt[1] - yExt[0]) * 0.05\n\n    const xs = d3.scaleLinear().domain([xExt[0] - xPad, xExt[1] + xPad]).range([0, pw]).nice()\n    const ys = d3.scaleLinear().domain([yExt[0] - yPad, yExt[1] + yPad]).range([ph, 0]).nice()\n\n    // Grid\n    g.selectAll('.grid').data(ys.ticks(4)).join('line')\n      .attr('class', 'grid').attr('x1', 0).attr('x2', pw)\n      .attr('y1', d => ys(d)).attr('y2', d => ys(d))\n      .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n    // Zero line for residual panels\n    if (idx === 0 || idx === 2) {\n      g.append('line').attr('x1', 0).attr('x2', pw)\n        .attr('y1', ys(0)).attr('y2', ys(0))\n        .attr('stroke', theme.axisLine).attr('stroke-dasharray', '4,2')\n    }\n\n    // Reference line for QQ\n    if (idx === 1) {\n      const mean_ = _mean(result.residuals)\n      const sd_ = Math.sqrt(result.residuals.reduce((s, r) => s + (r - mean_) ** 2, 0) / (result.residuals.length - 1))\n      const xd = xs.domain()\n      const xd0 = xd[0] ?? 0, xd1 = xd[1] ?? 1\n      g.append('line')\n        .attr('x1', xs(xd0)).attr('x2', xs(xd1))\n        .attr('y1', ys(mean_ + sd_ * xd0)).attr('y2', ys(mean_ + sd_ * xd1))\n        .attr('stroke', getColor(4, theme)).attr('stroke-width', 1.5).attr('stroke-dasharray', '5,2')\n    }\n\n    // Points\n    xData.forEach((xi, i) => {\n      g.append('circle')\n        .attr('cx', xs(xi)).attr('cy', ys(yData[i] ?? 0))\n        .attr('r', 2.5).attr('fill', color).attr('opacity', theme.pointOpacity)\n    })\n\n    // Axes\n    g.append('g').attr('transform', `translate(0,${ph})`).call(d3.axisBottom(xs).ticks(4))\n      .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n    g.append('g').call(d3.axisLeft(ys).ticks(4))\n      .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n  })\n}\n", "/**\n * Raincloud plot: half-violin + jitter + box.\n * Premium visualization for showing full distribution shape.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption, addNLabel } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport { quantile } from '../../core/math.js'\nimport type { GroupData, StatResult } from '../../core/types.js'\n\nexport interface RaincloudConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showN?: boolean\n  readonly showMean?: boolean\n  readonly showJitter?: boolean\n}\n\nexport interface RaincloudData {\n  readonly groups: readonly GroupData[]\n  readonly testResult?: StatResult\n}\n\nexport function renderRaincloud(\n  container: HTMLElement,\n  data: RaincloudData,\n  config: RaincloudConfig = {}\n): void {\n  import('d3').then(d3 => renderRaincloudD3(d3, container, data, config))\n}\n\nfunction renderRaincloudD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: RaincloudData,\n  config: RaincloudConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Raincloud Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const labels = data.groups.map(gr => gr.label)\n  const allValues = data.groups.flatMap(gr => [...gr.values])\n  const [yMin, yMax] = d3.extent(allValues) as [number, number]\n  const yPad = (yMax - yMin) * 0.1\n\n  const xScale = d3.scaleBand<string>().domain(labels).range([0, width]).padding(0.3)\n  const yScale = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll('.grid').data(yScale.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  data.groups.forEach((gr, gi) => {\n    const color = getColor(gi, theme)\n    const cx = (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2\n    const bw = (yMax - yMin) / 20\n    const violinR = xScale.bandwidth() * 0.35\n\n    // KDE\n    const kdePoints = kdeEstimate(gr.values, yScale.ticks(60), bw)\n    const maxD = Math.max(...kdePoints.map(p => p[1]))\n    const dScale = maxD > 0 ? violinR / maxD : 1\n\n    // Half violin (right side only \u2014 this is the \"cloud\")\n    const areaFn = d3.area<[number, number]>()\n      .x0(cx).x1(d => cx + d[1] * dScale)\n      .y(d => yScale(d[0])).curve(d3.curveCatmullRom)\n\n    g.append('path').datum(kdePoints).attr('d', areaFn)\n      .attr('fill', color).attr('opacity', theme.violinOpacity)\n      .attr('stroke', color).attr('stroke-width', 1)\n\n    // Box (narrow, slightly left of center)\n    const q1 = quantile(gr.values, 0.25)\n    const med = quantile(gr.values, 0.5)\n    const q3 = quantile(gr.values, 0.75)\n    const iqr = q3 - q1\n    const wLo = Math.min(...gr.values.filter(v => v >= q1 - 1.5 * iqr))\n    const wHi = Math.max(...gr.values.filter(v => v <= q3 + 1.5 * iqr))\n    const boxW = xScale.bandwidth() * 0.12\n    const bx = cx - violinR * 0.5  // shift box left\n\n    g.append('line').attr('x1', bx).attr('x2', bx)\n      .attr('y1', yScale(wLo)).attr('y2', yScale(wHi))\n      .attr('stroke', color).attr('stroke-width', 1.5)\n    g.append('rect')\n      .attr('x', bx - boxW / 2).attr('width', boxW)\n      .attr('y', yScale(q3)).attr('height', yScale(q1) - yScale(q3))\n      .attr('fill', theme.background).attr('stroke', color).attr('stroke-width', 2)\n    g.append('line').attr('x1', bx - boxW / 2).attr('x2', bx + boxW / 2)\n      .attr('y1', yScale(med)).attr('y2', yScale(med))\n      .attr('stroke', color).attr('stroke-width', 2.5)\n\n    // Mean diamond marker + value\n    if (config.showMean) {\n      const groupMean = gr.values.reduce((s, v) => s + v, 0) / gr.values.length\n      const my = yScale(groupMean)\n      const ds = 5\n      g.append('polygon')\n        .attr('points', `${bx},${my - ds} ${bx + ds},${my} ${bx},${my + ds} ${bx - ds},${my}`)\n        .attr('fill', 'white').attr('stroke', color).attr('stroke-width', 1.5)\n      g.append('text')\n        .attr('x', bx + ds + 4).attr('y', my + 3.5)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textAnnotation).text(groupMean.toFixed(2))\n    }\n\n    // Jitter (the \"rain\" \u2014 left of box)\n    if (config.showJitter !== false) {\n      const jx = bx - boxW - 4\n      const seed = gi * 99991\n      gr.values.forEach((v, vi) => {\n        const jitter = (pseudoRnd(seed + vi) - 0.5) * xScale.bandwidth() * 0.12\n        g.append('circle')\n          .attr('cx', jx + jitter).attr('cy', yScale(v))\n          .attr('r', 2.5).attr('fill', color).attr('opacity', theme.pointOpacity)\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event, [formatTooltipRow('Group', gr.label), formatTooltipRow('Value', v.toFixed(3))].join(''), theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    }\n\n    if (config.showN !== false) {\n      addNLabel(g, gr.values.length, cx, height + 60, theme)\n    }\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Value')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\nfunction kdeEstimate(data: readonly number[], xPoints: number[], bw: number): Array<[number, number]> {\n  return xPoints.map(x => {\n    const d = data.reduce((s, xi) => s + Math.exp(-0.5 * ((x - xi) / bw) ** 2) / (Math.sqrt(2 * Math.PI) * bw), 0) / data.length\n    return [x, d] as [number, number]\n  })\n}\n\nfunction pseudoRnd(seed: number): number {\n  const x = Math.sin(seed) * 10000\n  return x - Math.floor(x)\n}\n", "/**\n * LMM visualization: caterpillar plot of BLUPs + variance component chart.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport type { LMMResult } from '../../core/types.js'\n\nexport interface MixedPlotConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport function renderMixedPlot(\n  container: HTMLElement,\n  result: LMMResult,\n  blups: ReadonlyArray<{ group: string | number; blup: number }>,\n  config: MixedPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderMixedD3(d3, container, result, blups, config))\n}\n\nfunction renderMixedD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  result: LMMResult,\n  blups: ReadonlyArray<{ group: string | number; blup: number }>,\n  config: MixedPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 600\n  const H = config.height ?? Math.max(blups.length * 20 + 150, 300)\n  const margin = { top: theme.marginTop, right: 80, bottom: theme.marginBottom, left: 100 }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Random Effects (BLUPs)', result.formatted, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const sorted = [...blups].sort((a, b) => a.blup - b.blup)\n  const groupLabels = sorted.map(b => String(b.group))\n  const blupValues = sorted.map(b => b.blup)\n\n  const xExt = d3.extent(blupValues) as [number, number]\n  const xPad = Math.max(Math.abs(xExt[0]), Math.abs(xExt[1])) * 0.2\n  const xScale = d3.scaleLinear().domain([xExt[0] - xPad, xExt[1] + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleBand<string>().domain(groupLabels).range([height, 0]).padding(0.3)\n\n  // Zero line\n  g.append('line').attr('x1', xScale(0)).attr('x2', xScale(0))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '4,2').attr('stroke-width', 1.5)\n\n  // Grid\n  g.selectAll('.grid').data(xScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', d => xScale(d)).attr('x2', d => xScale(d))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // BLUP dots\n  sorted.forEach((b, _i) => {\n    const cy = (yScale(String(b.group)) ?? 0) + yScale.bandwidth() / 2\n    const color = b.blup >= 0 ? getColor(0, theme) : getColor(5, theme)\n    g.append('circle')\n      .attr('cx', xScale(b.blup)).attr('cy', cy)\n      .attr('r', 4).attr('fill', color)\n    // Whisker from 0\n    g.append('line')\n      .attr('x1', xScale(0)).attr('x2', xScale(b.blup))\n      .attr('y1', cy).attr('y2', cy)\n      .attr('stroke', color).attr('stroke-width', 1.5).attr('opacity', 0.5)\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text('BLUP (random intercept)')\n\n  // ICC annotation\n  svg.append('text').attr('x', W - 10).attr('y', H - 10)\n    .attr('text-anchor', 'end').attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall)\n    .attr('fill', theme.textMuted).text(`ICC = ${result.icc.toFixed(3)}`)\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * PCA visualizations: biplot, scree plot, loadings heatmap.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport type { PCAResult } from '../../core/types.js'\n\nexport interface PCAPlotConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly variableLabels?: readonly string[]\n  readonly observationLabels?: readonly string[]\n  readonly type?: 'biplot' | 'scree' | 'loadings'\n}\n\nexport function renderPCAPlot(\n  container: HTMLElement,\n  pca: PCAResult,\n  config: PCAPlotConfig = {}\n): void {\n  import('d3').then(d3 => {\n    const type = config.type ?? 'biplot'\n    if (type === 'biplot') renderBiplot(d3, container, pca, config)\n    else if (type === 'scree') renderScree(d3, container, pca, config)\n    else renderLoadingsHeatmap(d3, container, pca, config)\n  })\n}\n\nfunction renderBiplot(d3: typeof D3, container: HTMLElement, pca: PCAResult, config: PCAPlotConfig): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 500, H = config.height ?? 500\n  const margin = { top: theme.marginTop, right: 60, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right, height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const pct1 = ((pca.varianceExplained[0] ?? 0) * 100).toFixed(1)\n  const pct2 = ((pca.varianceExplained[1] ?? 0) * 100).toFixed(1)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'PCA Biplot', `PC1 (${pct1}%) \u00D7 PC2 (${pct2}%)`, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const scores = pca.scores\n  const xs = scores.map(s => s[0] ?? 0), ys = scores.map(s => s[1] ?? 0)\n  const xExt = d3.extent(xs) as [number, number], yExt = d3.extent(ys) as [number, number]\n  const xPad = (xExt[1] - xExt[0]) * 0.1, yPad = (yExt[1] - yExt[0]) * 0.1\n\n  const xScale = d3.scaleLinear().domain([xExt[0] - xPad, xExt[1] + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleLinear().domain([yExt[0] - yPad, yExt[1] + yPad]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll('.grid-h').data(yScale.ticks(5)).join('line')\n    .attr('x1', 0).attr('x2', width).attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Zero lines\n  g.append('line').attr('x1', xScale(0)).attr('x2', xScale(0)).attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '4,2')\n  g.append('line').attr('x1', 0).attr('x2', width).attr('y1', yScale(0)).attr('y2', yScale(0))\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '4,2')\n\n  // Observation points\n  scores.forEach((s, i) => {\n    g.append('circle').attr('cx', xScale(s[0] ?? 0)).attr('cy', yScale(s[1] ?? 0))\n      .attr('r', 3.5).attr('fill', getColor(0, theme)).attr('opacity', theme.pointOpacity)\n    if (config.observationLabels?.[i]) {\n      g.append('text').attr('x', xScale(s[0] ?? 0) + 5).attr('y', yScale(s[1] ?? 0) + 4)\n        .attr('font-size', theme.fontSizeSmall - 2).attr('fill', theme.textMuted)\n        .text(config.observationLabels[i]!)\n    }\n  })\n\n  // Loading vectors\n  const scale_ = Math.min(width, height) * 0.4\n  pca.loadings.forEach((loading, vi) => {\n    const lx = (loading[0] ?? 0) * scale_, ly = (loading[1] ?? 0) * scale_\n    const x0 = xScale(0), y0 = yScale(0)\n    const color = getColor(vi % 8 + 1, theme)\n    g.append('line')\n      .attr('x1', x0).attr('y1', y0)\n      .attr('x2', x0 + lx).attr('y2', y0 - ly)\n      .attr('stroke', color).attr('stroke-width', 1.5)\n      .attr('marker-end', 'url(#arrow)')\n    g.append('text')\n      .attr('x', x0 + lx + 5).attr('y', y0 - ly + 4)\n      .attr('font-size', theme.fontSizeSmall).attr('fill', color)\n      .text(config.variableLabels?.[vi] ?? `Var${vi + 1}`)\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text)\n    .text(`PC1 (${pct1}%)`)\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text)\n    .text(`PC2 (${pct2}%)`)\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\nfunction renderScree(d3: typeof D3, container: HTMLElement, pca: PCAResult, config: PCAPlotConfig): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 500, H = config.height ?? 350\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right, height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'Scree Plot', 'Eigenvalue by component', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const comps = pca.eigenvalues.map((_, i) => i + 1)\n  const xScale = d3.scaleBand<number>().domain(comps).range([0, width]).padding(0.3)\n  const yScale = d3.scaleLinear().domain([0, Math.max(...pca.eigenvalues) * 1.1]).range([height, 0]).nice()\n\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('x1', 0).attr('x2', width).attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Eigenvalue=1 reference line\n  g.append('line').attr('x1', 0).attr('x2', width)\n    .attr('y1', yScale(1)).attr('y2', yScale(1))\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '6,3').attr('stroke-width', 1.5)\n\n  // Bars\n  pca.eigenvalues.forEach((ev, i) => {\n    const x = xScale(i + 1) ?? 0\n    g.append('rect').attr('x', x).attr('y', yScale(ev))\n      .attr('width', xScale.bandwidth()).attr('height', height - yScale(ev))\n      .attr('fill', getColor(i, theme)).attr('opacity', 0.8).attr('rx', 2)\n    g.append('text').attr('x', x + xScale.bandwidth() / 2).attr('y', yScale(ev) - 4)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text).text(ev.toFixed(2))\n  })\n\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Component')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Eigenvalue')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\nfunction renderLoadingsHeatmap(d3: typeof D3, container: HTMLElement, pca: PCAResult, config: PCAPlotConfig): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const nVars = pca.loadings.length\n  const nc = pca.nComponents\n  const cellSize = 50\n  const W = config.width ?? (nc * cellSize + 120), H = config.height ?? (nVars * cellSize + 100)\n  const margin = { top: 60, right: 20, bottom: 40, left: 100 }\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'PCA Loadings', '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n  const colorScale = d3.scaleSequential().domain([-1, 1]).interpolator(d3.interpolateRdBu)\n\n  pca.loadings.forEach((row, vi) => {\n    row.forEach((val, ci) => {\n      g.append('rect').attr('x', ci * cellSize).attr('y', vi * cellSize)\n        .attr('width', cellSize - 2).attr('height', cellSize - 2).attr('rx', 3)\n        .attr('fill', colorScale(val))\n      g.append('text').attr('x', ci * cellSize + cellSize / 2).attr('y', vi * cellSize + cellSize / 2 + 4)\n        .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', Math.abs(val) > 0.6 ? '#fff' : theme.text).text(val.toFixed(2))\n    })\n    const label = config.variableLabels?.[vi] ?? `Var${vi + 1}`\n    g.append('text').attr('x', -6).attr('y', vi * cellSize + cellSize / 2 + 4)\n      .attr('text-anchor', 'end').attr('font-size', theme.fontSizeSmall).attr('fill', theme.text).text(label)\n  })\n\n  Array.from({ length: nc }, (_, ci) => {\n    g.append('text').attr('x', ci * cellSize + cellSize / 2).attr('y', -8)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall).attr('fill', theme.text).text(`PC${ci + 1}`)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Interactive distribution explorer.\n * Shows PDF/CDF for normal, t, chi-square, F, binomial, Poisson distributions.\n * Uses jStat for accurate distribution functions.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { normalCDF } from '../../core/math.js'\n\nexport type DistributionName = 'normal' | 't' | 'chi-square' | 'F' | 'uniform' | 'exponential'\n\nexport interface DistributionParams {\n  readonly distribution: DistributionName\n  readonly params: Readonly<Record<string, number>>  // e.g. { mean: 0, sd: 1 }\n  readonly showPDF?: boolean\n  readonly showCDF?: boolean\n  readonly highlightX?: number  // shade area to the left of this x\n}\n\nexport interface DistributionConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport function renderDistribution(\n  container: HTMLElement,\n  params: DistributionParams,\n  config: DistributionConfig = {}\n): void {\n  import('d3').then(d3 => renderDistD3(d3, container, params, config))\n}\n\nfunction renderDistD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  params: DistributionParams,\n  config: DistributionConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 550, H = config.height ?? 350\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right, height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  // Get PDF and x domain\n  const { xMin, xMax, pdf, cdf } = getDistributionFunctions(params)\n  const nPoints = 200\n  const xs = Array.from({ length: nPoints }, (_, i) => xMin + (xMax - xMin) * i / (nPoints - 1))\n  const pdfs = xs.map(x => pdf(x))\n  const cdfs = xs.map(x => cdf(x))\n\n  const subtitle = formatDistributionParams(params)\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? `${params.distribution} distribution`, subtitle, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, width])\n  const maxPDF = Math.max(...pdfs.filter(isFinite))\n  const yScale = d3.scaleLinear().domain([0, maxPDF * 1.1]).range([height, 0])\n\n  // Grid\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('x1', 0).attr('x2', width).attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  const lineData = xs.map((x, i) => ({ x, y: pdfs[i] ?? 0 })).filter(d => isFinite(d.y))\n\n  // Highlight area\n  if (params.highlightX !== undefined) {\n    const hx = params.highlightX\n    const shadedData = lineData.filter(d => d.x <= hx)\n    const area = d3.area<typeof shadedData[0]>()\n      .x(d => xScale(d.x)).y0(height).y1(d => yScale(d.y))\n    g.append('path').datum(shadedData).attr('d', area)\n      .attr('fill', getColor(0, theme)).attr('opacity', 0.25)\n\n    // P-value label\n    const p = cdf(hx)\n    g.append('text').attr('x', xScale(hx)).attr('y', 20)\n      .attr('text-anchor', 'middle').attr('font-family', theme.fontFamilyMono)\n      .attr('font-size', theme.fontSizeSmall).attr('fill', theme.textAnnotation)\n      .text(`P(X \u2264 ${hx.toFixed(2)}) = ${p.toFixed(4)}`)\n  }\n\n  // PDF curve\n  if (params.showPDF !== false) {\n    const line = d3.line<typeof lineData[0]>().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveBasis)\n    g.append('path').datum(lineData).attr('d', line)\n      .attr('fill', 'none').attr('stroke', getColor(0, theme)).attr('stroke-width', 2.5)\n  }\n\n  // CDF curve (secondary y-axis, mapped to same pixel space [0, maxPDF])\n  if (params.showCDF === true) {\n    const cdfData = xs.map((x, i) => ({ x, y: (cdfs[i] ?? 0) * maxPDF })).filter(d => isFinite(d.y))\n    const line = d3.line<typeof cdfData[0]>().x(d => xScale(d.x)).y(d => yScale(d.y)).curve(d3.curveBasis)\n    g.append('path').datum(cdfData).attr('d', line)\n      .attr('fill', 'none').attr('stroke', getColor(1, theme))\n      .attr('stroke-width', 2).attr('stroke-dasharray', '6,3')\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('x')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Density')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\nfunction getDistributionFunctions(params: DistributionParams): {\n  xMin: number; xMax: number\n  pdf: (x: number) => number\n  cdf: (x: number) => number\n} {\n  const p = params.params\n  switch (params.distribution) {\n    case 'normal': {\n      const mu = p['mean'] ?? 0, sigma = p['sd'] ?? 1\n      return {\n        xMin: mu - 4 * sigma, xMax: mu + 4 * sigma,\n        pdf: x => Math.exp(-0.5 * ((x - mu) / sigma) ** 2) / (sigma * Math.sqrt(2 * Math.PI)),\n        cdf: x => normalCDF((x - mu) / sigma),\n      }\n    }\n    case 't': {\n      const df = p['df'] ?? 5\n      return {\n        xMin: -5, xMax: 5,\n        pdf: x => {\n          const c = Math.exp(lgamma((df + 1) / 2) - lgamma(df / 2)) / Math.sqrt(df * Math.PI)\n          return c * Math.pow(1 + x * x / df, -(df + 1) / 2)\n        },\n        cdf: x => tDistCDFLocal(x, df),\n      }\n    }\n    case 'chi-square': {\n      const df = p['df'] ?? 5\n      return {\n        xMin: 0, xMax: df + 5 * Math.sqrt(2 * df),\n        pdf: x => x <= 0 ? 0 : Math.exp((df / 2 - 1) * Math.log(x) - x / 2 - (df / 2) * Math.log(2) - lgamma(df / 2)),\n        cdf: x => chiSqCDFLocal(x, df),\n      }\n    }\n    case 'uniform': {\n      const a = p['min'] ?? 0, b = p['max'] ?? 1\n      return {\n        xMin: a - 0.2 * (b - a), xMax: b + 0.2 * (b - a),\n        pdf: x => (x >= a && x <= b) ? 1 / (b - a) : 0,\n        cdf: x => x < a ? 0 : x > b ? 1 : (x - a) / (b - a),\n      }\n    }\n    case 'exponential': {\n      const rate = p['rate'] ?? 1\n      return {\n        xMin: 0, xMax: 5 / rate,\n        pdf: x => x < 0 ? 0 : rate * Math.exp(-rate * x),\n        cdf: x => x < 0 ? 0 : 1 - Math.exp(-rate * x),\n      }\n    }\n    case 'F': {\n      const df1 = p['df1'] ?? 2, df2 = p['df2'] ?? 10\n      return {\n        xMin: 0, xMax: 6,\n        pdf: x => {\n          if (x <= 0) return 0\n          const num = Math.pow(df1 * x, df1) * Math.pow(df2, df2)\n          const den = Math.pow(df1 * x + df2, df1 + df2)\n          return Math.sqrt(num / den) / (x * Math.exp(logBetaLocal(df1 / 2, df2 / 2)))\n        },\n        cdf: x => {\n          if (x <= 0) return 0\n          return incompleteBetaLocal(df1 * x / (df1 * x + df2), df1 / 2, df2 / 2)\n        },\n      }\n    }\n    default:\n      throw new Error(`Unknown distribution: ${params.distribution}`)\n  }\n}\n\nfunction formatDistributionParams(params: DistributionParams): string {\n  const entries = Object.entries(params.params).map(([k, v]) => `${k} = ${v}`).join(', ')\n  return `${params.distribution}(${entries})`\n}\n\n// Minimal standalone implementations to avoid circular imports\nfunction lgamma(z: number): number {\n  const c = [0.99999999999980993, 676.5203681218851, -1259.1392167224028, 771.32342877765313, -176.61502916214059, 12.507343278686905, -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7]\n  const x = z - 1\n  let sum = c[0]!\n  for (let i = 1; i < 9; i++) sum += (c[i] ?? 0) / (x + i)\n  const t = x + 7.5\n  return 0.5 * Math.log(2 * Math.PI) + (x + 0.5) * Math.log(t) - t + Math.log(sum)\n}\n\nfunction tDistCDFLocal(t: number, df: number): number {\n  const x = df / (df + t * t)\n  const p = incompleteBetaLocal(x, df / 2, 0.5) / 2\n  return t >= 0 ? 1 - p : p\n}\n\nfunction chiSqCDFLocal(x: number, df: number): number {\n  if (x <= 0) return 0\n  return incompleteGammaLocal(df / 2, x / 2)\n}\n\nfunction incompleteGammaLocal(a: number, x: number): number {\n  if (x < a + 1) {\n    let term = 1 / a, sum = term\n    for (let n = 1; n < 200; n++) {\n      term *= x / (a + n); sum += term\n      if (Math.abs(term) < Math.abs(sum) * 3e-7) break\n    }\n    return sum * Math.exp(-x + a * Math.log(x) - lgamma(a))\n  }\n  let f = x + 1 - a; const FPMIN = 1e-30\n  if (Math.abs(f) < FPMIN) f = FPMIN\n  let C = f, D = 0\n  for (let i = 1; i <= 200; i++) {\n    const an = -i * (i - a), bn = x + 2 * i + 1 - a\n    D = bn + an * D; if (Math.abs(D) < FPMIN) D = FPMIN\n    C = bn + an / C; if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D; const delta = C * D; f *= delta\n    if (Math.abs(delta - 1) < 3e-7) break\n  }\n  return 1 - Math.exp(-x + a * Math.log(x) - lgamma(a)) / f\n}\n\nfunction logBetaLocal(a: number, b: number): number {\n  return lgamma(a) + lgamma(b) - lgamma(a + b)\n}\n\nfunction incompleteBetaLocal(x: number, a: number, b: number): number {\n  if (x <= 0) return 0; if (x >= 1) return 1\n  if (x > (a + 1) / (a + b + 2)) return 1 - incompleteBetaLocal(1 - x, b, a)\n  const front = Math.exp(Math.log(x) * a + Math.log(1 - x) * b - logBetaLocal(a, b)) / a\n  const FPMIN = 1e-30\n  let f = 1, C = 1, D = 1 - (a + b) * x / (a + 1)\n  if (Math.abs(D) < FPMIN) D = FPMIN; D = 1 / D; f = D\n  for (let m = 1; m <= 200; m++) {\n    let num = m * (b - m) * x / ((a + 2 * m - 1) * (a + 2 * m))\n    D = 1 + num * D; if (Math.abs(D) < FPMIN) D = FPMIN\n    C = 1 + num / C; if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D; f *= C * D\n    num = -(a + m) * (a + b + m) * x / ((a + 2 * m) * (a + 2 * m + 1))\n    D = 1 + num * D; if (Math.abs(D) < FPMIN) D = FPMIN\n    C = 1 + num / C; if (Math.abs(C) < FPMIN) C = FPMIN\n    D = 1 / D; const delta = C * D; f *= delta\n    if (Math.abs(delta - 1) < 3e-7) break\n  }\n  return front * f\n}\n", "/**\n * Density plot: KDE curves for one or more series with optional rug ticks.\n * Uses Silverman's rule-of-thumb bandwidth: 1.06 * \u03C3 * n^(-1/5)\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface DensityConfig {\n  readonly bandwidth?: number\n  readonly showRug?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showLegend?: boolean\n}\n\nexport interface DensitySeries {\n  readonly label: string\n  readonly values: readonly number[]\n}\n\nexport interface DensityData {\n  readonly series: readonly DensitySeries[]\n  readonly testResult?: StatResult\n}\n\nexport function renderDensity(\n  container: HTMLElement,\n  data: DensityData,\n  config: DensityConfig = {}\n): void {\n  import('d3').then(d3 => renderDensityD3(d3, container, data, config))\n}\n\nfunction silvermanBW(values: readonly number[]): number {\n  const n = values.length\n  if (n < 2) return 1\n  const m = values.reduce((s, v) => s + v, 0) / n\n  const std = Math.sqrt(values.reduce((s, v) => s + (v - m) ** 2, 0) / (n - 1))\n  return 1.06 * std * Math.pow(n, -0.2)\n}\n\nfunction kdeGaussian(values: readonly number[], xPoints: number[], bw: number): Array<[number, number]> {\n  return xPoints.map(x => {\n    const density = values.reduce((s, xi) =>\n      s + Math.exp(-0.5 * ((x - xi) / bw) ** 2) / (Math.sqrt(2 * Math.PI) * bw), 0\n    ) / values.length\n    return [x, density] as [number, number]\n  })\n}\n\nfunction renderDensityD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: DensityData,\n  config: DensityConfig\n): void {\n  if (data.series.length === 0 || data.series.every(s => s.values.length === 0)) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 420\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n  const showRug = config.showRug ?? true\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Density Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allValues = data.series.flatMap(s => [...s.values])\n  const [xMin, xMax] = d3.extent(allValues) as [number, number]\n  const xPad = (xMax - xMin) * 0.1\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n\n  // Compute KDE for each series\n  const xTicks = xScale.ticks(100)\n  const seriesDensities = data.series.map(s => {\n    const bw = config.bandwidth ?? silvermanBW(s.values)\n    return kdeGaussian(s.values, xTicks, bw)\n  })\n\n  const maxDensity = Math.max(...seriesDensities.flatMap(pts => pts.map(p => p[1])))\n  const rugHeight = showRug ? height - 12 : height\n  const yScale = d3.scaleLinear().domain([0, maxDensity * 1.1]).range([rugHeight, 0]).nice()\n\n  // Grid lines\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Draw density curves and areas\n  seriesDensities.forEach((pts, i) => {\n    const color = getColor(i, theme)\n    const lineGen = d3.line<[number, number]>()\n      .x(d => xScale(d[0])).y(d => yScale(d[1])).curve(d3.curveCatmullRom)\n    const areaGen = d3.area<[number, number]>()\n      .x(d => xScale(d[0])).y0(yScale(0)).y1(d => yScale(d[1])).curve(d3.curveCatmullRom)\n\n    g.append('path').datum(pts).attr('d', areaGen)\n      .attr('fill', color).attr('opacity', theme.ciOpacity)\n    g.append('path').datum(pts).attr('d', lineGen)\n      .attr('fill', 'none').attr('stroke', color).attr('stroke-width', 2)\n  })\n\n  // Rug ticks\n  if (showRug) {\n    data.series.forEach((s, i) => {\n      const color = getColor(i, theme)\n      const rugY = height - 10\n      s.values.forEach(v => {\n        g.append('line')\n          .attr('x1', xScale(v)).attr('x2', xScale(v))\n          .attr('y1', rugY).attr('y2', rugY + 6)\n          .attr('stroke', color).attr('stroke-width', 1).attr('opacity', 0.5)\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event,\n              [formatTooltipRow('Series', s.label), formatTooltipRow('Value', v.toFixed(3))].join(''),\n              theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    })\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${rugHeight})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Density')\n\n  // Legend (if multiple series)\n  if (config.showLegend !== false && data.series.length > 1) {\n    data.series.forEach((s, i) => {\n      const color = getColor(i, theme)\n      const lx = width - 120\n      const ly = i * 18 + 8\n      g.append('line').attr('x1', lx).attr('x2', lx + 20).attr('y1', ly).attr('y2', ly)\n        .attr('stroke', color).attr('stroke-width', 2)\n      g.append('text').attr('x', lx + 24).attr('y', ly + 4)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text).text(s.label)\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Standalone box plot: Q1/Q3/median/whiskers (1.5 IQR)/outliers per group.\n * No violin. Uses quantile() from core/math.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport { quantile } from '../../core/math.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface BoxplotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showN?: boolean\n  readonly showMean?: boolean\n  readonly showOutliers?: boolean\n  readonly showMedian?: boolean\n}\n\nexport interface BoxplotGroup {\n  readonly label: string\n  readonly values: readonly number[]\n}\n\nexport interface BoxplotData {\n  readonly groups: readonly BoxplotGroup[]\n  readonly testResult?: StatResult\n}\n\nexport function renderBoxplot(\n  container: HTMLElement,\n  data: BoxplotData,\n  config: BoxplotConfig = {}\n): void {\n  import('d3').then(d3 => renderBoxplotD3(d3, container, data, config))\n}\n\nfunction computeBoxStats(values: readonly number[]) {\n  const q1 = quantile(values, 0.25)\n  const med = quantile(values, 0.5)\n  const q3 = quantile(values, 0.75)\n  const iqr = q3 - q1\n  const fence_lo = q1 - 1.5 * iqr\n  const fence_hi = q3 + 1.5 * iqr\n  const whisker_lo = Math.min(...values.filter(v => v >= fence_lo))\n  const whisker_hi = Math.max(...values.filter(v => v <= fence_hi))\n  const outliers = values.filter(v => v < fence_lo || v > fence_hi)\n  return { q1, med, q3, whisker_lo, whisker_hi, outliers }\n}\n\nfunction renderBoxplotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: BoxplotData,\n  config: BoxplotConfig\n): void {\n  if (data.groups.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 440\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Box Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const labels = data.groups.map(gr => gr.label)\n  const allValues = data.groups.flatMap(gr => [...gr.values])\n  const [yMin, yMax] = d3.extent(allValues) as [number, number]\n  const yPad = (yMax - yMin) * 0.1\n\n  const xScale = d3.scaleBand<string>().domain(labels).range([0, width]).padding(0.3)\n  const yScale = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([height, 0]).nice()\n\n  // Grid lines\n  g.selectAll('.grid').data(yScale.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  data.groups.forEach((gr, gi) => {\n    if (gr.values.length === 0) return\n    const color = getColor(gi, theme)\n    const bx = (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2\n    const boxW = xScale.bandwidth() * 0.5\n    const { q1, med, q3, whisker_lo, whisker_hi, outliers } = computeBoxStats(gr.values)\n\n    // Whisker lines\n    g.append('line')\n      .attr('x1', bx).attr('x2', bx)\n      .attr('y1', yScale(whisker_lo)).attr('y2', yScale(q1))\n      .attr('stroke', color).attr('stroke-width', 1.5).attr('stroke-dasharray', '3,2')\n    g.append('line')\n      .attr('x1', bx).attr('x2', bx)\n      .attr('y1', yScale(q3)).attr('y2', yScale(whisker_hi))\n      .attr('stroke', color).attr('stroke-width', 1.5).attr('stroke-dasharray', '3,2')\n\n    // Whisker caps\n    const capW = boxW * 0.4\n    g.append('line').attr('x1', bx - capW / 2).attr('x2', bx + capW / 2)\n      .attr('y1', yScale(whisker_lo)).attr('y2', yScale(whisker_lo))\n      .attr('stroke', color).attr('stroke-width', 1.5)\n    g.append('line').attr('x1', bx - capW / 2).attr('x2', bx + capW / 2)\n      .attr('y1', yScale(whisker_hi)).attr('y2', yScale(whisker_hi))\n      .attr('stroke', color).attr('stroke-width', 1.5)\n\n    // IQR box\n    g.append('rect')\n      .attr('x', bx - boxW / 2).attr('width', boxW)\n      .attr('y', yScale(q3)).attr('height', Math.max(1, yScale(q1) - yScale(q3)))\n      .attr('fill', color).attr('opacity', theme.violinOpacity)\n      .attr('stroke', color).attr('stroke-width', 2).attr('rx', 2)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('Group', gr.label),\n          formatTooltipRow('Median', med.toFixed(3)),\n          formatTooltipRow('Q1', q1.toFixed(3)),\n          formatTooltipRow('Q3', q3.toFixed(3)),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Median line + value\n    if (config.showMedian !== false) {\n      g.append('line')\n        .attr('x1', bx - boxW / 2).attr('x2', bx + boxW / 2)\n        .attr('y1', yScale(med)).attr('y2', yScale(med))\n        .attr('stroke', theme.background).attr('stroke-width', 2.5)\n      g.append('text')\n        .attr('x', bx + boxW / 2 + 4).attr('y', yScale(med) + 3.5)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textAnnotation).text(med.toFixed(2))\n    }\n\n    // Mean diamond marker + value\n    if (config.showMean) {\n      const groupMean = gr.values.reduce((s, v) => s + v, 0) / gr.values.length\n      const my = yScale(groupMean)\n      const ds = 5\n      g.append('polygon')\n        .attr('points', `${bx},${my - ds} ${bx + ds},${my} ${bx},${my + ds} ${bx - ds},${my}`)\n        .attr('fill', 'white').attr('stroke', color).attr('stroke-width', 1.5)\n      g.append('text')\n        .attr('x', bx + ds + 4).attr('y', my + 3.5)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textAnnotation).text(groupMean.toFixed(2))\n    }\n\n    // Outliers\n    if (config.showOutliers !== false) {\n      outliers.forEach((v) => {\n        g.append('circle')\n          .attr('cx', bx).attr('cy', yScale(v))\n          .attr('r', 3.5).attr('fill', 'none').attr('stroke', color).attr('stroke-width', 1.5)\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event, [\n              formatTooltipRow('Group', gr.label),\n              formatTooltipRow('Outlier', v.toFixed(3)),\n            ].join(''), theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    }\n\n    // n label\n    if (config.showN !== false) {\n      g.append('text').attr('x', bx).attr('y', height + 44)\n        .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall).attr('fill', theme.textMuted)\n        .text(`n = ${gr.values.length}`)\n    }\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 60)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Value')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Lollipop chart: stem + circle for each category.\n * Horizontal layout (categories on y-axis, values on x-axis).\n * Optional descending sort.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface LollipopConfig {\n  readonly sorted?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface LollipopData {\n  readonly labels: readonly string[]\n  readonly values: readonly number[]\n  readonly testResult?: StatResult\n}\n\nexport function renderLollipop(\n  container: HTMLElement,\n  data: LollipopData,\n  config: LollipopConfig = {}\n): void {\n  import('d3').then(d3 => renderLollipopD3(d3, container, data, config))\n}\n\nfunction renderLollipopD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: LollipopData,\n  config: LollipopConfig\n): void {\n  if (data.labels.length === 0 || data.values.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const itemCount = data.labels.length\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? Math.max(200, itemCount * 36 + theme.marginTop + theme.marginBottom)\n  const margin = { top: theme.marginTop, right: theme.marginRight + 20, bottom: theme.marginBottom, left: theme.marginLeft + 40 }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Lollipop Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // Build ordered index\n  let indices = data.labels.map((_, i) => i)\n  if (config.sorted) {\n    indices = [...indices].sort((a, b) => (data.values[b] ?? 0) - (data.values[a] ?? 0))\n  }\n\n  const orderedLabels = indices.map(i => data.labels[i] ?? '')\n  const orderedValues = indices.map(i => data.values[i] ?? 0)\n\n  const [vMin, vMax] = d3.extent(orderedValues) as [number, number]\n  const xMin = Math.min(0, vMin)\n  const xMax = Math.max(0, vMax)\n  const xPad = (xMax - xMin) * 0.1\n\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleBand<string>().domain(orderedLabels).range([0, height]).padding(0.35)\n\n  // Grid lines (vertical)\n  g.selectAll('.grid').data(xScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', d => xScale(d)).attr('x2', d => xScale(d))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Zero line\n  g.append('line')\n    .attr('x1', xScale(0)).attr('x2', xScale(0))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.axisLine).attr('stroke-width', 1.5)\n\n  // Lollipops\n  orderedLabels.forEach((label, i) => {\n    const val = orderedValues[i] ?? 0\n    const cy = (yScale(label) ?? 0) + yScale.bandwidth() / 2\n    const color = getColor(0, theme)\n\n    // Stem\n    g.append('line')\n      .attr('x1', xScale(0)).attr('x2', xScale(val))\n      .attr('y1', cy).attr('y2', cy)\n      .attr('stroke', color).attr('stroke-width', 2).attr('opacity', 0.7)\n\n    // Circle\n    g.append('circle')\n      .attr('cx', xScale(val)).attr('cy', cy).attr('r', 6)\n      .attr('fill', color).attr('stroke', theme.background).attr('stroke-width', 1.5)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('Label', label),\n          formatTooltipRow('Value', val.toFixed(3)),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Value')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -margin.left + 12)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? '')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Cleveland dot plot: horizontal layout with labels on y-axis.\n * Supports single dots or paired dots connected by a line (group comparison).\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface DotPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface DotPlotData {\n  readonly labels: readonly string[]\n  readonly values: readonly number[]\n  readonly group2?: readonly number[]\n  readonly group1Label?: string\n  readonly group2Label?: string\n  readonly testResult?: StatResult\n}\n\nexport function renderDotPlot(\n  container: HTMLElement,\n  data: DotPlotData,\n  config: DotPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderDotPlotD3(d3, container, data, config))\n}\n\nfunction renderDotPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: DotPlotData,\n  config: DotPlotConfig\n): void {\n  if (data.labels.length === 0 || data.values.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const itemCount = data.labels.length\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? Math.max(200, itemCount * 36 + theme.marginTop + theme.marginBottom)\n  const margin = { top: theme.marginTop, right: theme.marginRight + 20, bottom: theme.marginBottom, left: theme.marginLeft + 40 }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n  const isPaired = data.group2 != null && data.group2.length === data.labels.length\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Dot Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allValues: number[] = [...data.values]\n  if (isPaired) allValues.push(...data.group2!)\n  const [vMin, vMax] = d3.extent(allValues) as [number, number]\n  const xPad = (vMax - vMin) * 0.1\n\n  const xScale = d3.scaleLinear().domain([vMin - xPad, vMax + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleBand<string>().domain([...data.labels]).range([0, height]).padding(0.35)\n\n  // Grid lines (vertical)\n  g.selectAll('.grid').data(xScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', d => xScale(d)).attr('x2', d => xScale(d))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  const color1 = getColor(0, theme)\n  const color2 = getColor(1, theme)\n\n  data.labels.forEach((label, i) => {\n    const v1 = data.values[i] ?? 0\n    const v2 = isPaired ? (data.group2![i] ?? 0) : null\n    const cy = (yScale(label) ?? 0) + yScale.bandwidth() / 2\n\n    // Connecting line for paired\n    if (isPaired && v2 !== null) {\n      g.append('line')\n        .attr('x1', xScale(v1)).attr('x2', xScale(v2))\n        .attr('y1', cy).attr('y2', cy)\n        .attr('stroke', theme.gridLine).attr('stroke-width', 2)\n    }\n\n    // Group 1 dot\n    g.append('circle')\n      .attr('cx', xScale(v1)).attr('cy', cy).attr('r', 6)\n      .attr('fill', color1).attr('stroke', theme.background).attr('stroke-width', 1.5)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('Label', label),\n          formatTooltipRow(data.group1Label ?? 'Value', v1.toFixed(3)),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Group 2 dot (paired)\n    if (isPaired && v2 !== null) {\n      g.append('circle')\n        .attr('cx', xScale(v2)).attr('cy', cy).attr('r', 6)\n        .attr('fill', color2).attr('stroke', theme.background).attr('stroke-width', 1.5)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Label', label),\n            formatTooltipRow(data.group2Label ?? 'Group 2', v2.toFixed(3)),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    }\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Value')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -margin.left + 12)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? '')\n\n  // Legend for paired\n  if (isPaired) {\n    const legendX = width - 140\n    const label1 = data.group1Label ?? 'Group 1'\n    const label2 = data.group2Label ?? 'Group 2'\n    g.append('circle').attr('cx', legendX + 6).attr('cy', 8).attr('r', 5).attr('fill', color1)\n    g.append('text').attr('x', legendX + 16).attr('y', 12)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(label1)\n    g.append('circle').attr('cx', legendX + 6).attr('cy', 26).attr('r', 5).attr('fill', color2)\n    g.append('text').attr('x', legendX + 16).attr('y', 30)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(label2)\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Grouped or stacked bar chart: multiple series per category.\n * type='grouped' renders bars side-by-side; type='stacked' stacks them.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface GroupedBarConfig {\n  readonly type?: 'grouped' | 'stacked'\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface GroupedBarSeries {\n  readonly label: string\n  readonly values: readonly number[]\n}\n\nexport interface GroupedBarData {\n  readonly categories: readonly string[]\n  readonly series: readonly GroupedBarSeries[]\n  readonly testResult?: StatResult\n}\n\nexport function renderGroupedBar(\n  container: HTMLElement,\n  data: GroupedBarData,\n  config: GroupedBarConfig = {}\n): void {\n  import('d3').then(d3 => renderGroupedBarD3(d3, container, data, config))\n}\n\nfunction renderGroupedBarD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: GroupedBarData,\n  config: GroupedBarConfig\n): void {\n  if (data.categories.length === 0 || data.series.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const chartType = config.type ?? 'grouped'\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 440\n  const margin = { top: theme.marginTop, right: theme.marginRight + 20, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? (chartType === 'stacked' ? 'Stacked Bar Chart' : 'Grouped Bar Chart'),\n    data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const categories = [...data.categories]\n  const seriesLabels = data.series.map(s => s.label)\n\n  // Build row data: one object per category\n  const rows = categories.map((cat, ci) => {\n    const obj: Record<string, number | string> = { cat }\n    data.series.forEach(s => { obj[s.label] = s.values[ci] ?? 0 })\n    return obj\n  })\n\n  let yMax: number\n  if (chartType === 'stacked') {\n    yMax = Math.max(...rows.map(row =>\n      data.series.reduce((sum, s) => sum + (row[s.label] as number), 0)\n    ))\n  } else {\n    yMax = Math.max(...data.series.flatMap(s => [...s.values].map(v => Math.abs(v))))\n  }\n\n  const xOuter = d3.scaleBand<string>().domain(categories).range([0, width]).padding(0.2)\n  const xInner = d3.scaleBand<string>().domain(seriesLabels).range([0, xOuter.bandwidth()]).padding(0.05)\n  const yScale = d3.scaleLinear().domain([0, yMax * 1.1]).range([height, 0]).nice()\n\n  // Grid lines\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  if (chartType === 'stacked') {\n    const stackGen = d3.stack<Record<string, number | string>>()\n      .keys(seriesLabels)\n      .value((row, key) => (row[key] as number) ?? 0)\n\n    const stackedData = stackGen(rows)\n\n    stackedData.forEach((layer, si) => {\n      const color = getColor(si, theme)\n      layer.forEach((seg, ci) => {\n        const cat = categories[ci] ?? ''\n        const bx = xOuter(cat) ?? 0\n        const bw = xOuter.bandwidth()\n        g.append('rect')\n          .attr('x', bx).attr('width', bw)\n          .attr('y', yScale(seg[1])).attr('height', Math.max(0, yScale(seg[0]) - yScale(seg[1])))\n          .attr('fill', color).attr('opacity', theme.violinOpacity)\n          .attr('stroke', theme.background).attr('stroke-width', 0.5)\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event, [\n              formatTooltipRow('Category', cat),\n              formatTooltipRow('Series', seriesLabels[si] ?? ''),\n              formatTooltipRow('Value', ((seg[1] - seg[0])).toFixed(3)),\n            ].join(''), theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    })\n  } else {\n    // Grouped bars\n    categories.forEach(cat => {\n      const bxOuter = xOuter(cat) ?? 0\n      data.series.forEach((s, si) => {\n        const color = getColor(si, theme)\n        const val = s.values[categories.indexOf(cat)] ?? 0\n        const bx = bxOuter + (xInner(s.label) ?? 0)\n        const bw = xInner.bandwidth()\n        g.append('rect')\n          .attr('x', bx).attr('width', bw)\n          .attr('y', yScale(Math.max(0, val))).attr('height', Math.abs(yScale(0) - yScale(val)))\n          .attr('fill', color).attr('opacity', theme.violinOpacity)\n          .attr('stroke', color).attr('stroke-width', 0.5).attr('rx', 2)\n          .on('mouseover', (event: MouseEvent) => {\n            showTooltip(event, [\n              formatTooltipRow('Category', cat),\n              formatTooltipRow('Series', s.label),\n              formatTooltipRow('Value', val.toFixed(3)),\n            ].join(''), theme)\n          })\n          .on('mouseout', hideTooltip)\n      })\n    })\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xOuter))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Value')\n\n  // Legend\n  data.series.forEach((s, i) => {\n    const color = getColor(i, theme)\n    const lx = width - 130\n    const ly = i * 18 + 8\n    g.append('rect').attr('x', lx).attr('y', ly - 9).attr('width', 14).attr('height', 10)\n      .attr('fill', color).attr('opacity', theme.violinOpacity).attr('rx', 2)\n    g.append('text').attr('x', lx + 18).attr('y', ly)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(s.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Multi-line chart with optional area fill.\n * Each series has its own line + color. Points at each data location.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface LineChartConfig {\n  readonly showArea?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface LineChartSeries {\n  readonly label: string\n  readonly x: readonly number[]\n  readonly y: readonly number[]\n}\n\nexport interface LineChartData {\n  readonly series: readonly LineChartSeries[]\n  readonly testResult?: StatResult\n}\n\nexport function renderLineChart(\n  container: HTMLElement,\n  data: LineChartData,\n  config: LineChartConfig = {}\n): void {\n  import('d3').then(d3 => renderLineChartD3(d3, container, data, config))\n}\n\nfunction renderLineChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: LineChartData,\n  config: LineChartConfig\n): void {\n  if (data.series.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 420\n  const margin = { top: theme.marginTop, right: theme.marginRight + 20, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n  const showArea = config.showArea ?? false\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Line Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allX = data.series.flatMap(s => [...s.x])\n  const allY = data.series.flatMap(s => [...s.y])\n  const [xMin, xMax] = d3.extent(allX) as [number, number]\n  const [yMin, yMax] = d3.extent(allY) as [number, number]\n  const xPad = (xMax - xMin) * 0.05\n  const yPad = (yMax - yMin) * 0.1\n\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleLinear().domain([Math.min(0, yMin - yPad), yMax + yPad]).range([height, 0]).nice()\n\n  // Grid lines\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  data.series.forEach((s, si) => {\n    if (s.x.length === 0 || s.y.length === 0) return\n    const color = getColor(si, theme)\n    const pts = s.x.map((x, i) => [x, s.y[i] ?? 0] as [number, number])\n      .sort((a, b) => a[0] - b[0])\n\n    // Area fill\n    if (showArea) {\n      const areaGen = d3.area<[number, number]>()\n        .x(d => xScale(d[0])).y0(yScale(0)).y1(d => yScale(d[1])).curve(d3.curveCatmullRom)\n      g.append('path').datum(pts).attr('d', areaGen)\n        .attr('fill', color).attr('opacity', theme.ciOpacity)\n    }\n\n    // Line\n    const lineGen = d3.line<[number, number]>()\n      .x(d => xScale(d[0])).y(d => yScale(d[1])).curve(d3.curveCatmullRom)\n    g.append('path').datum(pts).attr('d', lineGen)\n      .attr('fill', 'none').attr('stroke', color).attr('stroke-width', 2)\n\n    // Points\n    pts.forEach(([x, y]) => {\n      g.append('circle')\n        .attr('cx', xScale(x)).attr('cy', yScale(y)).attr('r', 4)\n        .attr('fill', color).attr('stroke', theme.background).attr('stroke-width', 1.5)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Series', s.label),\n            formatTooltipRow('x', x.toFixed(3)),\n            formatTooltipRow('y', y.toFixed(3)),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    })\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'x')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'y')\n\n  // Legend\n  if (data.series.length > 1) {\n    data.series.forEach((s, i) => {\n      const color = getColor(i, theme)\n      const lx = width - 130\n      const ly = i * 18 + 8\n      g.append('line').attr('x1', lx).attr('x2', lx + 20).attr('y1', ly).attr('y2', ly)\n        .attr('stroke', color).attr('stroke-width', 2)\n      g.append('circle').attr('cx', lx + 10).attr('cy', ly).attr('r', 3)\n        .attr('fill', color).attr('stroke', theme.background).attr('stroke-width', 1)\n      g.append('text').attr('x', lx + 24).attr('y', ly + 4)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text).text(s.label)\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Bubble chart: scatter plot where bubble size is proportional to r value.\n * Color by group if group field is present. Tooltip on hover.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface BubbleChartConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface BubblePoint {\n  readonly x: number\n  readonly y: number\n  readonly r: number\n  readonly label?: string\n  readonly group?: string\n}\n\nexport interface BubbleChartData {\n  readonly points: readonly BubblePoint[]\n  readonly testResult?: StatResult\n}\n\nexport function renderBubbleChart(\n  container: HTMLElement,\n  data: BubbleChartData,\n  config: BubbleChartConfig = {}\n): void {\n  import('d3').then(d3 => renderBubbleChartD3(d3, container, data, config))\n}\n\nfunction renderBubbleChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: BubbleChartData,\n  config: BubbleChartConfig\n): void {\n  if (data.points.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 460\n  const margin = { top: theme.marginTop, right: theme.marginRight + 20, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Bubble Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const xVals = data.points.map(p => p.x)\n  const yVals = data.points.map(p => p.y)\n  const rVals = data.points.map(p => p.r)\n  const [xMin, xMax] = d3.extent(xVals) as [number, number]\n  const [yMin, yMax] = d3.extent(yVals) as [number, number]\n  const [rMin, rMax] = d3.extent(rVals) as [number, number]\n  const xPad = (xMax - xMin) * 0.1\n  const yPad = (yMax - yMin) * 0.1\n\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n  const yScale = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([height, 0]).nice()\n  // Map r values to pixel radius [4, 30]\n  const rScale = rMax === rMin\n    ? (_: number) => 12\n    : d3.scaleSqrt().domain([rMin, rMax]).range([4, 30])\n\n  // Unique groups for color mapping\n  const groups = [...new Set(data.points.map(p => p.group ?? '__default__'))]\n  const groupIndex = (grp: string) => groups.indexOf(grp)\n  const hasGroups = !(groups.length === 1 && groups[0] === '__default__')\n\n  // Grid lines\n  g.selectAll('.gridH').data(yScale.ticks(5)).join('line')\n    .attr('class', 'gridH').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Bubbles (sorted by r desc so smaller ones render on top)\n  const sorted = [...data.points].sort((a, b) => b.r - a.r)\n\n  sorted.forEach(pt => {\n    const grp = pt.group ?? '__default__'\n    const color = getColor(groupIndex(grp), theme)\n    const cx = xScale(pt.x)\n    const cy = yScale(pt.y)\n    const radius = rScale(pt.r)\n\n    g.append('circle')\n      .attr('cx', cx).attr('cy', cy).attr('r', radius)\n      .attr('fill', color).attr('opacity', theme.pointOpacity)\n      .attr('stroke', color).attr('stroke-width', 1.5).attr('stroke-opacity', 0.8)\n      .on('mouseover', (event: MouseEvent) => {\n        const rows = [\n          formatTooltipRow('x', pt.x.toFixed(3)),\n          formatTooltipRow('y', pt.y.toFixed(3)),\n          formatTooltipRow('size', pt.r.toFixed(3)),\n        ]\n        if (pt.label) rows.unshift(formatTooltipRow('Label', pt.label))\n        if (hasGroups && pt.group) rows.push(formatTooltipRow('Group', pt.group))\n        showTooltip(event, rows.join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Optional label inside large bubbles\n    if (pt.label && radius > 16) {\n      g.append('text')\n        .attr('x', cx).attr('y', cy + 4)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.background).attr('pointer-events', 'none')\n        .text(pt.label.slice(0, 6))\n    }\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'x')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle').attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'y')\n\n  // Group legend\n  if (hasGroups) {\n    groups.forEach((grp, i) => {\n      const color = getColor(i, theme)\n      const lx = width - 130\n      const ly = i * 18 + 8\n      g.append('circle').attr('cx', lx + 6).attr('cy', ly).attr('r', 5)\n        .attr('fill', color).attr('opacity', theme.pointOpacity)\n      g.append('text').attr('x', lx + 16).attr('y', ly + 4)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text).text(grp)\n    })\n  }\n\n  // Size legend (show 3 representative sizes if r values vary)\n  if (rMax > rMin) {\n    const sizeLegendVals = [rMin, (rMin + rMax) / 2, rMax]\n    const slx = 16\n    let sly = height - 70\n    g.append('text').attr('x', slx).attr('y', sly - 6)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.textMuted).text('Size:')\n    sizeLegendVals.forEach(rv => {\n      const rad = rScale(rv)\n      g.append('circle').attr('cx', slx + 16).attr('cy', sly + rad)\n        .attr('r', rad).attr('fill', 'none')\n        .attr('stroke', theme.textMuted).attr('stroke-width', 1)\n      g.append('text').attr('x', slx + 36).attr('y', sly + rad + 4)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textMuted).text(rv.toFixed(1))\n      sly += rad * 2 + 10\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Pareto chart: descending bars + cumulative % line on dual axis.\n * Includes 80% threshold line (the \"vital few\" cutoff).\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ParetoConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface ParetoData {\n  readonly labels: readonly string[]\n  readonly values: readonly number[]\n  readonly testResult?: StatResult\n}\n\nexport function renderPareto(\n  container: HTMLElement,\n  data: ParetoData,\n  config: ParetoConfig = {}\n): void {\n  import('d3').then(d3 => renderParetoD3(d3, container, data, config))\n}\n\ninterface ParetoPoint {\n  label: string\n  value: number\n  cumPct: number\n  index: number\n}\n\nfunction renderParetoD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ParetoData,\n  config: ParetoConfig\n): void {\n  if (data.labels.length === 0 || data.values.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: 64, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Pareto Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // Sort by descending value\n  const indices = Array.from({ length: data.labels.length }, (_, i) => i)\n    .sort((a, b) => (data.values[b] ?? 0) - (data.values[a] ?? 0))\n\n  const total = indices.reduce((s, i) => s + (data.values[i] ?? 0), 0)\n  let running = 0\n  const points: ParetoPoint[] = indices.map((origIdx, sortPos) => {\n    const val = data.values[origIdx] ?? 0\n    const lbl = data.labels[origIdx] ?? ''\n    running += val\n    return {\n      label: lbl,\n      value: val,\n      cumPct: (running / total) * 100,\n      index: sortPos\n    }\n  })\n\n  const sortedLabels = points.map(p => p.label)\n\n  // Scales\n  const xScale = d3.scaleBand<string>().domain(sortedLabels).range([0, width]).padding(0.25)\n  const yScaleBar = d3.scaleLinear().domain([0, (points[0]?.value ?? 0) * 1.1]).range([height, 0]).nice()\n  const yScalePct = d3.scaleLinear().domain([0, 100]).range([height, 0])\n\n  // Grid lines\n  g.selectAll<SVGLineElement, number>('.grid').data(yScaleBar.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScaleBar(d)).attr('y2', d => yScaleBar(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  const barColor = getColor(0, theme)\n  const lineColor = getColor(1, theme)\n\n  // Bars\n  g.selectAll<SVGRectElement, ParetoPoint>('.bar').data(points).join('rect')\n    .attr('class', 'bar')\n    .attr('x', d => xScale(d.label) ?? 0)\n    .attr('y', d => yScaleBar(d.value))\n    .attr('width', xScale.bandwidth())\n    .attr('height', d => height - yScaleBar(d.value))\n    .attr('fill', barColor)\n    .attr('opacity', 0.85)\n    .on('mouseover', function(event: MouseEvent, d: ParetoPoint) {\n      showTooltip(event, [\n        formatTooltipRow('Category', d.label),\n        formatTooltipRow('Value', d.value.toFixed(2)),\n        formatTooltipRow('Cumulative %', d.cumPct.toFixed(1) + '%')\n      ].join(''), theme)\n    })\n    .on('mouseout', hideTooltip)\n\n  // Cumulative line\n  const lineGen = d3.line<ParetoPoint>()\n    .x(d => (xScale(d.label) ?? 0) + xScale.bandwidth() / 2)\n    .y(d => yScalePct(d.cumPct))\n    .curve(d3.curveMonotoneX)\n\n  g.append('path').datum(points)\n    .attr('d', lineGen)\n    .attr('fill', 'none')\n    .attr('stroke', lineColor)\n    .attr('stroke-width', 2.5)\n\n  // Dots on cumulative line\n  g.selectAll<SVGCircleElement, ParetoPoint>('.cum-dot').data(points).join('circle')\n    .attr('class', 'cum-dot')\n    .attr('cx', d => (xScale(d.label) ?? 0) + xScale.bandwidth() / 2)\n    .attr('cy', d => yScalePct(d.cumPct))\n    .attr('r', 4)\n    .attr('fill', lineColor)\n    .attr('stroke', theme.background)\n    .attr('stroke-width', 1.5)\n\n  // 80% threshold line\n  g.append('line')\n    .attr('x1', 0).attr('x2', width)\n    .attr('y1', yScalePct(80)).attr('y2', yScalePct(80))\n    .attr('stroke', '#D55E00')\n    .attr('stroke-width', 1.5)\n    .attr('stroke-dasharray', '6,4')\n\n  g.append('text')\n    .attr('x', width + 4)\n    .attr('y', yScalePct(80) + 4)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall)\n    .attr('fill', '#D55E00')\n    .text('80%')\n\n  // Left axis (bar values)\n  const leftAxis = g.append('g').call(d3.axisLeft(yScaleBar).ticks(6))\n  leftAxis.selectAll('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  // Right axis (%)\n  const rightAxis = g.append('g')\n    .attr('transform', `translate(${width},0)`)\n    .call(d3.axisRight(yScalePct).ticks(5).tickFormat(d => `${d}%`))\n  rightAxis.selectAll('text')\n    .attr('fill', lineColor)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  // Bottom axis\n  const bottomAxis = g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n  bottomAxis.selectAll('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('text-anchor', 'end')\n    .attr('transform', 'rotate(-35)')\n\n  // Axis labels\n  g.append('text').attr('x', width / 2).attr('y', height + 60)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Frequency')\n\n  g.append('text')\n    .attr('transform', `translate(${width + 56},${height / 2}) rotate(90)`)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', lineColor).text('Cumulative %')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Funnel chart: trapezoidal segments stacked vertically.\n * Width proportional to value. Labels on left, value + % drop on right.\n */\n\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface FunnelConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface FunnelStage {\n  readonly label: string\n  readonly value: number\n}\n\nexport interface FunnelData {\n  readonly stages: readonly FunnelStage[]\n  readonly testResult?: StatResult\n}\n\nexport function renderFunnel(\n  container: HTMLElement,\n  data: FunnelData,\n  config: FunnelConfig = {}\n): void {\n  import('d3').then(d3 => renderFunnelD3(d3, container, data, config))\n}\n\nfunction renderFunnelD3(\n  _d3: unknown,\n  container: HTMLElement,\n  data: FunnelData,\n  config: FunnelConfig\n): void {\n  if (data.stages.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  // Build SVG manually without D3 (funnel uses SVG path primitives only)\n  const svgNS = 'http://www.w3.org/2000/svg'\n  const svgEl = document.createElementNS(svgNS, 'svg')\n  svgEl.setAttribute('width', String(W))\n  svgEl.setAttribute('height', String(H))\n  svgEl.style.background = theme.background\n  container.appendChild(svgEl)\n\n  // Title\n  const titleEl = document.createElementNS(svgNS, 'text')\n  titleEl.setAttribute('x', String(W / 2))\n  titleEl.setAttribute('y', '20')\n  titleEl.setAttribute('text-anchor', 'middle')\n  titleEl.setAttribute('font-family', theme.fontFamily)\n  titleEl.setAttribute('font-size', String(theme.fontSizeTitle))\n  titleEl.setAttribute('font-weight', '600')\n  titleEl.setAttribute('fill', theme.text)\n  titleEl.textContent = config.title ?? 'Funnel Chart'\n  svgEl.appendChild(titleEl)\n\n  const subtitleEl = document.createElementNS(svgNS, 'text')\n  subtitleEl.setAttribute('x', String(W / 2))\n  subtitleEl.setAttribute('y', '38')\n  subtitleEl.setAttribute('text-anchor', 'middle')\n  subtitleEl.setAttribute('font-family', theme.fontFamilyMono ?? theme.fontFamily)\n  subtitleEl.setAttribute('font-size', String(theme.fontSizeSmall))\n  subtitleEl.setAttribute('fill', theme.textMuted)\n  subtitleEl.textContent = data.testResult?.formatted ?? ''\n  svgEl.appendChild(subtitleEl)\n\n  const maxValue = Math.max(...data.stages.map(s => s.value))\n  const n = data.stages.length\n  const segH = height / n\n  const gap = 2\n  const labelColW = 110\n  const valueColW = 110\n  const funnelW = width - labelColW - valueColW\n  const funnelOffsetX = margin.left + labelColW\n  const offsetY = margin.top\n\n  data.stages.forEach((stage, i) => {\n    const color = getColor(i, theme)\n    const topW = (stage.value / maxValue) * funnelW\n    const nextStage = i + 1 < data.stages.length ? data.stages[i + 1] : undefined\n    const bottomW = nextStage != null ? (nextStage.value / maxValue) * funnelW : topW * 0.6\n\n    const topY = offsetY + i * segH\n    const bottomY = offsetY + (i + 1) * segH - gap\n\n    const topLeft = funnelOffsetX + (funnelW - topW) / 2\n    const topRight = funnelOffsetX + (funnelW + topW) / 2\n    const botLeft = funnelOffsetX + (funnelW - bottomW) / 2\n    const botRight = funnelOffsetX + (funnelW + bottomW) / 2\n\n    const pathD = `M ${topLeft},${topY} L ${topRight},${topY} L ${botRight},${bottomY} L ${botLeft},${bottomY} Z`\n    const pathEl = document.createElementNS(svgNS, 'path')\n    pathEl.setAttribute('d', pathD)\n    pathEl.setAttribute('fill', color)\n    pathEl.setAttribute('opacity', '0.85')\n    pathEl.addEventListener('mouseover', (event: MouseEvent) => {\n      const pct = ((stage.value / maxValue) * 100).toFixed(1)\n      const prevStage = i > 0 ? data.stages[i - 1] : undefined\n      const drop = prevStage != null\n        ? (((prevStage.value - stage.value) / prevStage.value) * 100).toFixed(1)\n        : '\u2014'\n      showTooltip(event, [\n        formatTooltipRow('Stage', stage.label),\n        formatTooltipRow('Value', stage.value.toFixed(0)),\n        formatTooltipRow('% of Max', pct + '%'),\n        formatTooltipRow('Drop from prev', drop === '\u2014' ? drop : drop + '%')\n      ].join(''), theme)\n    })\n    pathEl.addEventListener('mouseout', hideTooltip)\n    svgEl.appendChild(pathEl)\n\n    const midY = topY + segH / 2\n\n    // Label on left\n    const labelEl = document.createElementNS(svgNS, 'text')\n    labelEl.setAttribute('x', String(margin.left + labelColW - 8))\n    labelEl.setAttribute('y', String(midY))\n    labelEl.setAttribute('text-anchor', 'end')\n    labelEl.setAttribute('dominant-baseline', 'middle')\n    labelEl.setAttribute('font-family', theme.fontFamily)\n    labelEl.setAttribute('font-size', String(theme.fontSize))\n    labelEl.setAttribute('fill', theme.text)\n    labelEl.textContent = stage.label\n    svgEl.appendChild(labelEl)\n\n    // Value + % on right\n    const pctOfMax = ((stage.value / maxValue) * 100).toFixed(0)\n    const prevStage = i > 0 ? data.stages[i - 1] : undefined\n    const dropStr = prevStage != null\n      ? `\\u2212${(((prevStage.value - stage.value) / prevStage.value) * 100).toFixed(0)}%`\n      : ''\n\n    const valEl = document.createElementNS(svgNS, 'text')\n    valEl.setAttribute('x', String(funnelOffsetX + funnelW + 8))\n    valEl.setAttribute('y', String(midY - (dropStr ? 7 : 0)))\n    valEl.setAttribute('dominant-baseline', 'middle')\n    valEl.setAttribute('font-family', theme.fontFamilyMono ?? theme.fontFamily)\n    valEl.setAttribute('font-size', String(theme.fontSize))\n    valEl.setAttribute('fill', theme.text)\n    valEl.textContent = `${stage.value.toLocaleString()} (${pctOfMax}%)`\n    svgEl.appendChild(valEl)\n\n    if (dropStr) {\n      const dropEl = document.createElementNS(svgNS, 'text')\n      dropEl.setAttribute('x', String(funnelOffsetX + funnelW + 8))\n      dropEl.setAttribute('y', String(midY + 9))\n      dropEl.setAttribute('dominant-baseline', 'middle')\n      dropEl.setAttribute('font-family', theme.fontFamily)\n      dropEl.setAttribute('font-size', String(theme.fontSizeSmall))\n      dropEl.setAttribute('fill', '#D55E00')\n      dropEl.textContent = dropStr\n      svgEl.appendChild(dropEl)\n    }\n  })\n\n  if (config.caption) {\n    const capEl = document.createElementNS(svgNS, 'text')\n    capEl.setAttribute('x', String(W / 2))\n    capEl.setAttribute('y', String(H - 6))\n    capEl.setAttribute('text-anchor', 'middle')\n    capEl.setAttribute('font-family', theme.fontFamily)\n    capEl.setAttribute('font-size', String(theme.fontSizeSmall - 1))\n    capEl.setAttribute('fill', theme.textMuted)\n    capEl.style.fontStyle = 'italic'\n    capEl.textContent = config.caption\n    svgEl.appendChild(capEl)\n  }\n}\n", "/**\n * Pie / donut chart with polyline labels and optional test result subtitle.\n * Donut mode uses innerRadius = outerRadius * 0.55.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface PieChartConfig {\n  readonly donut?: boolean\n  readonly showPercentages?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface PieSlice {\n  readonly label: string\n  readonly value: number\n}\n\nexport interface PieChartData {\n  readonly slices: readonly PieSlice[]\n  readonly testResult?: StatResult\n}\n\nexport function renderPieChart(\n  container: HTMLElement,\n  data: PieChartData,\n  config: PieChartConfig = {}\n): void {\n  import('d3').then(d3 => renderPieChartD3(d3, container, data, config))\n}\n\nfunction renderPieChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: PieChartData,\n  config: PieChartConfig\n): void {\n  if (data.slices.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Pie Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const legendH = Math.ceil(data.slices.length / 3) * 22\n  const plotH = H - margin.top - margin.bottom - legendH\n  const cx = W / 2\n  const cy = margin.top + plotH / 2\n\n  const outerR = Math.min(W / 2, plotH / 2) * 0.72\n  const innerR = (config.donut ?? false) ? outerR * 0.55 : 0\n  const total = data.slices.reduce((s, sl) => s + sl.value, 0)\n\n  const pieGen = d3.pie<PieSlice>().value(d => d.value).sort(null)\n  const arcGen = d3.arc<D3.PieArcDatum<PieSlice>>()\n    .innerRadius(innerR).outerRadius(outerR)\n  const labelArc = d3.arc<D3.PieArcDatum<PieSlice>>()\n    .innerRadius(outerR * 1.15).outerRadius(outerR * 1.15)\n  const polyArc = d3.arc<D3.PieArcDatum<PieSlice>>()\n    .innerRadius(outerR * 0.85).outerRadius(outerR * 0.85)\n\n  const arcs = pieGen(data.slices as PieSlice[])\n  const g = svg.append('g').attr('transform', `translate(${cx},${cy})`)\n\n  // Slices\n  arcs.forEach((arc, i) => {\n    const color = getColor(i, theme)\n    const pct = ((arc.data.value / total) * 100).toFixed(1)\n\n    g.append('path')\n      .attr('d', arcGen(arc) ?? '')\n      .attr('fill', color)\n      .attr('opacity', 0.88)\n      .attr('stroke', theme.background)\n      .attr('stroke-width', 2)\n      .on('mouseover', function(event: MouseEvent) {\n        showTooltip(event, [\n          formatTooltipRow('Label', arc.data.label),\n          formatTooltipRow('Value', arc.data.value.toFixed(2)),\n          formatTooltipRow('Percentage', pct + '%')\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Polyline label\n    const midAngle = (arc.startAngle + arc.endAngle) / 2\n    const isRight = midAngle < Math.PI\n    const labelPt = labelArc.centroid(arc)\n    const polyPt = polyArc.centroid(arc)\n    const endX = isRight ? outerR * 1.35 : -outerR * 1.35\n\n    // Only draw label if slice is big enough\n    if (arc.data.value / total > 0.03) {\n      g.append('polyline')\n        .attr('points', [polyPt, labelPt, [endX, labelPt[1]]].map(p => p.join(',')).join(' '))\n        .attr('fill', 'none')\n        .attr('stroke', theme.textMuted)\n        .attr('stroke-width', 1)\n\n      const displayStr = (config.showPercentages ?? true)\n        ? `${arc.data.label} (${pct}%)`\n        : arc.data.label\n\n      g.append('text')\n        .attr('x', isRight ? endX + 4 : endX - 4)\n        .attr('y', labelPt[1])\n        .attr('dominant-baseline', 'middle')\n        .attr('text-anchor', isRight ? 'start' : 'end')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text)\n        .text(displayStr)\n    }\n  })\n\n  // Donut center label\n  if (config.donut ?? false) {\n    g.append('text').attr('text-anchor', 'middle').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize + 2)\n      .attr('font-weight', '600').attr('fill', theme.text)\n      .text(`n = ${total.toFixed(0)}`)\n  }\n\n  // Legend\n  const legendY = margin.top + plotH + 12\n  const colW = W / 3\n  data.slices.forEach((sl, i) => {\n    const col = i % 3\n    const row = Math.floor(i / 3)\n    const lx = col * colW + 16\n    const ly = legendY + row * 22\n\n    svg.append('rect').attr('x', lx).attr('y', ly).attr('width', 12).attr('height', 12)\n      .attr('fill', getColor(i, theme)).attr('rx', 2)\n    svg.append('text').attr('x', lx + 16).attr('y', ly + 9)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(sl.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Area chart with optional stacking.\n * Non-stacked: overlapping semi-transparent areas + lines per series.\n * Stacked: cumulative areas per series.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface AreaChartConfig {\n  readonly stacked?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface AreaSeries {\n  readonly label: string\n  readonly x: readonly number[]\n  readonly y: readonly number[]\n}\n\nexport interface AreaChartData {\n  readonly series: readonly AreaSeries[]\n  readonly testResult?: StatResult\n}\n\nexport function renderAreaChart(\n  container: HTMLElement,\n  data: AreaChartData,\n  config: AreaChartConfig = {}\n): void {\n  import('d3').then(d3 => renderAreaChartD3(d3, container, data, config))\n}\n\ninterface XYPoint {\n  readonly xVal: number\n  readonly yVal: number\n}\n\ninterface StackedPoint {\n  readonly xVal: number\n  readonly top: number\n  readonly bot: number\n}\n\nfunction renderAreaChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: AreaChartData,\n  config: AreaChartConfig\n): void {\n  if (data.series.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Area Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allX = data.series.flatMap(s => [...s.x])\n  const xMin = Math.min(...allX)\n  const xMax = Math.max(...allX)\n  const xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, width])\n\n  const stacked = config.stacked ?? false\n\n  let yMax: number\n  if (stacked) {\n    const allXSorted = [...new Set(allX)].sort((a, b) => a - b)\n    const rowSums = allXSorted.map(xVal =>\n      data.series.reduce((sum, s) => {\n        const idx = s.x.indexOf(xVal)\n        return sum + (idx >= 0 ? (s.y[idx] ?? 0) : 0)\n      }, 0)\n    )\n    yMax = Math.max(...rowSums)\n  } else {\n    yMax = Math.max(...data.series.flatMap(s => [...s.y]))\n  }\n\n  const yScale = d3.scaleLinear().domain([0, yMax * 1.1]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll<SVGLineElement, number>('.grid').data(yScale.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  if (stacked) {\n    const allXSorted = [...new Set(allX)].sort((a, b) => a - b)\n    const baselines = new Map<number, number>()\n    allXSorted.forEach(xVal => baselines.set(xVal, 0))\n\n    data.series.forEach((series, si) => {\n      const color = getColor(si, theme)\n\n      const points: StackedPoint[] = series.x.map((xVal, xi) => ({\n        xVal,\n        top: (baselines.get(xVal) ?? 0) + (series.y[xi] ?? 0),\n        bot: baselines.get(xVal) ?? 0\n      }))\n\n      const areaFn = d3.area<StackedPoint>()\n        .x(d => xScale(d.xVal))\n        .y0(d => yScale(d.bot))\n        .y1(d => yScale(d.top))\n        .curve(d3.curveMonotoneX)\n\n      g.append('path').datum(points)\n        .attr('d', areaFn)\n        .attr('fill', color)\n        .attr('opacity', 0.75)\n        .attr('stroke', color)\n        .attr('stroke-width', 1.5)\n\n      series.x.forEach((xVal, xi) => {\n        baselines.set(xVal, (baselines.get(xVal) ?? 0) + (series.y[xi] ?? 0))\n      })\n    })\n  } else {\n    data.series.forEach((series, si) => {\n      const color = getColor(si, theme)\n\n      // Build typed points array with guaranteed number (filter out bad indices)\n      const points: XYPoint[] = series.x\n        .map((xVal, xi) => ({ xVal, yVal: series.y[xi] }))\n        .filter((p): p is XYPoint => p.yVal !== undefined)\n\n      const areaFn = d3.area<XYPoint>()\n        .x(d => xScale(d.xVal))\n        .y0(yScale(0))\n        .y1(d => yScale(d.yVal))\n        .curve(d3.curveMonotoneX)\n\n      const lineFn = d3.line<XYPoint>()\n        .x(d => xScale(d.xVal))\n        .y(d => yScale(d.yVal))\n        .curve(d3.curveMonotoneX)\n\n      g.append('path').datum(points)\n        .attr('d', areaFn)\n        .attr('fill', color)\n        .attr('opacity', 0.22)\n\n      g.append('path').datum(points)\n        .attr('d', lineFn)\n        .attr('fill', 'none')\n        .attr('stroke', color)\n        .attr('stroke-width', 2.5)\n\n      g.selectAll<SVGCircleElement, XYPoint>(`.dot-s${si}`)\n        .data(points).join('circle')\n        .attr('class', `dot-s${si}`)\n        .attr('cx', d => xScale(d.xVal))\n        .attr('cy', d => yScale(d.yVal))\n        .attr('r', 3.5)\n        .attr('fill', color)\n        .attr('opacity', 0.7)\n        .on('mouseover', function(event: MouseEvent, d: XYPoint) {\n          showTooltip(event, [\n            formatTooltipRow('Series', series.label),\n            formatTooltipRow('x', d.xVal.toFixed(3)),\n            formatTooltipRow('y', d.yVal.toFixed(3))\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    })\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(8))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'x')\n\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Value')\n\n  // Legend\n  data.series.forEach((s, i) => {\n    const lx = margin.left + i * 130\n    const ly = H - 18\n    svg.append('rect').attr('x', lx).attr('y', ly - 9).attr('width', 12).attr('height', 12)\n      .attr('fill', getColor(i, theme)).attr('rx', 2)\n    svg.append('text').attr('x', lx + 16).attr('y', ly)\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(s.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Forest plot: per-study CI lines with square points + pooled diamond.\n * Vertical reference line at 0. Numeric estimates shown on the right.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ForestPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface ForestStudy {\n  readonly label: string\n  readonly estimate: number\n  readonly ciLow: number\n  readonly ciHigh: number\n  readonly weight?: number\n}\n\nexport interface ForestPooled {\n  readonly estimate: number\n  readonly ciLow: number\n  readonly ciHigh: number\n}\n\nexport interface ForestPlotData {\n  readonly studies: readonly ForestStudy[]\n  readonly pooled?: ForestPooled\n  readonly testResult?: StatResult\n}\n\nexport function renderForestPlot(\n  container: HTMLElement,\n  data: ForestPlotData,\n  config: ForestPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderForestPlotD3(d3, container, data, config))\n}\n\nfunction renderForestPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ForestPlotData,\n  config: ForestPlotConfig\n): void {\n  if (data.studies.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const totalRows = data.studies.length + (data.pooled != null ? 2 : 0)\n  const rowH = 28\n  const extraH = theme.marginTop + theme.marginBottom + 20\n  const H = config.height ?? Math.max(totalRows * rowH + extraH, 320)\n  const W = config.width ?? Math.max(container.clientWidth || 700, 500)\n\n  const labelColW = 160\n  const estColW = 140\n  const marginLeft = labelColW + 8\n  const marginRight = estColW + 16\n  const margin = { top: theme.marginTop, right: marginRight, bottom: theme.marginBottom, left: marginLeft }\n  const width = W - margin.left - margin.right\n  const height = totalRows * rowH\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H + margin.top + margin.bottom).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Forest Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const allLow = data.studies.map(s => s.ciLow).concat(data.pooled != null ? [data.pooled.ciLow] : [])\n  const allHigh = data.studies.map(s => s.ciHigh).concat(data.pooled != null ? [data.pooled.ciHigh] : [])\n  const xMin = Math.min(...allLow)\n  const xMax = Math.max(...allHigh)\n  const xPad = (xMax - xMin) * 0.12\n  const xScale = d3.scaleLinear().domain([xMin - xPad, xMax + xPad]).range([0, width]).nice()\n\n  const maxWeight = data.studies.reduce((m, s) => Math.max(m, s.weight ?? 1), 0)\n\n  // Reference line at 0\n  const [domainMin, domainMax] = xScale.domain() as [number, number]\n  if (domainMin <= 0 && domainMax >= 0) {\n    g.append('line')\n      .attr('x1', xScale(0)).attr('x2', xScale(0))\n      .attr('y1', 0).attr('y2', height)\n      .attr('stroke', theme.axisLine)\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '4,3')\n  }\n\n  // Column headers\n  svg.append('text')\n    .attr('x', margin.left - 8).attr('y', margin.top - 6)\n    .attr('text-anchor', 'end')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n    .attr('font-weight', '600').attr('fill', theme.textMuted)\n    .text('Study')\n  svg.append('text')\n    .attr('x', W - marginRight + 8).attr('y', margin.top - 6)\n    .attr('text-anchor', 'start')\n    .attr('font-family', theme.fontFamilyMono ?? theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n    .attr('font-weight', '600').attr('fill', theme.textMuted)\n    .text('Estimate [95% CI]')\n\n  const studyColor = getColor(0, theme)\n\n  data.studies.forEach((study, i) => {\n    const cy = i * rowH + rowH / 2\n\n    // CI line\n    g.append('line')\n      .attr('x1', xScale(study.ciLow)).attr('x2', xScale(study.ciHigh))\n      .attr('y1', cy).attr('y2', cy)\n      .attr('stroke', studyColor).attr('stroke-width', 1.5)\n\n    // CI caps\n    const capH = 5\n    ;[study.ciLow, study.ciHigh].forEach(xv => {\n      g.append('line')\n        .attr('x1', xScale(xv)).attr('x2', xScale(xv))\n        .attr('y1', cy - capH).attr('y2', cy + capH)\n        .attr('stroke', studyColor).attr('stroke-width', 1.5)\n    })\n\n    // Square point\n    const sqHalf = study.weight != null && maxWeight > 0\n      ? 4 + (study.weight / maxWeight) * 6\n      : 6\n    g.append('rect')\n      .attr('x', xScale(study.estimate) - sqHalf / 2)\n      .attr('y', cy - sqHalf / 2)\n      .attr('width', sqHalf).attr('height', sqHalf)\n      .attr('fill', studyColor)\n      .on('mouseover', function(event: MouseEvent) {\n        showTooltip(event, [\n          formatTooltipRow('Study', study.label),\n          formatTooltipRow('Estimate', study.estimate.toFixed(3)),\n          formatTooltipRow('95% CI', `[${study.ciLow.toFixed(3)}, ${study.ciHigh.toFixed(3)}]`),\n          ...(study.weight != null ? [formatTooltipRow('Weight', study.weight.toFixed(2))] : [])\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Label\n    svg.append('text')\n      .attr('x', margin.left - 8).attr('y', margin.top + cy)\n      .attr('text-anchor', 'end').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n      .attr('fill', theme.text).text(study.label)\n\n    // Numeric estimate\n    const estStr = `${study.estimate.toFixed(2)} [${study.ciLow.toFixed(2)}, ${study.ciHigh.toFixed(2)}]`\n    svg.append('text')\n      .attr('x', W - marginRight + 8).attr('y', margin.top + cy)\n      .attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamilyMono ?? theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(estStr)\n  })\n\n  // Pooled diamond\n  if (data.pooled != null) {\n    const pooled = data.pooled\n    const sepY = data.studies.length * rowH\n    g.append('line')\n      .attr('x1', 0).attr('x2', width)\n      .attr('y1', sepY).attr('y2', sepY)\n      .attr('stroke', theme.axisLine).attr('stroke-width', 1)\n\n    const pooledY = sepY + rowH * 1.0\n    const diamondColor = getColor(4, theme)\n    const dLeft = xScale(pooled.ciLow)\n    const dRight = xScale(pooled.ciHigh)\n    const dMid = xScale(pooled.estimate)\n    const dH = 9\n\n    const diamondPath = [\n      `M ${dMid},${pooledY - dH}`,\n      `L ${dRight},${pooledY}`,\n      `L ${dMid},${pooledY + dH}`,\n      `L ${dLeft},${pooledY}`,\n      'Z'\n    ].join(' ')\n\n    g.append('path').attr('d', diamondPath)\n      .attr('fill', diamondColor).attr('opacity', 0.88)\n      .attr('stroke', diamondColor).attr('stroke-width', 1)\n      .on('mouseover', function(event: MouseEvent) {\n        showTooltip(event, [\n          formatTooltipRow('Pooled estimate', pooled.estimate.toFixed(3)),\n          formatTooltipRow('95% CI', `[${pooled.ciLow.toFixed(3)}, ${pooled.ciHigh.toFixed(3)}]`)\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    svg.append('text')\n      .attr('x', margin.left - 8).attr('y', margin.top + pooledY)\n      .attr('text-anchor', 'end').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n      .attr('font-weight', '600').attr('fill', theme.text).text('Pooled')\n\n    const pEstStr = `${pooled.estimate.toFixed(2)} [${pooled.ciLow.toFixed(2)}, ${pooled.ciHigh.toFixed(2)}]`\n    svg.append('text')\n      .attr('x', W - marginRight + 8).attr('y', margin.top + pooledY)\n      .attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamilyMono ?? theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n      .attr('font-weight', '600').attr('fill', theme.text).text(pEstStr)\n  }\n\n  // X axis\n  g.append('g').attr('transform', `translate(0,${height + 8})`).call(d3.axisBottom(xScale).ticks(6))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'Effect Size')\n\n  if (config.caption) addCaption(svg, config.caption, W, H + margin.top + margin.bottom, theme)\n}\n", "/**\n * ROC curve: TPR vs FPR with AUC annotation.\n * Includes diagonal reference line, filled area under curve.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ROCCurveConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface ROCCurveData {\n  readonly fpr: readonly number[]\n  readonly tpr: readonly number[]\n  readonly auc: number\n  readonly testResult?: StatResult\n}\n\nexport function renderROCCurve(\n  container: HTMLElement,\n  data: ROCCurveData,\n  config: ROCCurveConfig = {}\n): void {\n  import('d3').then(d3 => renderROCCurveD3(d3, container, data, config))\n}\n\ninterface ROCPoint {\n  readonly fprVal: number\n  readonly tprVal: number\n}\n\nfunction renderROCCurveD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ROCCurveData,\n  config: ROCCurveConfig\n): void {\n  if (data.fpr.length === 0 || data.tpr.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 520, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  const aucStr = `AUC = ${data.auc.toFixed(4)}`\n  const subtitle = data.testResult?.formatted\n    ? `${data.testResult.formatted}   ${aucStr}`\n    : aucStr\n  addSubtitle(svg, config.title ?? 'ROC Curve', subtitle, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const xScale = d3.scaleLinear().domain([0, 1]).range([0, width])\n  const yScale = d3.scaleLinear().domain([0, 1]).range([height, 0])\n\n  // Grid\n  g.selectAll<SVGLineElement, number>('.grid-h').data(yScale.ticks(5)).join('line')\n    .attr('class', 'grid-h').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Diagonal reference line\n  g.append('line')\n    .attr('x1', xScale(0)).attr('y1', yScale(0))\n    .attr('x2', xScale(1)).attr('y2', yScale(1))\n    .attr('stroke', theme.axisLine)\n    .attr('stroke-width', 1.5)\n    .attr('stroke-dasharray', '6,4')\n\n  // Sort by FPR and build typed pairs\n  const pairs: ROCPoint[] = data.fpr\n    .map((fprVal, i) => ({ fprVal, tprVal: data.tpr[i] ?? 0 }))\n    .sort((a, b) => a.fprVal - b.fprVal)\n\n  const curveColor = getColor(0, theme)\n\n  // Area under ROC curve\n  const areaFn = d3.area<ROCPoint>()\n    .x(d => xScale(d.fprVal))\n    .y0(yScale(0))\n    .y1(d => yScale(d.tprVal))\n    .curve(d3.curveLinear)\n\n  g.append('path').datum(pairs)\n    .attr('d', areaFn)\n    .attr('fill', curveColor)\n    .attr('opacity', theme.ciOpacity)\n\n  // ROC line\n  const lineFn = d3.line<ROCPoint>()\n    .x(d => xScale(d.fprVal))\n    .y(d => yScale(d.tprVal))\n    .curve(d3.curveLinear)\n\n  g.append('path').datum(pairs)\n    .attr('d', lineFn)\n    .attr('fill', 'none')\n    .attr('stroke', curveColor)\n    .attr('stroke-width', 2.5)\n\n  // Interactive dots\n  g.selectAll<SVGCircleElement, ROCPoint>('.roc-dot')\n    .data(pairs).join('circle')\n    .attr('class', 'roc-dot')\n    .attr('cx', d => xScale(d.fprVal))\n    .attr('cy', d => yScale(d.tprVal))\n    .attr('r', 3)\n    .attr('fill', curveColor)\n    .attr('opacity', 0.6)\n    .on('mouseover', function(event: MouseEvent, d: ROCPoint) {\n      showTooltip(event, [\n        formatTooltipRow('FPR', d.fprVal.toFixed(4)),\n        formatTooltipRow('TPR', d.tprVal.toFixed(4)),\n        formatTooltipRow('Specificity', (1 - d.fprVal).toFixed(4)),\n        formatTooltipRow('Sensitivity', d.tprVal.toFixed(4))\n      ].join(''), theme)\n    })\n    .on('mouseout', hideTooltip)\n\n  // AUC annotation box\n  g.append('rect')\n    .attr('x', 8).attr('y', 8)\n    .attr('width', 130).attr('height', 28)\n    .attr('fill', theme.surface)\n    .attr('stroke', theme.gridLine)\n    .attr('rx', 4).attr('opacity', 0.9)\n\n  g.append('text')\n    .attr('x', 16).attr('y', 26)\n    .attr('font-family', theme.fontFamilyMono ?? theme.fontFamily)\n    .attr('font-size', theme.fontSize + 1)\n    .attr('font-weight', '600')\n    .attr('fill', curveColor)\n    .text(`AUC = ${data.auc.toFixed(4)}`)\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? 'False Positive Rate')\n\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'True Positive Rate')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Strip plot: pure jittered dot plot per group.\n * Shows individual data points with a horizontal mean line per group.\n * No violin, no box \u2014 raw distribution only.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface StripPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly showN?: boolean\n}\n\nexport interface StripGroup {\n  readonly label: string\n  readonly values: readonly number[]\n}\n\nexport interface StripPlotData {\n  readonly groups: readonly StripGroup[]\n  readonly testResult?: StatResult\n}\n\nexport function renderStripPlot(\n  container: HTMLElement,\n  data: StripPlotData,\n  config: StripPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderStripPlotD3(d3, container, data, config))\n}\n\nfunction renderStripPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: StripPlotData,\n  config: StripPlotConfig\n): void {\n  if (data.groups.length === 0) return\n\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H).style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Strip Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const labels = data.groups.map(gr => gr.label)\n  const allValues = data.groups.flatMap(gr => [...gr.values])\n  const yMinRaw = Math.min(...allValues)\n  const yMaxRaw = Math.max(...allValues)\n  const yPad = (yMaxRaw - yMinRaw) * 0.1\n\n  const xScale = d3.scaleBand<string>().domain(labels).range([0, width]).padding(0.3)\n  const yScale = d3.scaleLinear().domain([yMinRaw - yPad, yMaxRaw + yPad]).range([height, 0]).nice()\n\n  // Grid\n  g.selectAll<SVGLineElement, number>('.grid').data(yScale.ticks(6)).join('line')\n    .attr('class', 'grid').attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  data.groups.forEach((gr, gi) => {\n    if (gr.values.length === 0) return\n\n    const color = getColor(gi, theme)\n    const cx = (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2\n    const jitterWidth = xScale.bandwidth() * 0.38\n    const seed = gi * 77773\n\n    // Mean\n    const mean = gr.values.reduce((s, v) => s + v, 0) / gr.values.length\n\n    // Jittered points\n    gr.values.forEach((v, vi) => {\n      const jitter = (pseudoRnd(seed + vi * 13 + gi) - 0.5) * jitterWidth\n      g.append('circle')\n        .attr('cx', cx + jitter)\n        .attr('cy', yScale(v))\n        .attr('r', 3.5)\n        .attr('fill', color)\n        .attr('opacity', theme.pointOpacity)\n        .on('mouseover', function(event: MouseEvent) {\n          showTooltip(event, [\n            formatTooltipRow('Group', gr.label),\n            formatTooltipRow('Value', v.toFixed(4)),\n            formatTooltipRow('Group mean', mean.toFixed(4))\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    })\n\n    // Mean line\n    const lineHalfW = xScale.bandwidth() * 0.32\n    g.append('line')\n      .attr('x1', cx - lineHalfW).attr('x2', cx + lineHalfW)\n      .attr('y1', yScale(mean)).attr('y2', yScale(mean))\n      .attr('stroke', color)\n      .attr('stroke-width', 2.5)\n      .attr('opacity', 0.9)\n\n    // n label below axis\n    if (config.showN !== false) {\n      g.append('text')\n        .attr('x', cx).attr('y', height + 52)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.textMuted)\n        .text(`n = ${gr.values.length}`)\n    }\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text')\n    .attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('g').call(d3.axisLeft(yScale).ticks(6))\n    .selectAll('text')\n    .attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.xLabel ?? '')\n\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n    .attr('fill', theme.text).text(config.yLabel ?? 'Value')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\nfunction pseudoRnd(seed: number): number {\n  const x = Math.sin(seed) * 10000\n  return x - Math.floor(x)\n}\n", "/**\n * Beeswarm plot \u2014 individual points per group arranged to avoid overlap.\n * Points are sorted by value and offset horizontally so they spread\n * left/right of the group centre axis without colliding.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface SwarmPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly pointRadius?: number\n  readonly bandwidth?: number\n  readonly showN?: boolean\n  readonly showMean?: boolean\n}\n\nexport interface SwarmPlotData {\n  readonly groups: readonly { readonly label: string; readonly values: readonly number[] }[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a beeswarm plot with per-group colour and collision-avoidance layout.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - groups of numeric values + optional stat result\n * @param config - visual configuration\n */\nexport function renderSwarmPlot(\n  container: HTMLElement,\n  data: SwarmPlotData,\n  config: SwarmPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderSwarmPlotD3(d3, container, data, config))\n}\n\nfunction renderSwarmPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: SwarmPlotData,\n  config: SwarmPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = {\n    top: theme.marginTop,\n    right: theme.marginRight,\n    bottom: theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n  const r = config.pointRadius ?? 4\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Beeswarm Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // Scales\n  const labels = data.groups.map(gr => gr.label)\n  const xScale = d3.scaleBand<string>()\n    .domain(labels)\n    .range([0, width])\n    .padding(0.3)\n\n  const allValues = data.groups.flatMap(gr => [...gr.values])\n  const [yMin, yMax] = d3.extent(allValues) as [number, number]\n  const yPad = (yMax - yMin) * 0.08 || 1\n  const yScale = d3.scaleLinear()\n    .domain([yMin - yPad, yMax + yPad])\n    .range([height, 0])\n    .nice()\n\n  // Horizontal grid\n  g.selectAll<SVGLineElement, number>('.grid')\n    .data(yScale.ticks(6))\n    .join('line')\n    .attr('class', 'grid')\n    .attr('x1', 0).attr('x2', width)\n    .attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1)\n\n  // Axes\n  g.append('g')\n    .attr('transform', `translate(0,${height})`)\n    .call(d3.axisBottom(xScale))\n    .call(ax => ax.select('.domain').attr('stroke', theme.axisLine))\n    .selectAll<SVGTextElement, string>('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  g.append('g')\n    .call(d3.axisLeft(yScale).ticks(6))\n    .call(ax => ax.select('.domain').attr('stroke', theme.axisLine))\n    .selectAll<SVGTextElement, number>('text')\n    .attr('fill', theme.text)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n\n  // Axis labels\n  g.append('text')\n    .attr('x', width / 2).attr('y', height + 44)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(config.xLabel ?? '')\n\n  g.append('text')\n    .attr('transform', 'rotate(-90)')\n    .attr('x', -height / 2).attr('y', -48)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSize)\n    .attr('fill', theme.text)\n    .text(config.yLabel ?? 'Value')\n\n  // Draw beeswarm per group\n  data.groups.forEach((gr, gi) => {\n    const color = getColor(gi, theme)\n    const cx = (xScale(gr.label) ?? 0) + xScale.bandwidth() / 2\n    const maxHalfWidth = xScale.bandwidth() / 2 - r\n\n    // Compute beeswarm positions using bucket collision-avoidance\n    const positions = beeswarm([...gr.values], yScale, r, maxHalfWidth)\n\n    positions.forEach(({ value, xOffset }) => {\n      g.append('circle')\n        .attr('cx', cx + xOffset)\n        .attr('cy', yScale(value))\n        .attr('r', r)\n        .attr('fill', color)\n        .attr('opacity', theme.pointOpacity)\n        .attr('stroke', theme.background)\n        .attr('stroke-width', 0.5)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Group', gr.label),\n            formatTooltipRow('Value', value.toFixed(4)),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    })\n\n    // Mean diamond marker + value\n    if (config.showMean) {\n      const groupMean = gr.values.reduce((s, v) => s + v, 0) / gr.values.length\n      const my = yScale(groupMean)\n      const ds = 5\n      g.append('polygon')\n        .attr('points', `${cx},${my - ds} ${cx + ds},${my} ${cx},${my + ds} ${cx - ds},${my}`)\n        .attr('fill', 'white').attr('stroke', color).attr('stroke-width', 1.5)\n      g.append('text')\n        .attr('x', cx + ds + 4).attr('y', my + 3.5)\n        .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textAnnotation).text(groupMean.toFixed(2))\n    }\n\n    // n label below x-axis\n    if (config.showN !== false) {\n      svg.append('text')\n        .attr('x', margin.left + cx)\n        .attr('y', H - theme.marginBottom + 28)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.textMuted)\n        .text(`n = ${gr.values.length}`)\n    }\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Beeswarm layout \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Compute x-offsets for a set of values so that no two circles overlap.\n * Algorithm: sort by y-pixel position, then greedily place each point at the\n * smallest valid x-offset (trying 0, \u00B1step, \u00B12step, \u2026).\n */\nfunction beeswarm(\n  values: number[],\n  yScale: { (v: number): number },\n  r: number,\n  maxHalf: number\n): Array<{ value: number; xOffset: number }> {\n  // Sort values ascending (bottom-up on screen when y increases downward)\n  const sorted = values.slice().sort((a, b) => a - b)\n  const placed: Array<{ y: number; xOffset: number }> = []\n  const diameter = r * 2 + 0.5  // collision diameter with tiny gap\n\n  const result = sorted.map(value => {\n    const y = yScale(value)\n    let xOffset = 0\n    let placed_flag = false\n\n    // Try offsets in order: 0, +step, -step, +2step, -2step, \u2026\n    for (let attempt = 0; attempt <= Math.ceil(maxHalf / diameter) + 1; attempt++) {\n      const candidates = attempt === 0 ? [0] : [attempt * diameter, -attempt * diameter]\n      for (const xOff of candidates) {\n        if (Math.abs(xOff) > maxHalf) continue\n        const overlaps = placed.some(p => {\n          const dx = xOff - p.xOffset\n          const dy = y - p.y\n          return Math.sqrt(dx * dx + dy * dy) < diameter\n        })\n        if (!overlaps) {\n          xOffset = xOff\n          placed_flag = true\n          break\n        }\n      }\n      if (placed_flag) break\n    }\n\n    placed.push({ y, xOffset })\n    return { value, xOffset }\n  })\n\n  return result\n}\n", "/**\n * Mosaic plot \u2014 column widths proportional to column marginals, row heights\n * proportional to within-column conditional proportions.\n *\n * Cells coloured by discretised Pearson residual (RdBu ColorBrewer bins):\n *   > +4   dark blue     #2166ac\n *  +2..+4  medium blue   #74add1\n *   0..+2  light blue    #d1e5f0\n *  -2.. 0  light peach   #fddbc7\n *  -4..-2  salmon        #d6604d\n *   < -4   dark red      #b2182b\n *\n * Borders:\n *   |residual| \u2265 4  \u2192 thick solid (2.5 px)\n *   |residual| \u2265 2  \u2192 dashed (stroke-dasharray 4 2)\n *   otherwise       \u2192 thin solid (0.5 px, background colour)\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface MosaicPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface MosaicPlotData {\n  /** table[i][j] = count for row i, column j */\n  readonly table: readonly (readonly number[])[]\n  readonly rowLabels: readonly string[]\n  readonly colLabels: readonly string[]\n  readonly testResult?: StatResult\n}\n\n// \u2500\u2500\u2500 Discrete RdBu bins (matches R vcd / ggmosaic convention) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ninterface ResidBin {\n  readonly lo: number       // inclusive lower bound\n  readonly hi: number       // exclusive upper bound (Infinity for last)\n  readonly fill: string\n  readonly label: string\n  readonly borderStyle: 'none' | 'dashed' | 'thick'\n}\n\nconst RESID_BINS: readonly ResidBin[] = [\n  { lo:  4,    hi:  Infinity, fill: '#2166ac', label: '> 4',   borderStyle: 'thick'  },\n  { lo:  2,    hi:  4,        fill: '#74add1', label: '2 : 4', borderStyle: 'dashed' },\n  { lo:  0,    hi:  2,        fill: '#d1e5f0', label: '0 : 2', borderStyle: 'none'   },\n  { lo: -2,    hi:  0,        fill: '#fddbc7', label: '\u22122 : 0',borderStyle: 'none'   },\n  { lo: -4,    hi: -2,        fill: '#d6604d', label: '\u22124 : \u22122',borderStyle: 'dashed'},\n  { lo: -Infinity, hi: -4,   fill: '#b2182b', label: '< \u22124',  borderStyle: 'thick'  },\n]\n\nfunction binForResidual(r: number): ResidBin {\n  return RESID_BINS.find(b => r >= b.lo && r < b.hi) ?? RESID_BINS[2]!\n}\n\n/** White text on dark bins, dark text on light bins. */\nfunction textColor(fill: string): string {\n  const dark = ['#2166ac', '#b2182b', '#d6604d']\n  return dark.includes(fill) ? '#ffffff' : '#212529'\n}\n\nexport function renderMosaicPlot(\n  container: HTMLElement,\n  data: MosaicPlotData,\n  config: MosaicPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderMosaicPlotD3(d3, container, data, config))\n}\n\nfunction renderMosaicPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: MosaicPlotData,\n  config: MosaicPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const legendW = 110\n  const W = config.width ?? Math.max(container.clientWidth || 620, 420)\n  const H = config.height ?? 480\n  const margin = {\n    top:    theme.marginTop,\n    right:  theme.marginRight + legendW,\n    bottom: theme.marginBottom,\n    left:   theme.marginLeft,\n  }\n  const width  = W - margin.left - margin.right\n  const height = H - margin.top  - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W).attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Mosaic Plot', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const nRows = data.table.length\n  const nCols = data.table[0]?.length ?? 0\n  if (nRows === 0 || nCols === 0) return\n\n  // \u2500\u2500 Marginals \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const colSums = Array.from({ length: nCols }, (_, j) =>\n    data.table.reduce((s, row) => s + (row[j] ?? 0), 0)\n  )\n  const grandTotal = colSums.reduce((a, b) => a + b, 0)\n  const rowSums    = data.table.map(row => row.reduce((a, b) => a + b, 0))\n\n  // \u2500\u2500 Pearson residuals \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const residuals = data.table.map((row, i) =>\n    row.map((v, j) => {\n      const e = (rowSums[i]! * colSums[j]!) / grandTotal\n      return e > 0 ? (v - e) / Math.sqrt(e) : 0\n    })\n  )\n\n  // \u2500\u2500 Column x-positions (cumulative proportional widths) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const gap = 3\n  const colWidths = colSums.map(s => (s / grandTotal) * width)\n  const colX: number[] = []\n  colWidths.reduce((acc, w, i) => { colX[i] = acc; return acc + w }, 0)\n\n  // \u2500\u2500 Draw cells \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.table.forEach((row, ri) => {\n    row.forEach((count, ci) => {\n      const colSum = colSums[ci] ?? 1\n      const cellH  = colSum > 0 ? (count / colSum) * height : 0\n      const rowsAbove = data.table.slice(0, ri).reduce((s, r2) => s + (r2[ci] ?? 0), 0)\n      const cellY  = colSum > 0 ? (rowsAbove / colSum) * height : 0\n      const cx     = colX[ci] ?? 0\n      const cw     = colWidths[ci] ?? 0\n      const resid  = residuals[ri]![ci]!\n      const bin    = binForResidual(resid)\n\n      const rx = cx + gap / 2\n      const ry = cellY + gap / 2\n      const rw = Math.max(cw - gap, 0)\n      const rh = Math.max(cellH - gap, 0)\n\n      // Background rect\n      g.append('rect')\n        .attr('x', rx).attr('y', ry)\n        .attr('width', rw).attr('height', rh)\n        .attr('fill', bin.fill)\n        .attr('stroke', 'none')\n\n      // Border overlay (significance indicator)\n      if (bin.borderStyle !== 'none') {\n        const isThick = bin.borderStyle === 'thick'\n        g.append('rect')\n          .attr('x', rx).attr('y', ry)\n          .attr('width', rw).attr('height', rh)\n          .attr('fill', 'none')\n          .attr('stroke', isThick ? (resid > 0 ? '#08519c' : '#a50f15') : (resid > 0 ? '#4292c6' : '#cb181d'))\n          .attr('stroke-width', isThick ? 2.5 : 1.5)\n          .attr('stroke-dasharray', isThick ? 'none' : '5,2')\n\n      }\n\n      // Invisible hit-area for tooltip (covers full cell including gaps)\n      g.append('rect')\n        .attr('x', rx).attr('y', ry)\n        .attr('width', rw).attr('height', rh)\n        .attr('fill', 'transparent')\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Row',    data.rowLabels[ri] ?? `Row ${ri}`),\n            formatTooltipRow('Column', data.colLabels[ci] ?? `Col ${ci}`),\n            formatTooltipRow('Count',  count),\n            formatTooltipRow('Residual', resid.toFixed(2)),\n            formatTooltipRow('Bin',    bin.label),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n\n      // Count label if cell is large enough\n      if (rw > 30 && rh > 16) {\n        g.append('text')\n          .attr('x', rx + rw / 2)\n          .attr('y', ry + rh / 2 + 4)\n          .attr('text-anchor', 'middle')\n          .attr('font-family', theme.fontFamily)\n          .attr('font-size', Math.min(theme.fontSizeSmall, rh * 0.38, rw * 0.22))\n          .attr('fill', textColor(bin.fill))\n          .attr('pointer-events', 'none')\n          .text(String(count))\n      }\n    })\n  })\n\n  // \u2500\u2500 Column labels (x-axis) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  colX.forEach((x, ci) => {\n    const cw = colWidths[ci] ?? 0\n    g.append('text')\n      .attr('x', x + cw / 2).attr('y', height + 18)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(data.colLabels[ci] ?? `Col ${ci}`)\n  })\n\n  // \u2500\u2500 Row labels (y-axis) \u2014 midpoint of each row in the first column \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.table.forEach((row, ri) => {\n    const colSum = colSums[0] ?? 1\n    const rowsAbove = data.table.slice(0, ri).reduce((s, r2) => s + (r2[0] ?? 0), 0)\n    const cellY = colSum > 0 ? (rowsAbove / colSum) * height : 0\n    const cellH = colSum > 0 ? ((row[0] ?? 0) / colSum) * height : 0\n    g.append('text')\n      .attr('x', -8).attr('y', cellY + cellH / 2 + 4)\n      .attr('text-anchor', 'end')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(data.rowLabels[ri] ?? `Row ${ri}`)\n  })\n\n  // \u2500\u2500 Axis labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (config.xLabel) {\n    g.append('text')\n      .attr('x', width / 2).attr('y', height + 44)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.xLabel)\n  }\n  if (config.yLabel) {\n    g.append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('x', -height / 2).attr('y', -52)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.yLabel)\n  }\n\n  // \u2500\u2500 Discrete legend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const lgX  = width + 20\n  const lgY0 = height / 2 - (RESID_BINS.length * 22) / 2\n  const swatchS = 14\n\n  // Legend title\n  g.append('text')\n    .attr('x', lgX).attr('y', lgY0 - 14)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('font-weight', '600')\n    .attr('fill', theme.text)\n    .text('Standardised')\n  g.append('text')\n    .attr('x', lgX).attr('y', lgY0 - 2)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('font-weight', '600')\n    .attr('fill', theme.text)\n    .text('residual')\n\n  RESID_BINS.forEach((bin, bi) => {\n    const ly = lgY0 + bi * 22\n\n    // Colour swatch\n    g.append('rect')\n      .attr('x', lgX).attr('y', ly)\n      .attr('width', swatchS).attr('height', swatchS)\n      .attr('fill', bin.fill)\n      .attr('rx', 2)\n\n    // Significance border on swatch\n    if (bin.borderStyle !== 'none') {\n      g.append('rect')\n        .attr('x', lgX).attr('y', ly)\n        .attr('width', swatchS).attr('height', swatchS)\n        .attr('fill', 'none').attr('rx', 2)\n        .attr('stroke', bin.fill === '#2166ac' || bin.fill === '#74add1' ? '#4292c6' : '#cb181d')\n        .attr('stroke-width', bin.borderStyle === 'thick' ? 2 : 1.5)\n        .attr('stroke-dasharray', bin.borderStyle === 'thick' ? 'none' : '4,2')\n    }\n\n    // Label\n    g.append('text')\n      .attr('x', lgX + swatchS + 6).attr('y', ly + swatchS - 3)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text)\n      .text(bin.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Scatter matrix (pairs plot) \u2014 n\u00D7n grid of mini-plots.\n * Off-diagonal cells: scatter plot of variable i vs variable j.\n * Diagonal cells: histogram of variable i.\n * Each cell is a self-contained SVG <g> fitting in the available space.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface PairPlotConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface PairPlotData {\n  /** data[varIndex][obsIndex] \u2014 each inner array is one variable's observations */\n  readonly data: readonly (readonly number[])[]\n  readonly labels: readonly string[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a scatter matrix (pairs plot).\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - variable arrays + labels + optional stat result\n * @param config - visual configuration\n */\nexport function renderPairPlot(\n  container: HTMLElement,\n  data: PairPlotData,\n  config: PairPlotConfig = {}\n): void {\n  import('d3').then(d3 => renderPairPlotD3(d3, container, data, config))\n}\n\nfunction renderPairPlotD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: PairPlotData,\n  config: PairPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? Math.max(W, 480)\n\n  // Outer margins just for title/caption\n  const outerMarginTop = 52\n  const outerMarginBottom = config.caption ? 28 : 16\n  const outerMarginSide = 16\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Scatter Matrix', data.testResult?.formatted ?? '', W, theme)\n\n  const n = data.labels.length\n  if (n < 2) return\n\n  const gridW = W - outerMarginSide * 2\n  const gridH = H - outerMarginTop - outerMarginBottom\n  const cellW = gridW / n\n  const cellH = gridH / n\n  const cellPad = 6   // inner padding per cell\n\n  // Pre-compute per-variable scales (shared across the whole column/row)\n  const scales = data.data.map(vals => {\n    const [lo, hi] = d3.extent(vals) as [number, number]\n    const pad = ((hi - lo) * 0.08) || 0.5\n    return d3.scaleLinear().domain([lo - pad, hi + pad]).range([cellPad, cellW - cellPad]).nice()\n  })\n\n  const scalesY = data.data.map(vals => {\n    const [lo, hi] = d3.extent(vals) as [number, number]\n    const pad = ((hi - lo) * 0.08) || 0.5\n    return d3.scaleLinear().domain([lo - pad, hi + pad]).range([cellH - cellPad, cellPad]).nice()\n  })\n\n  const gridG = svg.append('g')\n    .attr('transform', `translate(${outerMarginSide},${outerMarginTop})`)\n\n  // Draw n\u00D7n cells\n  for (let row = 0; row < n; row++) {\n    for (let col = 0; col < n; col++) {\n      const cellX = col * cellW\n      const cellY = row * cellH\n      const cellG = gridG.append('g')\n        .attr('transform', `translate(${cellX},${cellY})`)\n\n      // Cell background\n      cellG.append('rect')\n        .attr('width', cellW).attr('height', cellH)\n        .attr('fill', row === col ? theme.surface : theme.background)\n        .attr('stroke', theme.gridLine).attr('stroke-width', 0.5)\n\n      if (row === col) {\n        // Diagonal: histogram of variable i\n        drawHistogramCell(d3, cellG, data.data[row]!, scales[col]!, cellW, cellH, cellPad, getColor(row, theme), theme)\n\n        // Variable label centred\n        cellG.append('text')\n          .attr('x', cellW / 2).attr('y', cellPad + 10)\n          .attr('text-anchor', 'middle')\n          .attr('font-family', theme.fontFamily)\n          .attr('font-size', Math.min(theme.fontSizeSmall, cellW / 8))\n          .attr('font-weight', '600')\n          .attr('fill', theme.text)\n          .text(data.labels[row] ?? '')\n      } else {\n        // Off-diagonal: scatter plot of col (x) vs row (y)\n        const xVals = data.data[col]!\n        const yVals = data.data[row]!\n        const xSc = scales[col]!\n        const ySc = scalesY[row]!\n\n        const n_obs = Math.min(xVals.length, yVals.length)\n        for (let i = 0; i < n_obs; i++) {\n          const xv = xVals[i]!\n          const yv = yVals[i]!\n          cellG.append('circle')\n            .attr('cx', xSc(xv))\n            .attr('cy', ySc(yv))\n            .attr('r', Math.min(2.5, cellW / 40))\n            .attr('fill', getColor(col, theme))\n            .attr('opacity', theme.pointOpacity)\n            .on('mouseover', (event: MouseEvent) => {\n              showTooltip(event, [\n                formatTooltipRow(data.labels[col] ?? `Var ${col}`, xv.toFixed(3)),\n                formatTooltipRow(data.labels[row] ?? `Var ${row}`, yv.toFixed(3)),\n              ].join(''), theme)\n            })\n            .on('mouseout', hideTooltip)\n        }\n\n        // Pearson correlation label\n        const r = pearsonR(xVals.slice(0, n_obs), yVals.slice(0, n_obs))\n        cellG.append('text')\n          .attr('x', cellW - cellPad - 2).attr('y', cellH - cellPad - 2)\n          .attr('text-anchor', 'end')\n          .attr('font-family', theme.fontFamilyMono)\n          .attr('font-size', Math.min(theme.fontSizeSmall - 1, cellW / 9))\n          .attr('fill', theme.textMuted)\n          .text(`r=${r.toFixed(2)}`)\n      }\n    }\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawHistogramCell(\n  d3: typeof D3,\n  g: D3.Selection<SVGGElement, unknown, null, undefined>,\n  values: readonly number[],\n  xScale: D3.ScaleLinear<number, number>,\n  _cellW: number,\n  cellH: number,\n  pad: number,\n  color: string,\n  _theme: CarmTheme\n): void {\n  const bins = d3.bin()\n    .domain(xScale.domain() as [number, number])\n    .thresholds(8)([...values])\n\n  const maxCount = Math.max(...bins.map(b => b.length))\n  const yScale = d3.scaleLinear().domain([0, maxCount]).range([cellH - pad - 14, pad + 14])\n\n  bins.forEach(bin => {\n    const x0 = xScale(bin.x0 ?? 0)\n    const x1 = xScale(bin.x1 ?? 0)\n    const bw = Math.max(x1 - x0 - 1, 1)\n    g.append('rect')\n      .attr('x', x0)\n      .attr('y', yScale(bin.length))\n      .attr('width', bw)\n      .attr('height', Math.max(cellH - pad - 14 - yScale(bin.length), 0))\n      .attr('fill', color)\n      .attr('opacity', 0.6)\n  })\n}\n\nfunction pearsonR(xs: readonly number[], ys: readonly number[]): number {\n  const n = xs.length\n  if (n < 2) return 0\n  const mx = xs.reduce((a, b) => a + b, 0) / n\n  const my = ys.reduce((a, b) => a + b, 0) / n\n  let num = 0, sdx = 0, sdy = 0\n  for (let i = 0; i < n; i++) {\n    const dx = (xs[i]! - mx)\n    const dy = (ys[i]! - my)\n    num += dx * dy\n    sdx += dx * dx\n    sdy += dy * dy\n  }\n  const denom = Math.sqrt(sdx * sdy)\n  return denom === 0 ? 0 : num / denom\n}\n", "/**\n * Radar / spider chart \u2014 one polygon per series, one spoke per axis.\n * Values are normalized per axis to [0,1] using min/max across all series.\n * Spokes are uniformly spaced angularly. Filled polygons with opacity.\n * Axis labels at spoke tips. Legend for series.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface RadarChartConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly levels?: number   // number of concentric rings\n}\n\nexport interface RadarChartData {\n  readonly series: readonly {\n    readonly label: string\n    readonly values: readonly number[]\n  }[]\n  readonly axes: readonly string[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a radar / spider chart.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - series (each with values per axis) + axis names + optional stat result\n * @param config - visual configuration\n */\nexport function renderRadarChart(\n  container: HTMLElement,\n  data: RadarChartData,\n  config: RadarChartConfig = {}\n): void {\n  import('d3').then(d3 => renderRadarChartD3(d3, container, data, config))\n}\n\nfunction renderRadarChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: RadarChartData,\n  config: RadarChartConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const levels = config.levels ?? 5\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Radar Chart', data.testResult?.formatted ?? '', W, theme)\n\n  const nAxes = data.axes.length\n  if (nAxes < 3 || data.series.length === 0) return\n\n  // Reserve space for legend on the right\n  const legendWidth = 120\n  const chartCentreX = (W - legendWidth) / 2\n  const chartCentreY = (H - theme.marginTop - 32) / 2 + theme.marginTop + 8\n  const radius = Math.min((W - legendWidth) / 2, (H - theme.marginTop - 48) / 2) * 0.72\n\n  const g = svg.append('g')\n\n  // Per-axis min/max (across all series) for normalisation\n  const axisMin = Array.from({ length: nAxes }, (_, ai) =>\n    Math.min(...data.series.map(s => s.values[ai] ?? 0))\n  )\n  const axisMax = Array.from({ length: nAxes }, (_, ai) =>\n    Math.max(...data.series.map(s => s.values[ai] ?? 0))\n  )\n\n  const normalize = (val: number, ai: number): number => {\n    const lo = axisMin[ai]!\n    const hi = axisMax[ai]!\n    return hi === lo ? 0.5 : (val - lo) / (hi - lo)\n  }\n\n  // Angle for each axis (start top, clockwise)\n  const angleOf = (i: number): number => (i / nAxes) * 2 * Math.PI - Math.PI / 2\n\n  // Point on radar at normalised radius t for axis ai\n  const pt = (t: number, ai: number): [number, number] => {\n    const a = angleOf(ai)\n    return [\n      chartCentreX + radius * t * Math.cos(a),\n      chartCentreY + radius * t * Math.sin(a),\n    ]\n  }\n\n  // Concentric level rings\n  for (let lvl = 1; lvl <= levels; lvl++) {\n    const t = lvl / levels\n    const ringPts = Array.from({ length: nAxes }, (_, ai) => pt(t, ai))\n    g.append('polygon')\n      .attr('points', ringPts.map(([x, y]) => `${x},${y}`).join(' '))\n      .attr('fill', 'none')\n      .attr('stroke', theme.gridLine)\n      .attr('stroke-width', 1)\n  }\n\n  // Spokes\n  Array.from({ length: nAxes }, (_, ai) => {\n    const [x2, y2] = pt(1, ai)\n    g.append('line')\n      .attr('x1', chartCentreX).attr('y1', chartCentreY)\n      .attr('x2', x2).attr('y2', y2)\n      .attr('stroke', theme.gridLine)\n      .attr('stroke-width', 1)\n  })\n\n  // Axis labels at spoke tips\n  data.axes.forEach((label, ai) => {\n    const angle = angleOf(ai)\n    const labelDist = radius * 1.15\n    const lx = chartCentreX + labelDist * Math.cos(angle)\n    const ly = chartCentreY + labelDist * Math.sin(angle)\n\n    let anchor = 'middle'\n    if (Math.cos(angle) > 0.1) anchor = 'start'\n    else if (Math.cos(angle) < -0.1) anchor = 'end'\n\n    g.append('text')\n      .attr('x', lx).attr('y', ly + 4)\n      .attr('text-anchor', anchor)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(label)\n  })\n\n  // Draw each series polygon\n  data.series.forEach((series, si) => {\n    const color = getColor(si, theme)\n    const polyPts = data.axes.map((_, ai) => {\n      const t = normalize(series.values[ai] ?? 0, ai)\n      return pt(t, ai)\n    })\n\n    g.append('polygon')\n      .attr('points', polyPts.map(([x, y]) => `${x},${y}`).join(' '))\n      .attr('fill', color)\n      .attr('fill-opacity', theme.ciOpacity + 0.05)\n      .attr('stroke', color)\n      .attr('stroke-width', 2)\n\n    // Vertex dots with tooltip\n    polyPts.forEach(([px, py], ai) => {\n      g.append('circle')\n        .attr('cx', px).attr('cy', py)\n        .attr('r', 4)\n        .attr('fill', color)\n        .attr('stroke', theme.background)\n        .attr('stroke-width', 1.5)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Series', series.label),\n            formatTooltipRow('Axis', data.axes[ai] ?? `Axis ${ai}`),\n            formatTooltipRow('Value', (series.values[ai] ?? 0).toFixed(3)),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    })\n  })\n\n  // Legend (right side)\n  const lgX = W - legendWidth + 8\n  data.series.forEach((series, si) => {\n    const color = getColor(si, theme)\n    const lgY = theme.marginTop + si * 22\n\n    g.append('rect')\n      .attr('x', lgX).attr('y', lgY)\n      .attr('width', 12).attr('height', 12)\n      .attr('fill', color).attr('opacity', 0.8)\n      .attr('rx', 2)\n\n    g.append('text')\n      .attr('x', lgX + 16).attr('y', lgY + 10)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(series.label.length > 14 ? series.label.slice(0, 13) + '\u2026' : series.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Parallel coordinates plot \u2014 one vertical axis per variable, evenly spaced\n * horizontally. Each data row is a polyline through its per-axis values.\n * Axes are individually min-max scaled. Rows are optionally coloured by group.\n * Lines are semi-transparent to show density.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ParallelCoordsConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface ParallelCoordsData {\n  /** rows[obsIndex][varIndex] */\n  readonly rows: readonly (readonly number[])[]\n  readonly axes: readonly string[]\n  /** optional group index per row (0-based) for colour coding */\n  readonly groups?: readonly number[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a parallel coordinates plot.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - observations (rows \u00D7 vars), axis names, optional groups + stat result\n * @param config - visual configuration\n */\nexport function renderParallelCoords(\n  container: HTMLElement,\n  data: ParallelCoordsData,\n  config: ParallelCoordsConfig = {}\n): void {\n  import('d3').then(d3 => renderParallelCoordsD3(d3, container, data, config))\n}\n\nfunction renderParallelCoordsD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ParallelCoordsData,\n  config: ParallelCoordsConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 700, 400)\n  const H = config.height ?? 480\n  const margin = {\n    top: theme.marginTop + 16,\n    right: theme.marginRight,\n    bottom: theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Parallel Coordinates', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const nAxes = data.axes.length\n  if (nAxes < 2 || data.rows.length === 0) return\n\n  // X position of each axis\n  const axisX = (i: number): number => (i / (nAxes - 1)) * width\n\n  // Per-axis linear scales (min\u2013max normalised to plot height)\n  const yScales = data.axes.map((_, ai) => {\n    const vals = data.rows.map(row => row[ai] ?? 0)\n    const [lo, hi] = d3.extent(vals) as [number, number]\n    const pad = ((hi - lo) * 0.05) || 0.5\n    return d3.scaleLinear().domain([lo - pad, hi + pad]).range([height, 0]).nice()\n  })\n\n  // Draw polyline per row\n  data.rows.forEach((row, ri) => {\n    const groupIdx = data.groups?.[ri] ?? 0\n    const color = getColor(groupIdx, theme)\n\n    const pathData = data.axes.map((_, ai) => {\n      const val = row[ai] ?? 0\n      return [axisX(ai), yScales[ai]!(val)] as [number, number]\n    })\n\n    g.append('path')\n      .attr('d', lineThrough(pathData))\n      .attr('fill', 'none')\n      .attr('stroke', color)\n      .attr('stroke-width', 1.2)\n      .attr('opacity', Math.max(0.1, Math.min(0.55, 30 / data.rows.length)))\n      .on('mouseover', (event: MouseEvent) => {\n        const tooltipRows = data.axes.map((label, ai) =>\n          formatTooltipRow(label, (row[ai] ?? 0).toFixed(3))\n        )\n        showTooltip(event, tooltipRows.join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n  })\n\n  // Draw vertical axes and labels\n  data.axes.forEach((label, ai) => {\n    const x = axisX(ai)\n    const ySc = yScales[ai]!\n\n    // Axis line\n    g.append('line')\n      .attr('x1', x).attr('x2', x)\n      .attr('y1', 0).attr('y2', height)\n      .attr('stroke', theme.axisLine)\n      .attr('stroke-width', 1.5)\n\n    // Tick marks (5 ticks)\n    const ticks = ySc.ticks(5)\n    ticks.forEach(tick => {\n      g.append('line')\n        .attr('x1', x - 4).attr('x2', x + 4)\n        .attr('y1', ySc(tick)).attr('y2', ySc(tick))\n        .attr('stroke', theme.axisLine)\n        .attr('stroke-width', 1)\n      g.append('text')\n        .attr('x', x - 6).attr('y', ySc(tick) + 4)\n        .attr('text-anchor', 'end')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall - 1)\n        .attr('fill', theme.textMuted)\n        .text(tick.toFixed(1))\n    })\n\n    // Axis label at top\n    g.append('text')\n      .attr('x', x).attr('y', -10)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('font-weight', '600')\n      .attr('fill', theme.text)\n      .text(label)\n  })\n\n  // Legend for groups (if present)\n  if (data.groups) {\n    const uniqueGroups = Array.from(new Set(data.groups)).sort((a, b) => a - b)\n    uniqueGroups.forEach((grp, i) => {\n      const lgX = 0\n      const lgY = height + 32 + i * 18\n      g.append('rect')\n        .attr('x', lgX).attr('y', lgY)\n        .attr('width', 10).attr('height', 10)\n        .attr('fill', getColor(grp, theme))\n        .attr('rx', 2)\n      g.append('text')\n        .attr('x', lgX + 14).attr('y', lgY + 9)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text)\n        .text(`Group ${grp}`)\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Helper \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Build an SVG path string connecting points with straight segments. */\nfunction lineThrough(pts: ReadonlyArray<readonly [number, number]>): string {\n  if (pts.length === 0) return ''\n  return pts.map(([x, y], i) => `${i === 0 ? 'M' : 'L'}${x.toFixed(2)},${y.toFixed(2)}`).join(' ')\n}\n", "/**\n * Treemap \u2014 rectangle area proportional to value, laid out using D3's\n * squarified treemap algorithm. Cells are labelled (truncated when small)\n * and coloured by group when provided, otherwise by index.\n * White borders separate cells. Tooltip shows label, value, and %.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface TreemapConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface TreemapChild {\n  readonly label: string\n  readonly value: number\n  readonly group?: string\n}\n\nexport interface TreemapData {\n  readonly children: readonly TreemapChild[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a treemap using D3's squarified layout.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - leaf nodes with labels, values, optional groups + stat result\n * @param config - visual configuration\n */\nexport function renderTreemap(\n  container: HTMLElement,\n  data: TreemapData,\n  config: TreemapConfig = {}\n): void {\n  import('d3').then(d3 => renderTreemapD3(d3, container, data, config))\n}\n\nfunction renderTreemapD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: TreemapData,\n  config: TreemapConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? 480\n  const margin = {\n    top: theme.marginTop,\n    right: theme.marginRight,\n    bottom: theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Treemap', data.testResult?.formatted ?? '', W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  if (data.children.length === 0) return\n\n  // Determine group colour mapping\n  const uniqueGroups = Array.from(new Set(data.children.map(c => c.group ?? ''))).filter(Boolean)\n  const groupColorMap = new Map(uniqueGroups.map((grp, i) => [grp, getColor(i, theme)]))\n\n  const total = data.children.reduce((s, c) => s + c.value, 0)\n\n  // Build hierarchy and layout\n  type HierarchyDatum = { readonly children: readonly TreemapChild[] }\n  const root = (d3.hierarchy as unknown as (datum: HierarchyDatum) => D3.HierarchyNode<HierarchyDatum>)(\n    { children: data.children }\n  )\n    .sum((d: unknown) => {\n      const node = d as Partial<TreemapChild>\n      return node.value ?? 0\n    })\n    .sort((a, b) => (b.value ?? 0) - (a.value ?? 0))\n\n  const treemapLayout = d3.treemap<HierarchyDatum>()\n    .size([width, height])\n    .paddingInner(2)\n    .paddingOuter(0)\n    .round(true)\n\n  treemapLayout(root)\n\n  // Draw leaves\n  const leaves = root.leaves() as unknown as Array<D3.HierarchyRectangularNode<HierarchyDatum>>\n\n  leaves.forEach((leaf, li) => {\n    const childData = leaf.data as unknown as TreemapChild\n    const x0 = leaf.x0\n    const y0 = leaf.y0\n    const x1 = leaf.x1\n    const y1 = leaf.y1\n    const cellW = x1 - x0\n    const cellH = y1 - y0\n\n    const color = childData.group && groupColorMap.has(childData.group)\n      ? groupColorMap.get(childData.group)!\n      : getColor(li, theme)\n\n    const pct = total > 0 ? (childData.value / total) * 100 : 0\n\n    const cell = g.append('g').attr('transform', `translate(${x0},${y0})`)\n\n    cell.append('rect')\n      .attr('width', cellW)\n      .attr('height', cellH)\n      .attr('fill', color)\n      .attr('opacity', 0.75)\n      .attr('stroke', theme.background)\n      .attr('stroke-width', 2)\n      .attr('rx', 2)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('Label', childData.label),\n          formatTooltipRow('Value', childData.value.toFixed(2)),\n          formatTooltipRow('Share', `${pct.toFixed(1)}%`),\n          ...(childData.group ? [formatTooltipRow('Group', childData.group)] : []),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Label: only if cell is large enough\n    if (cellW > 30 && cellH > 16) {\n      const maxChars = Math.max(3, Math.floor(cellW / 7))\n      const label = childData.label.length > maxChars\n        ? childData.label.slice(0, maxChars - 1) + '\u2026'\n        : childData.label\n\n      cell.append('text')\n        .attr('x', 5).attr('y', 14)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', Math.min(theme.fontSizeSmall, cellH / 3))\n        .attr('font-weight', '600')\n        .attr('fill', '#fff')\n        .attr('pointer-events', 'none')\n        .text(label)\n\n      if (cellH > 28) {\n        cell.append('text')\n          .attr('x', 5).attr('y', 26)\n          .attr('font-family', theme.fontFamily)\n          .attr('font-size', Math.min(theme.fontSizeSmall - 2, cellH / 4))\n          .attr('fill', 'rgba(255,255,255,0.75)')\n          .attr('pointer-events', 'none')\n          .text(`${pct.toFixed(1)}%`)\n      }\n    }\n  })\n\n  // Group legend if groups are present\n  if (uniqueGroups.length > 0) {\n    uniqueGroups.forEach((grp, i) => {\n      const lgX = 0\n      const lgY = height + 24 + i * 18\n      if (lgY + 12 > H - margin.top - 4) return  // no overflow\n      g.append('rect')\n        .attr('x', lgX).attr('y', lgY)\n        .attr('width', 12).attr('height', 12)\n        .attr('fill', groupColorMap.get(grp) ?? theme.gridLine)\n        .attr('rx', 2)\n      g.append('text')\n        .attr('x', lgX + 16).attr('y', lgY + 10)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text)\n        .text(grp)\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Waffle chart \u2014 10\u00D710 grid of small squares where each square represents 1%\n * of the total. Squares are coloured by slice proportionally (floor-rounded,\n * remainder assigned to largest slice). Legend below shows colour, label, %.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface WaffleChartConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface WaffleChartData {\n  readonly slices: readonly { readonly label: string; readonly value: number }[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a waffle chart (10\u00D710 proportional grid).\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - named slices with values + optional stat result\n * @param config - visual configuration\n */\nexport function renderWaffleChart(\n  container: HTMLElement,\n  data: WaffleChartData,\n  config: WaffleChartConfig = {}\n): void {\n  import('d3').then(d3 => renderWaffleChartD3(d3, container, data, config))\n}\n\nfunction renderWaffleChartD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: WaffleChartData,\n  config: WaffleChartConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 400, 300)\n  const H = config.height ?? 420\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(svg, config.title ?? 'Waffle Chart', data.testResult?.formatted ?? '', W, theme)\n\n  if (data.slices.length === 0) return\n\n  const total = data.slices.reduce((s, sl) => s + sl.value, 0)\n  if (total === 0) return\n\n  // Allocate 100 cells: floor then assign remainder to largest remainders\n  const pcts = data.slices.map(sl => (sl.value / total) * 100)\n  const floors = pcts.map(p => Math.floor(p))\n  const remainders = pcts.map((p, i) => p - floors[i]!)\n  let remaining = 100 - floors.reduce((a, b) => a + b, 0)\n\n  // Sort by remainder descending to assign leftover cells\n  const sortedIdx = Array.from({ length: data.slices.length }, (_, i) => i)\n    .sort((a, b) => remainders[b]! - remainders[a]!)\n\n  const cells = [...floors]\n  for (let i = 0; i < remaining; i++) {\n    cells[sortedIdx[i % sortedIdx.length]!]! += 1\n  }\n\n  // Build flat cell array: 100 entries, each holding the slice index\n  const cellColors: number[] = []\n  cells.forEach((count, si) => {\n    for (let c = 0; c < count; c++) cellColors.push(si)\n  })\n\n  // Grid geometry\n  const legendH = Math.ceil(data.slices.length / 3) * 22 + 12\n  const gridAreaH = H - theme.marginTop - legendH - 16\n  const gridAreaW = W - theme.marginLeft - theme.marginRight\n  const cellSize = Math.min(Math.floor(gridAreaH / 10), Math.floor(gridAreaW / 10))\n  const gap = Math.max(2, Math.floor(cellSize / 8))\n  const gridW = cellSize * 10 + gap * 9\n  const gridH = cellSize * 10 + gap * 9\n  const originX = (W - gridW) / 2\n  const originY = theme.marginTop + 8\n\n  const g = svg.append('g')\n\n  // Draw 10\u00D710 grid (row 0 = top)\n  for (let row = 0; row < 10; row++) {\n    for (let col = 0; col < 10; col++) {\n      const idx = row * 10 + col\n      const si = cellColors[idx] ?? 0\n      const color = getColor(si, theme)\n      const x = originX + col * (cellSize + gap)\n      const y = originY + row * (cellSize + gap)\n      const sliceData = data.slices[si]!\n\n      g.append('rect')\n        .attr('x', x).attr('y', y)\n        .attr('width', cellSize).attr('height', cellSize)\n        .attr('fill', color)\n        .attr('opacity', 0.85)\n        .attr('rx', Math.max(1, cellSize / 8))\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Slice', sliceData.label),\n            formatTooltipRow('Value', sliceData.value.toFixed(2)),\n            formatTooltipRow('Share', `${((sliceData.value / total) * 100).toFixed(1)}%`),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n    }\n  }\n\n  // Legend \u2014 up to 3 items per row\n  const lgTop = originY + gridH + 20\n  const lgColW = Math.floor(W / 3)\n\n  data.slices.forEach((sl, si) => {\n    const row = Math.floor(si / 3)\n    const col = si % 3\n    const lgX = col * lgColW + 12\n    const lgY = lgTop + row * 22\n    const color = getColor(si, theme)\n    const pct = ((sl.value / total) * 100).toFixed(1)\n\n    g.append('rect')\n      .attr('x', lgX).attr('y', lgY)\n      .attr('width', 12).attr('height', 12)\n      .attr('fill', color).attr('opacity', 0.85)\n      .attr('rx', 2)\n\n    const labelText = sl.label.length > 14 ? sl.label.slice(0, 13) + '\u2026' : sl.label\n    g.append('text')\n      .attr('x', lgX + 16).attr('y', lgY + 10)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text)\n      .text(`${labelText} (${pct}%)`)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Sparkline \u2014 minimal inline trend line for dashboard embedding.\n * Tiny margins, no axes, no labels, no grid. Just the line, an optional\n * shaded area, and a highlighted end-point dot.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface SparklineConfig {\n  readonly showArea?: boolean\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n}\n\nexport interface SparklineData {\n  readonly values: readonly number[]\n  readonly testResult?: StatResult\n}\n\n/**\n * Render a sparkline (minimal inline trend line).\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - numeric time series values + optional stat result\n * @param config - visual configuration (very minimal by design)\n */\nexport function renderSparkline(\n  container: HTMLElement,\n  data: SparklineData,\n  config: SparklineConfig = {}\n): void {\n  import('d3').then(d3 => renderSparklineD3(d3, container, data, config))\n}\n\nfunction renderSparklineD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: SparklineData,\n  config: SparklineConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 200, 80)\n  const H = config.height ?? 80\n  const m = 8   // tiny uniform margin\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  const values = [...data.values]\n  if (values.length < 2) {\n    // Draw a flat dot for a single value\n    if (values.length === 1) {\n      const color = getColor(0, theme)\n      svg.append('circle')\n        .attr('cx', W / 2).attr('cy', H / 2)\n        .attr('r', 3).attr('fill', color)\n    }\n    return\n  }\n\n  const color = getColor(0, theme)\n  const [yMin, yMax] = d3.extent(values) as [number, number]\n  const yPad = ((yMax - yMin) * 0.1) || 1\n\n  const xScale = d3.scaleLinear()\n    .domain([0, values.length - 1])\n    .range([m, W - m])\n\n  const yScale = d3.scaleLinear()\n    .domain([yMin - yPad, yMax + yPad])\n    .range([H - m, m])\n\n  const indexed = values.map((v, i) => [i, v] as [number, number])\n\n  // Optional area\n  if (config.showArea !== false) {\n    const areaFn = d3.area<[number, number]>()\n      .x(d => xScale(d[0]))\n      .y0(H - m)\n      .y1(d => yScale(d[1]))\n      .curve(d3.curveCatmullRom)\n\n    svg.append('path')\n      .datum(indexed)\n      .attr('d', areaFn)\n      .attr('fill', color)\n      .attr('opacity', theme.ciOpacity)\n  }\n\n  // Line\n  const lineFn = d3.line<[number, number]>()\n    .x(d => xScale(d[0]))\n    .y(d => yScale(d[1]))\n    .curve(d3.curveCatmullRom)\n\n  svg.append('path')\n    .datum(indexed)\n    .attr('d', lineFn)\n    .attr('fill', 'none')\n    .attr('stroke', color)\n    .attr('stroke-width', 1.5)\n\n  // End-point dot\n  const lastVal = values[values.length - 1]!\n  svg.append('circle')\n    .attr('cx', xScale(values.length - 1))\n    .attr('cy', yScale(lastVal))\n    .attr('r', 3)\n    .attr('fill', color)\n    .attr('stroke', theme.background)\n    .attr('stroke-width', 1.5)\n}\n", "/**\n * Sunburst chart \u2014 radial hierarchy visualization where each ring represents\n * one level of depth. Arc angles are proportional to node values. Center hole\n * shows total. Depth-1 nodes are listed in a right-side legend.\n * Inspired by ggstatsplot philosophy: every plot tells the full statistical story.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface SunburstNode {\n  readonly name: string\n  readonly value?: number\n  readonly children?: readonly SunburstNode[]\n}\n\nexport interface SunburstData {\n  readonly root: SunburstNode\n  readonly testResult?: StatResult\n}\n\nexport interface SunburstConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly innerRadius?: number   // fraction of outerRadius \u2014 0 = full pie, default 0.25\n  readonly maxDepth?: number      // max rings to render, default 4\n}\n\nexport function renderSunburst(\n  container: HTMLElement,\n  data: SunburstData,\n  config: SunburstConfig = {}\n): void {\n  import('d3').then(d3 => renderSunburstD3(d3, container, data, config))\n}\n\n// Internal type that carries partition layout coordinates on each node datum\ninterface PartitionDatum {\n  readonly name: string\n  readonly value?: number\n  readonly children?: readonly SunburstNode[]\n}\n\nfunction renderSunburstD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: SunburstData,\n  config: SunburstConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 640, 400)\n  const H = config.height ?? 520\n  const maxDepth = config.maxDepth ?? 4\n  const innerRadiusFrac = config.innerRadius ?? 0.25\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Sunburst Chart',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  // Reserve right margin for legend, caption at bottom\n  const captionH = config.caption ? 24 : 0\n  const legendW = 150\n  const availW = W - legendW - 8\n  const availH = H - theme.marginTop - theme.marginBottom - captionH\n\n  // Center the sunburst in the available area\n  const cx = theme.marginLeft + (availW - theme.marginLeft) / 2\n  const cy = theme.marginTop + availH / 2\n\n  const outerRadius = Math.min(availW - theme.marginLeft, availH) / 2 - 4\n  const innerRadius = outerRadius * innerRadiusFrac\n\n  if (outerRadius <= 0) return\n\n  // Build hierarchy\n  const hierarchyRoot = d3.hierarchy<PartitionDatum>(\n    data.root as PartitionDatum,\n    (d: PartitionDatum) => d.children as PartitionDatum[] | undefined\n  ).sum((d: PartitionDatum) => d.value ?? 0)\n\n  const total = hierarchyRoot.value ?? 0\n\n  // Partition layout \u2014 size([2\u03C0, outerRadius]) maps x to angles, y to radii\n  const partitionLayout = d3.partition<PartitionDatum>().size([2 * Math.PI, outerRadius])\n  const partitioned = partitionLayout(hierarchyRoot)\n\n  // Collect all nodes as HierarchyRectangularNode (partition sets x0/x1/y0/y1)\n  const nodes = partitioned.descendants() as D3.HierarchyRectangularNode<PartitionDatum>[]\n\n  // Build parent-index map for color variation: maps a node to its index among siblings\n  const siblingIndexMap = new Map<D3.HierarchyRectangularNode<PartitionDatum>, number>()\n  partitioned.eachBefore((node) => {\n    const rect = node as D3.HierarchyRectangularNode<PartitionDatum>\n    const parent = rect.parent as D3.HierarchyRectangularNode<PartitionDatum> | null\n    if (parent !== null) {\n      const siblings = (parent.children ?? []) as D3.HierarchyRectangularNode<PartitionDatum>[]\n      const idx = siblings.indexOf(rect)\n      siblingIndexMap.set(rect, idx >= 0 ? idx : 0)\n    }\n  })\n\n  // Arc generator \u2014 innerRadius/outerRadius come from the partition y0/y1 values\n  const arcGen = d3.arc<D3.HierarchyRectangularNode<PartitionDatum>>()\n    .startAngle(d => d.x0)\n    .endAngle(d => d.x1)\n    .innerRadius(d => Math.max(d.y0, innerRadius))\n    .outerRadius(d => d.y1)\n    .padAngle(0.005)\n    .padRadius(outerRadius / 2)\n\n  const g = svg.append('g').attr('transform', `translate(${cx},${cy})`)\n\n  // Depth-1 names for the legend\n  const depth1Nodes = nodes.filter(n => n.depth === 1)\n\n  // Draw arcs\n  nodes.forEach(node => {\n    if (node.depth === 0) return                   // root \u2014 skip (center hole)\n    if (node.depth > maxDepth) return              // beyond max depth\n    if (node.y0 < innerRadius) return              // inside the hole\n\n    const sibIdx = siblingIndexMap.get(node) ?? 0\n    const colorIdx = (node.depth - 1 + sibIdx) % 8\n    const fillColor = getColor(colorIdx, theme)\n    const opacity = Math.max(0.4, 1 - node.depth * 0.15)\n\n    const arcAngle = node.x1 - node.x0\n    const arcWidth = node.y1 - node.y0\n    const nodeValue = node.value ?? 0\n    const parentValue = (node.parent?.value ?? 0)\n    const pctOfParent = parentValue > 0 ? ((nodeValue / parentValue) * 100).toFixed(1) : '\u2014'\n\n    g.append('path')\n      .datum(node)\n      .attr('d', arcGen)\n      .attr('fill', fillColor)\n      .attr('opacity', opacity)\n      .attr('stroke', theme.background)\n      .attr('stroke-width', 1.5)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('Name', node.data.name),\n          formatTooltipRow('Value', nodeValue.toLocaleString()),\n          formatTooltipRow('% of parent', pctOfParent + '%'),\n          formatTooltipRow('Depth', String(node.depth)),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Text label \u2014 only if arc is wide enough\n    if (arcAngle > 0.15 && arcWidth > 20) {\n      const midAngle = (node.x0 + node.x1) / 2\n      const midRadius = (Math.max(node.y0, innerRadius) + node.y1) / 2\n      const midAngleDeg = (midAngle * 180 / Math.PI) - 90\n      // Flip text on the left half so it reads correctly\n      const flip = midAngle > Math.PI\n      const rotateDeg = flip ? midAngleDeg + 180 : midAngleDeg\n\n      const maxChars = Math.max(2, Math.floor((arcAngle * midRadius) / 7))\n      const label = node.data.name.length > maxChars\n        ? node.data.name.slice(0, maxChars - 1) + '\u2026'\n        : node.data.name\n\n      g.append('text')\n        .attr('transform', `rotate(${rotateDeg}) translate(${midRadius},0) rotate(${flip ? 180 : 0})`)\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'middle')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', Math.min(theme.fontSizeSmall, arcWidth * 0.5))\n        .attr('fill', '#fff')\n        .attr('pointer-events', 'none')\n        .text(label)\n    }\n  })\n\n  // Center label \u2014 total value + \"total\"\n  if (innerRadius > 12) {\n    g.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('dominant-baseline', 'auto')\n      .attr('y', -4)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeTitle)\n      .attr('font-weight', '700')\n      .attr('fill', theme.text)\n      .text(total.toLocaleString())\n\n    g.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('dominant-baseline', 'hanging')\n      .attr('y', 6)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.textMuted)\n      .text('total')\n  }\n\n  // Legend \u2014 depth-1 nodes on the right side\n  const legendX = cx + outerRadius + 16\n  const legendStartY = theme.marginTop + 8\n  const lineH = 20\n\n  depth1Nodes.forEach((node, i) => {\n    const sibIdx = siblingIndexMap.get(node) ?? 0\n    const colorIdx = sibIdx % 8\n    const fillColor = getColor(colorIdx, theme)\n    const ly = legendStartY + i * lineH\n\n    if (ly + lineH > H - theme.marginBottom - captionH) return\n\n    svg.append('rect')\n      .attr('x', legendX)\n      .attr('y', ly)\n      .attr('width', 12)\n      .attr('height', 12)\n      .attr('fill', fillColor)\n      .attr('rx', 2)\n\n    const maxLabelChars = Math.max(3, Math.floor((W - legendX - 28) / 7))\n    const rawLabel = node.data.name\n    const label = rawLabel.length > maxLabelChars\n      ? rawLabel.slice(0, maxLabelChars - 1) + '\u2026'\n      : rawLabel\n\n    svg.append('text')\n      .attr('x', legendX + 16)\n      .attr('y', ly + 10)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Marimekko (Mekko) chart \u2014 a 100% stacked bar chart where column WIDTHS are\n * proportional to each column's total value, so both axes encode data.\n *\n * - Column width  = that category's total as a fraction of the grand total.\n * - Within each column, stacked segments sum to 100%, coloured by series.\n * - Cells receive percentage (or raw value) labels when large enough.\n * - A \"spine\" bar below the x-axis shows relative column widths at a glance.\n *\n * Usage:\n *   renderMarimekko(container, data, config)\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\n// \u2500\u2500\u2500 Public interfaces \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface MarimekkoData {\n  /** Labels for each column (X variable). */\n  readonly categories: readonly string[]\n  /** One series per stacked segment. values[j] corresponds to categories[j]. */\n  readonly series: readonly {\n    readonly label: string\n    readonly values: readonly number[]\n  }[]\n  readonly testResult?: StatResult\n}\n\nexport interface MarimekkoConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  /** Show percentage labels inside cells when the cell is large enough. Default: true. */\n  readonly showPercentLabels?: boolean\n  /** Show raw values instead of percentages in cell labels. Default: false. */\n  readonly showValueLabels?: boolean\n}\n\n// \u2500\u2500\u2500 Entry point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function renderMarimekko(\n  container: HTMLElement,\n  data: MarimekkoData,\n  config: MarimekkoConfig = {}\n): void {\n  import('d3').then(d3 => renderMarimekkoD3(d3, container, data, config))\n}\n\n// \u2500\u2500\u2500 D3 render \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderMarimekkoD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: MarimekkoData,\n  config: MarimekkoConfig\n): void {\n  if (data.categories.length === 0 || data.series.length === 0) return\n\n  const theme           = config.theme ?? DEFAULT_THEME\n  const showPct         = config.showPercentLabels !== false\n  const showVal         = config.showValueLabels === true\n\n  // \u2500\u2500 Layout constants \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const legendW  = 130          // reserved width on the right for the legend\n  const spineH   = 6            // height of the column-width spine bar\n  const spineGap = 44           // vertical offset below x-axis for spine\n  const xLabelY  = spineGap + spineH + 18  // y offset for optional x-axis label\n\n  const W = config.width  ?? Math.max(container.clientWidth || 640, 420)\n  const H = config.height ?? 500\n\n  const margin = {\n    top:    theme.marginTop,\n    right:  theme.marginRight + legendW,\n    bottom: theme.marginBottom + spineH + 20, // extra room for spine + x label\n    left:   theme.marginLeft,\n  }\n  const width  = W - margin.left - margin.right\n  const height = H - margin.top  - margin.bottom\n\n  // \u2500\u2500 Column totals and grand total \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const nCols = data.categories.length\n  const colTotals: number[] = Array.from({ length: nCols }, (_, j) =>\n    data.series.reduce((sum, s) => sum + (s.values[j] ?? 0), 0)\n  )\n  const grandTotal = colTotals.reduce((a, b) => a + b, 0)\n  if (grandTotal === 0) return\n\n  // \u2500\u2500 Column widths and x positions (cumulative) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const gap = 3\n  const colWidths: number[] = colTotals.map(t => (t / grandTotal) * width)\n  const colX: number[] = []\n  colWidths.reduce((acc, w, i) => { colX[i] = acc; return acc + w }, 0)\n\n  // \u2500\u2500 Bootstrap SVG \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width',   W)\n    .attr('height',  H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Marimekko Chart',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // \u2500\u2500 Y-axis gridlines (0 / 25 / 50 / 75 / 100 %) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const yPcts = [0, 25, 50, 75, 100]\n  yPcts.forEach(pct => {\n    const yPos = height * (1 - pct / 100)\n\n    // Dashed gridline\n    g.append('line')\n      .attr('x1', 0).attr('x2', width)\n      .attr('y1', yPos).attr('y2', yPos)\n      .attr('stroke', theme.gridLine)\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '3,3')\n\n    // Tick label\n    g.append('text')\n      .attr('x', -8)\n      .attr('y', yPos + 4)\n      .attr('text-anchor', 'end')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.textMuted)\n      .text(`${pct}%`)\n  })\n\n  // Y-axis label (left, rotated)\n  if (config.yLabel) {\n    g.append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('x', -height / 2)\n      .attr('y', -52)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.yLabel)\n  } else {\n    g.append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('x', -height / 2)\n      .attr('y', -52)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.textMuted)\n      .text('Percentage (%)')\n  }\n\n  // \u2500\u2500 Draw cells \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.categories.forEach((cat, ci) => {\n    const colTotal = colTotals[ci] ?? 0\n    if (colTotal === 0) return\n\n    const cx = colX[ci] ?? 0\n    const cw = colWidths[ci] ?? 0\n\n    // Accumulate cumulative proportion from bottom (series drawn bottom\u2192top)\n    let cumPct = 0\n\n    data.series.forEach((s, si) => {\n      const rawVal  = s.values[ci] ?? 0\n      const cellPct = rawVal / colTotal          // proportion within column (0\u20131)\n      const cellH   = cellPct * height\n\n      const rx = cx + gap / 2\n      const ry = height - (cumPct + cellPct) * height\n      const rw = Math.max(cw - gap, 0)\n      const rh = Math.max(cellH - gap / 2, 0)\n\n      const color = getColor(si, theme)\n\n      // Cell rectangle\n      g.append('rect')\n        .attr('x', rx).attr('y', ry)\n        .attr('width', rw).attr('height', rh)\n        .attr('fill', color)\n        .attr('opacity', theme.violinOpacity)\n\n      // Cell label (% or raw value) \u2014 only if large enough\n      const labelStr = showVal\n        ? String(rawVal)\n        : `${(cellPct * 100).toFixed(1)}%`\n\n      if (rh > 18 && rw > 30 && (showPct || showVal)) {\n        const isDark = isDarkColor(color)\n        g.append('text')\n          .attr('x', rx + rw / 2)\n          .attr('y', ry + rh / 2 + 4)\n          .attr('text-anchor', 'middle')\n          .attr('font-family', theme.fontFamilyMono)\n          .attr('font-size', Math.min(theme.fontSizeSmall, rh * 0.38, rw * 0.18))\n          .attr('fill', isDark ? '#ffffff' : '#212529')\n          .attr('pointer-events', 'none')\n          .text(labelStr)\n      }\n\n      // Invisible hit-area for tooltip\n      const colPct = (colTotal / grandTotal * 100).toFixed(1)\n      g.append('rect')\n        .attr('x', rx).attr('y', ry)\n        .attr('width', rw).attr('height', rh)\n        .attr('fill', 'transparent')\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Category',     cat),\n            formatTooltipRow('Series',       s.label),\n            formatTooltipRow('Value',        rawVal),\n            formatTooltipRow('% of column',  `${(cellPct * 100).toFixed(1)}%`),\n            formatTooltipRow('Column total', `${colTotal} (${colPct}% of total)`),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n\n      cumPct += cellPct\n    })\n  })\n\n  // \u2500\u2500 X-axis: column labels + (N=xxx) totals \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.categories.forEach((cat, ci) => {\n    const cx = colX[ci] ?? 0\n    const cw = colWidths[ci] ?? 0\n    const midX = cx + cw / 2\n\n    // Category label\n    g.append('text')\n      .attr('x', midX)\n      .attr('y', height + 18)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .text(cat)\n\n    // N label in muted colour\n    g.append('text')\n      .attr('x', midX)\n      .attr('y', height + 30)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.textMuted)\n      .text(`(N=${colTotals[ci] ?? 0})`)\n  })\n\n  // \u2500\u2500 Spine bar (column-width indicator) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.categories.forEach((_, ci) => {\n    const cx = colX[ci] ?? 0\n    const cw = colWidths[ci] ?? 0\n    g.append('rect')\n      .attr('x', cx + gap / 2)\n      .attr('y', height + spineGap)\n      .attr('width', Math.max(cw - gap, 0))\n      .attr('height', spineH)\n      .attr('fill', getColor(0, theme))\n      .attr('opacity', 0.4)\n      .attr('rx', 1)\n  })\n\n  // \u2500\u2500 Optional X-axis label (below spine) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (config.xLabel) {\n    g.append('text')\n      .attr('x', width / 2)\n      .attr('y', height + xLabelY)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.xLabel)\n  }\n\n  // \u2500\u2500 Right-side legend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const swatchS = 12\n  const lgX     = width + 20\n  const lgY0    = Math.max(0, height / 2 - (data.series.length * 20) / 2)\n\n  // Legend title\n  g.append('text')\n    .attr('x', lgX)\n    .attr('y', lgY0 - 12)\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall - 1)\n    .attr('font-weight', '600')\n    .attr('fill', theme.text)\n    .text('Series')\n\n  data.series.forEach((s, si) => {\n    const color = getColor(si, theme)\n    const ly    = lgY0 + si * 20\n\n    g.append('rect')\n      .attr('x', lgX).attr('y', ly)\n      .attr('width', swatchS).attr('height', swatchS)\n      .attr('fill', color)\n      .attr('opacity', theme.violinOpacity)\n      .attr('rx', 2)\n\n    g.append('text')\n      .attr('x', lgX + swatchS + 6)\n      .attr('y', ly + swatchS - 2)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text)\n      .text(s.label)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Returns true if a hex color is perceptually dark (luminance < 0.35),\n * so overlaid text should be white rather than near-black.\n * Supports 6-digit hex strings (e.g. '#4e79a7').\n */\nfunction isDarkColor(hex: string): boolean {\n  const r = parseInt(hex.slice(1, 3), 16) / 255\n  const g = parseInt(hex.slice(3, 5), 16) / 255\n  const b = parseInt(hex.slice(5, 7), 16) / 255\n  // Relative luminance (WCAG 2.1 formula, approximate linearisation)\n  const lum = 0.2126 * r + 0.7152 * g + 0.0722 * b\n  return lum < 0.35\n}\n", "/**\n * Chord diagram: shows flows between groups as ribbons inside a circular layout.\n * Each group occupies an arc on the outer ring; ribbons inside represent flows.\n * Based on the D3 chord layout (d3.chord / d3.ribbon / d3.arc).\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ChordDiagramData {\n  readonly matrix: readonly (readonly number[])[]\n  readonly labels: readonly string[]\n  readonly testResult?: StatResult\n}\n\nexport interface ChordDiagramConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly innerRadius?: number\n  readonly padAngle?: number\n}\n\nexport function renderChordDiagram(\n  container: HTMLElement,\n  data: ChordDiagramData,\n  config: ChordDiagramConfig = {}\n): void {\n  import('d3').then(d3 => renderChordDiagramD3(d3, container, data, config))\n}\n\nfunction renderChordDiagramD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ChordDiagramData,\n  config: ChordDiagramConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 600, 400)\n  const H = config.height ?? Math.max(container.clientHeight || 500, 400)\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Chord Diagram',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  // Reserve space for subtitle at top (theme.marginTop) and caption at bottom\n  const captionH = config.caption ? 24 : 0\n  const availH = H - theme.marginTop - captionH - 8\n\n  const cx = W / 2\n  const cy = theme.marginTop + availH / 2\n\n  const minDim = Math.min(W, availH)\n  const outerRadius = (config.innerRadius != null)\n    ? config.innerRadius + 20\n    : minDim / 2 * 0.82\n  const innerRadius = (config.innerRadius != null)\n    ? config.innerRadius\n    : outerRadius - 20\n\n  const padAngle = config.padAngle ?? 0.02\n\n  // Build a mutable copy of the matrix for d3.chord (it expects number[][])\n  const mutableMatrix = data.matrix.map(row => [...row])\n\n  const chordLayout = d3.chord()\n    .padAngle(padAngle)\n    .sortSubgroups(d3.descending)\n\n  const chords = chordLayout(mutableMatrix)\n\n  const arcGenerator = d3.arc<D3.ChordGroup>()\n    .innerRadius(innerRadius)\n    .outerRadius(outerRadius)\n\n  // Use generic overload so TypeScript understands ChordSubgroup as the subgroup datum.\n  // The startAngle/endAngle accessors come directly from ChordSubgroup; radius is the\n  // constant innerRadius set via the accessor form.\n  const ribbonGenerator = d3.ribbon<D3.Chord, D3.ChordSubgroup>()\n    .startAngle((sg: D3.ChordSubgroup) => sg.startAngle)\n    .endAngle((sg: D3.ChordSubgroup) => sg.endAngle)\n    .radius((_sg: D3.ChordSubgroup) => innerRadius)\n\n  const g = svg.append('g')\n    .attr('transform', `translate(${cx},${cy})`)\n\n  // \u2500\u2500 Ribbons (render before arcs so arcs sit on top) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Sort chords ascending by value so smaller ribbons render on top\n  const sortedChords = [...chords].sort(\n    (a, b) => b.source.value + b.target.value - (a.source.value + a.target.value)\n  )\n\n  g.selectAll<SVGPathElement, D3.Chord>('.ribbon')\n    .data(sortedChords)\n    .join('path')\n    .attr('class', 'ribbon')\n    .attr('d', d => ribbonGenerator(d) ?? '')\n    .attr('fill', d => getColor(d.source.index, theme))\n    .attr('opacity', 0.65)\n    .attr('stroke', theme.background)\n    .attr('stroke-width', 0.5)\n    .on('mouseover', (event: MouseEvent, d: D3.Chord) => {\n      const srcLabel = data.labels[d.source.index] ?? `Group ${d.source.index}`\n      const tgtLabel = data.labels[d.target.index] ?? `Group ${d.target.index}`\n      const content = [\n        formatTooltipRow('From', srcLabel),\n        formatTooltipRow('To', tgtLabel),\n        formatTooltipRow('Flow', d.source.value),\n      ].join('')\n      showTooltip(event, content, theme)\n    })\n    .on('mouseout', hideTooltip)\n\n  // \u2500\u2500 Group arcs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const groupG = g.selectAll<SVGGElement, D3.ChordGroup>('.group')\n    .data(chords.groups)\n    .join('g')\n    .attr('class', 'group')\n\n  groupG.append('path')\n    .attr('d', d => arcGenerator(d) ?? '')\n    .attr('fill', d => getColor(d.index, theme))\n    .attr('stroke', theme.background)\n    .attr('stroke-width', 1)\n    .on('mouseover', (event: MouseEvent, d: D3.ChordGroup) => {\n      const label = data.labels[d.index] ?? `Group ${d.index}`\n      // Compute total outflow and inflow from the original matrix\n      const outflow = data.matrix[d.index]?.reduce((s, v) => s + v, 0) ?? 0\n      const inflow = data.matrix.reduce((s, row) => s + (row[d.index] ?? 0), 0)\n      const content = [\n        formatTooltipRow('Group', label),\n        formatTooltipRow('Outflow', outflow),\n        formatTooltipRow('Inflow', inflow),\n      ].join('')\n      showTooltip(event, content, theme)\n    })\n    .on('mouseout', hideTooltip)\n\n  // \u2500\u2500 Tick marks on group arcs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Compute total sum to derive tick step (every ~5% of total)\n  const total = data.matrix.reduce(\n    (s, row) => s + row.reduce((rs, v) => rs + v, 0),\n    0\n  )\n  const tickStep = total > 0 ? computeTickStep(total) : 1\n\n  chords.groups.forEach(group => {\n    const groupTotal = data.matrix[group.index]?.reduce((s, v) => s + v, 0) ?? 0\n    const tickCount = Math.floor(groupTotal / tickStep)\n\n    for (let ti = 0; ti <= tickCount; ti++) {\n      const tickValue = ti * tickStep\n      // Angle for this tick within the group's arc\n      const angleRange = group.endAngle - group.startAngle - padAngle\n      const tickAngle = group.startAngle + padAngle / 2 +\n        (groupTotal > 0 ? (tickValue / groupTotal) * angleRange : 0)\n\n      const sinA = Math.sin(tickAngle - Math.PI / 2)\n      const cosA = Math.cos(tickAngle - Math.PI / 2)\n\n      g.append('line')\n        .attr('x1', innerRadius * cosA)\n        .attr('y1', innerRadius * sinA)\n        .attr('x2', (outerRadius + 8) * cosA)\n        .attr('y2', (outerRadius + 8) * sinA)\n        .attr('stroke', theme.axisLine)\n        .attr('stroke-width', 1)\n\n      // Tick label for non-zero ticks\n      if (ti > 0) {\n        g.append('text')\n          .attr('x', (outerRadius + 14) * cosA)\n          .attr('y', (outerRadius + 14) * sinA)\n          .attr('text-anchor', tickAngle > Math.PI ? 'end' : 'start')\n          .attr('dominant-baseline', 'middle')\n          .attr('font-family', theme.fontFamily)\n          .attr('font-size', theme.fontSizeSmall - 2)\n          .attr('fill', theme.textMuted)\n          .text(formatTickValue(tickValue))\n      }\n    }\n  })\n\n  // \u2500\u2500 Group labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const labelRadius = outerRadius + 32\n\n  chords.groups.forEach(group => {\n    const angle = (group.startAngle + group.endAngle) / 2\n    // D3 chord angles are measured from 12 o'clock, clockwise\n    const labelAngle = angle - Math.PI / 2\n    const lx = labelRadius * Math.cos(labelAngle)\n    const ly = labelRadius * Math.sin(labelAngle)\n    const rightSide = Math.cos(labelAngle) > 0\n\n    g.append('text')\n      .attr('x', lx)\n      .attr('y', ly)\n      .attr('text-anchor', rightSide ? 'start' : 'end')\n      .attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('font-weight', '600')\n      .attr('fill', theme.text)\n      .text(data.labels[group.index] ?? `Group ${group.index}`)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n/** Compute a round tick step so there are roughly 5\u201310 ticks across the total. */\nfunction computeTickStep(total: number): number {\n  const rough = total / 8\n  const magnitude = Math.pow(10, Math.floor(Math.log10(rough)))\n  const norm = rough / magnitude\n  const step = norm < 1.5 ? 1 : norm < 3.5 ? 2 : norm < 7.5 ? 5 : 10\n  return step * magnitude\n}\n\n/** Format a tick value \u2014 suppress decimals for whole numbers. */\nfunction formatTickValue(v: number): string {\n  if (v >= 1000) return `${(v / 1000).toFixed(v % 1000 === 0 ? 0 : 1)}k`\n  return Number.isInteger(v) ? String(v) : v.toFixed(1)\n}\n", "/**\n * Arc diagram: nodes on a horizontal baseline connected by arcs above them.\n * Short connections produce shallow arcs; distant connections produce tall arcs.\n * Useful for visualising network topology when node order carries meaning.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\nexport interface ArcDiagramNode {\n  readonly id: string\n  readonly label?: string\n  readonly group?: string\n}\n\nexport interface ArcDiagramEdge {\n  readonly source: string\n  readonly target: string\n  readonly value?: number\n}\n\nexport interface ArcDiagramData {\n  readonly nodes: readonly ArcDiagramNode[]\n  readonly edges: readonly ArcDiagramEdge[]\n  readonly testResult?: StatResult\n}\n\nexport interface ArcDiagramConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly nodeRadius?: number\n  readonly sortByGroup?: boolean\n}\n\nexport function renderArcDiagram(\n  container: HTMLElement,\n  data: ArcDiagramData,\n  config: ArcDiagramConfig = {}\n): void {\n  import('d3').then(d3 => renderArcDiagramD3(d3, container, data, config))\n}\n\nfunction renderArcDiagramD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: ArcDiagramData,\n  config: ArcDiagramConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 700, 400)\n  const H = config.height ?? 420\n  const margin = {\n    top: theme.marginTop,\n    right: theme.marginRight,\n    bottom: theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  const nodeRadius = config.nodeRadius ?? 6\n  const sortByGroup = config.sortByGroup ?? true\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Arc Diagram',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // \u2500\u2500 Determine node order \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Collect unique groups in the order they first appear, then sort nodes\n  const uniqueGroups: string[] = []\n  data.nodes.forEach(n => {\n    const grp = n.group ?? '__none__'\n    if (!uniqueGroups.includes(grp)) uniqueGroups.push(grp)\n  })\n\n  const groupIndex = (grp: string | undefined): number =>\n    uniqueGroups.indexOf(grp ?? '__none__')\n\n  const orderedNodes: ArcDiagramNode[] = sortByGroup\n    ? [...data.nodes].sort((a, b) => {\n        const gi = groupIndex(a.group) - groupIndex(b.group)\n        if (gi !== 0) return gi\n        // Within the same group, preserve original order deterministically\n        return data.nodes.indexOf(a) - data.nodes.indexOf(b)\n      })\n    : [...data.nodes]\n\n  // \u2500\u2500 Positions \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Nodes sit on a horizontal baseline\n  const nodeY = height * 0.65\n\n  const n = orderedNodes.length\n  // Evenly space nodes; for a single node, place it at center\n  const xStep = n > 1 ? width / (n - 1) : width / 2\n  const xOffset = n > 1 ? 0 : width / 2\n\n  const nodeX = new Map<string, number>()\n  orderedNodes.forEach((node, i) => {\n    nodeX.set(node.id, xOffset + i * xStep)\n  })\n\n  // \u2500\u2500 Degree map \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const degree = new Map<string, number>()\n  data.nodes.forEach(node => degree.set(node.id, 0))\n  data.edges.forEach(edge => {\n    degree.set(edge.source, (degree.get(edge.source) ?? 0) + 1)\n    degree.set(edge.target, (degree.get(edge.target) ?? 0) + 1)\n  })\n\n  // \u2500\u2500 Baseline grid line \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  g.append('line')\n    .attr('x1', 0)\n    .attr('x2', width)\n    .attr('y1', nodeY)\n    .attr('y2', nodeY)\n    .attr('stroke', theme.gridLine)\n    .attr('stroke-width', 1.5)\n\n  // \u2500\u2500 Arcs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  data.edges.forEach(edge => {\n    const x1 = nodeX.get(edge.source)\n    const x2 = nodeX.get(edge.target)\n    if (x1 == null || x2 == null || edge.source === edge.target) return\n\n    const srcNode = data.nodes.find(nd => nd.id === edge.source)\n    const srcGroupIdx = groupIndex(srcNode?.group)\n    const arcColor = getColor(srcGroupIdx, theme)\n\n    // Arc height proportional to horizontal distance between nodes\n    const arcHeight = (Math.abs(x2 - x1) / width) * (height * 0.55)\n\n    const mx = (x1 + x2) / 2\n    const my = nodeY - arcHeight\n\n    const rawStroke = 1 + (edge.value ?? 1) * 0.5\n    const strokeWidth = Math.min(rawStroke, 4)\n\n    const pathD = `M ${x1},${nodeY} Q ${mx},${my} ${x2},${nodeY}`\n\n    g.append('path')\n      .attr('d', pathD)\n      .attr('fill', 'none')\n      .attr('stroke', arcColor)\n      .attr('stroke-width', strokeWidth)\n      .attr('opacity', 0.55)\n      .on('mouseover', (event: MouseEvent) => {\n        const srcLabel =\n          data.nodes.find(nd => nd.id === edge.source)?.label ?? edge.source\n        const tgtLabel =\n          data.nodes.find(nd => nd.id === edge.target)?.label ?? edge.target\n        const content = [\n          formatTooltipRow('From', srcLabel),\n          formatTooltipRow('To', tgtLabel),\n          ...(edge.value != null ? [formatTooltipRow('Value', edge.value)] : []),\n        ].join('')\n        showTooltip(event, content, theme)\n      })\n      .on('mouseout', hideTooltip)\n  })\n\n  // \u2500\u2500 Nodes \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const rotateLabelThreshold = 8\n\n  orderedNodes.forEach(node => {\n    const x = nodeX.get(node.id) ?? 0\n    const grpIdx = groupIndex(node.group)\n    const color = getColor(grpIdx, theme)\n    const displayLabel = node.label ?? node.id\n    const deg = degree.get(node.id) ?? 0\n\n    // Node circle\n    g.append('circle')\n      .attr('cx', x)\n      .attr('cy', nodeY)\n      .attr('r', nodeRadius)\n      .attr('fill', color)\n      .attr('stroke', theme.background)\n      .attr('stroke-width', 1.5)\n      .on('mouseover', (event: MouseEvent) => {\n        const groupName = node.group ?? 'none'\n        const content = [\n          formatTooltipRow('Node', displayLabel),\n          formatTooltipRow('Group', groupName),\n          formatTooltipRow('Degree', deg),\n        ].join('')\n        showTooltip(event, content, theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Label below node\n    if (n <= rotateLabelThreshold) {\n      // Straight label, centered below node\n      g.append('text')\n        .attr('x', x)\n        .attr('y', nodeY + nodeRadius + 14)\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'hanging')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSize)\n        .attr('fill', theme.text)\n        .text(displayLabel)\n    } else {\n      // Rotated 45\u00B0 to avoid overlap when many nodes\n      g.append('text')\n        .attr('transform', `translate(${x},${nodeY + nodeRadius + 8}) rotate(45)`)\n        .attr('text-anchor', 'start')\n        .attr('dominant-baseline', 'middle')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text)\n        .text(displayLabel)\n    }\n  })\n\n  // \u2500\u2500 x/y axis labels (optional) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (config.xLabel) {\n    g.append('text')\n      .attr('x', width / 2)\n      .attr('y', height + 44)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.xLabel)\n  }\n\n  if (config.yLabel) {\n    g.append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('x', -height / 2)\n      .attr('y', -48)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.yLabel)\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Alluvial (Sankey-like) plot \u2014 nodes stacked by stage, flows as cubic bezier\n * ribbons. Every stage is a vertical column; node height is proportional to\n * total flow value. Ribbons connect adjacent stages and are coloured by source\n * node colour at reduced opacity so layering is visible.\n *\n * Layout:\n *   stages are evenly spaced across the plot width.\n *   within each stage nodes are sorted largest\u2192smallest, stacked top\u2192bottom\n *   with a configurable gap between them.\n *   each node tracks separate y-offsets for outgoing and incoming ribbons so\n *   ribbons stack neatly without crossing inside a node.\n *\n * Colour: all unique node labels are collected up-front and assigned a fixed\n * colour from the theme palette so the same category always has the same\n * colour regardless of which stage it appears in.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\n// \u2500\u2500\u2500 Public interfaces \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface AlluvialNode {\n  readonly id: string\n  readonly stage: number     // 0-based column index\n  readonly label: string\n}\n\nexport interface AlluvialFlow {\n  readonly source: string    // node id\n  readonly target: string    // node id\n  readonly value: number\n}\n\nexport interface AlluvialData {\n  readonly nodes: readonly AlluvialNode[]\n  readonly flows: readonly AlluvialFlow[]\n  readonly stageLabels?: readonly string[]\n  readonly testResult?: StatResult\n}\n\nexport interface AlluvialConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly nodePadding?: number   // vertical gap between nodes in same stage, default 8\n  readonly nodeWidth?: number     // width of node rectangles, default 18\n}\n\n// \u2500\u2500\u2500 Public entry-point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Render an alluvial / Sankey-style plot.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data      - nodes, flows, optional stage labels and stat result\n * @param config    - visual configuration\n */\nexport function renderAlluvialPlot(\n  container: HTMLElement,\n  data: AlluvialData,\n  config: AlluvialConfig = {}\n): void {\n  import('d3').then(d3 => renderAlluvialD3(d3, container, data, config))\n}\n\n// \u2500\u2500\u2500 Internal types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ninterface LayoutNode {\n  readonly id: string\n  readonly stage: number\n  readonly label: string\n  readonly color: string\n  readonly totalValue: number   // sum of all flows in + out (used for sizing)\n  readonly inValue: number      // sum of incoming flows (used for height in non-first stages)\n  readonly outValue: number     // sum of outgoing flows\n  x: number                     // left edge of node rect\n  y: number                     // top edge of node rect\n  readonly height: number       // pixel height\n  outOffset: number             // running y-offset for stacking outgoing ribbons\n  inOffset: number              // running y-offset for stacking incoming ribbons\n}\n\ninterface LayoutFlow {\n  readonly sourceNode: LayoutNode\n  readonly targetNode: LayoutNode\n  readonly value: number\n  readonly ribbonHeight: number\n  readonly sourceY: number      // top of this ribbon's slot on source node\n  readonly targetY: number      // top of this ribbon's slot on target node\n}\n\n// \u2500\u2500\u2500 D3 render function \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderAlluvialD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: AlluvialData,\n  config: AlluvialConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 700, 400)\n  const H = config.height ?? 520\n  const nodePadding = config.nodePadding ?? 8\n  const nodeWidth = config.nodeWidth ?? 18\n\n  // When stage headers are shown, add 24 px so they don't overlap the subtitle\n  // (subtitle baseline is at SVG y = 45; headers render at g-coord y = -12, i.e.\n  //  SVG y = marginTop - 12; we need marginTop - 12 > 55 \u2192 marginTop > 67).\n  const hasStageLabels = (data.stageLabels?.length ?? 0) > 0\n  const margin = {\n    top: theme.marginTop + (hasStageLabels ? 24 : 0),\n    right: theme.marginRight + 80,    // extra right room for last stage's labels\n    bottom: theme.marginBottom,\n    left: theme.marginLeft + 60,      // extra left room for first stage's labels\n  }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Alluvial Plot',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  if (data.nodes.length === 0 || data.flows.length === 0) return\n\n  // \u2500\u2500 1. Colour mapping: unique labels get a fixed palette colour \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const uniqueLabels = Array.from(new Set(data.nodes.map(n => n.label)))\n  const labelColor = new Map(uniqueLabels.map((lbl, i) => [lbl, getColor(i, theme)]))\n\n  // \u2500\u2500 2. Determine stage count and x positions \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const stageIndices = Array.from(new Set(data.nodes.map(n => n.stage))).sort((a, b) => a - b)\n  const nStages = stageIndices.length\n  const stageX = (stageIdx: number): number =>\n    nStages < 2 ? width / 2 : (stageIdx / (nStages - 1)) * (width - nodeWidth)\n\n  // \u2500\u2500 3. Compute per-node flow sums \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const nodeById = new Map(data.nodes.map(n => [n.id, n]))\n  const inSum = new Map<string, number>()\n  const outSum = new Map<string, number>()\n\n  data.flows.forEach(f => {\n    outSum.set(f.source, (outSum.get(f.source) ?? 0) + f.value)\n    inSum.set(f.target, (inSum.get(f.target) ?? 0) + f.value)\n  })\n\n  // Total value per node: for the first stage, use outgoing; last stage uses incoming;\n  // middle stages use max(in, out) so nodes are sized to the larger of the two.\n  const firstStage = stageIndices[0] ?? 0\n  const lastStage = stageIndices[nStages - 1] ?? 0\n\n  const nodeTotal = (id: string): number => {\n    const node = nodeById.get(id)\n    if (!node) return 0\n    if (node.stage === firstStage) return outSum.get(id) ?? 0\n    if (node.stage === lastStage) return inSum.get(id) ?? 0\n    return Math.max(outSum.get(id) ?? 0, inSum.get(id) ?? 0)\n  }\n\n  // \u2500\u2500 4. Layout nodes within each stage \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Total value across all nodes in a stage determines the height scale.\n  const stageNodes = new Map<number, LayoutNode[]>()\n  stageIndices.forEach(si => {\n    const nodesInStage = data.nodes\n      .filter(n => n.stage === si)\n      .sort((a, b) => nodeTotal(b.id) - nodeTotal(a.id))\n\n    const totalVal = nodesInStage.reduce((s, n) => s + nodeTotal(n.id), 0)\n    const usableHeight = height - nodePadding * Math.max(0, nodesInStage.length - 1)\n    const heightScale = totalVal > 0 ? usableHeight / totalVal : 1\n\n    const lnodes: LayoutNode[] = []\n    let yCursor = 0\n\n    nodesInStage.forEach(n => {\n      const tv = nodeTotal(n.id)\n      const nh = Math.max(4, tv * heightScale)\n      lnodes.push({\n        id: n.id,\n        stage: n.stage,\n        label: n.label,\n        color: labelColor.get(n.label) ?? getColor(0, theme),\n        totalValue: tv,\n        inValue: inSum.get(n.id) ?? 0,\n        outValue: outSum.get(n.id) ?? 0,\n        x: stageX(stageIndices.indexOf(si)),\n        y: yCursor,\n        height: nh,\n        outOffset: 0,\n        inOffset: 0,\n      })\n      yCursor += nh + nodePadding\n    })\n\n    stageNodes.set(si, lnodes)\n  })\n\n  const layoutNodeMap = new Map<string, LayoutNode>()\n  stageNodes.forEach(lnodes => lnodes.forEach(ln => layoutNodeMap.set(ln.id, ln)))\n\n  // \u2500\u2500 5. Compute flow layout (ribbon slots) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Scale ribbon height relative to the source node's height / out-value.\n  const layoutFlows: LayoutFlow[] = []\n\n  // Sort flows by value desc so large ribbons sit at the top of each node.\n  const sortedFlows = [...data.flows].sort((a, b) => b.value - a.value)\n\n  sortedFlows.forEach(f => {\n    const src = layoutNodeMap.get(f.source)\n    const tgt = layoutNodeMap.get(f.target)\n    if (!src || !tgt) return\n\n    const srcHeightScale = src.outValue > 0 ? src.height / src.outValue : 0\n    const tgtHeightScale = tgt.inValue > 0 ? tgt.height / tgt.inValue : 0\n    const ribbonH = Math.max(1, f.value * Math.min(srcHeightScale, tgtHeightScale))\n\n    const sourceY = src.y + src.outOffset\n    const targetY = tgt.y + tgt.inOffset\n\n    layoutFlows.push({ sourceNode: src, targetNode: tgt, value: f.value, ribbonHeight: ribbonH, sourceY, targetY })\n\n    // Advance offsets (mutate LayoutNode offsets \u2014 they are tracking state)\n    ;(src as { outOffset: number }).outOffset += ribbonH\n    ;(tgt as { inOffset: number }).inOffset += ribbonH\n  })\n\n  // \u2500\u2500 6. Draw ribbons (below nodes) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const flowGroup = g.append('g').attr('class', 'flows')\n  const nodeGroup = g.append('g').attr('class', 'nodes')\n\n  layoutFlows.forEach(lf => {\n    const x1 = lf.sourceNode.x + nodeWidth\n    const x2 = lf.targetNode.x\n    const cpX1 = x1 + (x2 - x1) * 0.4\n    const cpX2 = x1 + (x2 - x1) * 0.6\n\n    const yTop1 = lf.sourceY\n    const yBot1 = lf.sourceY + lf.ribbonHeight\n    const yTop2 = lf.targetY\n    const yBot2 = lf.targetY + lf.ribbonHeight\n\n    // Closed ribbon shape: top bezier forward + bottom bezier backward\n    const pathD = [\n      `M ${x1.toFixed(2)},${yTop1.toFixed(2)}`,\n      `C ${cpX1.toFixed(2)},${yTop1.toFixed(2)} ${cpX2.toFixed(2)},${yTop2.toFixed(2)} ${x2.toFixed(2)},${yTop2.toFixed(2)}`,\n      `L ${x2.toFixed(2)},${yBot2.toFixed(2)}`,\n      `C ${cpX2.toFixed(2)},${yBot2.toFixed(2)} ${cpX1.toFixed(2)},${yBot1.toFixed(2)} ${x1.toFixed(2)},${yBot1.toFixed(2)}`,\n      'Z',\n    ].join(' ')\n\n    const srcPct = lf.sourceNode.outValue > 0\n      ? ((lf.value / lf.sourceNode.outValue) * 100).toFixed(1)\n      : '\u2013'\n\n    flowGroup.append('path')\n      .attr('d', pathD)\n      .attr('fill', lf.sourceNode.color)\n      .attr('opacity', 0.42)\n      .attr('stroke', lf.sourceNode.color)\n      .attr('stroke-width', 0.5)\n      .attr('stroke-opacity', 0.25)\n      .on('mouseover', (event: MouseEvent) => {\n        showTooltip(event, [\n          formatTooltipRow('From', lf.sourceNode.label),\n          formatTooltipRow('To', lf.targetNode.label),\n          formatTooltipRow('Value', lf.value.toFixed(2)),\n          formatTooltipRow('% of source', `${srcPct}%`),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n      // Highlight on hover\n      .on('mouseover.highlight', function (event: MouseEvent) {\n        d3.select(this as SVGPathElement).attr('opacity', 0.72)\n        showTooltip(event, [\n          formatTooltipRow('From', lf.sourceNode.label),\n          formatTooltipRow('To', lf.targetNode.label),\n          formatTooltipRow('Value', lf.value.toFixed(2)),\n          formatTooltipRow('% of source', `${srcPct}%`),\n        ].join(''), theme)\n      })\n      .on('mouseout.highlight', function () {\n        d3.select(this as SVGPathElement).attr('opacity', 0.42)\n        hideTooltip()\n      })\n  })\n\n  // \u2500\u2500 7. Draw nodes and labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  stageIndices.forEach(si => {\n    const lnodes = stageNodes.get(si) ?? []\n    const isFirst = si === firstStage\n    const isLast = si === lastStage\n\n    lnodes.forEach(ln => {\n      // Node rectangle\n      nodeGroup.append('rect')\n        .attr('x', ln.x)\n        .attr('y', ln.y)\n        .attr('width', nodeWidth)\n        .attr('height', ln.height)\n        .attr('fill', ln.color)\n        .attr('rx', 3)\n        .attr('stroke', theme.background)\n        .attr('stroke-width', 1.5)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow('Label', ln.label),\n            formatTooltipRow('Stage', ln.stage.toString()),\n            formatTooltipRow('Total value', ln.totalValue.toFixed(2)),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n\n      // Label placement\n      const labelX = isFirst\n        ? ln.x - 6                      // left of leftmost stage\n        : isLast\n          ? ln.x + nodeWidth + 6        // right of rightmost stage\n          : ln.x + nodeWidth / 2        // centred above middle stages\n\n      const labelAnchor = isFirst ? 'end' : isLast ? 'start' : 'middle'\n      const labelY = ln.y + ln.height / 2 + 4\n\n      nodeGroup.append('text')\n        .attr('x', labelX)\n        .attr('y', labelY)\n        .attr('text-anchor', labelAnchor)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('font-weight', '500')\n        .attr('fill', theme.text)\n        .attr('pointer-events', 'none')\n        .text(ln.label)\n    })\n  })\n\n  // \u2500\u2500 8. Stage column headers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (data.stageLabels) {\n    stageIndices.forEach((si, sIdx) => {\n      const label = data.stageLabels?.[sIdx] ?? `Stage ${si}`\n      const x = stageX(sIdx) + nodeWidth / 2\n\n      nodeGroup.append('text')\n        .attr('x', x)\n        .attr('y', -12)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('font-weight', '700')\n        .attr('fill', theme.textMuted)\n        .attr('letter-spacing', '0.5')\n        .text(label.toUpperCase())\n    })\n  }\n\n  // \u2500\u2500 9. Optional axis labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (config.xLabel) {\n    g.append('text')\n      .attr('x', width / 2)\n      .attr('y', height + 48)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.xLabel)\n  }\n\n  if (config.yLabel) {\n    g.append('text')\n      .attr('transform', 'rotate(-90)')\n      .attr('x', -height / 2)\n      .attr('y', -margin.left + 16)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.text)\n      .text(config.yLabel)\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Hierarchical edge bundling (Holten 2006).\n *\n * Leaf nodes are arranged on a circle. Non-leaf nodes form the hierarchy used\n * to bundle edges \u2014 they are not drawn. Edges between leaf nodes are drawn as\n * cubic B-spline paths routed through the common ancestor path in the\n * hierarchy, which causes edges that share ancestry to visually cluster\n * (\"bundle\") together.\n *\n * Layout:\n *   d3.stratify builds the hierarchy from the flat node list.\n *   d3.cluster assigns angular positions (x) and radial depth (y).\n *   Only leaf nodes (no children) are shown as circles with radial labels.\n *   Each edge walks the path [source \u2192 LCA \u2192 target] through the tree and\n *   passes those anchor points to d3.lineRadial with d3.curveBundle.beta(\u03B2).\n *\n * Colour:\n *   Nodes are coloured by their `group` field if provided, otherwise by their\n *   immediate parent id. The same colour mapping is reused for edges (source\n *   colour at low opacity so overlapping edges remain readable).\n *\n * Interactivity:\n *   Hovering a node highlights all its edges (full opacity, thicker stroke)\n *   and dims all other edges. Clicking a node locks the highlight; clicking\n *   again unlocks it.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { StatResult } from '../../core/types.js'\n\n// \u2500\u2500\u2500 Public interfaces \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface BundleNode {\n  readonly id: string\n  readonly parent: string   // id of parent node; root has parent = \"\"\n  readonly label?: string\n  readonly group?: string   // optional group for colouring\n}\n\nexport interface BundleEdge {\n  readonly source: string   // leaf node id\n  readonly target: string   // leaf node id\n}\n\nexport interface EdgeBundlingData {\n  readonly nodes: readonly BundleNode[]\n  readonly edges: readonly BundleEdge[]\n  readonly testResult?: StatResult\n}\n\nexport interface EdgeBundlingConfig {\n  readonly title?: string\n  readonly xLabel?: string\n  readonly yLabel?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly bundlingStrength?: number  // beta for d3.curveBundle, 0\u20131, default 0.85\n  readonly nodeRadius?: number        // leaf node dot radius, default 4\n}\n\n// \u2500\u2500\u2500 Public entry-point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Render a hierarchical edge bundling diagram.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data      - nodes (with parent hierarchy), edges between leaves, optional stat result\n * @param config    - visual configuration\n */\nexport function renderEdgeBundling(\n  container: HTMLElement,\n  data: EdgeBundlingData,\n  config: EdgeBundlingConfig = {}\n): void {\n  import('d3').then(d3 => renderEdgeBundlingD3(d3, container, data, config))\n}\n\n// \u2500\u2500\u2500 Internal types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n// d3.stratify does not expose a generic-typed HierarchyNode with .path() in\n// all versions, so we use a minimal typed wrapper that we can annotate.\ninterface RadialHierarchyNode {\n  data: BundleNode\n  x: number          // angle in degrees (from d3.cluster)\n  y: number          // radius (from d3.cluster)\n  children?: RadialHierarchyNode[]\n  parent: RadialHierarchyNode | null\n  // ancestors() is present on all d3-hierarchy nodes\n  ancestors(): RadialHierarchyNode[]\n}\n\n// \u2500\u2500\u2500 D3 render function \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderEdgeBundlingD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: EdgeBundlingData,\n  config: EdgeBundlingConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? Math.max(container.clientWidth || 640, 400)\n  const H = config.height ?? Math.max(W, 480)\n  const beta = config.bundlingStrength ?? 0.85\n  const nodeR = config.nodeRadius ?? 4\n\n  // Radial layout fills the inner square minus generous padding for labels\n  const labelPad = 90\n  const radius = Math.min(W, H) / 2 - labelPad\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .attr('viewBox', `0 0 ${W} ${H}`)\n    .style('background', theme.background)\n\n  addSubtitle(\n    svg,\n    config.title ?? 'Edge Bundling',\n    data.testResult?.formatted ?? '',\n    W,\n    theme\n  )\n\n  // Centre the radial layout in the SVG\n  const cx = W / 2\n  const cy = H / 2 + (theme.marginTop / 2)\n\n  const g = svg.append('g').attr('transform', `translate(${cx},${cy})`)\n\n  if (data.nodes.length === 0) return\n\n  // \u2500\u2500 1. Colour mapping \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Use group if provided, otherwise parent id. Collect unique values and map\n  // them to palette colours.\n  const colorKey = (n: BundleNode): string => n.group ?? n.parent ?? ''\n  const uniqueColorKeys = Array.from(new Set(data.nodes.map(colorKey)))\n  const colorKeyMap = new Map(uniqueColorKeys.map((k, i) => [k, getColor(i, theme)]))\n  const nodeColor = (n: BundleNode): string => colorKeyMap.get(colorKey(n)) ?? getColor(0, theme)\n\n  // \u2500\u2500 2. Build d3 hierarchy \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // d3.stratify requires a root node whose parentId returns null/undefined.\n  // Our root node has parent = \"\".\n  type RawNode = { id: string; parentId: string | undefined; data: BundleNode }\n  const rawNodes: RawNode[] = data.nodes.map(n => ({\n    id: n.id,\n    parentId: n.parent === '' ? undefined : n.parent,\n    data: n,\n  }))\n\n  let root: RadialHierarchyNode\n  try {\n    const stratify = (d3.stratify as unknown as (opts: {\n      id: (d: RawNode) => string\n      parentId: (d: RawNode) => string | undefined\n    }) => (data: RawNode[]) => RadialHierarchyNode)({\n      id: (d: RawNode) => d.id,\n      parentId: (d: RawNode) => d.parentId,\n    })\n    root = stratify(rawNodes)\n  } catch {\n    // If stratify fails (bad hierarchy), render empty\n    g.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSize)\n      .attr('fill', theme.textMuted)\n      .text('Invalid hierarchy \u2014 check node parent ids.')\n    return\n  }\n\n  // \u2500\u2500 3. Cluster layout: leaf nodes on a circle \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // d3.cluster assigns .x (angle in [0, 360)) and .y (depth in [0, radius]).\n  // We fix inner nodes at y=0 and leaves at y=radius.\n  interface D3ClusterLayout {\n    size(sz: [number, number]): D3ClusterLayout\n    (root: RadialHierarchyNode): RadialHierarchyNode\n  }\n  const cluster = (d3.cluster as unknown as () => D3ClusterLayout)()\n  cluster.size([360, radius])\n  cluster(root)\n\n  // \u2500\u2500 4. Index nodes by id \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const nodeIndex = new Map<string, RadialHierarchyNode>()\n  const allNodes: RadialHierarchyNode[] = []\n\n  // Walk the hierarchy using a queue (no for loops \u2014 use array methods)\n  ;(function collectNodes(node: RadialHierarchyNode): void {\n    allNodes.push(node)\n    nodeIndex.set(node.data.id, node)\n    node.children?.forEach(collectNodes)\n  })(root)\n\n  const leafNodes = allNodes.filter(n => !n.children || n.children.length === 0)\n\n  // \u2500\u2500 5. LCA path helper \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  // Returns the path [a, ...up_to_LCA, ...down_to_b] as an array of nodes.\n  function lcaPath(\n    a: RadialHierarchyNode,\n    b: RadialHierarchyNode\n  ): RadialHierarchyNode[] {\n    const ancestorsA = a.ancestors()          // [a, parent(a), ..., root]\n    const ancestorsB = b.ancestors()          // [b, parent(b), ..., root]\n    const ancestorSetA = new Set(ancestorsA.map(n => n.data.id))\n\n    // Find LCA: first ancestor of b that is also an ancestor of a\n    const lca = ancestorsB.find(n => ancestorSetA.has(n.data.id))\n    if (!lca) return [a, b]\n\n    // Path from a up to LCA (inclusive on both ends)\n    const lcaIdx = ancestorsA.findIndex(n => n.data.id === lca.data.id)\n    const pathUp = ancestorsA.slice(0, lcaIdx + 1)\n\n    // Path from LCA down to b (exclusive LCA, inclusive b)\n    const lcaIdxB = ancestorsB.findIndex(n => n.data.id === lca.data.id)\n    const pathDown = ancestorsB.slice(0, lcaIdxB).reverse()\n\n    return [...pathUp, ...pathDown]\n  }\n\n  // \u2500\u2500 6. Line generator: radial + cubic bundle \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  interface D3LineRadial {\n    curve(c: unknown): D3LineRadial\n    angle(fn: (d: RadialHierarchyNode) => number): D3LineRadial\n    radius(fn: (d: RadialHierarchyNode) => number): D3LineRadial\n    (pts: RadialHierarchyNode[]): string | null\n  }\n  const bundleCurve = (d3.curveBundle as unknown as { beta: (b: number) => unknown }).beta(beta)\n  const lineRadial = (d3.lineRadial as unknown as () => D3LineRadial)()\n    .curve(bundleCurve)\n    .angle((d: RadialHierarchyNode) => (d.x * Math.PI) / 180)\n    .radius((d: RadialHierarchyNode) => d.y)\n\n  // \u2500\u2500 7. Draw edges \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const edgeGroup = g.append('g').attr('class', 'edges')\n  const nodeGroup = g.append('g').attr('class', 'nodes')\n\n  // Build edge paths and store them for hover interaction\n  type EdgePath = {\n    srcId: string\n    tgtId: string\n    el: D3.Selection<SVGPathElement, unknown, null, undefined>\n    srcColor: string\n  }\n  const edgePaths: EdgePath[] = []\n\n  data.edges.forEach(e => {\n    const srcNode = nodeIndex.get(e.source)\n    const tgtNode = nodeIndex.get(e.target)\n    if (!srcNode || !tgtNode) return\n\n    const path = lcaPath(srcNode, tgtNode)\n    const pathStr = (lineRadial as unknown as (pts: RadialHierarchyNode[]) => string | null)(path)\n    if (!pathStr) return\n\n    const color = nodeColor(srcNode.data)\n\n    const el = edgeGroup.append('path')\n      .attr('d', pathStr)\n      .attr('fill', 'none')\n      .attr('stroke', color)\n      .attr('stroke-width', 1)\n      .attr('opacity', 0.28)\n\n    edgePaths.push({ srcId: e.source, tgtId: e.target, el, srcColor: color })\n  })\n\n  // \u2500\u2500 8. Draw leaf nodes and labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  let lockedNodeId: string | null = null\n\n  leafNodes.forEach(n => {\n    const angleRad = (n.x * Math.PI) / 180\n    const nx = Math.sin(angleRad) * n.y\n    const ny = -Math.cos(angleRad) * n.y\n    const color = nodeColor(n.data)\n    const label = n.data.label ?? n.data.id\n\n    // Node circle\n    nodeGroup.append('circle')\n      .attr('cx', nx)\n      .attr('cy', ny)\n      .attr('r', nodeR)\n      .attr('fill', color)\n      .attr('stroke', theme.background)\n      .attr('stroke-width', 1.5)\n      .attr('cursor', 'pointer')\n      .on('mouseover', (event: MouseEvent) => {\n        if (lockedNodeId !== null) return\n        highlightNode(n.data.id)\n        showTooltip(event, [\n          formatTooltipRow('Node', label),\n          formatTooltipRow('Group', n.data.group ?? n.data.parent ?? '\u2014'),\n          formatTooltipRow(\n            'Connections',\n            data.edges.filter(e => e.source === n.data.id || e.target === n.data.id).length.toString()\n          ),\n        ].join(''), theme)\n      })\n      .on('mouseout', () => {\n        if (lockedNodeId !== null) return\n        resetHighlight()\n        hideTooltip()\n      })\n      .on('click', (event: MouseEvent) => {\n        event.stopPropagation()\n        if (lockedNodeId === n.data.id) {\n          lockedNodeId = null\n          resetHighlight()\n          hideTooltip()\n        } else {\n          lockedNodeId = n.data.id\n          highlightNode(n.data.id)\n          showTooltip(event, [\n            formatTooltipRow('Node', label),\n            formatTooltipRow('Group', n.data.group ?? n.data.parent ?? '\u2014'),\n            formatTooltipRow(\n              'Connections',\n              data.edges.filter(e => e.source === n.data.id || e.target === n.data.id).length.toString()\n            ),\n          ].join(''), theme)\n        }\n      })\n\n    // Radial label: flip text on the left half so it always reads outward\n    const labelAngle = n.x              // degrees\n    const flipped = labelAngle > 180\n    const rotDeg = flipped ? labelAngle - 90 : labelAngle - 90\n    const labelR = n.y + nodeR + 5\n\n    const lx = Math.sin(angleRad) * labelR\n    const ly = -Math.cos(angleRad) * labelR\n\n    // Rotation: align text along the radial line, flip if on left half\n    const textRotate = flipped\n      ? `rotate(${rotDeg + 180},${lx.toFixed(2)},${ly.toFixed(2)})`\n      : `rotate(${rotDeg},${lx.toFixed(2)},${ly.toFixed(2)})`\n\n    nodeGroup.append('text')\n      .attr('x', lx)\n      .attr('y', ly)\n      .attr('dy', '0.35em')\n      .attr('text-anchor', flipped ? 'end' : 'start')\n      .attr('transform', textRotate)\n      .attr('font-family', theme.fontFamily)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text)\n      .attr('pointer-events', 'none')\n      .text(label)\n  })\n\n  // Click background to unlock\n  svg.on('click', () => {\n    if (lockedNodeId !== null) {\n      lockedNodeId = null\n      resetHighlight()\n      hideTooltip()\n    }\n  })\n\n  // \u2500\u2500 9. Highlight helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  function highlightNode(nodeId: string): void {\n    edgePaths.forEach(ep => {\n      const connected = ep.srcId === nodeId || ep.tgtId === nodeId\n      ep.el\n        .attr('opacity', connected ? 0.9 : 0.05)\n        .attr('stroke-width', connected ? 2 : 0.8)\n    })\n  }\n\n  function resetHighlight(): void {\n    edgePaths.forEach(ep => {\n      ep.el.attr('opacity', 0.28).attr('stroke-width', 1)\n    })\n  }\n\n  // \u2500\u2500 10. Colour legend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (uniqueColorKeys.filter(k => k !== '').length > 1) {\n    const legendKeys = uniqueColorKeys.filter(k => k !== '')\n    const lgX = -W / 2 + (theme.marginLeft)\n    const lgY = H / 2 - theme.marginBottom - (legendKeys.length * 18)\n\n    legendKeys.forEach((k, i) => {\n      g.append('rect')\n        .attr('x', lgX)\n        .attr('y', lgY + i * 18)\n        .attr('width', 10)\n        .attr('height', 10)\n        .attr('fill', colorKeyMap.get(k) ?? getColor(i, theme))\n        .attr('rx', 2)\n      g.append('text')\n        .attr('x', lgX + 14)\n        .attr('y', lgY + i * 18 + 9)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n        .attr('fill', theme.text)\n        .text(k)\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * Dendrogram visualization for hierarchical agglomerative clustering.\n * Renders a U-shaped elbow dendrogram with cluster coloring, cut line,\n * leaf labels, and hover tooltips.\n *\n * Uses manual coordinate computation (not d3.hierarchy) because dendrograms\n * need continuous y-axis (merge height) and specific DFS leaf ordering,\n * which d3.cluster/d3.tree cannot represent correctly.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport type { HACMerge } from '../../stats/clustering.js'\n\n// \u2500\u2500\u2500 Data & Config \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface DendrogramData {\n  readonly merges: readonly HACMerge[]\n  readonly heights: readonly number[]\n  readonly dendrogramOrder: readonly number[]\n  readonly labels: readonly number[]\n  readonly k: number\n  readonly linkage: string\n  readonly copheneticCorrelation: number\n  readonly observationLabels?: readonly string[]\n}\n\nexport interface DendrogramConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly orientation?: 'vertical' | 'horizontal'\n  readonly showCutLine?: boolean\n  readonly showLabels?: boolean\n  readonly colorSubtrees?: boolean\n}\n\n// \u2500\u2500\u2500 Public entry point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Render a dendrogram into the given container.\n * @param container - HTMLElement to render into (cleared on call)\n * @param data - merge data from runHierarchical + cutTree\n * @param config - visual configuration\n */\nexport function renderDendrogram(\n  container: HTMLElement,\n  data: DendrogramData,\n  config: DendrogramConfig = {}\n): void {\n  import('d3').then(d3 => renderDendrogramD3(d3, container, data, config))\n}\n\n// \u2500\u2500\u2500 Core renderer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderDendrogramD3(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: DendrogramData,\n  config: DendrogramConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 600\n  const H = config.height ?? 480\n  const showCut = config.showCutLine !== false\n  const showLabels = config.showLabels !== false\n  const colorSubs = config.colorSubtrees !== false\n\n  const margin = {\n    top: theme.marginTop,\n    right: theme.marginRight,\n    bottom: showLabels ? Math.max(theme.marginBottom, 100) : theme.marginBottom,\n    left: theme.marginLeft,\n  }\n  const plotW = W - margin.left - margin.right\n  const plotH = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const { merges, heights, dendrogramOrder, labels, k } = data\n  const n = merges.length + 1\n\n  // \u2500\u2500 Node coordinates \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  // nodeX / nodeY for all 2n-1 nodes (0..n-1 are leaves, n..2n-2 are internal)\n  const nodeX = new Float64Array(2 * n - 1)\n  const nodeY = new Float64Array(2 * n - 1)\n\n  // Leaf x positions: index in dendrogramOrder \u2192 uniform spacing\n  const leafPos = new Float64Array(n)\n  for (let i = 0; i < dendrogramOrder.length; i++) {\n    leafPos[dendrogramOrder[i]!] = i\n  }\n  for (let i = 0; i < n; i++) {\n    nodeX[i] = leafPos[i]!\n    nodeY[i] = 0\n  }\n\n  // Internal node positions from merges\n  for (let s = 0; s < merges.length; s++) {\n    const m = merges[s]!\n    const internalIdx = n + s\n    nodeX[internalIdx] = (nodeX[m.a]! + nodeX[m.b]!) / 2\n    nodeY[internalIdx] = heights[s]!\n  }\n\n  // \u2500\u2500 Cluster assignment per node (for subtree coloring) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const nodeCluster = new Int32Array(2 * n - 1)\n  // Leaves: use labels directly\n  for (let i = 0; i < n; i++) {\n    nodeCluster[i] = labels[i]!\n  }\n  // Internal: same cluster if both children share one, else -1 (mixed)\n  for (let s = 0; s < merges.length; s++) {\n    const m = merges[s]!\n    const cA = nodeCluster[m.a]!\n    const cB = nodeCluster[m.b]!\n    nodeCluster[n + s] = cA === cB ? cA : -1\n  }\n\n  // \u2500\u2500 Subtree sizes (for tooltip) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const subtreeSize = new Float64Array(2 * n - 1)\n  for (let i = 0; i < n; i++) subtreeSize[i] = 1\n  for (let s = 0; s < merges.length; s++) {\n    const m = merges[s]!\n    subtreeSize[n + s] = subtreeSize[m.a]! + subtreeSize[m.b]!\n  }\n\n  // \u2500\u2500 Scales \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const maxHeight = Math.max(...heights) * 1.05\n  const xScale = d3.scaleLinear().domain([0, n - 1]).range([0, plotW])\n  const yScale = d3.scaleLinear().domain([0, maxHeight]).range([plotH, 0])\n\n  // \u2500\u2500 SVG setup \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const svg = d3.select(container)\n    .append('svg')\n    .attr('width', W)\n    .attr('height', H)\n    .style('background', theme.background)\n\n  const subtitle = `${data.linkage} linkage, K = ${k}, cophenetic r = ${data.copheneticCorrelation.toFixed(3)}`\n  addSubtitle(svg, config.title ?? 'Dendrogram', subtitle, W, theme)\n\n  if (config.caption) {\n    addCaption(svg, config.caption, W, H, theme)\n  }\n\n  const g = svg.append('g')\n    .attr('transform', `translate(${margin.left},${margin.top})`)\n\n  // \u2500\u2500 Y-axis (height) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const yAxis = d3.axisLeft(yScale).ticks(6)\n  g.append('g')\n    .attr('class', 'y-axis')\n    .call(yAxis)\n    .call(sel => {\n      sel.select('.domain').attr('stroke', theme.axisLine)\n      sel.selectAll('.tick line').attr('stroke', theme.gridLine)\n      sel.selectAll('.tick text')\n        .attr('fill', theme.textMuted)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', theme.fontSizeSmall)\n    })\n\n  // Horizontal gridlines\n  g.append('g')\n    .attr('class', 'grid')\n    .call(d3.axisLeft(yScale).ticks(6).tickSize(-plotW).tickFormat(() => ''))\n    .call(sel => {\n      sel.select('.domain').remove()\n      sel.selectAll('.tick line')\n        .attr('stroke', theme.gridLine)\n        .attr('stroke-opacity', 0.5)\n    })\n\n  // Y-axis label\n  g.append('text')\n    .attr('transform', 'rotate(-90)')\n    .attr('x', -plotH / 2)\n    .attr('y', -margin.left + 16)\n    .attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily)\n    .attr('font-size', theme.fontSizeSmall)\n    .attr('fill', theme.textMuted)\n    .text('Merge Height')\n\n  // \u2500\u2500 U-shaped elbow links \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  for (let s = 0; s < merges.length; s++) {\n    const m = merges[s]!\n    const internalIdx = n + s\n\n    const ax = xScale(nodeX[m.a]!)\n    const ay = yScale(nodeY[m.a]!)\n    const bx = xScale(nodeX[m.b]!)\n    const by = yScale(nodeY[m.b]!)\n    const my = yScale(nodeY[internalIdx]!)\n\n    // U-shape: from A up to merge height, across, down to B\n    const pathD = `M${ax},${ay} V${my} H${bx} V${by}`\n\n    // Link color: cluster color if pure subtree, neutral gray if mixed\n    const cluster = nodeCluster[internalIdx]!\n    const color = colorSubs && cluster >= 0\n      ? getColor(cluster, theme)\n      : theme.axisLine\n\n    const sizeA = subtreeSize[m.a]!\n    const sizeB = subtreeSize[m.b]!\n    const sizeC = subtreeSize[internalIdx]!\n    const mergeH = heights[s]!\n\n    g.append('path')\n      .attr('d', pathD)\n      .attr('fill', 'none')\n      .attr('stroke', color)\n      .attr('stroke-width', 1.5)\n      .attr('stroke-linejoin', 'round')\n      .style('cursor', 'pointer')\n      .on('mouseenter', (event: MouseEvent) => {\n        const content = [\n          formatTooltipRow('Merge height', mergeH.toFixed(3)),\n          formatTooltipRow('Left subtree', String(sizeA)),\n          formatTooltipRow('Right subtree', String(sizeB)),\n          formatTooltipRow('Combined', String(sizeC)),\n        ].join('')\n        showTooltip(event, content, theme)\n      })\n      .on('mousemove', (event: MouseEvent) => {\n        const content = [\n          formatTooltipRow('Merge height', mergeH.toFixed(3)),\n          formatTooltipRow('Left subtree', String(sizeA)),\n          formatTooltipRow('Right subtree', String(sizeB)),\n          formatTooltipRow('Combined', String(sizeC)),\n        ].join('')\n        showTooltip(event, content, theme)\n      })\n      .on('mouseleave', () => hideTooltip())\n  }\n\n  // \u2500\u2500 Cut line \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  if (showCut && k > 1 && k <= n) {\n    // Cut between the (n-k)-th and (n-k+1)-th merge heights\n    // merges are sorted by height ascending: index n-k-1 is last merge kept, n-k is first merge cut\n    const belowIdx = n - k - 1\n    const aboveIdx = n - k\n    const hBelow = belowIdx >= 0 ? heights[belowIdx]! : 0\n    const hAbove = aboveIdx < heights.length ? heights[aboveIdx]! : maxHeight\n    const cutY = yScale((hBelow + hAbove) / 2)\n\n    g.append('line')\n      .attr('x1', -8)\n      .attr('x2', plotW + 8)\n      .attr('y1', cutY)\n      .attr('y2', cutY)\n      .attr('stroke', theme.textMuted)\n      .attr('stroke-width', 1.5)\n      .attr('stroke-dasharray', '6,4')\n      .attr('opacity', 0.7)\n\n    g.append('text')\n      .attr('x', plotW + 4)\n      .attr('y', cutY - 6)\n      .attr('font-family', theme.fontFamilyMono)\n      .attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.textMuted)\n      .attr('text-anchor', 'end')\n      .text(`K = ${k}`)\n  }\n\n  // \u2500\u2500 Leaf labels \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  if (showLabels) {\n    const obsLabels = data.observationLabels\n    // For large n, thin out labels to prevent overlap\n    const step = n > 80 ? Math.ceil(n / 40) : 1\n\n    for (let i = 0; i < dendrogramOrder.length; i++) {\n      if (i % step !== 0) continue\n      const leafIdx = dendrogramOrder[i]!\n      const lx = xScale(i)\n      const ly = plotH + 8\n\n      const label = obsLabels?.[leafIdx] ?? String(leafIdx + 1)\n      const cluster = labels[leafIdx]!\n\n      g.append('text')\n        .attr('x', lx)\n        .attr('y', ly)\n        .attr('transform', `rotate(-60, ${lx}, ${ly})`)\n        .attr('font-family', theme.fontFamily)\n        .attr('font-size', Math.min(theme.fontSizeSmall, Math.max(8, plotW / n * 0.8)))\n        .attr('fill', colorSubs ? getColor(cluster, theme) : theme.textMuted)\n        .attr('text-anchor', 'end')\n        .attr('dominant-baseline', 'auto')\n        .text(label)\n    }\n  }\n}\n", "/**\n * Factor Analysis visualizations (6 plot types).\n * Scree with parallel analysis, loadings heatmap, CFA/SEM path diagram,\n * communality bar chart, factor correlation matrix, fit indices dashboard.\n *\n * All plots follow Carm viz conventions: dynamic D3 import, CarmTheme,\n * addSubtitle/addCaption annotations, tooltip interactions.\n */\n\nimport type * as D3 from 'd3'\nimport { DEFAULT_THEME, applyTheme, getColor } from '../themes/default.js'\nimport type { CarmTheme } from '../themes/default.js'\nimport { addSubtitle, addCaption } from '../components/annotations.js'\nimport { showTooltip, hideTooltip, formatTooltipRow } from '../components/tooltip.js'\nimport { formatStat, formatP } from '../../core/apa.js'\nimport type { FAResult, CFAResult, FADiagnostics } from '../../core/types.js'\n\n// \u2500\u2500\u2500 Config \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport type FAPlotType = 'scree' | 'loadings' | 'path' | 'communality' | 'factor-correlation' | 'fit-indices'\n\n/**\n * Obsessive control over every visual element of the SEM path diagram.\n * Every field has a sensible default \u2014 override only what you need.\n */\nexport interface FAPathStyle {\n  // \u2500\u2500 Factor ellipses \u2500\u2500\n  readonly factorRx?: number              // default: 56\n  readonly factorRy?: number              // default: 28\n  readonly factorStroke?: number          // default: 2.5\n  readonly factorFontSize?: number        // default: 14\n  readonly factorFontWeight?: string      // default: '800'\n  readonly factorGlow?: boolean           // default: true \u2014 outer glow on factor ellipses\n  readonly factorGlowRadius?: number      // default: 6\n  readonly factorHighlight?: boolean      // default: true \u2014 inner specular shine arc\n\n  // \u2500\u2500 Item rectangles \u2500\u2500\n  readonly itemWidth?: number             // default: 96\n  readonly itemHeight?: number            // default: 30\n  readonly itemRadius?: number            // default: 5 \u2014 corner radius\n  readonly itemStroke?: number            // default: 1.2\n  readonly itemFontSize?: number          // default: 11\n  readonly itemFontWeight?: string        // default: '600'\n  readonly itemAccentWidth?: number       // default: 4 \u2014 left color bar width\n  readonly itemGradient?: boolean         // default: true \u2014 subtle left\u2192right gradient fill\n\n  // \u2500\u2500 Error ellipses \u2500\u2500\n  readonly errorRx?: number               // default: 14\n  readonly errorRy?: number               // default: 12\n  readonly errorStroke?: number           // default: 1.2\n  readonly errorFontSize?: number         // default: 9\n  readonly errorSelfLoop?: boolean        // default: true \u2014 self-loop variance arc\n  readonly errorSelfLoopSize?: number     // default: 12 \u2014 height of self-loop arc above error\n\n  // \u2500\u2500 Loading arrows (factor \u2192 item) \u2500\u2500\n  readonly arrowMinWidth?: number         // default: 0.8\n  readonly arrowMaxWidth?: number         // default: 2.5\n  readonly arrowMinOpacity?: number       // default: 0.4\n  readonly arrowMaxOpacity?: number       // default: 0.95\n  readonly arrowMarkerSize?: number       // default: 6 \u2014 arrowhead size\n  readonly arrowCurvature?: number        // default: 0.4 \u2014 B\u00E9zier control point offset (0=straight, 1=extreme)\n\n  // \u2500\u2500 Loading labels \u2500\u2500\n  readonly loadingFontSize?: number       // default: 9.5\n  readonly loadingFontWeight?: string     // default: '700'\n  readonly loadingPillRadius?: number     // default: 7\n  readonly loadingLabelOffset?: number    // default: -6 \u2014 vertical offset from arrow midpoint (negative = above)\n  readonly loadingPosition?: number       // default: 0.6 \u2014 t param along B\u00E9zier (0=factor, 1=item)\n\n  // \u2500\u2500 Text halo (white outline behind labels for legibility) \u2500\u2500\n  readonly halo?: boolean                 // default: true \u2014 enable white halo on all path labels\n  readonly haloColor?: string             // default: '#ffffff'\n  readonly haloWidth?: number             // default: 3.5 \u2014 stroke width of halo outline\n\n  // \u2500\u2500 Covariance arcs \u2500\u2500\n  readonly covColor?: string              // default: '#8892a0'\n  readonly covMinWidth?: number           // default: 1.0\n  readonly covMaxWidth?: number           // default: 3.0\n  readonly covMarkerSize?: number         // default: 6\n  readonly covLabelFontSize?: number      // default: 10\n  readonly covNestSpacing?: number        // default: 20 \u2014 extra X offset per nesting level\n\n  // \u2500\u2500 Error arrows (error \u2192 item) \u2500\u2500\n  readonly errorArrowWidth?: number       // default: 0.8\n  readonly errorArrowMarkerSize?: number  // default: 5\n\n  // \u2500\u2500 Layout spacing \u2500\u2500\n  readonly itemGap?: number               // default: 6 \u2014 vertical gap between items\n  readonly factorGroupGap?: number        // default: 32 \u2014 vertical gap between factor groups\n  readonly arrowSpan?: number             // default: 120 \u2014 horizontal distance factor\u2192item\n  readonly errorSpan?: number             // default: 36 \u2014 horizontal distance item\u2192error\n  readonly covArcReserve?: number         // default: 70 \u2014 left space for covariance arcs\n  readonly topPadding?: number            // default: 74\n  readonly bottomPadding?: number         // default: 44 (140 if showFitBox)\n  readonly rightPadding?: number          // default: 50\n\n  // \u2500\u2500 Colors (override palette per factor) \u2500\u2500\n  readonly factorColors?: readonly string[] // default: uses theme palette\n\n  // \u2500\u2500 Fit card \u2500\u2500\n  readonly fitCardWidth?: number          // default: 210\n  readonly fitCardHeight?: number         // default: 118\n\n  // \u2500\u2500 Cross-loadings (EFA) \u2500\u2500\n  readonly crossLoadingThreshold?: number  // default: 0.2\n  readonly crossLoadingDash?: string       // default: '5,4'\n  readonly crossLoadingOpacity?: number    // default: 0.3\n\n  // \u2500\u2500 Group bracket lines \u2500\u2500\n  readonly showGroupBrackets?: boolean     // default: true\n  readonly groupBracketOpacity?: number    // default: 0.12\n\n  // \u2500\u2500 Shadow \u2500\u2500\n  readonly showShadows?: boolean           // default: true\n}\n\nexport interface FAPlotConfig {\n  readonly title?: string\n  readonly caption?: string\n  readonly width?: number\n  readonly height?: number\n  readonly theme?: CarmTheme\n  readonly type?: FAPlotType               // default: 'loadings'\n  readonly variableLabels?: readonly string[]\n  readonly factorLabels?: readonly string[]\n  readonly loadingThreshold?: number       // default: 0.3 (for loadings heatmap)\n  readonly showParallelAnalysis?: boolean  // default: true (for scree)\n  readonly showErrorTerms?: boolean        // default: true (for path)\n  readonly showFitBox?: boolean            // default: true (for path)\n  readonly diagnostics?: FADiagnostics     // for scree plot parallel analysis overlay\n  readonly pathStyle?: FAPathStyle         // obsessive control over path diagram\n  readonly decimals?: number               // default: 2 \u2014 decimal places for loadings/communalities/correlations\n  readonly sortBy?: 'original' | 'factor' | 'loading'  // default: 'factor' \u2014 loadings heatmap row order\n  readonly suppressBelow?: number          // default: 0 \u2014 hide text for |loading| < threshold (cell still colored)\n}\n\n// \u2500\u2500\u2500 Entry Point \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function renderFAPlot(\n  container: HTMLElement,\n  data: FAResult | CFAResult,\n  config: FAPlotConfig = {}\n): void {\n  import('d3').then(d3 => {\n    const type = config.type ?? 'loadings'\n    if (type === 'scree') renderScree(d3, container, data, config)\n    else if (type === 'loadings') renderLoadings(d3, container, data, config)\n    else if (type === 'path') renderPath(d3, container, data, config)\n    else if (type === 'communality') renderCommunality(d3, container, data, config)\n    else if (type === 'factor-correlation') renderFactorCorrelation(d3, container, data, config)\n    else if (type === 'fit-indices') renderFitIndices(d3, container, data, config)\n  })\n}\n\n// \u2500\u2500\u2500 Helper: check if CFAResult \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction isCFA(data: FAResult | CFAResult): data is CFAResult {\n  return 'parameterEstimates' in data\n}\n\n// \u2500\u2500\u2500 Plot 1: Scree with Parallel Analysis \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderScree(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 520, H = config.height ?? 380\n  const margin = { top: theme.marginTop, right: theme.marginRight, bottom: theme.marginBottom, left: theme.marginLeft }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n\n  const diag = config.diagnostics\n  const subtitleParts: string[] = []\n  if (diag) {\n    subtitleParts.push(`Parallel Analysis: ${diag.parallelSuggested} factors`)\n    subtitleParts.push(`MAP: ${diag.mapSuggested} factors`)\n  }\n  addSubtitle(svg, config.title ?? 'Scree Plot with Parallel Analysis', subtitleParts.join('; '), W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const eigenvalues = data.eigenvalues\n  const comps = eigenvalues.map((_, i) => i + 1)\n  const maxEv = Math.max(...eigenvalues, ...(diag?.parallelSimulated ?? []), 1)\n\n  const xScale = d3.scaleBand<number>().domain(comps).range([0, width]).padding(0.25)\n  const yScale = d3.scaleLinear().domain([0, maxEv * 1.15]).range([height, 0]).nice()\n\n  // Gridlines\n  g.selectAll('.grid').data(yScale.ticks(5)).join('line')\n    .attr('x1', 0).attr('x2', width).attr('y1', d => yScale(d)).attr('y2', d => yScale(d))\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Kaiser criterion line (eigenvalue = 1)\n  g.append('line').attr('x1', 0).attr('x2', width)\n    .attr('y1', yScale(1)).attr('y2', yScale(1))\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '6,3').attr('stroke-width', 1.5)\n  g.append('text').attr('x', width + 4).attr('y', yScale(1) + 4)\n    .attr('font-size', 9).attr('fill', theme.textMuted).text('Kaiser')\n\n  // Eigenvalue bars\n  eigenvalues.forEach((ev, i) => {\n    const x = xScale(i + 1) ?? 0\n    const barColor = i < data.nFactors ? getColor(0, theme) : theme.gridLine\n    g.append('rect')\n      .attr('x', x).attr('y', yScale(ev))\n      .attr('width', xScale.bandwidth()).attr('height', height - yScale(ev))\n      .attr('fill', barColor).attr('opacity', 0.8).attr('rx', 2)\n      .on('mouseover', (event: MouseEvent) => {\n        const pctVar = eigenvalues.length > 0\n          ? (ev / eigenvalues.reduce((s, v) => s + v, 0) * 100).toFixed(1)\n          : '0'\n        showTooltip(event, [\n          formatTooltipRow('Component', `${i + 1}`),\n          formatTooltipRow('Eigenvalue', ev),\n          formatTooltipRow('% Variance', `${pctVar}%`),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Eigenvalue label on bar\n    g.append('text')\n      .attr('x', x + xScale.bandwidth() / 2).attr('y', yScale(ev) - 4)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text).text(ev.toFixed(2))\n  })\n\n  // Parallel analysis line (simulated 95th percentile)\n  if (config.showParallelAnalysis !== false && diag?.parallelSimulated) {\n    const sim = diag.parallelSimulated\n    const lineData = comps.map((c, i) => ({\n      x: (xScale(c) ?? 0) + xScale.bandwidth() / 2,\n      y: yScale(sim[i] ?? 0),\n    }))\n\n    const line = d3.line<{ x: number; y: number }>().x(d => d.x).y(d => d.y)\n    g.append('path').datum(lineData)\n      .attr('d', line).attr('fill', 'none')\n      .attr('stroke', getColor(2, theme)).attr('stroke-width', 2)\n      .attr('stroke-dasharray', '5,3')\n\n    lineData.forEach((pt) => {\n      g.append('circle').attr('cx', pt.x).attr('cy', pt.y)\n        .attr('r', 3).attr('fill', getColor(2, theme))\n    })\n\n    // Legend\n    const legY = 8\n    g.append('line').attr('x1', width - 120).attr('x2', width - 90)\n      .attr('y1', legY).attr('y2', legY)\n      .attr('stroke', getColor(2, theme)).attr('stroke-width', 2).attr('stroke-dasharray', '5,3')\n    g.append('text').attr('x', width - 86).attr('y', legY + 4)\n      .attr('font-size', 9).attr('fill', theme.textMuted).text('Simulated (95th)')\n  }\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Factor')\n  g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2).attr('y', -48).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Eigenvalue')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Plot 2: Loadings Heatmap \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderLoadings(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const threshold = config.loadingThreshold ?? 0.3\n  const dec = config.decimals ?? 2\n  const suppressBelow = config.suppressBelow ?? 0\n  const sortBy = config.sortBy ?? 'factor'\n  const nItems = data.loadings.length\n  const nFactors = data.nFactors\n\n  // Sort items according to sortBy option\n  const itemOrder = Array.from({ length: nItems }, (_, i) => i)\n  if (sortBy === 'factor') {\n    itemOrder.sort((a, b) => {\n      const rowA = data.loadings[a]!\n      const rowB = data.loadings[b]!\n      const maxFactorA = rowA.indexOf(Math.max(...rowA.map(Math.abs)))\n      const maxFactorB = rowB.indexOf(Math.max(...rowB.map(Math.abs)))\n      if (maxFactorA !== maxFactorB) return maxFactorA - maxFactorB\n      return Math.max(...rowB.map(Math.abs)) - Math.max(...rowA.map(Math.abs))\n    })\n  } else if (sortBy === 'loading') {\n    itemOrder.sort((a, b) => {\n      const maxA = Math.max(...data.loadings[a]!.map(Math.abs))\n      const maxB = Math.max(...data.loadings[b]!.map(Math.abs))\n      return maxB - maxA\n    })\n  }\n  // sortBy === 'original' \u2192 no sorting, keep natural order\n\n  const cellW = 56, cellH = 28\n  const showComm = true\n  const extraCols = showComm ? 1 : 0\n  const W = config.width ?? ((nFactors + extraCols) * cellW + 140)\n  const H = config.height ?? (nItems * cellH + 100)\n  const margin = { top: 60, right: 20, bottom: 30, left: 110 }\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'Factor Loadings', data.formatted, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const colorScale = d3.scaleSequential().domain([-1, 1]).interpolator(d3.interpolateRdBu)\n  const commScale = d3.scaleSequential().domain([0, 1]).interpolator(d3.interpolateGreens)\n\n  // Variable labels\n  const varLabels = config.variableLabels ?? data.variableNames\n  const facLabels = config.factorLabels ?? data.factorNames\n\n  // Column headers\n  facLabels.forEach((label, ci) => {\n    g.append('text').attr('x', ci * cellW + cellW / 2).attr('y', -8)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall)\n      .attr('font-weight', '600').attr('fill', theme.text).text(label)\n  })\n  if (showComm) {\n    g.append('text').attr('x', nFactors * cellW + cellW / 2).attr('y', -8)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall)\n      .attr('font-weight', '600').attr('fill', theme.text).text('h\u00B2')\n  }\n\n  // Cells\n  itemOrder.forEach((origIdx, rowIdx) => {\n    const row = data.loadings[origIdx]!\n    const label = varLabels[origIdx] ?? `V${origIdx + 1}`\n\n    // Row label\n    g.append('text').attr('x', -6).attr('y', rowIdx * cellH + cellH / 2 + 4)\n      .attr('text-anchor', 'end').attr('font-size', theme.fontSizeSmall)\n      .attr('fill', theme.text).text(label)\n\n    // Loading cells\n    row.forEach((val, ci) => {\n      const dimmed = Math.abs(val) < threshold\n      g.append('rect')\n        .attr('x', ci * cellW).attr('y', rowIdx * cellH)\n        .attr('width', cellW - 2).attr('height', cellH - 2).attr('rx', 3)\n        .attr('fill', colorScale(val)).attr('opacity', dimmed ? 0.3 : 1)\n        .on('mouseover', (event: MouseEvent) => {\n          showTooltip(event, [\n            formatTooltipRow(label, ''),\n            formatTooltipRow(facLabels[ci] ?? `F${ci + 1}`, val),\n          ].join(''), theme)\n        })\n        .on('mouseout', hideTooltip)\n\n      // Show text unless suppressed\n      const suppressed = suppressBelow > 0 && Math.abs(val) < suppressBelow\n      if (!suppressed) {\n        g.append('text')\n          .attr('x', ci * cellW + cellW / 2).attr('y', rowIdx * cellH + cellH / 2 + 4)\n          .attr('text-anchor', 'middle')\n          .attr('font-family', theme.fontFamilyMono).attr('font-size', Math.min(10, cellW / 5))\n          .attr('fill', Math.abs(val) > 0.6 ? '#fff' : theme.text)\n          .attr('opacity', dimmed ? 0.5 : 1)\n          .text(val.toFixed(dec))\n      }\n    })\n\n    // Communality cell\n    if (showComm) {\n      const comm = data.communalities[origIdx] ?? 0\n      g.append('rect')\n        .attr('x', nFactors * cellW).attr('y', rowIdx * cellH)\n        .attr('width', cellW - 2).attr('height', cellH - 2).attr('rx', 3)\n        .attr('fill', commScale(comm))\n\n      g.append('text')\n        .attr('x', nFactors * cellW + cellW / 2).attr('y', rowIdx * cellH + cellH / 2 + 4)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamilyMono).attr('font-size', Math.min(10, cellW / 5))\n        .attr('fill', comm > 0.6 ? '#fff' : theme.text)\n        .text(comm.toFixed(dec))\n    }\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Plot 3: CFA/SEM Path Diagram \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Resolve FAPathStyle with defaults. */\nfunction resolvePathStyle(s?: FAPathStyle): Required<FAPathStyle> {\n  return {\n    factorRx: s?.factorRx ?? 56,\n    factorRy: s?.factorRy ?? 28,\n    factorStroke: s?.factorStroke ?? 2.5,\n    factorFontSize: s?.factorFontSize ?? 14,\n    factorFontWeight: s?.factorFontWeight ?? '800',\n    factorGlow: s?.factorGlow ?? true,\n    factorGlowRadius: s?.factorGlowRadius ?? 6,\n    factorHighlight: s?.factorHighlight ?? true,\n    itemWidth: s?.itemWidth ?? 96,\n    itemHeight: s?.itemHeight ?? 30,\n    itemRadius: s?.itemRadius ?? 5,\n    itemStroke: s?.itemStroke ?? 1.2,\n    itemFontSize: s?.itemFontSize ?? 11,\n    itemFontWeight: s?.itemFontWeight ?? '600',\n    itemAccentWidth: s?.itemAccentWidth ?? 4,\n    itemGradient: s?.itemGradient ?? true,\n    errorRx: s?.errorRx ?? 14,\n    errorRy: s?.errorRy ?? 12,\n    errorStroke: s?.errorStroke ?? 1.2,\n    errorFontSize: s?.errorFontSize ?? 9,\n    errorSelfLoop: s?.errorSelfLoop ?? true,\n    errorSelfLoopSize: s?.errorSelfLoopSize ?? 12,\n    arrowMinWidth: s?.arrowMinWidth ?? 0.8,\n    arrowMaxWidth: s?.arrowMaxWidth ?? 2.5,\n    arrowMinOpacity: s?.arrowMinOpacity ?? 0.4,\n    arrowMaxOpacity: s?.arrowMaxOpacity ?? 0.95,\n    arrowMarkerSize: s?.arrowMarkerSize ?? 6,\n    arrowCurvature: s?.arrowCurvature ?? 0.4,\n    loadingFontSize: s?.loadingFontSize ?? 9.5,\n    loadingFontWeight: s?.loadingFontWeight ?? '700',\n    loadingPillRadius: s?.loadingPillRadius ?? 7,\n    loadingLabelOffset: s?.loadingLabelOffset ?? -6,\n    loadingPosition: s?.loadingPosition ?? 0.6,\n    halo: s?.halo ?? true,\n    haloColor: s?.haloColor ?? '#ffffff',\n    haloWidth: s?.haloWidth ?? 3.5,\n    covColor: s?.covColor ?? '#8892a0',\n    covMinWidth: s?.covMinWidth ?? 1.0,\n    covMaxWidth: s?.covMaxWidth ?? 3.0,\n    covMarkerSize: s?.covMarkerSize ?? 6,\n    covLabelFontSize: s?.covLabelFontSize ?? 10,\n    covNestSpacing: s?.covNestSpacing ?? 20,\n    errorArrowWidth: s?.errorArrowWidth ?? 0.8,\n    errorArrowMarkerSize: s?.errorArrowMarkerSize ?? 5,\n    itemGap: s?.itemGap ?? 6,\n    factorGroupGap: s?.factorGroupGap ?? 32,\n    arrowSpan: s?.arrowSpan ?? 120,\n    errorSpan: s?.errorSpan ?? 36,\n    covArcReserve: s?.covArcReserve ?? 70,\n    topPadding: s?.topPadding ?? 74,\n    bottomPadding: s?.bottomPadding ?? 44,\n    rightPadding: s?.rightPadding ?? 50,\n    factorColors: s?.factorColors ?? [],\n    fitCardWidth: s?.fitCardWidth ?? 210,\n    fitCardHeight: s?.fitCardHeight ?? 118,\n    crossLoadingThreshold: s?.crossLoadingThreshold ?? 0.2,\n    crossLoadingDash: s?.crossLoadingDash ?? '5,4',\n    crossLoadingOpacity: s?.crossLoadingOpacity ?? 0.3,\n    showGroupBrackets: s?.showGroupBrackets ?? true,\n    groupBracketOpacity: s?.groupBracketOpacity ?? 0.12,\n    showShadows: s?.showShadows ?? true,\n  }\n}\n\n/** Get factor color: custom array \u2192 theme palette fallback. */\nfunction fColor(fi: number, ps: Required<FAPathStyle>, theme: CarmTheme): string {\n  if (ps.factorColors.length > 0) return ps.factorColors[fi % ps.factorColors.length]!\n  return getColor(fi, theme)\n}\n\n/**\n * Enterprise-grade AMOS-style SEM path diagram.\n * Every visual parameter is controllable via FAPathStyle.\n */\nfunction renderPath(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult | CFAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const ps = resolvePathStyle(config.pathStyle)\n  const dec = config.decimals ?? 2\n  const showErrors = config.showErrorTerms !== false\n  const showFit = config.showFitBox !== false\n\n  const nFactors = data.nFactors\n  const nItems = data.loadings.length\n  const varLabels = config.variableLabels ?? data.variableNames\n  const facLabels = config.factorLabels ?? data.factorNames\n  const hasCFA = isCFA(data)\n\n  // \u2500\u2500 Assign items to primary factor \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const factorItems: number[][] = Array.from({ length: nFactors }, () => [])\n  if (hasCFA) {\n    const cfaModel = (data as CFAResult).model\n    for (let fi = 0; fi < nFactors; fi++) {\n      const key = facLabels[fi]!\n      const items = cfaModel[key]\n      if (items) {\n        for (let j = 0; j < items.length; j++) factorItems[fi]!.push(items[j]!)\n      }\n    }\n  } else {\n    for (let i = 0; i < nItems; i++) {\n      const row = data.loadings[i]!\n      let maxF = 0, maxVal = 0\n      for (let f = 0; f < nFactors; f++) {\n        if (Math.abs(row[f]!) > maxVal) { maxVal = Math.abs(row[f]!); maxF = f }\n      }\n      factorItems[maxF]!.push(i)\n    }\n  }\n\n  // \u2500\u2500 Layout from pathStyle \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const groupHeights = factorItems.map(items =>\n    Math.max(items.length * (ps.itemHeight + ps.itemGap) - ps.itemGap, ps.factorRy * 2)\n  )\n  const totalGroupH = groupHeights.reduce((s, h) => s + h, 0) + (nFactors - 1) * ps.factorGroupGap\n\n  const bottomPad = ps.bottomPadding\n\n  // Column X positions\n  const factorCx = ps.covArcReserve + ps.factorRx + 16\n  const itemLeft = factorCx + ps.factorRx + ps.arrowSpan\n  const itemRight = itemLeft + ps.itemWidth\n  const errorCx = showErrors ? itemRight + ps.errorSpan + ps.errorRx : itemRight + 10\n\n  const selfLoopExtra = (showErrors && ps.errorSelfLoop) ? ps.errorSelfLoopSize + 30 : 0\n  const W = config.width ?? (errorCx + (showErrors ? ps.errorRx : 0) + selfLoopExtra + ps.rightPadding)\n  const H = config.height ?? (ps.topPadding + totalGroupH + bottomPad)\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg')\n    .attr('width', W).attr('height', H)\n    .style('background', theme.background)\n    .attr('xmlns', 'http://www.w3.org/2000/svg')\n\n  addSubtitle(\n    svg,\n    config.title ?? (hasCFA ? 'Confirmatory Factor Analysis \u2014 Path Diagram' : 'Exploratory Factor Analysis \u2014 Path Diagram'),\n    data.formatted, W, theme\n  )\n\n  const defs = svg.append('defs')\n  const g = svg.append('g')\n\n  // \u2500\u2500 SVG Defs: filters \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  if (ps.factorGlow) {\n    const glowFilter = defs.append('filter').attr('id', 'fa-glow')\n      .attr('x', '-40%').attr('y', '-40%').attr('width', '180%').attr('height', '180%')\n    glowFilter.append('feGaussianBlur').attr('in', 'SourceGraphic').attr('stdDeviation', ps.factorGlowRadius).attr('result', 'blur')\n    glowFilter.append('feColorMatrix').attr('in', 'blur').attr('type', 'saturate').attr('values', '0.35').attr('result', 'desatBlur')\n    const glowMerge = glowFilter.append('feMerge')\n    glowMerge.append('feMergeNode').attr('in', 'desatBlur')\n    glowMerge.append('feMergeNode').attr('in', 'SourceGraphic')\n  }\n\n  if (ps.showShadows) {\n    const shadowMed = defs.append('filter').attr('id', 'fa-shadow-med')\n      .attr('x', '-20%').attr('y', '-15%').attr('width', '140%').attr('height', '140%')\n    shadowMed.append('feDropShadow').attr('dx', 0).attr('dy', 2).attr('stdDeviation', 4).attr('flood-color', 'rgba(0,0,0,0.10)')\n\n    const shadowSm = defs.append('filter').attr('id', 'fa-shadow-sm')\n      .attr('x', '-10%').attr('y', '-10%').attr('width', '120%').attr('height', '130%')\n    shadowSm.append('feDropShadow').attr('dx', 0).attr('dy', 1).attr('stdDeviation', 2).attr('flood-color', 'rgba(0,0,0,0.07)')\n  }\n\n  // \u2500\u2500 SVG Defs: gradients \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  for (let f = 0; f < nFactors; f++) {\n    const color = fColor(f, ps, theme)\n    const grad = defs.append('radialGradient').attr('id', `fa-fgrad-${f}`)\n      .attr('cx', '35%').attr('cy', '28%').attr('r', '70%')\n    grad.append('stop').attr('offset', '0%').attr('stop-color', '#fff').attr('stop-opacity', 0.55)\n    grad.append('stop').attr('offset', '35%').attr('stop-color', color).attr('stop-opacity', 0.18)\n    grad.append('stop').attr('offset', '100%').attr('stop-color', color).attr('stop-opacity', 0.06)\n\n    if (ps.itemGradient) {\n      const lg = defs.append('linearGradient').attr('id', `fa-igrad-${f}`)\n        .attr('x1', '0%').attr('y1', '0%').attr('x2', '100%').attr('y2', '0%')\n      lg.append('stop').attr('offset', '0%').attr('stop-color', color).attr('stop-opacity', 0.08)\n      lg.append('stop').attr('offset', '100%').attr('stop-color', color).attr('stop-opacity', 0.0)\n    }\n  }\n\n  // \u2500\u2500 SVG Defs: markers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n  const mw = ps.arrowMarkerSize, mh = ps.arrowMarkerSize * 0.7\n  for (let f = 0; f < nFactors; f++) {\n    const color = fColor(f, ps, theme)\n    defs.append('marker')\n      .attr('id', `fa-arr-${f}`)\n      .attr('viewBox', '0 0 10 7').attr('refX', 9.5).attr('refY', 3.5)\n      .attr('markerWidth', mw).attr('markerHeight', mh).attr('orient', 'auto')\n      .append('path').attr('d', 'M0,0.5 L9,3.5 L0,6.5 L2,3.5 Z').attr('fill', color)\n  }\n\n  defs.append('marker')\n    .attr('id', 'fa-arr-ns')\n    .attr('viewBox', '0 0 10 7').attr('refX', 9.5).attr('refY', 3.5)\n    .attr('markerWidth', mw).attr('markerHeight', mh).attr('orient', 'auto')\n    .append('path').attr('d', 'M0,0.5 L9,3.5 L0,6.5 L2,3.5 Z').attr('fill', theme.textMuted)\n\n  // Covariance markers\n  const cmw = ps.covMarkerSize, cmh = ps.covMarkerSize * 0.7\n  defs.append('marker')\n    .attr('id', 'fa-cov-s')\n    .attr('viewBox', '0 0 10 7').attr('refX', 1).attr('refY', 3.5)\n    .attr('markerWidth', cmw).attr('markerHeight', cmh).attr('orient', 'auto')\n    .append('path').attr('d', 'M10,0.5 L1,3.5 L10,6.5 L8,3.5 Z').attr('fill', ps.covColor)\n  defs.append('marker')\n    .attr('id', 'fa-cov-e')\n    .attr('viewBox', '0 0 10 7').attr('refX', 9).attr('refY', 3.5)\n    .attr('markerWidth', cmw).attr('markerHeight', cmh).attr('orient', 'auto')\n    .append('path').attr('d', 'M0,0.5 L9,3.5 L0,6.5 L2,3.5 Z').attr('fill', ps.covColor)\n\n  // Error arrow\n  const emw = ps.errorArrowMarkerSize, emh = ps.errorArrowMarkerSize * 0.7\n  defs.append('marker')\n    .attr('id', 'fa-arr-err')\n    .attr('viewBox', '0 0 10 7').attr('refX', 9).attr('refY', 3.5)\n    .attr('markerWidth', emw).attr('markerHeight', emh).attr('orient', 'auto')\n    .append('path').attr('d', 'M0,0.5 L9,3.5 L0,6.5 L2,3.5 Z').attr('fill', theme.axisLine)\n\n  // \u2500\u2500 Compute Y positions \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const factorCy: number[] = []\n  const itemCy: number[] = new Array(nItems).fill(0)\n  let yAccum = ps.topPadding\n\n  for (let fi = 0; fi < nFactors; fi++) {\n    const items = factorItems[fi]!\n    const gh = groupHeights[fi]!\n    factorCy.push(yAccum + gh / 2)\n    for (let j = 0; j < items.length; j++) {\n      itemCy[items[j]!] = yAccum + j * (ps.itemHeight + ps.itemGap) + ps.itemHeight / 2\n    }\n    yAccum += gh + ps.factorGroupGap\n  }\n\n  // \u2500\u2500 Layer 0: Group bracket lines \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (ps.showGroupBrackets) {\n    for (let fi = 0; fi < nFactors; fi++) {\n      const items = factorItems[fi]!\n      if (items.length < 2) continue\n      const firstY = itemCy[items[0]!]!\n      const lastY = itemCy[items[items.length - 1]!]!\n      g.append('line')\n        .attr('x1', itemLeft - 6).attr('y1', firstY)\n        .attr('x2', itemLeft - 6).attr('y2', lastY)\n        .attr('stroke', fColor(fi, ps, theme)).attr('stroke-width', 1.5)\n        .attr('opacity', ps.groupBracketOpacity).attr('stroke-linecap', 'round')\n    }\n  }\n\n  // \u2500\u2500 Layer 1: Factor covariance arcs (left side) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const Phi = data.factorCorrelations\n  for (let fi = 0; fi < nFactors; fi++) {\n    for (let fj = fi + 1; fj < nFactors; fj++) {\n      const corr = Phi[fi]![fj]!\n      if (Math.abs(corr) < 0.01) continue\n\n      const y1 = factorCy[fi]!, y2 = factorCy[fj]!\n      const span = Math.abs(y2 - y1)\n      const nestLevel = fj - fi\n      const arcX = factorCx - ps.factorRx - 14 - nestLevel * ps.covNestSpacing - span * 0.04\n      const absCorr = Math.abs(corr)\n      const strokeW = ps.covMinWidth + absCorr * (ps.covMaxWidth - ps.covMinWidth)\n\n      const path = `M${factorCx - ps.factorRx - 2},${y1} C${arcX},${y1} ${arcX},${y2} ${factorCx - ps.factorRx - 2},${y2}`\n      g.append('path')\n        .attr('d', path).attr('fill', 'none')\n        .attr('stroke', ps.covColor).attr('stroke-width', strokeW)\n        .attr('stroke-linecap', 'round')\n        .attr('marker-start', 'url(#fa-cov-s)')\n        .attr('marker-end', 'url(#fa-cov-e)')\n\n      // Pill label at B\u00E9zier t=0.5\n      const pillW = 38, pillH = 17\n      const t = 0.5, t1 = 0.5\n      const labelX = t1 * t1 * t1 * (factorCx - ps.factorRx - 2) + 3 * t1 * t1 * t * arcX + 3 * t1 * t * t * arcX + t * t * t * (factorCx - ps.factorRx - 2)\n      const labelY = t1 * t1 * t1 * y1 + 3 * t1 * t1 * t * y1 + 3 * t1 * t * t * y2 + t * t * t * y2\n      g.append('rect')\n        .attr('x', labelX - pillW / 2).attr('y', labelY - pillH / 2)\n        .attr('width', pillW).attr('height', pillH).attr('rx', 8)\n        .attr('fill', theme.background).attr('stroke', theme.gridLine).attr('stroke-width', 0.7)\n      g.append('text')\n        .attr('x', labelX).attr('y', labelY + 3.5)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamilyMono).attr('font-size', ps.covLabelFontSize).attr('font-weight', '600')\n        .attr('fill', ps.covColor)\n        .text(corr.toFixed(dec))\n    }\n  }\n\n  // \u2500\u2500 Layer 2: Loading arrows (factor \u2192 item) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  for (let fi = 0; fi < nFactors; fi++) {\n    const items = factorItems[fi]!\n    const color = fColor(fi, ps, theme)\n\n    for (let idx = 0; idx < items.length; idx++) {\n      const itemIdx = items[idx]!\n      if (itemIdx >= nItems) continue\n      const loading = data.loadings[itemIdx]![fi]!\n      if (Math.abs(loading) < 0.01) continue\n\n      let sig = true\n      let stars = ''\n      if (hasCFA) {\n        const pe = (data as CFAResult).parameterEstimates.loadings[fi]?.[idx]\n        if (pe) {\n          sig = pe.pValue < 0.05\n          stars = pe.pValue < 0.001 ? '***' : pe.pValue < 0.01 ? '**' : pe.pValue < 0.05 ? '*' : ''\n        }\n      }\n\n      const x1 = factorCx + ps.factorRx + 2\n      const y1 = factorCy[fi]!\n      const x2 = itemLeft - 2\n      const y2 = itemCy[itemIdx]!\n      const dy = y2 - y1\n\n      // S-shaped B\u00E9zier controlled by arrowCurvature\n      const curv = ps.arrowCurvature\n      const cp1x = x1 + ps.arrowSpan * curv, cp1y = y1 + dy * 0.05\n      const cp2x = x2 - ps.arrowSpan * (curv * 0.85), cp2y = y2\n\n      const absL = Math.abs(loading)\n      const strokeW = ps.arrowMinWidth + absL * (ps.arrowMaxWidth - ps.arrowMinWidth)\n      const opacity = ps.arrowMinOpacity + absL * (ps.arrowMaxOpacity - ps.arrowMinOpacity)\n      const arrowColor = sig ? color : theme.textMuted\n      const markerId = sig ? `fa-arr-${fi}` : 'fa-arr-ns'\n\n      g.append('path')\n        .attr('d', `M${x1},${y1} C${cp1x},${cp1y} ${cp2x},${cp2y} ${x2},${y2}`)\n        .attr('fill', 'none')\n        .attr('stroke', arrowColor).attr('stroke-width', strokeW)\n        .attr('stroke-linecap', 'round').attr('opacity', opacity)\n        .attr('marker-end', `url(#${markerId})`)\n\n      // Loading label \u2014 clean number directly on the arrow (AMOS-style)\n      const mt = ps.loadingPosition, mt1 = 1 - mt\n      const lx = mt1 * mt1 * mt1 * x1 + 3 * mt1 * mt1 * mt * cp1x + 3 * mt1 * mt * mt * cp2x + mt * mt * mt * x2\n      const ly = mt1 * mt1 * mt1 * y1 + 3 * mt1 * mt1 * mt * cp1y + 3 * mt1 * mt * mt * cp2y + mt * mt * mt * y2\n\n      const labelText = `${loading.toFixed(dec)}${stars}`\n\n      const lbl = g.append('text')\n        .attr('x', lx).attr('y', ly + ps.loadingLabelOffset)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamilyMono).attr('font-size', ps.loadingFontSize)\n        .attr('font-weight', ps.loadingFontWeight)\n        .attr('fill', arrowColor)\n        .text(labelText)\n      if (ps.halo) lbl.attr('paint-order', 'stroke').attr('stroke', ps.haloColor).attr('stroke-width', ps.haloWidth).attr('stroke-linejoin', 'round')\n    }\n  }\n\n  // \u2500\u2500 Layer 2b: Cross-loadings (EFA only, dashed) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (!hasCFA) {\n    for (let i = 0; i < nItems; i++) {\n      const row = data.loadings[i]!\n      let primaryF = 0, maxVal = 0\n      for (let f = 0; f < nFactors; f++) {\n        if (Math.abs(row[f]!) > maxVal) { maxVal = Math.abs(row[f]!); primaryF = f }\n      }\n      for (let f = 0; f < nFactors; f++) {\n        if (f === primaryF) continue\n        if (Math.abs(row[f]!) < ps.crossLoadingThreshold) continue\n        const x1 = factorCx + ps.factorRx + 2, y1 = factorCy[f]!\n        const x2 = itemLeft - 2, y2 = itemCy[i]!\n        const dy = y2 - y1\n        const curv = ps.arrowCurvature\n        g.append('path')\n          .attr('d', `M${x1},${y1} C${x1 + ps.arrowSpan * curv},${y1 + dy * 0.05} ${x2 - ps.arrowSpan * curv * 0.85},${y2} ${x2},${y2}`)\n          .attr('fill', 'none')\n          .attr('stroke', theme.textMuted).attr('stroke-width', 0.9)\n          .attr('stroke-dasharray', ps.crossLoadingDash).attr('opacity', ps.crossLoadingOpacity)\n      }\n    }\n  }\n\n  // \u2500\u2500 Layer 3: Factor ellipses \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  for (let fi = 0; fi < nFactors; fi++) {\n    const cy = factorCy[fi]!\n    const color = fColor(fi, ps, theme)\n\n    if (ps.factorGlow) {\n      g.append('ellipse').attr('cx', factorCx).attr('cy', cy)\n        .attr('rx', ps.factorRx + 4).attr('ry', ps.factorRy + 3)\n        .attr('fill', color).attr('opacity', 0.06)\n        .attr('filter', 'url(#fa-glow)')\n    }\n\n    if (ps.showShadows) {\n      g.append('ellipse').attr('cx', factorCx).attr('cy', cy)\n        .attr('rx', ps.factorRx).attr('ry', ps.factorRy)\n        .attr('fill', 'none').attr('filter', 'url(#fa-shadow-med)')\n        .attr('stroke', 'transparent')\n    }\n\n    g.append('ellipse').attr('cx', factorCx).attr('cy', cy)\n      .attr('rx', ps.factorRx).attr('ry', ps.factorRy)\n      .attr('fill', `url(#fa-fgrad-${fi})`)\n      .attr('stroke', color).attr('stroke-width', ps.factorStroke)\n\n    if (ps.factorHighlight && ps.factorRx > 20 && ps.factorRy > 15) {\n      g.append('ellipse').attr('cx', factorCx).attr('cy', cy - 4)\n        .attr('rx', ps.factorRx - 10).attr('ry', ps.factorRy - 10)\n        .attr('fill', 'none')\n        .attr('stroke', '#fff').attr('stroke-width', 1).attr('opacity', 0.25)\n    }\n\n    g.append('text').attr('x', factorCx).attr('y', cy + 1)\n      .attr('text-anchor', 'middle').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', ps.factorFontSize)\n      .attr('font-weight', ps.factorFontWeight).attr('letter-spacing', '-0.4')\n      .attr('fill', theme.text).text(facLabels[fi] ?? `F${fi + 1}`)\n  }\n\n  // \u2500\u2500 Layer 4: Item rectangles \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  for (let i = 0; i < nItems; i++) {\n    const cy = itemCy[i]!\n    let primaryFactor = 0, primVal = 0\n    for (let f = 0; f < nFactors; f++) {\n      if (Math.abs(data.loadings[i]![f]!) > primVal) { primVal = Math.abs(data.loadings[i]![f]!); primaryFactor = f }\n    }\n    const accentColor = fColor(primaryFactor, ps, theme)\n\n    if (ps.showShadows) {\n      g.append('rect')\n        .attr('x', itemLeft).attr('y', cy - ps.itemHeight / 2)\n        .attr('width', ps.itemWidth).attr('height', ps.itemHeight).attr('rx', ps.itemRadius)\n        .attr('fill', theme.surface).attr('filter', 'url(#fa-shadow-sm)')\n    }\n\n    g.append('rect')\n      .attr('x', itemLeft).attr('y', cy - ps.itemHeight / 2)\n      .attr('width', ps.itemWidth).attr('height', ps.itemHeight).attr('rx', ps.itemRadius)\n      .attr('fill', ps.itemGradient ? `url(#fa-igrad-${primaryFactor})` : theme.background)\n      .attr('stroke', accentColor).attr('stroke-width', ps.itemStroke).attr('stroke-opacity', 0.5)\n\n    if (ps.itemAccentWidth > 0) {\n      g.append('rect')\n        .attr('x', itemLeft).attr('y', cy - ps.itemHeight / 2)\n        .attr('width', ps.itemAccentWidth).attr('height', ps.itemHeight)\n        .attr('rx', Math.min(ps.itemAccentWidth, ps.itemRadius))\n        .attr('fill', accentColor).attr('opacity', 0.85)\n    }\n\n    g.append('text')\n      .attr('x', itemLeft + ps.itemWidth / 2 + ps.itemAccentWidth / 2).attr('y', cy + 1)\n      .attr('text-anchor', 'middle').attr('dominant-baseline', 'middle')\n      .attr('font-family', theme.fontFamily).attr('font-size', ps.itemFontSize)\n      .attr('font-weight', ps.itemFontWeight).attr('fill', theme.text)\n      .text(varLabels[i] ?? `V${i + 1}`)\n\n    // Tooltip hitbox\n    g.append('rect')\n      .attr('x', itemLeft).attr('y', cy - ps.itemHeight / 2)\n      .attr('width', ps.itemWidth).attr('height', ps.itemHeight)\n      .attr('fill', 'transparent').attr('cursor', 'default')\n      .on('mouseover', (event: MouseEvent) => {\n        const rows = facLabels.map((fl, fi) =>\n          formatTooltipRow(fl, data.loadings[i]![fi] ?? 0)\n        ).join('')\n        showTooltip(event, [\n          formatTooltipRow(varLabels[i] ?? `V${i + 1}`, ''),\n          rows,\n          formatTooltipRow('h\u00B2', data.communalities[i] ?? 0),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n  }\n\n  // \u2500\u2500 Layer 5: Error ellipses \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  if (showErrors) {\n    for (let i = 0; i < nItems; i++) {\n      const cy = itemCy[i]!\n      const uniq = data.uniqueness[i] ?? 0\n\n      // Arrow: error \u2192 item (fixed to 1 in CFA for identification)\n      const errArrX1 = errorCx - ps.errorRx - 1\n      const errArrX2 = itemRight + 2\n      g.append('line')\n        .attr('x1', errArrX1).attr('y1', cy)\n        .attr('x2', errArrX2).attr('y2', cy)\n        .attr('stroke', theme.axisLine).attr('stroke-width', ps.errorArrowWidth)\n        .attr('marker-end', 'url(#fa-arr-err)')\n\n      // \"1\" label on the error\u2192item arrow (fixed loading)\n      const errMidX = (errArrX1 + errArrX2) / 2\n      const oneLbl = g.append('text')\n        .attr('x', errMidX).attr('y', cy - 5)\n        .attr('text-anchor', 'middle')\n        .attr('font-family', theme.fontFamilyMono).attr('font-size', ps.errorFontSize)\n        .attr('font-weight', '600').attr('fill', theme.textMuted)\n        .text('1')\n      if (ps.halo) oneLbl.attr('paint-order', 'stroke').attr('stroke', ps.haloColor).attr('stroke-width', ps.haloWidth).attr('stroke-linejoin', 'round')\n\n      g.append('ellipse').attr('cx', errorCx).attr('cy', cy)\n        .attr('rx', ps.errorRx).attr('ry', ps.errorRy)\n        .attr('fill', theme.surface).attr('stroke', theme.axisLine).attr('stroke-width', ps.errorStroke)\n\n      // Self-loop on the outside right of the error ellipse\n      if (ps.errorSelfLoop) {\n        const loopRight = errorCx + ps.errorRx + ps.errorSelfLoopSize\n        g.append('path')\n          .attr('d', `M${errorCx + ps.errorRx},${cy - 3} C${loopRight},${cy - 14} ${loopRight},${cy + 14} ${errorCx + ps.errorRx},${cy + 3}`)\n          .attr('fill', 'none')\n          .attr('stroke', theme.axisLine).attr('stroke-width', ps.errorArrowWidth)\n          .attr('marker-end', 'url(#fa-arr-err)')\n\n        // Uniqueness label next to the self-loop\n        const errLbl = g.append('text')\n          .attr('x', loopRight + 2).attr('y', cy + ps.errorFontSize * 0.35)\n          .attr('text-anchor', 'start')\n          .attr('font-family', theme.fontFamilyMono).attr('font-size', ps.errorFontSize - 0.5)\n          .attr('font-weight', '500').attr('fill', theme.textMuted)\n          .text(uniq.toFixed(dec))\n        if (ps.halo) errLbl.attr('paint-order', 'stroke').attr('stroke', ps.haloColor).attr('stroke-width', ps.haloWidth).attr('stroke-linejoin', 'round')\n      }\n\n      g.append('text').attr('x', errorCx).attr('y', cy + 1)\n        .attr('text-anchor', 'middle').attr('dominant-baseline', 'middle')\n        .attr('font-family', theme.fontFamilyMono).attr('font-size', ps.errorFontSize)\n        .attr('font-weight', '600').attr('fill', theme.textMuted)\n        .text(`e${i + 1}`)\n    }\n  }\n\n  // \u2500\u2500 Layer 6: Fit indices \u2014 publication table below diagram \u2500\u2500\u2500\u2500\u2500\n  if (showFit) {\n    const fit = data.fit\n    const fitColor = (good: boolean, ok: boolean) =>\n      good ? '#2e7d32' : ok ? '#e65100' : '#c62828'\n\n    const table = d3.select(container).append('table')\n      .style('border-collapse', 'collapse')\n      .style('margin', '12px auto 4px')\n      .style('font-family', theme.fontFamilyMono)\n      .style('font-size', '12px')\n      .style('color', theme.text)\n      .style('min-width', '420px')\n\n    // Header\n    const thead = table.append('thead')\n    const headerRow = thead.append('tr')\n      .style('border-bottom', `2px solid ${theme.text}`)\n    const headers = ['Index', 'Value', '90% CI', 'Verdict']\n    headers.forEach(h => {\n      headerRow.append('th')\n        .style('padding', '6px 14px')\n        .style('text-align', h === 'Index' ? 'left' : 'right')\n        .style('font-weight', '700')\n        .style('font-size', '11px')\n        .style('letter-spacing', '0.5px')\n        .style('color', theme.textMuted)\n        .text(h)\n    })\n\n    const tbody = table.append('tbody')\n\n    const fitRows: Array<{\n      label: string; value: string; ci: string; verdict: string; color: string\n    }> = [\n      {\n        label: '\u03C7\u00B2',\n        value: `${formatStat(fit.chiSq)} (df = ${fit.df})`,\n        ci: '',\n        verdict: `${formatP(fit.pValue)}`,\n        color: theme.textAnnotation,\n      },\n      {\n        label: 'RMSEA',\n        value: formatStat(fit.rmsea, 3),\n        ci: `[${formatStat(fit.rmseaCI[0], 3)}, ${formatStat(fit.rmseaCI[1], 3)}]`,\n        verdict: fit.rmsea <= 0.05 ? 'Good' : fit.rmsea <= 0.08 ? 'Acceptable' : 'Poor',\n        color: fitColor(fit.rmsea <= 0.05, fit.rmsea <= 0.08),\n      },\n      {\n        label: 'CFI',\n        value: formatStat(fit.cfi, 3),\n        ci: '',\n        verdict: fit.cfi >= 0.95 ? 'Good' : fit.cfi >= 0.90 ? 'Acceptable' : 'Poor',\n        color: fitColor(fit.cfi >= 0.95, fit.cfi >= 0.90),\n      },\n      {\n        label: 'TLI',\n        value: formatStat(fit.tli, 3),\n        ci: '',\n        verdict: fit.tli >= 0.95 ? 'Good' : fit.tli >= 0.90 ? 'Acceptable' : 'Poor',\n        color: fitColor(fit.tli >= 0.95, fit.tli >= 0.90),\n      },\n      {\n        label: 'SRMR',\n        value: formatStat(fit.srmr, 3),\n        ci: '',\n        verdict: fit.srmr <= 0.05 ? 'Good' : fit.srmr <= 0.08 ? 'Acceptable' : 'Poor',\n        color: fitColor(fit.srmr <= 0.05, fit.srmr <= 0.08),\n      },\n      {\n        label: 'AIC',\n        value: formatStat(fit.aic, 1),\n        ci: '',\n        verdict: '',\n        color: theme.textAnnotation,\n      },\n      {\n        label: 'BIC',\n        value: formatStat(fit.bic, 1),\n        ci: '',\n        verdict: '',\n        color: theme.textAnnotation,\n      },\n    ]\n\n    fitRows.forEach((row, i) => {\n      const tr = tbody.append('tr')\n        .style('border-bottom', i < fitRows.length - 1 ? `1px solid ${theme.gridLine}` : 'none')\n\n      tr.append('td')\n        .style('padding', '5px 14px')\n        .style('font-weight', '600')\n        .style('white-space', 'nowrap')\n        .text(row.label)\n\n      tr.append('td')\n        .style('padding', '5px 14px')\n        .style('text-align', 'right')\n        .style('font-weight', '500')\n        .text(row.value)\n\n      tr.append('td')\n        .style('padding', '5px 14px')\n        .style('text-align', 'right')\n        .style('color', theme.textMuted)\n        .style('font-size', '11px')\n        .text(row.ci)\n\n      const verdictCell = tr.append('td')\n        .style('padding', '5px 14px')\n        .style('text-align', 'right')\n        .style('font-weight', '700')\n        .style('color', row.color)\n\n      if (row.verdict) {\n        verdictCell.append('span')\n          .style('display', 'inline-block')\n          .style('width', '8px')\n          .style('height', '8px')\n          .style('border-radius', '50%')\n          .style('background', row.color)\n          .style('margin-right', '6px')\n          .style('vertical-align', 'middle')\n        verdictCell.append('span')\n          .style('vertical-align', 'middle')\n          .text(row.verdict)\n      }\n    })\n  }\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Plot 4: Communality Bar Chart \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderCommunality(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const dec = config.decimals ?? 2\n  const nItems = data.communalities.length\n  const W = config.width ?? 500\n  const H = config.height ?? Math.max(nItems * 28 + 120, 250)\n  const margin = { top: theme.marginTop, right: 70, bottom: theme.marginBottom, left: 110 }\n  const width = W - margin.left - margin.right\n  const height = H - margin.top - margin.bottom\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'Communalities', data.formatted, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const varLabels = config.variableLabels ?? data.variableNames\n\n  // Sort by communality descending\n  const indices = Array.from({ length: nItems }, (_, i) => i)\n  indices.sort((a, b) => (data.communalities[b] ?? 0) - (data.communalities[a] ?? 0))\n\n  const names = indices.map(i => varLabels[i] ?? `V${i + 1}`)\n  const values = indices.map(i => data.communalities[i] ?? 0)\n\n  const xScale = d3.scaleLinear().domain([0, 1]).range([0, width]).nice()\n  const yScale = d3.scaleBand<string>().domain(names).range([0, height]).padding(0.25)\n\n  // Color scale: red (0) \u2192 amber (0.4) \u2192 green (1.0)\n  const commColor = (v: number) => {\n    if (v < 0.3) return '#e15759'\n    if (v < 0.5) return '#f28e2b'\n    return '#59a14f'\n  }\n\n  // Gridlines\n  g.selectAll('.grid').data(xScale.ticks(5)).join('line')\n    .attr('x1', d => xScale(d)).attr('x2', d => xScale(d))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.gridLine).attr('stroke-width', 1)\n\n  // Reference line at 0.4\n  g.append('line')\n    .attr('x1', xScale(0.4)).attr('x2', xScale(0.4))\n    .attr('y1', 0).attr('y2', height)\n    .attr('stroke', theme.axisLine).attr('stroke-dasharray', '6,3').attr('stroke-width', 1.5)\n\n  // Bars\n  values.forEach((val, i) => {\n    const y = yScale(names[i]!) ?? 0\n    g.append('rect')\n      .attr('x', 0).attr('y', y)\n      .attr('width', xScale(val)).attr('height', yScale.bandwidth())\n      .attr('fill', commColor(val)).attr('opacity', 0.8).attr('rx', 2)\n      .on('mouseover', (event: MouseEvent) => {\n        const origIdx = indices[i]!\n        showTooltip(event, [\n          formatTooltipRow('Variable', varLabels[origIdx] ?? `V${origIdx + 1}`),\n          formatTooltipRow('Communality', val),\n          formatTooltipRow('Uniqueness', data.uniqueness[origIdx] ?? 0),\n        ].join(''), theme)\n      })\n      .on('mouseout', hideTooltip)\n\n    // Value at bar end\n    g.append('text')\n      .attr('x', xScale(val) + 4).attr('y', y + yScale.bandwidth() / 2 + 4)\n      .attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall - 1)\n      .attr('fill', theme.text).text(val.toFixed(dec))\n  })\n\n  // Axes\n  g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(5))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n  g.append('g').call(d3.axisLeft(yScale))\n    .selectAll('text').attr('fill', theme.text).attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize)\n\n  g.append('text').attr('x', width / 2).attr('y', height + 44).attr('text-anchor', 'middle')\n    .attr('font-family', theme.fontFamily).attr('font-size', theme.fontSize).attr('fill', theme.text).text('Communality (h\u00B2)')\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Plot 5: Factor Correlation Matrix \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderFactorCorrelation(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const dec = config.decimals ?? 2\n  const Phi = data.factorCorrelations\n  const k = data.nFactors\n  const facLabels = config.factorLabels ?? data.factorNames\n\n  // Check if orthogonal (identity matrix)\n  let isOrthogonal = true\n  for (let i = 0; i < k && isOrthogonal; i++) {\n    for (let j = 0; j < k && isOrthogonal; j++) {\n      if (i !== j && Math.abs(Phi[i]![j]!) > 0.001) isOrthogonal = false\n    }\n  }\n\n  const cellSize = 60\n  const W = config.width ?? (k * cellSize + 140)\n  const H = config.height ?? (k * cellSize + 120)\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'Factor Correlations (\u03A6)', data.rotation === 'varimax' ? 'Orthogonal rotation \u2014 \u03A6 = I' : '', W, theme)\n\n  if (isOrthogonal) {\n    svg.append('text')\n      .attr('x', W / 2).attr('y', H / 2)\n      .attr('text-anchor', 'middle').attr('font-size', 14)\n      .attr('fill', theme.textMuted)\n      .text('Orthogonal rotation: all factor correlations = 0')\n    return\n  }\n\n  const margin = { top: 60, right: 20, bottom: 20, left: 80 }\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const colorScale = d3.scaleSequential().domain([-1, 1]).interpolator(d3.interpolateRdBu)\n\n  for (let i = 0; i < k; i++) {\n    for (let j = 0; j < k; j++) {\n      const val = Phi[i]![j]!\n      g.append('rect')\n        .attr('x', j * cellSize).attr('y', i * cellSize)\n        .attr('width', cellSize - 2).attr('height', cellSize - 2).attr('rx', 3)\n        .attr('fill', i === j ? theme.surface : colorScale(val))\n        .on('mouseover', (event: MouseEvent) => {\n          if (i !== j) {\n            showTooltip(event, [\n              formatTooltipRow(`${facLabels[i]} \u00D7 ${facLabels[j]}`, ''),\n              formatTooltipRow('r', val),\n            ].join(''), theme)\n          }\n        })\n        .on('mouseout', hideTooltip)\n\n      if (i !== j) {\n        g.append('text')\n          .attr('x', j * cellSize + cellSize / 2).attr('y', i * cellSize + cellSize / 2 + 4)\n          .attr('text-anchor', 'middle')\n          .attr('font-family', theme.fontFamilyMono).attr('font-size', 12)\n          .attr('fill', Math.abs(val) > 0.6 ? '#fff' : theme.text)\n          .text(val.toFixed(dec))\n      }\n    }\n  }\n\n  // Labels\n  facLabels.forEach((lbl, i) => {\n    g.append('text').attr('x', -6).attr('y', i * cellSize + cellSize / 2 + 4)\n      .attr('text-anchor', 'end').attr('font-size', theme.fontSizeSmall).attr('fill', theme.text).text(lbl)\n    g.append('text').attr('x', i * cellSize + cellSize / 2).attr('y', -8)\n      .attr('text-anchor', 'middle').attr('font-size', theme.fontSizeSmall).attr('fill', theme.text).text(lbl)\n  })\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n\n// \u2500\u2500\u2500 Plot 6: Fit Indices Dashboard \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderFitIndices(\n  d3: typeof D3,\n  container: HTMLElement,\n  data: FAResult,\n  config: FAPlotConfig\n): void {\n  const theme = config.theme ?? DEFAULT_THEME\n  const W = config.width ?? 500, H = config.height ?? 340\n  const margin = { top: theme.marginTop, right: 40, bottom: 50, left: 80 }\n  const width = W - margin.left - margin.right\n\n  container.innerHTML = ''\n  applyTheme(container, theme)\n\n  const svg = d3.select(container).append('svg').attr('width', W).attr('height', H).style('background', theme.background)\n  addSubtitle(svg, config.title ?? 'Model Fit Indices', data.formatted, W, theme)\n\n  const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)\n\n  const fit = data.fit\n\n  // Gauge definitions: { label, value, range, goodThreshold, okThreshold, reversed }\n  const gauges = [\n    { label: 'RMSEA', value: fit.rmsea, range: [0, 0.15] as const, good: 0.05, ok: 0.08, reversed: true, ci: fit.rmseaCI },\n    { label: 'CFI', value: fit.cfi, range: [0.8, 1.0] as const, good: 0.95, ok: 0.90, reversed: false },\n    { label: 'TLI', value: fit.tli, range: [0.8, 1.0] as const, good: 0.95, ok: 0.90, reversed: false },\n    { label: 'SRMR', value: fit.srmr, range: [0, 0.12] as const, good: 0.05, ok: 0.08, reversed: true },\n  ]\n\n  const barH = 24\n  const gap = 50\n  const startY = 10\n\n  gauges.forEach((gauge, i) => {\n    const y = startY + i * gap\n\n    const xScale = d3.scaleLinear()\n      .domain([gauge.range[0], gauge.range[1]])\n      .range([0, width]).clamp(true)\n\n    // Background zones\n    if (gauge.reversed) {\n      // Good (left) \u2192 OK (mid) \u2192 Poor (right)\n      g.append('rect').attr('x', 0).attr('y', y).attr('width', xScale(gauge.good)).attr('height', barH)\n        .attr('fill', '#59a14f').attr('opacity', 0.15).attr('rx', 4)\n      g.append('rect').attr('x', xScale(gauge.good)).attr('y', y)\n        .attr('width', xScale(gauge.ok) - xScale(gauge.good)).attr('height', barH)\n        .attr('fill', '#f28e2b').attr('opacity', 0.15)\n      g.append('rect').attr('x', xScale(gauge.ok)).attr('y', y)\n        .attr('width', width - xScale(gauge.ok)).attr('height', barH)\n        .attr('fill', '#e15759').attr('opacity', 0.15).attr('rx', 4)\n    } else {\n      // Poor (left) \u2192 OK (mid) \u2192 Good (right)\n      g.append('rect').attr('x', 0).attr('y', y).attr('width', xScale(gauge.ok)).attr('height', barH)\n        .attr('fill', '#e15759').attr('opacity', 0.15).attr('rx', 4)\n      g.append('rect').attr('x', xScale(gauge.ok)).attr('y', y)\n        .attr('width', xScale(gauge.good) - xScale(gauge.ok)).attr('height', barH)\n        .attr('fill', '#f28e2b').attr('opacity', 0.15)\n      g.append('rect').attr('x', xScale(gauge.good)).attr('y', y)\n        .attr('width', width - xScale(gauge.good)).attr('height', barH)\n        .attr('fill', '#59a14f').attr('opacity', 0.15).attr('rx', 4)\n    }\n\n    // Threshold lines\n    g.append('line').attr('x1', xScale(gauge.good)).attr('x2', xScale(gauge.good))\n      .attr('y1', y).attr('y2', y + barH)\n      .attr('stroke', theme.axisLine).attr('stroke-dasharray', '2,2').attr('stroke-width', 1)\n    g.append('line').attr('x1', xScale(gauge.ok)).attr('x2', xScale(gauge.ok))\n      .attr('y1', y).attr('y2', y + barH)\n      .attr('stroke', theme.axisLine).attr('stroke-dasharray', '2,2').attr('stroke-width', 1)\n\n    // CI range for RMSEA\n    if ('ci' in gauge && gauge.ci) {\n      const ciLo = gauge.ci[0]\n      const ciHi = gauge.ci[1]\n      g.append('rect')\n        .attr('x', xScale(ciLo)).attr('y', y + barH / 2 - 3)\n        .attr('width', xScale(ciHi) - xScale(ciLo)).attr('height', 6)\n        .attr('fill', getColor(0, theme)).attr('opacity', 0.3).attr('rx', 2)\n    }\n\n    // Value marker\n    const valColor = gauge.reversed\n      ? (gauge.value <= gauge.good ? '#59a14f' : gauge.value <= gauge.ok ? '#f28e2b' : '#e15759')\n      : (gauge.value >= gauge.good ? '#59a14f' : gauge.value >= gauge.ok ? '#f28e2b' : '#e15759')\n\n    g.append('circle')\n      .attr('cx', xScale(gauge.value)).attr('cy', y + barH / 2)\n      .attr('r', 6).attr('fill', valColor).attr('stroke', '#fff').attr('stroke-width', 2)\n\n    // Label\n    g.append('text').attr('x', -6).attr('y', y + barH / 2 + 4)\n      .attr('text-anchor', 'end').attr('font-size', theme.fontSizeSmall)\n      .attr('font-weight', '600').attr('fill', theme.text).text(gauge.label)\n\n    // Value\n    g.append('text').attr('x', width + 6).attr('y', y + barH / 2 + 4)\n      .attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall)\n      .attr('fill', valColor).attr('font-weight', '600').text(gauge.value.toFixed(3))\n  })\n\n  // Chi-square + AIC/BIC text below\n  const textY = startY + gauges.length * gap + 10\n  g.append('text').attr('x', 0).attr('y', textY)\n    .attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall)\n    .attr('fill', theme.textAnnotation)\n    .text(`\u03C7\u00B2(${fit.df}) = ${formatStat(fit.chiSq)}, ${formatP(fit.pValue)}`)\n  g.append('text').attr('x', 0).attr('y', textY + 16)\n    .attr('font-family', theme.fontFamilyMono).attr('font-size', theme.fontSizeSmall)\n    .attr('fill', theme.textAnnotation)\n    .text(`AIC = ${formatStat(fit.aic, 1)}, BIC = ${formatStat(fit.bic, 1)}`)\n\n  if (config.caption) addCaption(svg, config.caption, W, H, theme)\n}\n", "/**\n * SVG + PNG export for Carm plots.\n * Exports at publication quality (300 DPI for PNG).\n */\n\n/** Download SVG source of a plot container. */\nexport function exportSVG(container: HTMLElement, filename = 'carm-plot.svg'): void {\n  const svgEl = container.querySelector('svg')\n  if (!svgEl) throw new Error('exportSVG: no SVG element found in container')\n\n  // Add xmlns if missing\n  if (!svgEl.hasAttribute('xmlns')) {\n    svgEl.setAttribute('xmlns', 'http://www.w3.org/2000/svg')\n  }\n\n  const serializer = new XMLSerializer()\n  const svgStr = serializer.serializeToString(svgEl)\n  const blob = new Blob([svgStr], { type: 'image/svg+xml;charset=utf-8' })\n  triggerDownload(URL.createObjectURL(blob), filename)\n}\n\n/** Export plot container as PNG at specified DPI (default 300). */\nexport function exportPNG(\n  container: HTMLElement,\n  filename = 'carm-plot.png',\n  dpi = 300\n): Promise<void> {\n  const svgEl = container.querySelector('svg')\n  if (!svgEl) throw new Error('exportPNG: no SVG element found in container')\n\n  const svgW = svgEl.viewBox.baseVal.width || svgEl.clientWidth\n  const svgH = svgEl.viewBox.baseVal.height || svgEl.clientHeight\n  const scale = dpi / 96  // 96 = screen DPI\n\n  const canvas = document.createElement('canvas')\n  canvas.width = svgW * scale\n  canvas.height = svgH * scale\n  const ctx = canvas.getContext('2d')!\n  ctx.scale(scale, scale)\n\n  if (!svgEl.hasAttribute('xmlns')) svgEl.setAttribute('xmlns', 'http://www.w3.org/2000/svg')\n  const svgStr = new XMLSerializer().serializeToString(svgEl)\n  const blob = new Blob([svgStr], { type: 'image/svg+xml;charset=utf-8' })\n  const url = URL.createObjectURL(blob)\n\n  return new Promise((resolve, reject) => {\n    const img = new Image()\n    img.onload = () => {\n      ctx.drawImage(img, 0, 0)\n      URL.revokeObjectURL(url)\n      canvas.toBlob(pngBlob => {\n        if (!pngBlob) { reject(new Error('Canvas toBlob failed')); return }\n        triggerDownload(URL.createObjectURL(pngBlob), filename)\n        resolve()\n      }, 'image/png')\n    }\n    img.onerror = () => { URL.revokeObjectURL(url); reject(new Error('SVG to Image conversion failed')) }\n    img.src = url\n  })\n}\n\nfunction triggerDownload(url: string, filename: string): void {\n  const a = document.createElement('a')\n  a.href = url\n  a.download = filename\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  setTimeout(() => URL.revokeObjectURL(url), 1000)\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACMO,IAAM,SAAN,MAAM,QAAO;AAAA,EACT;AAAA,EAC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",
  "names": ["_", "gamma", "a", "rank", "i", "gamma", "_", "se", "se", "_", "mu", "eta", "w", "sqrtW", "Xw", "erf", "p", "gammas", "probs", "se", "erf", "cov", "ss", "formatted", "rows", "ssA", "ssB", "ssAB", "dfA", "dfB", "dfAB", "dfResid", "msResid", "ssTotal", "se", "rank", "se", "_", "colMeans", "colSDs", "ss", "_", "Z", "unique", "result", "cov", "_", "logBeta", "gamma", "_", "L", "ss", "gamma", "s", "loadingSE", "thetaSE", "phiSE", "variance", "se", "se", "prevStage", "mean", "pseudoRnd", "pearsonR", "color", "n", "renderScree"]
}
